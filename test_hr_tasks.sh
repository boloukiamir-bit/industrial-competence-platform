#!/bin/bash
# Test /api/hr/tasks with same cookie pattern as test_inbox.sh.
# Requires: dev server on :5001, valid COOKIE for org a1b2c3d4-e5f6-7890-abcd-ef1234567890.

NADIPLAN_ORG="a1b2c3d4-e5f6-7890-abcd-ef1234567890"
# Use sb auth token from test_inbox.sh or export COOKIE before running.
if [ -z "$SB_AUTH_TOKEN" ]; then
  SB_AUTH_TOKEN="base64-eyJhY2Nlc3NfdG9rZW4iOiJleUpoYkdjaU9pSklVekkxTmlJc0ltdHBaQ0k2SWt0S2Vtc3lhVzQyUW1kbFVVTXpPSGtpTENKMGVYQWlPaUpLVjFRaWZRLmV5SnBjM01pT2lKb2RIUndjem92TDJKdGRtRjNabkp1YkhCa2RtTnRabVp4Y25wakxuTjFjR0ZpWVhObExtTnZMMkYxZEdndmRqRWlMQ0p6ZFdJaU9pSTNORFF3WVRGbU9TMW1OR0V6TFRReFlUQXRPRE16TWkwek1qQmtZemN4TXpVelkyVWlMQ0poZFdRaU9pSmhkWFJvWlc1MGFXTmhkR1ZrSWl3aVpYaHdJam94TnpZNU5URXhOakkwTENKcFlYUWlPakUzTmprMU1EZ3dNalFzSW1WdFlXbHNJam9pWVcxcGNrQmliMnh2ZFd0cExuTmxJaXdpY0dodmJtVWlPaUlpTENKaGNIQmZiV1YwWVdSaGRHRWlPbnNpY0hKdmRtbGtaWElpT2lKbGJXRnBiQ0lzSW5CeWIzWnBaR1Z5Y3lJNld5SmxiV0ZwYkNKZGZTd2lkWE5sY2w5dFpYUmhaR0YwWVNJNmV5SmxiV0ZwYkNJNkltRnRhWEpBWW05c2IzVnJhUzV6WlNJc0ltVnRZV2xzWDNabGNtbG1hV1ZrSWpwMGNuVmxMQ0p3YUc5dVpWOTJaWEpwWm1sbFpDSTZabUZzYzJVc0luTjFZaUk2SWpjME5EQmhNV1k1TFdZMFlUTXROREZoTUMwNE16TXlMVE15TUdSak56RXpOVE5qWlNKOUxDSnliMnhsSWpvaVlYVjBhR1Z1ZEdsallYUmxaQ0lzSW1GaGJDSTZJbUZoYkRFaUxDSmhiWElpT2x0N0ltMWxkR2h2WkNJNkluQmhjM04zYjNKa0lpd2lkR2x0WlhOMFlXMXdJam94TnpZNU5EVTROamN3ZlYwc0luTmxjM05wYjI1ZmFXUWlPaUkwWWpreU5qa3dNaTA1TjJKaUxUUXpNVGN0WWpBMFppMWxORFU1T0RBMk5qTTBZemtpTENKcGMxOWhibTl1ZVcxdmRYTWlPbVpoYkhObGZRLmxsb0xJZVBSbmVjQkRZOG5jWjUzNE1CSkZpV3gxdmNWcmtNeWR4RjczNUkiLCJ0b2tlbl90eXBlIjoiYmVhcmVyIiwiZXhwaXJlc19pbiI6MzYwMCwiZXhwaXJlc19hdCI6MTc2OTUxMTYyNCwicmVmcmVzaF90b2tlbiI6Im5xZXJnbXpmc3o3YyIsInVzZXIiOnsiaWQiOiI3NDQwYTFmOS1mNGEzLTQxYTAtODMzMi0zMjBkYzcxMzUzY2UiLCJhdWQiOiJhdXRoZW50aWNhdGVkIiwicm9sZSI6ImF1dGhlbnRpY2F0ZWQiLCJlbWFpbCI6ImFtaXJAYm9sb3VraS5zZSIsImVtYWlsX2NvbmZpcm1lZF9hdCI6IjIwMjYtMDEtMTVUMTM6MTE6MTYuMDc0MTRaIiwicGhvbmUiOiIiLCJjb25maXJtYXRpb25fc2VudF9hdCI6IjIwMjYtMDEtMTVUMTM6MTA6NTAuMTY1ODhaIiwiY29uZmlybWVkX2F0IjoiMjAyNi0wMS0xNVQxMzoxMToxNi4wNzQxNFoiLCJsYXN0X3NpZ25faW5fYXQiOiIyMDI2LTAxLTI2VDIwOjE4OjI1LjgxNTQxN1oiLCJhcHBfbWV0YWRhdGEiOnsicHJvdmlkZXIiOiJlbWFpbCIsInByb3ZpZGVycyI6WyJlbWFpbCJdfSwidXNlcl9tZXRhZGF0YSI6eyJlbWFpbCI6ImFtaXJAYm9sb3VraS5zZSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJwaG9uZV92ZXJpZmllZCI6ZmFsc2UsInN1YiI6Ijc0NDBhMWY5LWY0YTMtNDFhMC04MzMyLTMyMGRjNzEzNTNjZSJ9LCJpZGVudGl0aWVzIjpbeyJpZGVudGl0eV9pZCI6ImJhNTE0MTExLTdhYmMtNGQzNC04NTkxLWFlYmY2ZGQ4YmFhNyIsImlkIjoiNzQ0MGExZjktZjRhMy00MWEwLTgzMzItMzIwZGM3MTM1M2NlIiwidXNlcl9pZCI6Ijc0NDBhMWY5LWY0YTMtNDFhMC04MzMyLTMyMGRjNzEzNTNjZSIsImlkZW50aXR5X2RhdGEiOnsiZW1haWwiOiJhbWlyQGJvbG91a2kuc2UiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwicGhvbmVfdmVyaWZpZWQiOmZhbHNlLCJzdWIiOiI3NDQwYTFmOS1mNGEzLTQxYTAtODMzMi0zMjBkYzcxMzUzY2UifSwicHJvdmlkZXIiOiJlbWFpbCIsImxhc3Rfc2lnbl9pbl9hdCI6IjIwMjYtMDEtMTVUMTM6MTA6NTAuMTYyNDU4WiIsImNyZWF0ZWRfYXQiOiIyMDI2LTAxLTE1VDEzOjEwOjUwLjE2MjUwNVoiLCJ1cGRhdGVkX2F0IjoiMjAyNi0wMS0xNVQxMzoxMDo1MC4xNjI1MDVaIiwiZW1haWwiOiJhbWlyQGJvbG91a2kuc2UifV0sImNyZWF0ZWRfYXQiOiIyMDI2LTAxLTE1VDEzOjEwOjUwLjE1NTM2M1oiLCJ1cGRhdGVkX2F0IjoiMjAyNi0wMS0yN1QxMDowMDoxNy4zMDIzMDJaIiwiaXNfYW5vbnltb3VzIjpmYWxzZX19"
fi
COOKIE="${COOKIE:-nadiplan_current_org=${NADIPLAN_ORG}; sb-bmvawfrnlpdvcmffqrzc-auth-token=${SB_AUTH_TOKEN}}"

echo "GET /api/hr/tasks with Cookie (org=${NADIPLAN_ORG})"
curl -sS -i \
  -H "Accept: application/json" \
  -H "Cookie: ${COOKIE}" \
  "http://localhost:5001/api/hr/tasks" 2>&1 | head -80
