{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/components/WhatToFixSummary.tsx"],"sourcesContent":["import React from \"react\";\n\ntype GapItem = {\n  line: string;\n  role: string;\n  skill: string;\n  missingCount: number;\n};\n\ntype TrainingItem = {\n  skill: string;\n  countLevel0or1: number;\n};\n\ntype OverstaffedItem = {\n  skill: string;\n  countLevel3or4: number;\n};\n\ntype WhatToFixSummaryProps = {\n  criticalGaps: GapItem[];\n  trainingPriorities: TrainingItem[];\n  overstaffedSkills: OverstaffedItem[];\n};\n\nexport const WhatToFixSummary: React.FC<WhatToFixSummaryProps> = ({\n  criticalGaps,\n  trainingPriorities,\n  overstaffedSkills,\n}) => {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n      {/* Critical Gaps */}\n      <div className=\"rounded-xl border border-red-200 bg-red-50 p-4\">\n        <h3 className=\"font-semibold text-red-800 mb-2\">Critical Gaps</h3>\n        {criticalGaps.length === 0 && (\n          <p className=\"text-sm text-red-700\">\n            Inga kritiska gaps för imorgon.\n          </p>\n        )}\n        {criticalGaps.slice(0, 5).map((g, idx) => (\n          <div key={idx} className=\"text-xs text-red-900 mb-1\">\n            <span className=\"font-semibold\">{g.line}</span>\n            {\" – \"}\n            <span>{g.role}</span>\n            {\": \"}\n            <span>{g.skill}</span>\n            {\" (saknas \"}\n            <span className=\"font-semibold\">{g.missingCount}</span>\n            {\")\"}\n          </div>\n        ))}\n      </div>\n\n      {/* Training Priorities */}\n      <div className=\"rounded-xl border border-yellow-200 bg-yellow-50 p-4\">\n        <h3 className=\"font-semibold text-yellow-800 mb-2\">\n          Training Priorities\n        </h3>\n        {trainingPriorities.length === 0 && (\n          <p className=\"text-sm text-yellow-700\">\n            Inga tydliga utbildningsbehov.\n          </p>\n        )}\n        {trainingPriorities.slice(0, 5).map((t, idx) => (\n          <div key={idx} className=\"text-xs text-yellow-900 mb-1\">\n            <span className=\"font-semibold\">{t.skill}</span>\n            {\": \"}\n            <span>{t.countLevel0or1}</span> personer på nivå 0–1\n          </div>\n        ))}\n      </div>\n\n      {/* Overstaffed Skills */}\n      <div className=\"rounded-xl border border-blue-200 bg-blue-50 p-4\">\n        <h3 className=\"font-semibold text-blue-800 mb-2\">Overstaffed Skills</h3>\n        {overstaffedSkills.length === 0 && (\n          <p className=\"text-sm text-blue-700\">\n            Ingen överkapacitet identifierad.\n          </p>\n        )}\n        {overstaffedSkills.slice(0, 5).map((o, idx) => (\n          <div key={idx} className=\"text-xs text-blue-900 mb-1\">\n            <span className=\"font-semibold\">{o.skill}</span>\n            {\": \"}\n            <span>{o.countLevel3or4}</span> personer på nivå 3–4\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;;AAyBO,MAAM,mBAAoD,CAAC,EAChE,YAAY,EACZ,kBAAkB,EAClB,iBAAiB,EAClB;IACC,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,WAAU;kCAAkC;;;;;;oBAC/C,aAAa,MAAM,KAAK,mBACvB,6LAAC;wBAAE,WAAU;kCAAuB;;;;;;oBAIrC,aAAa,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,GAAG,oBAChC,6LAAC;4BAAc,WAAU;;8CACvB,6LAAC;oCAAK,WAAU;8CAAiB,EAAE,IAAI;;;;;;gCACtC;8CACD,6LAAC;8CAAM,EAAE,IAAI;;;;;;gCACZ;8CACD,6LAAC;8CAAM,EAAE,KAAK;;;;;;gCACb;8CACD,6LAAC;oCAAK,WAAU;8CAAiB,EAAE,YAAY;;;;;;gCAC9C;;2BARO;;;;;;;;;;;0BAcd,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,WAAU;kCAAqC;;;;;;oBAGlD,mBAAmB,MAAM,KAAK,mBAC7B,6LAAC;wBAAE,WAAU;kCAA0B;;;;;;oBAIxC,mBAAmB,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,GAAG,oBACtC,6LAAC;4BAAc,WAAU;;8CACvB,6LAAC;oCAAK,WAAU;8CAAiB,EAAE,KAAK;;;;;;gCACvC;8CACD,6LAAC;8CAAM,EAAE,cAAc;;;;;;gCAAQ;;2BAHvB;;;;;;;;;;;0BASd,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,WAAU;kCAAmC;;;;;;oBAChD,kBAAkB,MAAM,KAAK,mBAC5B,6LAAC;wBAAE,WAAU;kCAAwB;;;;;;oBAItC,kBAAkB,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,GAAG,oBACrC,6LAAC;4BAAc,WAAU;;8CACvB,6LAAC;oCAAK,WAAU;8CAAiB,EAAE,KAAK;;;;;;gCACvC;8CACD,6LAAC;8CAAM,EAAE,cAAc;;;;;;gCAAQ;;2BAHvB;;;;;;;;;;;;;;;;;AASpB;KAlEa"}},
    {"offset": {"line": 201, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/services/competence.ts"],"sourcesContent":["// services/competence.ts\nimport { supabase } from \"@/lib/supabaseClient\";\n\nexport type EmployeeCompetenceItem = {\n  competenceId: string;\n  competenceName: string;\n  competenceCode: string | null;\n  groupName: string | null;\n  requiredLevel: number | null;\n  mandatory: boolean;\n  employeeLevel: number | null;\n  validTo: string | null;\n  status: \"OK\" | \"RISK\" | \"N/A\";\n  riskReason: string | null;\n  isSafetyCritical: boolean;\n};\n\nexport type EmployeeCompetenceSummary = {\n  riskLevel: \"LOW\" | \"MEDIUM\" | \"HIGH\";\n  gapCount: number;\n  totalRequired: number;\n  coveragePercent: number; // 0–100\n  expiredCount: number;\n};\n\nexport type EmployeeCompetenceProfile = {\n  employee: {\n    id: string;\n    name: string;\n    positionName: string | null;\n  };\n  summary: EmployeeCompetenceSummary;\n  items: EmployeeCompetenceItem[];\n};\n\nexport type PositionSummary = {\n  id: string;\n  name: string;\n  site: string | null;\n  department: string | null;\n};\n\nexport type SimpleEmployee = {\n  id: string;\n  name: string;\n};\n\nexport type MatrixColumn = {\n  competenceId: string;\n  label: string;\n  groupName: string | null;\n  requiredLevel: number | null;\n};\n\nexport type MatrixCellStatus = 'OK' | 'RISK' | 'N/A';\n\nexport type MatrixRow = {\n  employeeId: string;\n  employeeName: string;\n  riskLevel: 'LOW' | 'MEDIUM' | 'HIGH';\n  items: {\n    competenceId: string;\n    status: MatrixCellStatus;\n    level: number | null;\n  }[];\n};\n\nexport async function getAllPositions(): Promise<PositionSummary[]> {\n  const { data, error } = await supabase\n    .from('positions')\n    .select('id, name, site, department')\n    .order('name', { ascending: true });\n\n  if (error) throw error;\n  return (data ?? []) as PositionSummary[];\n}\n\nexport async function getEmployeesForPosition(positionId: string): Promise<SimpleEmployee[]> {\n  const { data, error } = await supabase\n    .from('employees')\n    .select('id, name')\n    .eq('position_id', positionId);\n\n  if (error) throw error;\n\n  return (data ?? []).map((row: any) => ({\n    id: row.id,\n    name: row.name ?? 'Employee',\n  }));\n}\n\ntype EmployeeRow = {\n  id: string;\n  name?: string | null;\n  position_id?: string | null;\n};\n\ntype RequirementRow = {\n  id: string;\n  position_id: string;\n  competence_id: string;\n  required_level: number;\n  mandatory: boolean;\n};\n\ntype EmployeeCompetenceRow = {\n  id: string;\n  employee_id: string;\n  competence_id: string;\n  level: number;\n  valid_from: string | null;\n  valid_to: string | null;\n};\n\ntype CompetenceRow = {\n  id: string;\n  name: string;\n  description?: string | null;\n  code?: string | null;\n  group_id?: string | null;\n  is_safety_critical: boolean;\n};\n\ntype GroupRow = {\n  id: string;\n  name: string;\n};\n\nexport async function getEmployeeCompetenceProfile(\n  employeeId: string,\n): Promise<EmployeeCompetenceProfile> {\n  // 1) Employee\n  const { data: employeeRow, error: empError } = await supabase\n    .from(\"employees\")\n    .select(\"id, name, position_id\")\n    .eq(\"id\", employeeId)\n    .single<EmployeeRow>();\n\n  if (empError || !employeeRow) {\n    console.error(empError);\n    throw empError ?? new Error(\"Employee not found\");\n  }\n\n  const employeeName = employeeRow.name ?? \"Employee\";\n\n  // 2) Position (optional)\n  let positionName: string | null = null;\n  const positionId = employeeRow.position_id ?? null;\n\n  if (positionId) {\n    const { data: posRows } = await supabase\n      .from(\"positions\")\n      .select(\"id, name\")\n      .eq(\"id\", positionId)\n      .limit(1);\n\n    const pos = posRows?.[0] as { id: string; name: string } | undefined;\n    if (pos) {\n      positionName = pos.name;\n    }\n  }\n\n  // 3) Requirements for this position\n  let requirementRows: RequirementRow[] = [];\n  if (positionId) {\n    const { data: reqData, error: reqError } = await supabase\n      .from(\"position_competence_requirements\")\n      .select(\"id, position_id, competence_id, required_level, mandatory\")\n      .eq(\"position_id\", positionId);\n\n    if (reqError) {\n      console.error(reqError);\n      throw reqError;\n    }\n    requirementRows = (reqData ?? []) as RequirementRow[];\n  }\n\n  // 4) Employee competences\n  const { data: empCompData, error: empCompError } = await supabase\n    .from(\"employee_competences\")\n    .select(\"id, employee_id, competence_id, level, valid_from, valid_to\")\n    .eq(\"employee_id\", employeeId);\n\n  if (empCompError) {\n    console.error(empCompError);\n    throw empCompError;\n  }\n\n  const employeeCompRows = (empCompData ?? []) as EmployeeCompetenceRow[];\n  const empCompByCompetenceId = new Map<string, EmployeeCompetenceRow>();\n  for (const row of employeeCompRows) {\n    empCompByCompetenceId.set(row.competence_id, row);\n  }\n\n  // 5) Load all involved competences + groups\n  const competenceIds = new Set<string>();\n  requirementRows.forEach((r) => competenceIds.add(r.competence_id));\n  employeeCompRows.forEach((r) => competenceIds.add(r.competence_id));\n\n  const competencesById = new Map<\n    string,\n    CompetenceRow & { groupName: string | null }\n  >();\n\n  if (competenceIds.size > 0) {\n    const { data: compData, error: compError } = await supabase\n      .from(\"competences\")\n      .select(\"id, name, description, code, group_id, is_safety_critical\")\n      .in(\"id\", Array.from(competenceIds));\n\n    if (compError) {\n      console.error(compError);\n      throw compError;\n    }\n\n    const comps = (compData ?? []) as CompetenceRow[];\n\n    const groupIds = new Set<string>();\n    comps.forEach((c) => {\n      if (c.group_id) groupIds.add(c.group_id);\n    });\n\n    let groupById = new Map<string, string>();\n    if (groupIds.size > 0) {\n      const { data: groupData, error: groupError } = await supabase\n        .from(\"competence_groups\")\n        .select(\"id, name\")\n        .in(\"id\", Array.from(groupIds));\n\n      if (groupError) {\n        console.error(groupError);\n      } else {\n        (groupData ?? []).forEach((g) => {\n          const gr = g as GroupRow;\n          groupById.set(gr.id, gr.name);\n        });\n      }\n    }\n\n    comps.forEach((c) => {\n      competencesById.set(c.id, {\n        ...c,\n        groupName: c.group_id ? (groupById.get(c.group_id) ?? null) : null,\n      });\n    });\n  }\n\n  const today = new Date();\n  const todayStr = today.toISOString().slice(0, 10);\n\n  function isExpired(validTo: string | null): boolean {\n    if (!validTo) return false;\n    // date-only compare\n    return validTo < todayStr;\n  }\n\n  const items: EmployeeCompetenceItem[] = [];\n  let totalRequired = 0;\n  let gapCount = 0;\n  let expiredCount = 0;\n\n  const usedCompetenceIds = new Set<string>();\n\n  // 6) Build items for all requirements (rollkrav)\n  for (const req of requirementRows) {\n    const compInfo = competencesById.get(req.competence_id);\n    if (!compInfo) continue;\n\n    const empComp = empCompByCompetenceId.get(req.competence_id) ?? null;\n\n    let status: \"OK\" | \"RISK\" | \"N/A\" = \"N/A\";\n    let riskReason: string | null = null;\n    let empLevel: number | null = empComp ? empComp.level : null;\n    const validTo = empComp?.valid_to ?? null;\n\n    if (req.mandatory) {\n      totalRequired += 1;\n\n      if (!empComp) {\n        status = \"RISK\";\n        riskReason = \"Saknar kompetens\";\n        gapCount += 1;\n      } else if (isExpired(validTo)) {\n        status = \"RISK\";\n        riskReason = \"Utgången giltighet\";\n        gapCount += 1;\n        expiredCount += 1;\n      } else if (empLevel! < req.required_level) {\n        status = \"RISK\";\n        riskReason = \"För låg nivå\";\n        gapCount += 1;\n      } else {\n        status = \"OK\";\n      }\n    } else {\n      // ej obligatorisk men definierad\n      status = empComp ? \"OK\" : \"N/A\";\n    }\n\n    items.push({\n      competenceId: compInfo.id,\n      competenceName: compInfo.name,\n      competenceCode: compInfo.code ?? null,\n      groupName: compInfo.groupName,\n      requiredLevel: req.required_level,\n      mandatory: req.mandatory,\n      employeeLevel: empLevel,\n      validTo,\n      status,\n      riskReason,\n      isSafetyCritical: compInfo.is_safety_critical,\n    });\n\n    usedCompetenceIds.add(compInfo.id);\n  }\n\n  // 7) Extra kompetenser som inte finns i rollkraven (nice-to-have / historik)\n  for (const empComp of employeeCompRows) {\n    if (usedCompetenceIds.has(empComp.competence_id)) continue;\n    const compInfo = competencesById.get(empComp.competence_id);\n    if (!compInfo) continue;\n\n    items.push({\n      competenceId: compInfo.id,\n      competenceName: compInfo.name,\n      competenceCode: compInfo.code ?? null,\n      groupName: compInfo.groupName,\n      requiredLevel: null,\n      mandatory: false,\n      employeeLevel: empComp.level,\n      validTo: empComp.valid_to,\n      status: isExpired(empComp.valid_to) ? \"RISK\" : \"N/A\",\n      riskReason: isExpired(empComp.valid_to) ? \"Utgången giltighet\" : null,\n      isSafetyCritical: compInfo.is_safety_critical,\n    });\n  }\n\n  // 8) Summary / risk score\n  const coveragePercent =\n    totalRequired === 0\n      ? 100\n      : Math.round(((totalRequired - gapCount) / totalRequired) * 100);\n\n  let riskLevel: \"LOW\" | \"MEDIUM\" | \"HIGH\" = \"LOW\";\n  if (gapCount === 0) {\n    riskLevel = \"LOW\";\n  } else if (gapCount <= 2) {\n    riskLevel = \"MEDIUM\";\n  } else {\n    riskLevel = \"HIGH\";\n  }\n\n  // Sortera per grupp + namn\n  items.sort((a, b) => {\n    const g1 = a.groupName ?? \"\";\n    const g2 = b.groupName ?? \"\";\n    if (g1 !== g2) return g1.localeCompare(g2);\n    return a.competenceName.localeCompare(b.competenceName);\n  });\n\n  return {\n    employee: {\n      id: employeeRow.id,\n      name: employeeName,\n      positionName,\n    },\n    summary: {\n      riskLevel,\n      gapCount,\n      totalRequired,\n      coveragePercent,\n      expiredCount,\n    },\n    items,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 418, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/services/gaps.ts"],"sourcesContent":["import { supabase } from \"@/lib/supabaseClient\";\nimport type { GapItem } from \"@/types/domain\";\n\nexport async function calculateTomorrowsGaps(): Promise<GapItem[]> {\n  const { data: requirements, error: reqError } = await supabase\n    .from(\"role_skill_requirements\")\n    .select(\"id, role, line, skill_id, required_level, required_headcount\");\n\n  if (reqError) {\n    console.error(\"Failed to fetch requirements:\", reqError);\n    throw new Error(`Legacy skill requirements unavailable: ${reqError.message}`);\n  }\n\n  if (!requirements || requirements.length === 0) {\n    return [];\n  }\n\n  const skillIds = [...new Set(requirements.map((r) => r.skill_id))];\n  const { data: skills } = await supabase\n    .from(\"skills\")\n    .select(\"id, name\")\n    .in(\"id\", skillIds);\n\n  const skillMap = new Map<string, string>();\n  for (const skill of skills || []) {\n    skillMap.set(skill.id, skill.name);\n  }\n\n  const gaps: GapItem[] = [];\n\n  for (const req of requirements) {\n    const { role, line, skill_id, required_level, required_headcount } = req;\n\n    const { data: employees } = await supabase\n      .from(\"employees\")\n      .select(\"id\")\n      .eq(\"role\", role)\n      .eq(\"line\", line)\n      .eq(\"is_active\", true);\n\n    const employeeIds = (employees || []).map((e) => e.id);\n\n    if (employeeIds.length === 0) {\n      gaps.push({\n        line,\n        team: null,\n        role,\n        skillName: skillMap.get(skill_id) || \"Unknown\",\n        skillId: skill_id,\n        requiredLevel: required_level,\n        currentAvgLevel: 0,\n        missingCount: required_headcount,\n      });\n      continue;\n    }\n\n    const { data: empSkills } = await supabase\n      .from(\"employee_skills\")\n      .select(\"employee_id, level\")\n      .eq(\"skill_id\", skill_id)\n      .in(\"employee_id\", employeeIds);\n\n    const qualifiedCount = (empSkills || []).filter(\n      (es) => es.level >= required_level\n    ).length;\n\n    const avgLevel =\n      empSkills && empSkills.length > 0\n        ? empSkills.reduce((sum, es) => sum + es.level, 0) / empSkills.length\n        : 0;\n\n    const missingCount = Math.max(0, required_headcount - qualifiedCount);\n\n    if (missingCount > 0) {\n      gaps.push({\n        line,\n        team: null,\n        role,\n        skillName: skillMap.get(skill_id) || \"Unknown\",\n        skillId: skill_id,\n        requiredLevel: required_level,\n        currentAvgLevel: Math.round(avgLevel * 10) / 10,\n        missingCount,\n      });\n    }\n  }\n\n  return gaps;\n}\n\ninterface RawGapData {\n  line_name: string;\n  role_name: string;\n  skill_name: string;\n  missing: number;\n}\n\nexport function getCriticalGaps(gaps: RawGapData[]) {\n  return gaps\n    .filter((g) => g.missing > 0)\n    .map((g) => ({\n      line: g.line_name,\n      role: g.role_name,\n      skill: g.skill_name,\n      missingCount: g.missing,\n    }));\n}\n\nexport function getCriticalGapsFromItems(gaps: GapItem[]) {\n  return gaps\n    .filter((g) => g.missingCount > 0)\n    .map((g) => ({\n      line: g.line,\n      role: g.role,\n      skill: g.skillName,\n      missingCount: g.missingCount,\n    }));\n}\n\ninterface SkillStats {\n  level_0: number;\n  level_1: number;\n  level_2?: number;\n  level_3: number;\n  level_4: number;\n}\n\nexport function getTrainingPriorities(skillsStats: Record<string, SkillStats>) {\n  return Object.entries(skillsStats)\n    .map(([skill, stats]) => ({\n      skill,\n      countLevel0or1: stats.level_0 + stats.level_1,\n    }))\n    .filter((i) => i.countLevel0or1 > 0)\n    .sort((a, b) => b.countLevel0or1 - a.countLevel0or1);\n}\n\nexport function getOverstaffedSkills(skillsStats: Record<string, SkillStats>) {\n  return Object.entries(skillsStats)\n    .map(([skill, stats]) => ({\n      skill,\n      countLevel3or4: stats.level_3 + stats.level_4,\n    }))\n    .filter((i) => i.countLevel3or4 >= 3)\n    .sort((a, b) => b.countLevel3or4 - a.countLevel3or4);\n}\n\nexport async function getSkillStats(): Promise<Record<string, SkillStats>> {\n  const { data: skills } = await supabase.from(\"skills\").select(\"id, name\");\n  const { data: empSkills } = await supabase\n    .from(\"employee_skills\")\n    .select(\"skill_id, level\");\n\n  const stats: Record<string, SkillStats> = {};\n\n  for (const skill of skills || []) {\n    stats[skill.name] = {\n      level_0: 0,\n      level_1: 0,\n      level_2: 0,\n      level_3: 0,\n      level_4: 0,\n    };\n  }\n\n  for (const es of empSkills || []) {\n    const skill = skills?.find((s) => s.id === es.skill_id);\n    if (skill && stats[skill.name]) {\n      const key = `level_${es.level}` as keyof SkillStats;\n      if (key in stats[skill.name]) {\n        (stats[skill.name][key] as number)++;\n      }\n    }\n  }\n\n  return stats;\n}\n\n// ============================================================\n// Position-based Tomorrow's Gaps v1\n// ============================================================\n\nimport { getEmployeesForPosition, getEmployeeCompetenceProfile } from \"./competence\";\n\nexport type PositionGapRisk = \"LOW\" | \"MEDIUM\" | \"HIGH\" | \"CRITICAL\";\n\nexport type PositionGapSummary = {\n  positionId: string;\n  positionName: string;\n  site: string | null;\n  department: string | null;\n  minHeadcount: number;\n  totalEmployees: number;\n  fullyCompetentCount: number;\n  gapCount: number;\n  coveragePercent: number;\n  riskLevel: PositionGapRisk;\n  riskReason: string | null;\n};\n\nexport type TomorrowsGapsOverview = {\n  positions: PositionGapSummary[];\n  summary: {\n    totalPositions: number;\n    criticalPositions: number;\n    highRiskPositions: number;\n    mediumRiskPositions: number;\n    lowRiskPositions: number;\n    totalGapHeadcount: number;\n  };\n  configWarning?: string;\n};\n\ntype PositionRow = {\n  id: string;\n  name: string;\n  site: string | null;\n  department: string | null;\n  min_headcount: number | null;\n};\n\nexport async function getTomorrowsGaps(): Promise<TomorrowsGapsOverview> {\n  let posData: PositionRow[] = [];\n  let minHeadcountMissing = false;\n  \n  // First try with min_headcount column\n  const result = await supabase\n    .from(\"positions\")\n    .select(\"id, name, site, department, min_headcount\")\n    .order(\"name\", { ascending: true });\n\n  // If min_headcount column doesn't exist (error 42703), fall back to query without it\n  if (result.error) {\n    const errorCode = (result.error as any).code;\n    if (errorCode === \"42703\" || result.error.message?.includes(\"min_headcount\")) {\n      console.warn(\"min_headcount column not found, fetching positions without it\");\n      minHeadcountMissing = true;\n      const fallbackResult = await supabase\n        .from(\"positions\")\n        .select(\"id, name, site, department\")\n        .order(\"name\", { ascending: true });\n      \n      if (fallbackResult.error) throw fallbackResult.error;\n      \n      // Add null min_headcount to all positions\n      posData = (fallbackResult.data ?? []).map((p: any) => ({\n        id: p.id,\n        name: p.name,\n        site: p.site ?? null,\n        department: p.department ?? null,\n        min_headcount: null\n      }));\n    } else {\n      throw result.error;\n    }\n  } else {\n    posData = (result.data ?? []) as PositionRow[];\n    // Check if ALL positions have null min_headcount (column exists but not configured)\n    const allNull = posData.every(p => p.min_headcount === null || p.min_headcount === 0);\n    if (allNull && posData.length > 0) {\n      minHeadcountMissing = true;\n    }\n  }\n\n  const positions = (posData ?? []) as PositionRow[];\n  const positionGaps: PositionGapSummary[] = [];\n\n  let criticalPositions = 0;\n  let highRiskPositions = 0;\n  let mediumRiskPositions = 0;\n  let lowRiskPositions = 0;\n  let totalGapHeadcount = 0;\n\n  for (const pos of positions) {\n    const minHeadcount = pos.min_headcount ?? 0;\n    \n    const employees = await getEmployeesForPosition(pos.id);\n    const totalEmployees = employees.length;\n    \n    let fullyCompetentCount = 0;\n    \n    for (const emp of employees) {\n      try {\n        const profile = await getEmployeeCompetenceProfile(emp.id);\n        if (profile.summary.gapCount === 0 && profile.summary.coveragePercent === 100) {\n          fullyCompetentCount++;\n        }\n      } catch (err) {\n        console.error(`Failed to get profile for employee ${emp.id}:`, err);\n      }\n    }\n\n    const gapCount = Math.max(0, minHeadcount - fullyCompetentCount);\n    const coveragePercent = minHeadcount === 0 \n      ? 100 \n      : Math.round((fullyCompetentCount / minHeadcount) * 100);\n\n    let riskLevel: PositionGapRisk;\n    let riskReason: string | null = null;\n\n    if (minHeadcount === 0) {\n      riskLevel = \"LOW\";\n      riskReason = \"No minimum headcount defined\";\n    } else if (fullyCompetentCount >= minHeadcount) {\n      riskLevel = \"LOW\";\n    } else if (fullyCompetentCount === 0) {\n      riskLevel = \"CRITICAL\";\n      riskReason = `No fully competent employees (need ${minHeadcount})`;\n    } else if (coveragePercent < 50) {\n      riskLevel = \"HIGH\";\n      riskReason = `Only ${fullyCompetentCount}/${minHeadcount} positions covered`;\n    } else {\n      riskLevel = \"MEDIUM\";\n      riskReason = `${gapCount} position(s) uncovered`;\n    }\n\n    switch (riskLevel) {\n      case \"CRITICAL\":\n        criticalPositions++;\n        break;\n      case \"HIGH\":\n        highRiskPositions++;\n        break;\n      case \"MEDIUM\":\n        mediumRiskPositions++;\n        break;\n      case \"LOW\":\n        lowRiskPositions++;\n        break;\n    }\n\n    totalGapHeadcount += gapCount;\n\n    positionGaps.push({\n      positionId: pos.id,\n      positionName: pos.name,\n      site: pos.site,\n      department: pos.department,\n      minHeadcount,\n      totalEmployees,\n      fullyCompetentCount,\n      gapCount,\n      coveragePercent,\n      riskLevel,\n      riskReason,\n    });\n  }\n\n  positionGaps.sort((a, b) => {\n    const riskOrder: Record<PositionGapRisk, number> = { CRITICAL: 0, HIGH: 1, MEDIUM: 2, LOW: 3 };\n    return riskOrder[a.riskLevel] - riskOrder[b.riskLevel];\n  });\n\n  const configWarning = minHeadcountMissing \n    ? \"Minimum headcount requirements are not configured for positions. Risk levels may not reflect actual coverage needs. Configure min_headcount for each position to enable accurate gap analysis.\"\n    : undefined;\n\n  return {\n    positions: positionGaps,\n    summary: {\n      totalPositions: positions.length,\n      criticalPositions,\n      highRiskPositions,\n      mediumRiskPositions,\n      lowRiskPositions,\n      totalGapHeadcount,\n    },\n    configWarning,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 683, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,yKAAO,EAAC,IAAA,gJAAI,EAAC;AACtB"}},
    {"offset": {"line": 701, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\";\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\";\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-2xl font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n));\nCardTitle.displayName = \"CardTitle\";\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\";\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n));\nCardContent.displayName = \"CardContent\";\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n));\nCardFooter.displayName = \"CardFooter\";\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent };\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA;AACA;;;;AAEA,MAAM,qBAAO,2KAAgB,MAG3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,+EACA;QAED,GAAG,KAAK;;;;;;;AAGb,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,2KAAgB,OAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,2KAAgB,OAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,sDAAsD;QACnE,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,2KAAgB,OAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QAAI,KAAK;QAAK,WAAW,IAAA,qHAAE,EAAC,YAAY;QAAa,GAAG,KAAK;;;;;;;AAEhE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,2KAAgB,QAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;;AAGb,WAAW,WAAW,GAAG"}},
    {"offset": {"line": 808, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\nimport { cn } from \"@/lib/utils\";\n\nconst badgeVariants = cva(\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 hover-elevate\",\n  {\n    variants: {\n      variant: {\n        default: \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive: \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n        outline: \"border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n      size: {\n        default: \"\",\n        sm: \"text-[10px] px-2 py-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n);\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, size, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant, size }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants };\n"],"names":[],"mappings":";;;;;;;AACA;AACA;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EACvB,wMACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,WAAW;YACX,aAAa;YACb,SAAS;QACX;QACA,MAAM;YACJ,SAAS;YACT,IAAI;QACN;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAOF,SAAS,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,OAAmB;IAC/D,qBACE,6LAAC;QAAI,WAAW,IAAA,qHAAE,EAAC,cAAc;YAAE;YAAS;QAAK,IAAI;QAAa,GAAG,KAAK;;;;;;AAE9E;KAJS"}},
    {"offset": {"line": 862, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/components/ui/tabs.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AACA;AACA;AAJA;;;;;AAMA,MAAM,OAAO,2KAAkB;AAE/B,MAAM,yBAAW,2KAAgB,MAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,2KAAkB;QACjB,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,6FACA;QAED,GAAG,KAAK;;;;;;;AAGb,SAAS,WAAW,GAAG,2KAAkB,CAAC,WAAW;AAErD,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,8KAAqB;QACpB,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,kYACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG,8KAAqB,CAAC,WAAW;AAE3D,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,8KAAqB;QACpB,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,mIACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG,8KAAqB,CAAC,WAAW"}},
    {"offset": {"line": 930, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/components/ui/progress.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-primary/20\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMA,MAAM,yBAAW,2KAAgB,MAG/B,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,OAAO,EAAE,oBACjC,6LAAC,+KAAsB;QACrB,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,kEACA;QAED,GAAG,KAAK;kBAET,cAAA,6LAAC,oLAA2B;YAC1B,WAAU;YACV,OAAO;gBAAE,WAAW,CAAC,YAAY,EAAE,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC;YAAC;;;;;;;;;;;;AAIhE,SAAS,WAAW,GAAG,+KAAsB,CAAC,WAAW"}},
    {"offset": {"line": 975, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/app/tomorrows-gaps/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { WhatToFixSummary } from \"@/components/WhatToFixSummary\";\nimport { \n  calculateTomorrowsGaps, \n  getCriticalGapsFromItems, \n  getTrainingPriorities, \n  getOverstaffedSkills,\n  getSkillStats,\n  getTomorrowsGaps,\n  type PositionGapSummary,\n  type TomorrowsGapsOverview\n} from \"@/services/gaps\";\nimport type { GapItem } from \"@/types/domain\";\nimport { Loader2, AlertTriangle, Users, TrendingDown, CheckCircle } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Progress } from \"@/components/ui/progress\";\n\nfunction RiskBadge({ risk }: { risk: string }) {\n  const variants: Record<string, string> = {\n    CRITICAL: \"hr-risk-pill hr-risk-pill--critical\",\n    HIGH: \"hr-risk-pill hr-risk-pill--high\",\n    MEDIUM: \"hr-risk-pill hr-risk-pill--medium\",\n    LOW: \"hr-risk-pill hr-risk-pill--low\",\n  };\n\n  return (\n    <span className={variants[risk] || \"hr-risk-pill\"} data-testid={`risk-badge-${risk.toLowerCase()}`}>\n      {risk}\n    </span>\n  );\n}\n\nfunction PositionGapCard({ position }: { position: PositionGapSummary }) {\n  return (\n    <div className=\"hr-card\" data-testid={`card-position-gap-${position.positionId}`}>\n      <div className=\"flex items-center justify-between gap-2 flex-wrap mb-3\">\n        <h3 className=\"hr-card__title\">{position.positionName}</h3>\n        <RiskBadge risk={position.riskLevel} />\n      </div>\n      \n      <div className=\"hr-emp-summary-grid\">\n        <div className=\"hr-emp-summary-card\">\n          <span className=\"hr-emp-summary-label\">Min Required</span>\n          <span className=\"hr-emp-summary-value\">{position.minHeadcount}</span>\n        </div>\n        <div className=\"hr-emp-summary-card\">\n          <span className=\"hr-emp-summary-label\">Total Staff</span>\n          <span className=\"hr-emp-summary-value\">{position.totalEmployees}</span>\n        </div>\n        <div className=\"hr-emp-summary-card\">\n          <span className=\"hr-emp-summary-label\">Fully Qualified</span>\n          <span className=\"hr-emp-summary-value\">{position.fullyCompetentCount}</span>\n        </div>\n        <div className=\"hr-emp-summary-card\">\n          <span className=\"hr-emp-summary-label\">Gap</span>\n          <span className={`hr-emp-summary-value ${position.gapCount > 0 ? 'text-red-600 dark:text-red-400' : ''}`}>\n            {position.gapCount}\n          </span>\n        </div>\n      </div>\n\n      <div className=\"mt-4\">\n        <div className=\"flex items-center justify-between mb-1\">\n          <span className=\"text-sm text-muted-foreground\">Coverage</span>\n          <span className=\"text-sm font-medium\">{position.coveragePercent}%</span>\n        </div>\n        <Progress value={position.coveragePercent} className=\"h-2\" />\n      </div>\n\n      {position.riskReason && (\n        <p className=\"text-sm text-muted-foreground mt-3\">{position.riskReason}</p>\n      )}\n\n      {position.site && (\n        <div className=\"flex items-center gap-2 mt-3 text-sm text-muted-foreground\">\n          <span>{position.site}</span>\n          {position.department && (\n            <>\n              <span>/</span>\n              <span>{position.department}</span>\n            </>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default function TomorrowsGapsPage() {\n  const [gaps, setGaps] = useState<GapItem[]>([]);\n  const [criticalGaps, setCriticalGaps] = useState<{ line: string; role: string; skill: string; missingCount: number }[]>([]);\n  const [trainingPriorities, setTrainingPriorities] = useState<{ skill: string; countLevel0or1: number }[]>([]);\n  const [overstaffedSkills, setOverstaffedSkills] = useState<{ skill: string; countLevel3or4: number }[]>([]);\n  const [positionGaps, setPositionGaps] = useState<TomorrowsGapsOverview | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [legacyGapsUnavailable, setLegacyGapsUnavailable] = useState(false);\n\n  useEffect(() => {\n    async function fetchData() {\n      setLoading(true);\n      setError(null);\n      \n      try {\n        const positionGapsData = await getTomorrowsGaps();\n        setPositionGaps(positionGapsData);\n        \n        try {\n          const gapsData = await calculateTomorrowsGaps();\n          setGaps(gapsData);\n          setCriticalGaps(getCriticalGapsFromItems(gapsData));\n          \n          const skillStats = await getSkillStats();\n          setTrainingPriorities(getTrainingPriorities(skillStats));\n          setOverstaffedSkills(getOverstaffedSkills(skillStats));\n        } catch (legacyErr) {\n          console.warn(\"Legacy skill gaps not available:\", legacyErr);\n          setLegacyGapsUnavailable(true);\n        }\n      } catch (err) {\n        console.error(\"Failed to load gaps data:\", err);\n        setError(\"Failed to load gap analysis data\");\n      } finally {\n        setLoading(false);\n      }\n    }\n    \n    fetchData();\n  }, []);\n\n  if (loading) {\n    return (\n      <div className=\"hr-page\">\n        <div className=\"hr-page__header\">\n          <h1 className=\"hr-page__title\">Tomorrow&apos;s Gaps</h1>\n        </div>\n        <div className=\"flex items-center justify-center p-12\">\n          <Loader2 className=\"h-6 w-6 animate-spin\" data-testid=\"loading-spinner\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"hr-page\">\n        <div className=\"hr-page__header\">\n          <h1 className=\"hr-page__title\">Tomorrow&apos;s Gaps</h1>\n        </div>\n        <div className=\"hr-error\" data-testid=\"error-message\">{error}</div>\n      </div>\n    );\n  }\n\n  const summary = positionGaps?.summary;\n\n  return (\n    <div className=\"hr-page\">\n      <div className=\"hr-page__header\">\n        <h1 className=\"hr-page__title\">Tomorrow&apos;s Gaps</h1>\n        <p className=\"hr-page__subtitle\">\n          Risk and coverage analysis per position based on minimum headcount requirements\n        </p>\n      </div>\n\n      {summary && (\n        <div className=\"hr-kpi-grid\" data-testid=\"summary-kpis\">\n          <div className=\"hr-kpi\">\n            <span className=\"hr-kpi__label\">Total Positions</span>\n            <span className=\"hr-kpi__value\">{summary.totalPositions}</span>\n          </div>\n          <div className=\"hr-kpi\">\n            <span className=\"hr-kpi__label\">Critical Risk</span>\n            <span className={`hr-kpi__value ${summary.criticalPositions > 0 ? 'hr-kpi__value--danger' : ''}`}>\n              {summary.criticalPositions}\n            </span>\n          </div>\n          <div className=\"hr-kpi\">\n            <span className=\"hr-kpi__label\">High Risk</span>\n            <span className={`hr-kpi__value ${summary.highRiskPositions > 0 ? 'hr-kpi__value--danger' : ''}`}>\n              {summary.highRiskPositions}\n            </span>\n          </div>\n          <div className=\"hr-kpi\">\n            <span className=\"hr-kpi__label\">Medium Risk</span>\n            <span className={`hr-kpi__value ${summary.mediumRiskPositions > 0 ? 'hr-kpi__value--warn' : ''}`}>\n              {summary.mediumRiskPositions}\n            </span>\n          </div>\n          <div className=\"hr-kpi\">\n            <span className=\"hr-kpi__label\">Low Risk</span>\n            <span className=\"hr-kpi__value hr-kpi__value--ok\">{summary.lowRiskPositions}</span>\n          </div>\n          <div className=\"hr-kpi\">\n            <span className=\"hr-kpi__label\">Total Gap Headcount</span>\n            <span className={`hr-kpi__value ${summary.totalGapHeadcount > 0 ? 'hr-kpi__value--danger' : ''}`}>\n              {summary.totalGapHeadcount}\n            </span>\n          </div>\n        </div>\n      )}\n\n      {positionGaps?.configWarning && (\n        <div className=\"flex items-start gap-3 p-4 mt-4 rounded-md border border-amber-300 bg-amber-50 dark:border-amber-700 dark:bg-amber-950\" data-testid=\"config-warning\">\n          <AlertTriangle className=\"h-5 w-5 text-amber-600 dark:text-amber-400 shrink-0 mt-0.5\" />\n          <div>\n            <p className=\"text-sm font-medium text-amber-800 dark:text-amber-200\">Configuration Needed</p>\n            <p className=\"text-sm text-amber-700 dark:text-amber-300 mt-1\">\n              {positionGaps.configWarning}\n            </p>\n          </div>\n        </div>\n      )}\n\n      <Tabs defaultValue=\"positions\" className=\"mt-6\">\n        <TabsList>\n          <TabsTrigger value=\"positions\" data-testid=\"tab-positions\">\n            Position Coverage\n          </TabsTrigger>\n          <TabsTrigger value=\"skills\" data-testid=\"tab-skills\">\n            Skill Gaps\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"positions\" className=\"mt-4\">\n          {positionGaps && positionGaps.positions.length > 0 ? (\n            <div className=\"hr-grid\" data-testid=\"position-gaps-grid\">\n              {positionGaps.positions.map((position) => (\n                <PositionGapCard key={position.positionId} position={position} />\n              ))}\n            </div>\n          ) : (\n            <div className=\"hr-empty\" data-testid=\"no-positions-message\">\n              No positions found. Add positions and set minimum headcount to see gap analysis.\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"skills\" className=\"mt-4\">\n          {legacyGapsUnavailable ? (\n            <div className=\"hr-empty\" data-testid=\"legacy-gaps-unavailable\">\n              <p className=\"font-medium mb-2\">Skill Gap Analysis Unavailable</p>\n              <p className=\"text-sm text-muted-foreground\">\n                The legacy skill gap analysis requires role_skill_requirements and skills tables to be configured.\n                Use the Position Coverage tab to see gap analysis based on position competence requirements.\n              </p>\n            </div>\n          ) : (\n            <>\n              <WhatToFixSummary\n                criticalGaps={criticalGaps}\n                trainingPriorities={trainingPriorities}\n                overstaffedSkills={overstaffedSkills}\n              />\n\n              <div className=\"mt-8\">\n                <h2 className=\"hr-section__title\">Detailed Skill Gaps</h2>\n                \n                {gaps.length === 0 ? (\n                  <div className=\"hr-empty\" data-testid=\"no-skill-gaps-message\">\n                    No skill gaps detected. All skill requirements are met.\n                  </div>\n                ) : (\n                  <div className=\"hr-grid\">\n                    {gaps.map((gap, index) => (\n                      <Card key={index} data-testid={`card-gap-${index}`}>\n                        <CardHeader className=\"pb-2\">\n                          <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                            <CardTitle className=\"text-base\">{gap.skillName}</CardTitle>\n                            <Badge variant=\"destructive\">\n                              Missing: {gap.missingCount}\n                            </Badge>\n                          </div>\n                        </CardHeader>\n                        <CardContent>\n                          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n                            <div>\n                              <span className=\"text-muted-foreground\">Line:</span>\n                              <p className=\"font-medium\">{gap.line}</p>\n                            </div>\n                            <div>\n                              <span className=\"text-muted-foreground\">Role:</span>\n                              <p className=\"font-medium\">{gap.role}</p>\n                            </div>\n                            <div>\n                              <span className=\"text-muted-foreground\">Required Level:</span>\n                              <p className=\"font-medium\">{gap.requiredLevel}</p>\n                            </div>\n                            <div>\n                              <span className=\"text-muted-foreground\">Current Avg:</span>\n                              <p className=\"font-medium\">{gap.currentAvgLevel}</p>\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                )}\n              </div>\n            </>\n          )}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}