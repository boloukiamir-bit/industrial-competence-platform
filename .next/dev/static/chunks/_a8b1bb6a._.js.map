{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/supabaseClient.ts"],"sourcesContent":["import { createClient, SupabaseClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || \"\";\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || \"\";\n\nfunction createSupabaseClient(): SupabaseClient {\n  if (!supabaseUrl || !supabaseAnonKey) {\n    if (typeof window === \"undefined\" && process.env.NODE_ENV === \"production\") {\n      console.warn(\n        \"Supabase environment variables not set. \" +\n        \"Please ensure NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are configured.\"\n      );\n    }\n  }\n  return createClient(supabaseUrl || \"https://placeholder.supabase.co\", supabaseAnonKey || \"placeholder\");\n}\n\nexport const supabase: SupabaseClient = createSupabaseClient();\n\nexport function getSupabaseClient(): SupabaseClient {\n  if (!supabaseUrl || !supabaseAnonKey) {\n    throw new Error(\n      \"Missing Supabase environment variables. \" +\n      \"Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.\"\n    );\n  }\n  return supabase;\n}\n"],"names":[],"mappings":";;;;;;AAEoB;AAFpB;;AAEA,MAAM,cAAc,gFAAwC;AAC5D,MAAM,kBAAkB,wPAA6C;AAErE,SAAS;IACP;;IAQA,OAAO,IAAA,0LAAY,EAAC,eAAe,mCAAmC,mBAAmB;AAC3F;AAEO,MAAM,WAA2B;AAEjC,SAAS;IACd;;IAMA,OAAO;AACT"}},
    {"offset": {"line": 33, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/auth.ts"],"sourcesContent":["import { supabase } from \"./supabaseClient\";\nimport type { AppRole, AppUser } from \"@/types/domain\";\n\nexport type { AppRole };\n\nexport type CurrentUser = {\n  id: string;\n  role: AppRole;\n  employeeId?: string;\n  email: string;\n};\n\nexport async function getCurrentUser(): Promise<CurrentUser | null> {\n  const devEmail = process.env.NEXT_PUBLIC_DEV_USER_EMAIL || \"hr@example.com\";\n  \n  try {\n    const { data, error } = await supabase\n      .from(\"users\")\n      .select(\"id, employee_id, email, role\")\n      .eq(\"email\", devEmail)\n      .single();\n\n    if (error || !data) {\n      return {\n        id: \"dev-user\",\n        role: \"HR_ADMIN\" as AppRole,\n        email: devEmail,\n      };\n    }\n\n    return {\n      id: data.id,\n      role: data.role as AppRole,\n      employeeId: data.employee_id || undefined,\n      email: data.email,\n    };\n  } catch {\n    return {\n      id: \"dev-user\",\n      role: \"HR_ADMIN\" as AppRole,\n      email: devEmail,\n    };\n  }\n}\n\nexport function requireRole(\n  user: { role: AppRole } | null,\n  allowed: AppRole[]\n): void {\n  if (!user) {\n    throw new Error(\"Unauthorized: User not authenticated\");\n  }\n  if (!allowed.includes(user.role)) {\n    throw new Error(`Forbidden: Role ${user.role} not allowed`);\n  }\n}\n\nexport function canAccessEmployee(\n  user: CurrentUser | null,\n  employeeId: string,\n  managedEmployeeIds: string[]\n): boolean {\n  if (!user) return false;\n  if (user.role === \"HR_ADMIN\") return true;\n  if (user.role === \"MANAGER\") {\n    return managedEmployeeIds.includes(employeeId);\n  }\n  if (user.role === \"EMPLOYEE\") {\n    return user.employeeId === employeeId;\n  }\n  return false;\n}\n\nexport async function getManagedEmployeeIds(managerId: string): Promise<string[]> {\n  const { data } = await supabase\n    .from(\"employees\")\n    .select(\"id\")\n    .eq(\"manager_id\", managerId)\n    .eq(\"is_active\", true);\n\n  return (data || []).map((e) => e.id);\n}\n"],"names":[],"mappings":";;;;;;;;;;AAamB;AAbnB;;AAYO,eAAe;IACpB,MAAM,WAAW,2KAAO,CAAC,GAAG,CAAC,0BAA0B,IAAI;IAE3D,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,oIAAQ,CACnC,IAAI,CAAC,SACL,MAAM,CAAC,gCACP,EAAE,CAAC,SAAS,UACZ,MAAM;QAET,IAAI,SAAS,CAAC,MAAM;YAClB,OAAO;gBACL,IAAI;gBACJ,MAAM;gBACN,OAAO;YACT;QACF;QAEA,OAAO;YACL,IAAI,KAAK,EAAE;YACX,MAAM,KAAK,IAAI;YACf,YAAY,KAAK,WAAW,IAAI;YAChC,OAAO,KAAK,KAAK;QACnB;IACF,EAAE,OAAM;QACN,OAAO;YACL,IAAI;YACJ,MAAM;YACN,OAAO;QACT;IACF;AACF;AAEO,SAAS,YACd,IAA8B,EAC9B,OAAkB;IAElB,IAAI,CAAC,MAAM;QACT,MAAM,IAAI,MAAM;IAClB;IACA,IAAI,CAAC,QAAQ,QAAQ,CAAC,KAAK,IAAI,GAAG;QAChC,MAAM,IAAI,MAAM,CAAC,gBAAgB,EAAE,KAAK,IAAI,CAAC,YAAY,CAAC;IAC5D;AACF;AAEO,SAAS,kBACd,IAAwB,EACxB,UAAkB,EAClB,kBAA4B;IAE5B,IAAI,CAAC,MAAM,OAAO;IAClB,IAAI,KAAK,IAAI,KAAK,YAAY,OAAO;IACrC,IAAI,KAAK,IAAI,KAAK,WAAW;QAC3B,OAAO,mBAAmB,QAAQ,CAAC;IACrC;IACA,IAAI,KAAK,IAAI,KAAK,YAAY;QAC5B,OAAO,KAAK,UAAU,KAAK;IAC7B;IACA,OAAO;AACT;AAEO,eAAe,sBAAsB,SAAiB;IAC3D,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,oIAAQ,CAC5B,IAAI,CAAC,aACL,MAAM,CAAC,MACP,EAAE,CAAC,cAAc,WACjB,EAAE,CAAC,aAAa;IAEnB,OAAO,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAC,IAAM,EAAE,EAAE;AACrC"}},
    {"offset": {"line": 101, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/app/layout.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { useState, useEffect } from \"react\";\nimport { \n  LayoutDashboard, \n  Grid3X3, \n  AlertTriangle, \n  Upload, \n  Users, \n  Settings,\n  ShieldAlert,\n  Package,\n  Newspaper,\n  FileText,\n  CreditCard,\n  BookOpen,\n  Shield,\n  Building2,\n  BarChart3,\n  Workflow\n} from \"lucide-react\";\nimport { getCurrentUser, type CurrentUser } from \"@/lib/auth\";\n\ntype NavItem = {\n  name: string;\n  href: string;\n  icon: React.ComponentType<{ className?: string }>;\n  hrAdminOnly?: boolean;\n};\n\nconst navItems: NavItem[] = [\n  { name: \"Dashboard\", href: \"/app/dashboard\", icon: LayoutDashboard },\n  { name: \"Employees\", href: \"/app/employees\", icon: Users },\n  { name: \"Organization\", href: \"/app/org/overview\", icon: Building2 },\n  { name: \"Competence Matrix\", href: \"/app/competence-matrix\", icon: Grid3X3 },\n  { name: \"Tomorrow's Gaps\", href: \"/app/tomorrows-gaps\", icon: AlertTriangle },\n  { name: \"Manager Risks\", href: \"/app/manager/risks\", icon: ShieldAlert },\n  { name: \"Safety / Certificates\", href: \"/app/safety/certificates\", icon: Shield },\n  { name: \"Equipment\", href: \"/app/equipment\", icon: Package },\n  { name: \"Handbooks\", href: \"/app/handbooks\", icon: BookOpen },\n  { name: \"Documents\", href: \"/app/documents\", icon: FileText },\n  { name: \"News\", href: \"/app/news\", icon: Newspaper },\n  { name: \"HR Analytics\", href: \"/app/hr/analytics\", icon: BarChart3, hrAdminOnly: true },\n  { name: \"HR Workflows\", href: \"/app/hr/workflows\", icon: Workflow, hrAdminOnly: true },\n  { name: \"Import Employees\", href: \"/app/import-employees\", icon: Upload, hrAdminOnly: true },\n  { name: \"Billing\", href: \"/app/billing\", icon: CreditCard, hrAdminOnly: true },\n  { name: \"Settings\", href: \"/app/settings\", icon: Settings },\n];\n\nexport default function AppLayout({ children }: { children: React.ReactNode }) {\n  const pathname = usePathname();\n  const [user, setUser] = useState<CurrentUser | null>(null);\n\n  useEffect(() => {\n    getCurrentUser().then(setUser);\n  }, []);\n\n  const visibleNavItems = navItems.filter((item) => {\n    if (item.hrAdminOnly && user?.role !== \"HR_ADMIN\") return false;\n    return true;\n  });\n\n  return (\n    <div className=\"flex h-screen bg-gray-50 dark:bg-gray-900\">\n      <aside className=\"w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col\">\n        <div className=\"p-6 border-b border-gray-200 dark:border-gray-700\">\n          <h1 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n            Industrial Competence\n          </h1>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">Platform</p>\n        </div>\n        <nav className=\"flex-1 p-4 overflow-y-auto\">\n          <ul className=\"space-y-1\">\n            {visibleNavItems.map((item) => {\n              const isActive = pathname === item.href || pathname?.startsWith(item.href + \"/\");\n              const Icon = item.icon;\n              return (\n                <li key={item.name}>\n                  <Link\n                    href={item.href}\n                    className={`flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium transition-colors ${\n                      isActive\n                        ? \"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white\"\n                        : \"text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50\"\n                    }`}\n                    data-testid={`nav-${item.name.toLowerCase().replace(/\\s+/g, \"-\")}`}\n                  >\n                    <Icon className=\"h-4 w-4\" />\n                    {item.name}\n                  </Link>\n                </li>\n              );\n            })}\n          </ul>\n        </nav>\n      </aside>\n\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\n        <header className=\"h-16 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between px-6\">\n          <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n            {new Date().toLocaleDateString(\"en-US\", {\n              weekday: \"long\",\n              year: \"numeric\",\n              month: \"long\",\n              day: \"numeric\",\n            })}\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <span className=\"text-sm text-gray-600 dark:text-gray-300\">{user?.email || \"User\"}</span>\n            <div\n              className=\"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600\"\n              data-testid=\"user-avatar-placeholder\"\n            />\n          </div>\n        </header>\n\n        <main className=\"flex-1 overflow-auto\">\n          {children}\n        </main>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}