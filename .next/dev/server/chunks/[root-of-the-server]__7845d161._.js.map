{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/line-overview/demand/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { createClient } from \"@supabase/supabase-js\";\n\nconst DEMO_ORG_ID = \"f607f244-da91-41d9-a648-d02a1591105c\";\n\nconst supabaseAdmin = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\n);\n\nfunction shiftParamToDbValue(shift: string): string {\n  const map: Record<string, string> = {\n    day: \"Day\",\n    evening: \"Evening\",\n    night: \"Night\",\n  };\n  return map[shift.toLowerCase()] || \"Day\";\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { machineCode, date, shift, requiredHours, priority, comment } = body;\n\n    if (!machineCode || !date || !shift || requiredHours === undefined) {\n      return NextResponse.json(\n        { error: \"Missing required fields: machineCode, date, shift, requiredHours\" },\n        { status: 400 }\n      );\n    }\n\n    const shiftType = shiftParamToDbValue(shift);\n\n    const existingCheck = await supabaseAdmin\n      .from(\"pl_machine_demand\")\n      .select(\"id\")\n      .eq(\"org_id\", DEMO_ORG_ID)\n      .eq(\"machine_code\", machineCode)\n      .eq(\"plan_date\", date)\n      .eq(\"shift_type\", shiftType)\n      .maybeSingle();\n\n    if (existingCheck.data) {\n      const { data, error } = await supabaseAdmin\n        .from(\"pl_machine_demand\")\n        .update({\n          required_hours: requiredHours,\n          priority: priority || 1,\n          comment: comment || null,\n        })\n        .eq(\"id\", existingCheck.data.id)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      return NextResponse.json({ success: true, demand: data, updated: true });\n    }\n\n    const { data, error } = await supabaseAdmin\n      .from(\"pl_machine_demand\")\n      .insert({\n        org_id: DEMO_ORG_ID,\n        machine_code: machineCode,\n        plan_date: date,\n        shift_type: shiftType,\n        required_hours: requiredHours,\n        priority: priority || 1,\n        comment: comment || null,\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n\n    return NextResponse.json({ success: true, demand: data, created: true });\n  } catch (error) {\n    console.error(\"Demand creation error:\", error);\n    return NextResponse.json({ error: \"Failed to create demand\" }, { status: 500 });\n  }\n}\n\nexport async function DELETE(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const machineCode = searchParams.get(\"machineCode\");\n    const date = searchParams.get(\"date\");\n    const shift = searchParams.get(\"shift\");\n\n    if (!machineCode || !date || !shift) {\n      return NextResponse.json(\n        { error: \"Missing required params: machineCode, date, shift\" },\n        { status: 400 }\n      );\n    }\n\n    const shiftType = shiftParamToDbValue(shift);\n\n    const { error } = await supabaseAdmin\n      .from(\"pl_machine_demand\")\n      .delete()\n      .eq(\"org_id\", DEMO_ORG_ID)\n      .eq(\"machine_code\", machineCode)\n      .eq(\"plan_date\", date)\n      .eq(\"shift_type\", shiftType);\n\n    if (error) throw error;\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error(\"Demand deletion error:\", error);\n    return NextResponse.json({ error: \"Failed to delete demand\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}