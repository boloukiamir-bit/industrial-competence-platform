{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/supabaseClient.ts"],"sourcesContent":["import { createClient, SupabaseClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || \"\";\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || \"\";\n\nfunction createSupabaseClient(): SupabaseClient {\n  if (!supabaseUrl || !supabaseAnonKey) {\n    if (typeof window === \"undefined\" && process.env.NODE_ENV === \"production\") {\n      console.warn(\n        \"Supabase environment variables not set. \" +\n        \"Please ensure NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are configured.\"\n      );\n    }\n  }\n  return createClient(supabaseUrl || \"https://placeholder.supabase.co\", supabaseAnonKey || \"placeholder\");\n}\n\nexport const supabase: SupabaseClient = createSupabaseClient();\n\nexport function getSupabaseClient(): SupabaseClient {\n  if (!supabaseUrl || !supabaseAnonKey) {\n    throw new Error(\n      \"Missing Supabase environment variables. \" +\n      \"Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.\"\n    );\n  }\n  return supabase;\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,cAAc,gFAAwC;AAC5D,MAAM,kBAAkB,wPAA6C;AAErE,SAAS;IACP;;IAQA,OAAO,IAAA,yLAAY,EAAC,eAAe,mCAAmC,mBAAmB;AAC3F;AAEO,MAAM,WAA2B;AAEjC,SAAS;IACd;;IAMA,OAAO;AACT"}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/services/oneToOne.ts"],"sourcesContent":["import { supabase } from \"@/lib/supabaseClient\";\nimport type { OneToOneMeeting, OneToOneAction, OneToOneMeetingStatus, OneToOneActionOwner } from \"@/types/domain\";\n\nexport async function getAllMeetings(): Promise<OneToOneMeeting[]> {\n  const { data, error } = await supabase\n    .from(\"one_to_one_meetings\")\n    .select(\"*, employee:employee_id(name), manager:manager_id(name)\")\n    .order(\"scheduled_at\", { ascending: false });\n\n  if (error) {\n    console.error(\"Error fetching all meetings:\", error);\n    return [];\n  }\n\n  return (data || []).map((row) => ({\n    id: row.id,\n    employeeId: row.employee_id,\n    employeeName: row.employee?.name || undefined,\n    managerId: row.manager_id || undefined,\n    managerName: row.manager?.name || undefined,\n    scheduledAt: row.scheduled_at,\n    durationMinutes: row.duration_minutes || undefined,\n    location: row.location || undefined,\n    status: row.status as OneToOneMeetingStatus,\n    templateName: row.template_name || undefined,\n    sharedAgenda: row.shared_agenda || undefined,\n    employeeNotesPrivate: row.employee_notes_private || undefined,\n    managerNotesPrivate: row.manager_notes_private || undefined,\n    createdAt: row.created_at,\n    updatedAt: row.updated_at || undefined,\n  }));\n}\n\nexport async function getMeetingsForEmployee(employeeId: string): Promise<OneToOneMeeting[]> {\n  const { data, error } = await supabase\n    .from(\"one_to_one_meetings\")\n    .select(\"*, employee:employee_id(name), manager:manager_id(name)\")\n    .eq(\"employee_id\", employeeId)\n    .order(\"scheduled_at\", { ascending: false });\n\n  if (error) {\n    console.error(\"Error fetching meetings for employee:\", error);\n    return [];\n  }\n\n  return (data || []).map((row) => ({\n    id: row.id,\n    employeeId: row.employee_id,\n    employeeName: row.employee?.name || undefined,\n    managerId: row.manager_id || undefined,\n    managerName: row.manager?.name || undefined,\n    scheduledAt: row.scheduled_at,\n    durationMinutes: row.duration_minutes || undefined,\n    location: row.location || undefined,\n    status: row.status as OneToOneMeetingStatus,\n    templateName: row.template_name || undefined,\n    sharedAgenda: row.shared_agenda || undefined,\n    employeeNotesPrivate: row.employee_notes_private || undefined,\n    managerNotesPrivate: row.manager_notes_private || undefined,\n    createdAt: row.created_at,\n    updatedAt: row.updated_at || undefined,\n  }));\n}\n\nexport async function getMeetingsForManager(managerId: string): Promise<OneToOneMeeting[]> {\n  const { data, error } = await supabase\n    .from(\"one_to_one_meetings\")\n    .select(\"*, employee:employee_id(name), manager:manager_id(name)\")\n    .eq(\"manager_id\", managerId)\n    .order(\"scheduled_at\", { ascending: false });\n\n  if (error) {\n    console.error(\"Error fetching meetings for manager:\", error);\n    return [];\n  }\n\n  return (data || []).map((row) => ({\n    id: row.id,\n    employeeId: row.employee_id,\n    employeeName: row.employee?.name || undefined,\n    managerId: row.manager_id || undefined,\n    managerName: row.manager?.name || undefined,\n    scheduledAt: row.scheduled_at,\n    durationMinutes: row.duration_minutes || undefined,\n    location: row.location || undefined,\n    status: row.status as OneToOneMeetingStatus,\n    templateName: row.template_name || undefined,\n    sharedAgenda: row.shared_agenda || undefined,\n    employeeNotesPrivate: row.employee_notes_private || undefined,\n    managerNotesPrivate: row.manager_notes_private || undefined,\n    createdAt: row.created_at,\n    updatedAt: row.updated_at || undefined,\n  }));\n}\n\nexport async function getMeetingById(id: string): Promise<OneToOneMeeting | null> {\n  const { data, error } = await supabase\n    .from(\"one_to_one_meetings\")\n    .select(\"*, employee:employee_id(name), manager:manager_id(name)\")\n    .eq(\"id\", id)\n    .single();\n\n  if (error || !data) {\n    console.error(\"Error fetching meeting:\", error);\n    return null;\n  }\n\n  return {\n    id: data.id,\n    employeeId: data.employee_id,\n    employeeName: data.employee?.name || undefined,\n    managerId: data.manager_id || undefined,\n    managerName: data.manager?.name || undefined,\n    scheduledAt: data.scheduled_at,\n    durationMinutes: data.duration_minutes || undefined,\n    location: data.location || undefined,\n    status: data.status as OneToOneMeetingStatus,\n    templateName: data.template_name || undefined,\n    sharedAgenda: data.shared_agenda || undefined,\n    employeeNotesPrivate: data.employee_notes_private || undefined,\n    managerNotesPrivate: data.manager_notes_private || undefined,\n    createdAt: data.created_at,\n    updatedAt: data.updated_at || undefined,\n  };\n}\n\nexport type CreateMeetingPayload = {\n  employeeId: string;\n  managerId: string;\n  scheduledAt: string;\n  durationMinutes?: number;\n  location?: string;\n  templateName?: string;\n  sharedAgenda?: string;\n};\n\nexport async function createMeeting(payload: CreateMeetingPayload): Promise<OneToOneMeeting | null> {\n  if (!payload.employeeId || !payload.managerId || !payload.scheduledAt) {\n    console.error(\"Invalid meeting payload: missing required fields\");\n    return null;\n  }\n\n  const { data, error } = await supabase\n    .from(\"one_to_one_meetings\")\n    .insert({\n      employee_id: payload.employeeId,\n      manager_id: payload.managerId,\n      scheduled_at: payload.scheduledAt,\n      duration_minutes: payload.durationMinutes || null,\n      location: payload.location || null,\n      template_name: payload.templateName || null,\n      shared_agenda: payload.sharedAgenda || null,\n      status: \"planned\",\n    })\n    .select()\n    .single();\n\n  if (error || !data) {\n    console.error(\"Error creating meeting:\", error);\n    return null;\n  }\n\n  return {\n    id: data.id,\n    employeeId: data.employee_id,\n    managerId: data.manager_id || undefined,\n    scheduledAt: data.scheduled_at,\n    durationMinutes: data.duration_minutes || undefined,\n    location: data.location || undefined,\n    status: data.status as OneToOneMeetingStatus,\n    templateName: data.template_name || undefined,\n    sharedAgenda: data.shared_agenda || undefined,\n    employeeNotesPrivate: data.employee_notes_private || undefined,\n    managerNotesPrivate: data.manager_notes_private || undefined,\n    createdAt: data.created_at,\n    updatedAt: data.updated_at || undefined,\n  };\n}\n\nexport type UpdateMeetingPayload = {\n  status?: OneToOneMeetingStatus;\n  sharedAgenda?: string;\n  employeeNotesPrivate?: string;\n  managerNotesPrivate?: string;\n  scheduledAt?: string;\n  durationMinutes?: number;\n  location?: string;\n};\n\nexport async function updateMeeting(id: string, updates: UpdateMeetingPayload): Promise<boolean> {\n  if (!id) {\n    console.error(\"Invalid updateMeeting: missing meeting id\");\n    return false;\n  }\n\n  const validStatuses: OneToOneMeetingStatus[] = [\"planned\", \"in_progress\", \"completed\", \"cancelled\"];\n  if (updates.status !== undefined && !validStatuses.includes(updates.status)) {\n    console.error(\"Invalid status value:\", updates.status);\n    return false;\n  }\n\n  const updateData: Record<string, unknown> = { updated_at: new Date().toISOString() };\n  \n  if (updates.status !== undefined) updateData.status = updates.status;\n  if (updates.sharedAgenda !== undefined) updateData.shared_agenda = updates.sharedAgenda;\n  if (updates.employeeNotesPrivate !== undefined) updateData.employee_notes_private = updates.employeeNotesPrivate;\n  if (updates.managerNotesPrivate !== undefined) updateData.manager_notes_private = updates.managerNotesPrivate;\n  if (updates.scheduledAt !== undefined) updateData.scheduled_at = updates.scheduledAt;\n  if (updates.durationMinutes !== undefined) updateData.duration_minutes = updates.durationMinutes;\n  if (updates.location !== undefined) updateData.location = updates.location;\n\n  const { error } = await supabase\n    .from(\"one_to_one_meetings\")\n    .update(updateData)\n    .eq(\"id\", id);\n\n  if (error) {\n    console.error(\"Error updating meeting:\", error);\n    return false;\n  }\n\n  return true;\n}\n\nexport async function getActionsForMeeting(meetingId: string): Promise<OneToOneAction[]> {\n  const { data, error } = await supabase\n    .from(\"one_to_one_actions\")\n    .select(\"*\")\n    .eq(\"meeting_id\", meetingId)\n    .order(\"created_at\", { ascending: true });\n\n  if (error) {\n    console.error(\"Error fetching actions:\", error);\n    return [];\n  }\n\n  return (data || []).map((row) => ({\n    id: row.id,\n    meetingId: row.meeting_id,\n    description: row.description,\n    ownerType: row.owner_type as OneToOneActionOwner,\n    isCompleted: row.is_completed,\n    dueDate: row.due_date || undefined,\n    createdAt: row.created_at,\n    completedAt: row.completed_at || undefined,\n  }));\n}\n\nexport type AddActionPayload = {\n  description: string;\n  ownerType: OneToOneActionOwner;\n  dueDate?: string;\n};\n\nexport async function addAction(meetingId: string, payload: AddActionPayload): Promise<OneToOneAction | null> {\n  if (!meetingId || !payload.description || !payload.description.trim()) {\n    console.error(\"Invalid action payload: missing meetingId or description\");\n    return null;\n  }\n\n  const { data, error } = await supabase\n    .from(\"one_to_one_actions\")\n    .insert({\n      meeting_id: meetingId,\n      description: payload.description.trim(),\n      owner_type: payload.ownerType,\n      due_date: payload.dueDate || null,\n    })\n    .select()\n    .single();\n\n  if (error || !data) {\n    console.error(\"Error adding action:\", error);\n    return null;\n  }\n\n  return {\n    id: data.id,\n    meetingId: data.meeting_id,\n    description: data.description,\n    ownerType: data.owner_type as OneToOneActionOwner,\n    isCompleted: data.is_completed,\n    dueDate: data.due_date || undefined,\n    createdAt: data.created_at,\n    completedAt: data.completed_at || undefined,\n  };\n}\n\nexport async function completeAction(actionId: string): Promise<boolean> {\n  const { error } = await supabase\n    .from(\"one_to_one_actions\")\n    .update({\n      is_completed: true,\n      completed_at: new Date().toISOString(),\n    })\n    .eq(\"id\", actionId);\n\n  if (error) {\n    console.error(\"Error completing action:\", error);\n    return false;\n  }\n\n  return true;\n}\n\nexport async function getUpcomingMeetings(daysAhead: number = 7): Promise<OneToOneMeeting[]> {\n  const now = new Date();\n  const futureDate = new Date(now.getTime() + daysAhead * 24 * 60 * 60 * 1000);\n\n  const { data, error } = await supabase\n    .from(\"one_to_one_meetings\")\n    .select(\"*, employee:employee_id(name, email), manager:manager_id(name, email)\")\n    .eq(\"status\", \"planned\")\n    .gte(\"scheduled_at\", now.toISOString())\n    .lte(\"scheduled_at\", futureDate.toISOString())\n    .order(\"scheduled_at\", { ascending: true });\n\n  if (error) {\n    console.error(\"Error fetching upcoming meetings:\", error);\n    return [];\n  }\n\n  return (data || []).map((row) => ({\n    id: row.id,\n    employeeId: row.employee_id,\n    employeeName: row.employee?.name || undefined,\n    managerId: row.manager_id || undefined,\n    managerName: row.manager?.name || undefined,\n    scheduledAt: row.scheduled_at,\n    durationMinutes: row.duration_minutes || undefined,\n    location: row.location || undefined,\n    status: row.status as OneToOneMeetingStatus,\n    templateName: row.template_name || undefined,\n    sharedAgenda: row.shared_agenda || undefined,\n    employeeNotesPrivate: row.employee_notes_private || undefined,\n    managerNotesPrivate: row.manager_notes_private || undefined,\n    createdAt: row.created_at,\n    updatedAt: row.updated_at || undefined,\n  }));\n}\n\nexport async function getOverdueActions(): Promise<(OneToOneAction & { employeeEmail?: string; managerEmail?: string })[]> {\n  const today = new Date().toISOString().split(\"T\")[0];\n\n  const { data, error } = await supabase\n    .from(\"one_to_one_actions\")\n    .select(\"*, meeting:meeting_id(employee:employee_id(email), manager:manager_id(email))\")\n    .eq(\"is_completed\", false)\n    .lt(\"due_date\", today);\n\n  if (error) {\n    console.error(\"Error fetching overdue actions:\", error);\n    return [];\n  }\n\n  return (data || []).map((row) => ({\n    id: row.id,\n    meetingId: row.meeting_id,\n    description: row.description,\n    ownerType: row.owner_type as OneToOneActionOwner,\n    isCompleted: row.is_completed,\n    dueDate: row.due_date || undefined,\n    createdAt: row.created_at,\n    completedAt: row.completed_at || undefined,\n    employeeEmail: row.meeting?.employee?.email || undefined,\n    managerEmail: row.meeting?.manager?.email || undefined,\n  }));\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 374, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/services/notifications.ts"],"sourcesContent":["import { supabase } from \"@/lib/supabaseClient\";\nimport type { PersonEvent } from \"@/types/domain\";\nimport { getUpcomingMeetings, getOverdueActions } from \"./oneToOne\";\n\nexport async function enqueueDueEventNotifications(referenceDate: Date): Promise<number> {\n  const { data: events, error } = await supabase\n    .from(\"person_events\")\n    .select(\"*, employee:employee_id(name, email), manager:owner_manager_id(name, email)\")\n    .in(\"status\", [\"due_soon\", \"overdue\"]);\n\n  if (error || !events) {\n    console.error(\"Error fetching due events:\", error);\n    return 0;\n  }\n\n  let count = 0;\n\n  for (const event of events) {\n    const employeeEmail = event.employee?.email;\n    const managerEmail = event.manager?.email;\n\n    if (employeeEmail) {\n      const subject = event.status === \"overdue\"\n        ? `[OVERDUE] ${event.title}`\n        : `[Due Soon] ${event.title}`;\n\n      const body = `\nHello ${event.employee?.name || \"\"},\n\nThis is a reminder about the following task:\n\nTitle: ${event.title}\nCategory: ${event.category}\nDue Date: ${event.due_date}\nStatus: ${event.status}\n${event.description ? `\\nDescription: ${event.description}` : \"\"}\n\nPlease take action as soon as possible.\n\nBest regards,\nIndustrial Competence Platform\n      `.trim();\n\n      const { error: insertError } = await supabase.from(\"email_outbox\").insert({\n        to_email: employeeEmail,\n        subject,\n        body,\n        status: \"pending\",\n        meta: { event_id: event.id, type: \"due_event_employee\" },\n      });\n      if (insertError) {\n        console.error(\"Error inserting employee notification:\", insertError);\n      } else {\n        count++;\n      }\n    }\n\n    if (managerEmail && managerEmail !== employeeEmail) {\n      const subject = event.status === \"overdue\"\n        ? `[OVERDUE] Action required for ${event.employee?.name}: ${event.title}`\n        : `[Due Soon] Reminder for ${event.employee?.name}: ${event.title}`;\n\n      const body = `\nHello ${event.manager?.name || \"\"},\n\nThis is a reminder about a task for your team member ${event.employee?.name || \"\"}:\n\nTitle: ${event.title}\nCategory: ${event.category}\nDue Date: ${event.due_date}\nStatus: ${event.status}\n${event.description ? `\\nDescription: ${event.description}` : \"\"}\n\nPlease ensure this is addressed.\n\nBest regards,\nIndustrial Competence Platform\n      `.trim();\n\n      const { error: insertError } = await supabase.from(\"email_outbox\").insert({\n        to_email: managerEmail,\n        subject,\n        body,\n        status: \"pending\",\n        meta: { event_id: event.id, type: \"due_event_manager\" },\n      });\n      if (insertError) {\n        console.error(\"Error inserting manager notification:\", insertError);\n      } else {\n        count++;\n      }\n    }\n  }\n\n  return count;\n}\n\nexport async function enqueueUpcomingOneToOnes(referenceDate: Date): Promise<number> {\n  const meetings = await getUpcomingMeetings(7);\n\n  let count = 0;\n\n  for (const meeting of meetings) {\n    const { data: employeeData } = await supabase\n      .from(\"employees\")\n      .select(\"email\")\n      .eq(\"id\", meeting.employeeId)\n      .single();\n\n    const { data: managerData } = await supabase\n      .from(\"employees\")\n      .select(\"email\")\n      .eq(\"id\", meeting.managerId)\n      .single();\n\n    const scheduledDate = new Date(meeting.scheduledAt).toLocaleDateString(\"sv-SE\");\n    const scheduledTime = new Date(meeting.scheduledAt).toLocaleTimeString(\"sv-SE\", {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n\n    if (employeeData?.email) {\n      const subject = `Upcoming 1:1 Meeting on ${scheduledDate}`;\n      const body = `\nHello ${meeting.employeeName || \"\"},\n\nYou have an upcoming 1:1 meeting scheduled:\n\nDate: ${scheduledDate}\nTime: ${scheduledTime}\n${meeting.location ? `Location: ${meeting.location}` : \"\"}\n${meeting.templateName ? `Type: ${meeting.templateName}` : \"\"}\n\n${meeting.sharedAgenda ? `Agenda:\\n${meeting.sharedAgenda}` : \"Please prepare any topics you would like to discuss.\"}\n\nBest regards,\nIndustrial Competence Platform\n      `.trim();\n\n      const { error: insertError } = await supabase.from(\"email_outbox\").insert({\n        to_email: employeeData.email,\n        subject,\n        body,\n        status: \"pending\",\n        meta: { meeting_id: meeting.id, type: \"upcoming_1to1_employee\" },\n      });\n      if (insertError) {\n        console.error(\"Error inserting employee meeting notification:\", insertError);\n      } else {\n        count++;\n      }\n    }\n\n    if (managerData?.email) {\n      const subject = `Upcoming 1:1 with ${meeting.employeeName} on ${scheduledDate}`;\n      const body = `\nHello ${meeting.managerName || \"\"},\n\nYou have an upcoming 1:1 meeting with ${meeting.employeeName}:\n\nDate: ${scheduledDate}\nTime: ${scheduledTime}\n${meeting.location ? `Location: ${meeting.location}` : \"\"}\n${meeting.templateName ? `Type: ${meeting.templateName}` : \"\"}\n\n${meeting.sharedAgenda ? `Agenda:\\n${meeting.sharedAgenda}` : \"\"}\n\nBest regards,\nIndustrial Competence Platform\n      `.trim();\n\n      const { error: insertError } = await supabase.from(\"email_outbox\").insert({\n        to_email: managerData.email,\n        subject,\n        body,\n        status: \"pending\",\n        meta: { meeting_id: meeting.id, type: \"upcoming_1to1_manager\" },\n      });\n      if (insertError) {\n        console.error(\"Error inserting manager meeting notification:\", insertError);\n      } else {\n        count++;\n      }\n    }\n  }\n\n  return count;\n}\n\nexport async function enqueueOverdueActions(referenceDate: Date): Promise<number> {\n  const overdueActions = await getOverdueActions();\n\n  let count = 0;\n\n  for (const action of overdueActions) {\n    const recipientEmail = action.ownerType === \"employee\"\n      ? action.employeeEmail\n      : action.managerEmail;\n\n    if (recipientEmail) {\n      const subject = `[Overdue Action] ${action.description.substring(0, 50)}...`;\n      const body = `\nHello,\n\nYou have an overdue action item from a 1:1 meeting:\n\nAction: ${action.description}\nDue Date: ${action.dueDate}\n\nPlease complete this action as soon as possible.\n\nBest regards,\nIndustrial Competence Platform\n      `.trim();\n\n      const { error: insertError } = await supabase.from(\"email_outbox\").insert({\n        to_email: recipientEmail,\n        subject,\n        body,\n        status: \"pending\",\n        meta: { action_id: action.id, type: \"overdue_action\" },\n      });\n      if (insertError) {\n        console.error(\"Error inserting overdue action notification:\", insertError);\n      } else {\n        count++;\n      }\n    }\n  }\n\n  return count;\n}\n\nexport async function getPendingEmails(): Promise<number> {\n  const { count, error } = await supabase\n    .from(\"email_outbox\")\n    .select(\"*\", { count: \"exact\", head: true })\n    .eq(\"status\", \"pending\");\n\n  if (error) {\n    console.error(\"Error counting pending emails:\", error);\n    return 0;\n  }\n\n  return count || 0;\n}\n\nexport async function markEmailSent(emailId: string): Promise<boolean> {\n  const { error } = await supabase\n    .from(\"email_outbox\")\n    .update({\n      status: \"sent\",\n      sent_at: new Date().toISOString(),\n    })\n    .eq(\"id\", emailId);\n\n  return !error;\n}\n\nexport async function markEmailFailed(emailId: string, errorMessage: string): Promise<boolean> {\n  const { error } = await supabase\n    .from(\"email_outbox\")\n    .update({\n      status: \"failed\",\n      error_message: errorMessage,\n    })\n    .eq(\"id\", emailId);\n\n  return !error;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 624, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/cron/daily-notifications/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport {\n  enqueueDueEventNotifications,\n  enqueueUpcomingOneToOnes,\n  enqueueOverdueActions,\n} from \"@/services/notifications\";\n\nexport async function GET() {\n  const referenceDate = new Date();\n\n  try {\n    const [dueEventCount, upcomingCount, overdueCount] = await Promise.all([\n      enqueueDueEventNotifications(referenceDate),\n      enqueueUpcomingOneToOnes(referenceDate),\n      enqueueOverdueActions(referenceDate),\n    ]);\n\n    return NextResponse.json({\n      success: true,\n      referenceDate: referenceDate.toISOString(),\n      notifications: {\n        dueEvents: dueEventCount,\n        upcomingOneToOnes: upcomingCount,\n        overdueActions: overdueCount,\n        total: dueEventCount + upcomingCount + overdueCount,\n      },\n    });\n  } catch (error) {\n    console.error(\"Error running daily notifications:\", error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : \"Unknown error\",\n      },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST() {\n  return GET();\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAMO,eAAe;IACpB,MAAM,gBAAgB,IAAI;IAE1B,IAAI;QACF,MAAM,CAAC,eAAe,eAAe,aAAa,GAAG,MAAM,QAAQ,GAAG,CAAC;YACrE,IAAA,2JAA4B,EAAC;YAC7B,IAAA,uJAAwB,EAAC;YACzB,IAAA,oJAAqB,EAAC;SACvB;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,eAAe,cAAc,WAAW;YACxC,eAAe;gBACb,WAAW;gBACX,mBAAmB;gBACnB,gBAAgB;gBAChB,OAAO,gBAAgB,gBAAgB;YACzC;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;QACpD,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAClD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe;IACpB,OAAO;AACT"}}]
}