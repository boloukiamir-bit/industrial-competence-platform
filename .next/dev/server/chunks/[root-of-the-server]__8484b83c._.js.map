{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/pgClient.ts"],"sourcesContent":["import { Pool } from \"pg\";\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.DATABASE_URL?.includes(\"localhost\") ? false : { rejectUnauthorized: false },\n});\n\nexport default pool;\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,QAAQ,GAAG,CAAC,YAAY,EAAE,SAAS,eAAe,QAAQ;QAAE,oBAAoB;IAAM;AAC7F;uCAEe"}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/workflows/dashboard/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport pool from \"@/lib/pgClient\";\nimport { cookies } from \"next/headers\";\n\nasync function getOrgId(request: NextRequest): Promise<string | null> {\n  const orgId = request.headers.get(\"x-org-id\");\n  if (orgId) return orgId;\n  \n  const cookieStore = await cookies();\n  const orgCookie = cookieStore.get(\"current_org_id\");\n  return orgCookie?.value || null;\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const orgId = await getOrgId(request);\n    if (!orgId) {\n      return NextResponse.json({ error: \"Organization ID required\" }, { status: 400 });\n    }\n\n    const activeResult = await pool.query(`\n      SELECT COUNT(*) as count \n      FROM wf_instances \n      WHERE org_id = $1 AND status = 'active'\n    `, [orgId]);\n\n    const overdueResult = await pool.query(`\n      SELECT COUNT(*) as count \n      FROM wf_instance_tasks t\n      JOIN wf_instances i ON i.id = t.instance_id\n      WHERE i.org_id = $1 \n        AND i.status = 'active'\n        AND t.status != 'done'\n        AND t.due_date < CURRENT_DATE\n    `, [orgId]);\n\n    const byTemplateResult = await pool.query(`\n      SELECT \n        wt.name as template_name,\n        wt.category,\n        COUNT(i.id) as count\n      FROM wf_instances i\n      LEFT JOIN wf_templates wt ON wt.id = i.template_id\n      WHERE i.org_id = $1 AND i.status = 'active'\n      GROUP BY wt.name, wt.category\n      ORDER BY count DESC\n    `, [orgId]);\n\n    const recentResult = await pool.query(`\n      SELECT \n        i.id,\n        i.employee_name,\n        i.status,\n        i.start_date,\n        i.due_date,\n        i.updated_at,\n        i.area_code,\n        wt.name as template_name,\n        wt.category as template_category,\n        (SELECT COUNT(*) FROM wf_instance_tasks WHERE instance_id = i.id) as total_tasks,\n        (SELECT COUNT(*) FROM wf_instance_tasks WHERE instance_id = i.id AND status = 'done') as done_tasks\n      FROM wf_instances i\n      LEFT JOIN wf_templates wt ON wt.id = i.template_id\n      WHERE i.org_id = $1\n      ORDER BY i.updated_at DESC\n      LIMIT 10\n    `, [orgId]);\n\n    const completedTodayResult = await pool.query(`\n      SELECT COUNT(*) as count \n      FROM wf_instances \n      WHERE org_id = $1 \n        AND status = 'completed'\n        AND completed_at::date = CURRENT_DATE\n    `, [orgId]);\n\n    return NextResponse.json({\n      activeWorkflows: parseInt(activeResult.rows[0].count),\n      overdueTasks: parseInt(overdueResult.rows[0].count),\n      completedToday: parseInt(completedTodayResult.rows[0].count),\n      byTemplate: byTemplateResult.rows.map((row: any) => ({\n        templateName: row.template_name || \"Unknown\",\n        category: row.category,\n        count: parseInt(row.count),\n      })),\n      recentInstances: recentResult.rows.map((row: any) => ({\n        id: row.id,\n        employeeName: row.employee_name,\n        status: row.status,\n        startDate: row.start_date,\n        dueDate: row.due_date,\n        updatedAt: row.updated_at,\n        areaCode: row.area_code,\n        templateName: row.template_name,\n        templateCategory: row.template_category,\n        progress: {\n          total: parseInt(row.total_tasks),\n          done: parseInt(row.done_tasks),\n          percent: row.total_tasks > 0 ? Math.round((parseInt(row.done_tasks) / parseInt(row.total_tasks)) * 100) : 0,\n        },\n      })),\n    });\n  } catch (err) {\n    console.error(\"Dashboard error:\", err);\n    return NextResponse.json(\n      { error: err instanceof Error ? err.message : \"Failed to fetch dashboard\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEA,eAAe,SAAS,OAAoB;IAC1C,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC;IAClC,IAAI,OAAO,OAAO;IAElB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,YAAY,YAAY,GAAG,CAAC;IAClC,OAAO,WAAW,SAAS;AAC7B;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,QAAQ,MAAM,SAAS;QAC7B,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,MAAM,eAAe,MAAM,4HAAI,CAAC,KAAK,CAAC,CAAC;;;;IAIvC,CAAC,EAAE;YAAC;SAAM;QAEV,MAAM,gBAAgB,MAAM,4HAAI,CAAC,KAAK,CAAC,CAAC;;;;;;;;IAQxC,CAAC,EAAE;YAAC;SAAM;QAEV,MAAM,mBAAmB,MAAM,4HAAI,CAAC,KAAK,CAAC,CAAC;;;;;;;;;;IAU3C,CAAC,EAAE;YAAC;SAAM;QAEV,MAAM,eAAe,MAAM,4HAAI,CAAC,KAAK,CAAC,CAAC;;;;;;;;;;;;;;;;;;IAkBvC,CAAC,EAAE;YAAC;SAAM;QAEV,MAAM,uBAAuB,MAAM,4HAAI,CAAC,KAAK,CAAC,CAAC;;;;;;IAM/C,CAAC,EAAE;YAAC;SAAM;QAEV,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,iBAAiB,SAAS,aAAa,IAAI,CAAC,EAAE,CAAC,KAAK;YACpD,cAAc,SAAS,cAAc,IAAI,CAAC,EAAE,CAAC,KAAK;YAClD,gBAAgB,SAAS,qBAAqB,IAAI,CAAC,EAAE,CAAC,KAAK;YAC3D,YAAY,iBAAiB,IAAI,CAAC,GAAG,CAAC,CAAC,MAAa,CAAC;oBACnD,cAAc,IAAI,aAAa,IAAI;oBACnC,UAAU,IAAI,QAAQ;oBACtB,OAAO,SAAS,IAAI,KAAK;gBAC3B,CAAC;YACD,iBAAiB,aAAa,IAAI,CAAC,GAAG,CAAC,CAAC,MAAa,CAAC;oBACpD,IAAI,IAAI,EAAE;oBACV,cAAc,IAAI,aAAa;oBAC/B,QAAQ,IAAI,MAAM;oBAClB,WAAW,IAAI,UAAU;oBACzB,SAAS,IAAI,QAAQ;oBACrB,WAAW,IAAI,UAAU;oBACzB,UAAU,IAAI,SAAS;oBACvB,cAAc,IAAI,aAAa;oBAC/B,kBAAkB,IAAI,iBAAiB;oBACvC,UAAU;wBACR,OAAO,SAAS,IAAI,WAAW;wBAC/B,MAAM,SAAS,IAAI,UAAU;wBAC7B,SAAS,IAAI,WAAW,GAAG,IAAI,KAAK,KAAK,CAAC,AAAC,SAAS,IAAI,UAAU,IAAI,SAAS,IAAI,WAAW,IAAK,OAAO;oBAC5G;gBACF,CAAC;QACH;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,eAAe,QAAQ,IAAI,OAAO,GAAG;QAA4B,GAC1E;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}