{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/pgClient.ts"],"sourcesContent":["import { Pool } from \"pg\";\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.DATABASE_URL?.includes(\"localhost\") ? false : { rejectUnauthorized: false },\n});\n\nexport default pool;\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,QAAQ,GAAG,CAAC,YAAY,EAAE,SAAS,eAAe,QAAQ;QAAE,oBAAoB;IAAM;AAC7F;uCAEe"}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/spaljisten/setup/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport pool from \"@/lib/pgClient\";\n\nconst SETUP_SECRET = process.env.SPALJISTEN_SETUP_SECRET || \"sp-go-live-2024\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    const authHeader = request.headers.get(\"x-setup-secret\");\n    const body = await request.json();\n    const { email, secret } = body;\n    \n    const providedSecret = authHeader || secret;\n    if (providedSecret !== SETUP_SECRET) {\n      return NextResponse.json({ error: \"Unauthorized: Invalid setup secret\" }, { status: 401 });\n    }\n    \n    if (!email || email.toLowerCase() !== \"daniel.buhre@spaljisten.se\") {\n      return NextResponse.json({ error: \"Invalid setup request: Only daniel.buhre@spaljisten.se can be set up\" }, { status: 400 });\n    }\n\n    const client = await pool.connect();\n    try {\n      const result = await client.query(\"SELECT sp_setup_daniel_admin() as result\");\n      const setupResult = result.rows[0]?.result;\n      \n      if (!setupResult?.success) {\n        return NextResponse.json({ error: setupResult?.error || \"Setup failed\" }, { status: 400 });\n      }\n\n      return NextResponse.json({\n        success: true,\n        message: \"Daniel Buhre has been set up as Customer Admin + Data Owner for Spaljisten\",\n        details: setupResult,\n      });\n    } finally {\n      client.release();\n    }\n  } catch (error) {\n    console.error(\"Setup error:\", error);\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : \"Setup failed\" },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function GET() {\n  return NextResponse.json({\n    message: \"Spaljisten Go-Live Setup API\",\n    instructions: [\n      \"1. Daniel signs up at /login with email: daniel.buhre@spaljisten.se\",\n      \"2. POST to this endpoint with { email: 'daniel.buhre@spaljisten.se', secret: '<setup-secret>' }\",\n      \"3. Or run SQL directly: SELECT sp_setup_daniel_admin();\",\n      \"4. Daniel can then access /app/spaljisten/import and /app/spaljisten/dashboard\",\n    ],\n    note: \"This endpoint requires a setup secret for security\",\n  });\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;;;;;AAEA,MAAM,eAAe,QAAQ,GAAG,CAAC,uBAAuB,IAAI;AAErD,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG;QAE1B,MAAM,iBAAiB,cAAc;QACrC,IAAI,mBAAmB,cAAc;YACnC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqC,GAAG;gBAAE,QAAQ;YAAI;QAC1F;QAEA,IAAI,CAAC,SAAS,MAAM,WAAW,OAAO,8BAA8B;YAClE,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuE,GAAG;gBAAE,QAAQ;YAAI;QAC5H;QAEA,MAAM,SAAS,MAAM,4HAAI,CAAC,OAAO;QACjC,IAAI;YACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC;YAClC,MAAM,cAAc,OAAO,IAAI,CAAC,EAAE,EAAE;YAEpC,IAAI,CAAC,aAAa,SAAS;gBACzB,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,OAAO,aAAa,SAAS;gBAAe,GAAG;oBAAE,QAAQ;gBAAI;YAC1F;YAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,SAAS;gBACT,SAAS;YACX;QACF,SAAU;YACR,OAAO,OAAO;QAChB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAe,GACjE;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe;IACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;QACvB,SAAS;QACT,cAAc;YACZ;YACA;YACA;YACA;SACD;QACD,MAAM;IACR;AACF"}}]
}