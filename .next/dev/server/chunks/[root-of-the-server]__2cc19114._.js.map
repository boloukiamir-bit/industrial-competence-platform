{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/pgClient.ts"],"sourcesContent":["import { Pool } from \"pg\";\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.DATABASE_URL?.includes(\"localhost\") ? false : { rejectUnauthorized: false },\n});\n\nexport default pool;\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,QAAQ,GAAG,CAAC,YAAY,EAAE,SAAS,eAAe,QAAQ;QAAE,oBAAoB;IAAM;AAC7F;uCAEe"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/spaliDevMode.ts"],"sourcesContent":["export function getSpaliDevMode(): boolean {\n  if (typeof window === \"undefined\") {\n    return process.env.SPALI_DEV_MODE === \"true\";\n  }\n  return process.env.NEXT_PUBLIC_SPALI_DEV_MODE === \"true\";\n}\n\nexport const SPALJISTEN_ORG_ID = \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\";\n"],"names":[],"mappings":";;;;;;AAAO,SAAS;IACd,wCAAmC;QACjC,OAAO,QAAQ,GAAG,CAAC,cAAc,KAAK;IACxC;;;AAEF;AAEO,MAAM,oBAAoB"}},
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/spaljisten/smoke-test/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport pool from \"@/lib/pgClient\";\nimport { getSpaliDevMode, SPALJISTEN_ORG_ID } from \"@/lib/spaliDevMode\";\n\ntype SmokeTestResult = {\n  timestamp: string;\n  orgId: string;\n  devMode: boolean;\n  checks: {\n    name: string;\n    status: \"pass\" | \"fail\" | \"warn\";\n    message: string;\n    value?: number | string;\n  }[];\n  overallStatus: \"pass\" | \"fail\" | \"warn\";\n  counts: {\n    areas: number;\n    stations: number;\n    employees: number;\n    skills: number;\n    ratings: number;\n  };\n};\n\nexport async function GET(request: NextRequest) {\n  const timestamp = new Date().toISOString();\n  const devMode = getSpaliDevMode();\n  const checks: SmokeTestResult[\"checks\"] = [];\n  const searchParams = request.nextUrl.searchParams;\n  const expectZero = searchParams.get(\"expectZero\") === \"true\";\n\n  let overallStatus: \"pass\" | \"fail\" | \"warn\" = \"pass\";\n  let counts = { areas: 0, stations: 0, employees: 0, skills: 0, ratings: 0 };\n\n  try {\n    const client = await pool.connect();\n    try {\n      // Check 1: Database connection\n      checks.push({\n        name: \"Database Connection\",\n        status: \"pass\",\n        message: \"Connected to PostgreSQL successfully\",\n      });\n\n      // Check 2: Count areas\n      const areasRes = await client.query(\n        \"SELECT COUNT(*) as count FROM sp_areas WHERE org_id = $1\",\n        [SPALJISTEN_ORG_ID]\n      );\n      const areaCount = parseInt(areasRes.rows[0].count, 10);\n      counts.areas = areaCount;\n\n      // Check 3: Count stations\n      const stationsRes = await client.query(\n        \"SELECT COUNT(*) as count FROM sp_stations WHERE org_id = $1\",\n        [SPALJISTEN_ORG_ID]\n      );\n      const stationCount = parseInt(stationsRes.rows[0].count, 10);\n      counts.stations = stationCount;\n\n      // Check 4: Count employees\n      const employeesRes = await client.query(\n        \"SELECT COUNT(*) as count FROM sp_employees WHERE org_id = $1 AND is_active = true\",\n        [SPALJISTEN_ORG_ID]\n      );\n      const employeeCount = parseInt(employeesRes.rows[0].count, 10);\n      counts.employees = employeeCount;\n\n      // Check 5: Count skills\n      const skillsRes = await client.query(\n        \"SELECT COUNT(*) as count FROM sp_skills WHERE org_id = $1\",\n        [SPALJISTEN_ORG_ID]\n      );\n      const skillCount = parseInt(skillsRes.rows[0].count, 10);\n      counts.skills = skillCount;\n\n      // Check 6: Count ratings\n      const ratingsRes = await client.query(\n        \"SELECT COUNT(*) as count FROM sp_employee_skills WHERE org_id = $1\",\n        [SPALJISTEN_ORG_ID]\n      );\n      const ratingCount = parseInt(ratingsRes.rows[0].count, 10);\n      counts.ratings = ratingCount;\n\n      // If expectZero=true, FAIL if any count > 0\n      if (expectZero) {\n        const totalCount = areaCount + stationCount + employeeCount + skillCount + ratingCount;\n        if (totalCount > 0) {\n          checks.push({\n            name: \"Reset Verification\",\n            status: \"fail\",\n            message: `Expected all counts to be 0 after reset, but found: Areas=${areaCount}, Stations=${stationCount}, Employees=${employeeCount}, Skills=${skillCount}, Ratings=${ratingCount}`,\n            value: totalCount,\n          });\n          overallStatus = \"fail\";\n        } else {\n          checks.push({\n            name: \"Reset Verification\",\n            status: \"pass\",\n            message: \"All counts are 0 - reset successful\",\n            value: 0,\n          });\n        }\n      } else {\n        // Normal mode - report counts\n        checks.push({\n          name: \"Areas Count\",\n          status: areaCount > 0 ? \"pass\" : \"warn\",\n          message: areaCount > 0 ? `Found ${areaCount} areas` : \"No areas found - import areas.csv first\",\n          value: areaCount,\n        });\n\n        checks.push({\n          name: \"Stations Count\",\n          status: stationCount > 0 ? \"pass\" : \"warn\",\n          message: stationCount > 0 ? `Found ${stationCount} stations` : \"No stations found\",\n          value: stationCount,\n        });\n\n        checks.push({\n          name: \"Employees Count\",\n          status: employeeCount > 0 ? \"pass\" : \"warn\",\n          message: employeeCount > 0 ? `Found ${employeeCount} active employees` : \"No employees found\",\n          value: employeeCount,\n        });\n\n        checks.push({\n          name: \"Skills Count\",\n          status: skillCount > 0 ? \"pass\" : \"warn\",\n          message: skillCount > 0 ? `Found ${skillCount} skills` : \"No skills found\",\n          value: skillCount,\n        });\n\n        checks.push({\n          name: \"Ratings Count\",\n          status: ratingCount > 0 ? \"pass\" : \"warn\",\n          message: ratingCount > 0 ? `Found ${ratingCount} skill ratings` : \"No ratings found\",\n          value: ratingCount,\n        });\n\n        // Check 7: Area filter query returns only filtered area\n        if (areaCount > 0) {\n          const firstAreaRes = await client.query(\n            \"SELECT id, area_name FROM sp_areas WHERE org_id = $1 LIMIT 1\",\n            [SPALJISTEN_ORG_ID]\n          );\n          const firstArea = firstAreaRes.rows[0];\n          \n          const filteredSkillsRes = await client.query(\n            `SELECT COUNT(*) as count FROM sp_skills s\n             JOIN sp_stations st ON s.station_id = st.id\n             WHERE s.org_id = $1 AND st.area_id = $2`,\n            [SPALJISTEN_ORG_ID, firstArea.id]\n          );\n          const filteredCount = parseInt(filteredSkillsRes.rows[0].count, 10);\n          \n          checks.push({\n            name: \"Area Filter Query\",\n            status: \"pass\",\n            message: `Filter for \"${firstArea.area_name}\" returns ${filteredCount} skills via station chain`,\n            value: filteredCount,\n          });\n        }\n\n        // Check 8: Export endpoint accessible\n        checks.push({\n          name: \"Export Endpoint\",\n          status: \"pass\",\n          message: \"Export endpoint available at /api/spaljisten/export\",\n        });\n      }\n\n      // Determine overall status\n      const failCount = checks.filter((c) => c.status === \"fail\").length;\n      const warnCount = checks.filter((c) => c.status === \"warn\").length;\n      \n      if (failCount > 0) overallStatus = \"fail\";\n      else if (warnCount > 0 && overallStatus !== \"fail\") overallStatus = \"warn\";\n\n    } finally {\n      client.release();\n    }\n  } catch (error) {\n    checks.push({\n      name: \"Database Connection\",\n      status: \"fail\",\n      message: error instanceof Error ? error.message : \"Connection failed\",\n    });\n    overallStatus = \"fail\";\n  }\n\n  const result: SmokeTestResult = {\n    timestamp,\n    orgId: SPALJISTEN_ORG_ID,\n    devMode,\n    checks,\n    overallStatus,\n    counts,\n  };\n\n  return NextResponse.json(result);\n}\n"],"names":[],"mappings":"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"}}]
}