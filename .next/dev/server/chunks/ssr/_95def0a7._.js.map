{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/app/import-employees/actions.ts"],"sourcesContent":["\"use server\";\n\nimport { supabase } from \"@/lib/supabaseClient\";\nimport Papa from \"papaparse\";\n\ninterface CsvRow {\n  name?: string;\n  employee_number?: string;\n  role?: string;\n  line?: string;\n  team?: string;\n  is_active?: string;\n}\n\ninterface ImportResult {\n  success: boolean;\n  message: string;\n  count?: number;\n}\n\nexport async function importEmployeesFromCsv(formData: FormData): Promise<ImportResult> {\n  const file = formData.get(\"file\") as File | null;\n\n  if (!file) {\n    return { success: false, message: \"No file provided\" };\n  }\n\n  const text = await file.text();\n\n  const parseResult = Papa.parse<CsvRow>(text, {\n    header: true,\n    skipEmptyLines: true,\n    transformHeader: (header) => header.trim().toLowerCase(),\n  });\n\n  if (parseResult.errors.length > 0) {\n    return {\n      success: false,\n      message: `CSV parsing error: ${parseResult.errors[0].message}`,\n    };\n  }\n\n  const rows = parseResult.data;\n\n  if (rows.length === 0) {\n    return { success: false, message: \"CSV file is empty\" };\n  }\n\n  const requiredColumns = [\"name\", \"employee_number\", \"role\", \"line\", \"team\"];\n  const headers = Object.keys(rows[0] || {});\n  const missingColumns = requiredColumns.filter((col) => !headers.includes(col));\n\n  if (missingColumns.length > 0) {\n    return {\n      success: false,\n      message: `Missing required columns: ${missingColumns.join(\", \")}`,\n    };\n  }\n\n  const employeesToUpsert: {\n    name: string;\n    employee_number: string;\n    role: string;\n    line: string;\n    team: string;\n    is_active: boolean;\n  }[] = [];\n\n  for (const row of rows) {\n    if (!row.name || !row.employee_number || !row.role || !row.line || !row.team) {\n      continue;\n    }\n\n    const isActive =\n      row.is_active === undefined ||\n      row.is_active === \"\" ||\n      row.is_active.toLowerCase() === \"true\" ||\n      row.is_active === \"1\";\n\n    employeesToUpsert.push({\n      name: row.name.trim(),\n      employee_number: row.employee_number.trim(),\n      role: row.role.trim(),\n      line: row.line.trim(),\n      team: row.team.trim(),\n      is_active: isActive,\n    });\n  }\n\n  if (employeesToUpsert.length === 0) {\n    return { success: false, message: \"No valid employee rows found in CSV\" };\n  }\n\n  const { error } = await supabase\n    .from(\"employees\")\n    .upsert(employeesToUpsert, { onConflict: \"employee_number\" });\n\n  if (error) {\n    return { success: false, message: `Database error: ${error.message}` };\n  }\n\n  return {\n    success: true,\n    message: `Imported ${employeesToUpsert.length} employees`,\n    count: employeesToUpsert.length,\n  };\n}\n"],"names":[],"mappings":";;;;;;;IAoBsB,yBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/app/import-employees/ImportForm.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef } from \"react\";\nimport { importEmployeesFromCsv } from \"./actions\";\n\nexport default function ImportForm() {\n  const [result, setResult] = useState<{\n    success: boolean;\n    message: string;\n  } | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const formRef = useRef<HTMLFormElement>(null);\n\n  async function handleSubmit(formData: FormData) {\n    setIsLoading(true);\n    setResult(null);\n\n    try {\n      const response = await importEmployeesFromCsv(formData);\n      setResult(response);\n      if (response.success) {\n        formRef.current?.reset();\n      }\n    } catch (error) {\n      setResult({\n        success: false,\n        message: error instanceof Error ? error.message : \"Unknown error occurred\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  }\n\n  return (\n    <form ref={formRef} action={handleSubmit} className=\"space-y-6\">\n      <div>\n        <label\n          htmlFor=\"csv-file\"\n          className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\"\n        >\n          CSV File\n        </label>\n        <input\n          type=\"file\"\n          id=\"csv-file\"\n          name=\"file\"\n          accept=\".csv\"\n          required\n          className=\"block w-full text-sm text-gray-900 dark:text-gray-100 \n            file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 \n            file:text-sm file:font-medium file:bg-gray-100 dark:file:bg-gray-700 \n            file:text-gray-700 dark:file:text-gray-200 \n            hover:file:bg-gray-200 dark:hover:file:bg-gray-600 \n            file:cursor-pointer cursor-pointer\"\n          data-testid=\"input-csv-file\"\n        />\n      </div>\n\n      <button\n        type=\"submit\"\n        disabled={isLoading}\n        className=\"px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium \n          hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed \n          transition-colors\"\n        data-testid=\"button-upload-import\"\n      >\n        {isLoading ? \"Importing...\" : \"Upload and import\"}\n      </button>\n\n      {result && (\n        <div\n          className={`p-4 rounded-md text-sm ${\n            result.success\n              ? \"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 border border-green-200 dark:border-green-800\"\n              : \"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 border border-red-200 dark:border-red-800\"\n          }`}\n          data-testid={result.success ? \"message-success\" : \"message-error\"}\n        >\n          {result.message}\n        </div>\n      )}\n    </form>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAKe,SAAS;IACtB,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAG1B;IACV,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,UAAU,IAAA,+MAAM,EAAkB;IAExC,eAAe,aAAa,QAAkB;QAC5C,aAAa;QACb,UAAU;QAEV,IAAI;YACF,MAAM,WAAW,MAAM,IAAA,mMAAsB,EAAC;YAC9C,UAAU;YACV,IAAI,SAAS,OAAO,EAAE;gBACpB,QAAQ,OAAO,EAAE;YACnB;QACF,EAAE,OAAO,OAAO;YACd,UAAU;gBACR,SAAS;gBACT,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YACpD;QACF,SAAU;YACR,aAAa;QACf;IACF;IAEA,qBACE,8OAAC;QAAK,KAAK;QAAS,QAAQ;QAAc,WAAU;;0BAClD,8OAAC;;kCACC,8OAAC;wBACC,SAAQ;wBACR,WAAU;kCACX;;;;;;kCAGD,8OAAC;wBACC,MAAK;wBACL,IAAG;wBACH,MAAK;wBACL,QAAO;wBACP,QAAQ;wBACR,WAAU;wBAMV,eAAY;;;;;;;;;;;;0BAIhB,8OAAC;gBACC,MAAK;gBACL,UAAU;gBACV,WAAU;gBAGV,eAAY;0BAEX,YAAY,iBAAiB;;;;;;YAG/B,wBACC,8OAAC;gBACC,WAAW,CAAC,uBAAuB,EACjC,OAAO,OAAO,GACV,sHACA,yGACJ;gBACF,eAAa,OAAO,OAAO,GAAG,oBAAoB;0BAEjD,OAAO,OAAO;;;;;;;;;;;;AAKzB"}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-client-wrapper.ts"],"sourcesContent":["// This file must be bundled in the app's client layer, it shouldn't be directly\n// imported by the server.\n\nexport { callServer } from 'next/dist/client/app-call-server'\nexport { findSourceMapURL } from 'next/dist/client/app-find-source-map-url'\n\n// A noop wrapper to let the Flight client create the server reference.\n// See also: https://github.com/facebook/react/pull/26632\n// eslint-disable-next-line import/no-extraneous-dependencies\nexport { createServerReference } from 'react-server-dom-webpack/client'\n"],"names":["callServer","createServerReference","findSourceMapURL"],"mappings":"AAAA,gFAAgF;AAChF,0BAA0B;;;;;;;;;;;;;;;;IAEjBA,UAAU,EAAA;eAAVA,eAAAA,UAAU;;IAMVC,qBAAqB,EAAA;eAArBA,QAAAA,qBAAqB;;IALrBC,gBAAgB,EAAA;eAAhBA,qBAAAA,gBAAgB;;;+BADE;qCACM;wBAKK","ignoreList":[0]}}]
}