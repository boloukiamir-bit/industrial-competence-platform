{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/pgClient.ts"],"sourcesContent":["import { Pool } from \"pg\";\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.DATABASE_URL?.includes(\"localhost\") ? false : { rejectUnauthorized: false },\n});\n\nexport default pool;\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,QAAQ,GAAG,CAAC,YAAY,EAAE,SAAS,eAAe,QAAQ;QAAE,oBAAoB;IAAM;AAC7F;uCAEe"}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/workflows/my-tasks/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport pool from \"@/lib/pgClient\";\nimport { cookies } from \"next/headers\";\n\nasync function getOrgId(request: NextRequest): Promise<string | null> {\n  const orgId = request.headers.get(\"x-org-id\");\n  if (orgId) return orgId;\n  \n  const cookieStore = await cookies();\n  const orgCookie = cookieStore.get(\"current_org_id\");\n  return orgCookie?.value || null;\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const orgId = await getOrgId(request);\n    if (!orgId) {\n      return NextResponse.json({ error: \"Organization ID required\" }, { status: 400 });\n    }\n\n    const result = await pool.query(`\n      SELECT \n        t.id,\n        t.instance_id,\n        t.step_no,\n        t.title,\n        t.description,\n        t.owner_role,\n        t.owner_user_id,\n        t.due_date,\n        t.status,\n        t.notes,\n        t.evidence_url,\n        t.completed_at,\n        i.employee_name,\n        i.status as instance_status,\n        i.area_code,\n        wt.name as template_name,\n        wt.category as template_category\n      FROM wf_instance_tasks t\n      JOIN wf_instances i ON i.id = t.instance_id\n      LEFT JOIN wf_templates wt ON wt.id = i.template_id\n      WHERE i.org_id = $1\n        AND i.status = 'active'\n        AND t.status != 'done'\n      ORDER BY \n        CASE WHEN t.due_date < CURRENT_DATE THEN 0 ELSE 1 END,\n        t.due_date ASC NULLS LAST,\n        t.step_no\n    `, [orgId]);\n\n    const tasks = result.rows.map((row: any) => {\n      const isOverdue = row.due_date && new Date(row.due_date) < new Date() && row.status !== \"done\";\n      const isDueToday = row.due_date && new Date(row.due_date).toDateString() === new Date().toDateString();\n      \n      return {\n        id: row.id,\n        instanceId: row.instance_id,\n        stepNo: row.step_no,\n        title: row.title,\n        description: row.description,\n        ownerRole: row.owner_role,\n        ownerUserId: row.owner_user_id,\n        dueDate: row.due_date,\n        status: row.status,\n        notes: row.notes,\n        evidenceUrl: row.evidence_url,\n        completedAt: row.completed_at,\n        employeeName: row.employee_name,\n        instanceStatus: row.instance_status,\n        areaCode: row.area_code,\n        templateName: row.template_name,\n        templateCategory: row.template_category,\n        isOverdue,\n        isDueToday,\n      };\n    });\n\n    const overdueCount = tasks.filter((t: any) => t.isOverdue).length;\n    const dueTodayCount = tasks.filter((t: any) => t.isDueToday).length;\n\n    return NextResponse.json({\n      tasks,\n      summary: {\n        total: tasks.length,\n        overdue: overdueCount,\n        dueToday: dueTodayCount,\n      },\n    });\n  } catch (err) {\n    console.error(\"My tasks error:\", err);\n    return NextResponse.json(\n      { error: err instanceof Error ? err.message : \"Failed to fetch tasks\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEA,eAAe,SAAS,OAAoB;IAC1C,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC;IAClC,IAAI,OAAO,OAAO;IAElB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,YAAY,YAAY,GAAG,CAAC;IAClC,OAAO,WAAW,SAAS;AAC7B;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,QAAQ,MAAM,SAAS;QAC7B,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,MAAM,SAAS,MAAM,4HAAI,CAAC,KAAK,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IA6BjC,CAAC,EAAE;YAAC;SAAM;QAEV,MAAM,QAAQ,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC;YAC7B,MAAM,YAAY,IAAI,QAAQ,IAAI,IAAI,KAAK,IAAI,QAAQ,IAAI,IAAI,UAAU,IAAI,MAAM,KAAK;YACxF,MAAM,aAAa,IAAI,QAAQ,IAAI,IAAI,KAAK,IAAI,QAAQ,EAAE,YAAY,OAAO,IAAI,OAAO,YAAY;YAEpG,OAAO;gBACL,IAAI,IAAI,EAAE;gBACV,YAAY,IAAI,WAAW;gBAC3B,QAAQ,IAAI,OAAO;gBACnB,OAAO,IAAI,KAAK;gBAChB,aAAa,IAAI,WAAW;gBAC5B,WAAW,IAAI,UAAU;gBACzB,aAAa,IAAI,aAAa;gBAC9B,SAAS,IAAI,QAAQ;gBACrB,QAAQ,IAAI,MAAM;gBAClB,OAAO,IAAI,KAAK;gBAChB,aAAa,IAAI,YAAY;gBAC7B,aAAa,IAAI,YAAY;gBAC7B,cAAc,IAAI,aAAa;gBAC/B,gBAAgB,IAAI,eAAe;gBACnC,UAAU,IAAI,SAAS;gBACvB,cAAc,IAAI,aAAa;gBAC/B,kBAAkB,IAAI,iBAAiB;gBACvC;gBACA;YACF;QACF;QAEA,MAAM,eAAe,MAAM,MAAM,CAAC,CAAC,IAAW,EAAE,SAAS,EAAE,MAAM;QACjE,MAAM,gBAAgB,MAAM,MAAM,CAAC,CAAC,IAAW,EAAE,UAAU,EAAE,MAAM;QAEnE,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB;YACA,SAAS;gBACP,OAAO,MAAM,MAAM;gBACnB,SAAS;gBACT,UAAU;YACZ;QACF;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,eAAe,QAAQ,IAAI,OAAO,GAAG;QAAwB,GACtE;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}