{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/line-overview/assignments/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { createClient } from \"@supabase/supabase-js\";\nimport { z } from \"zod\";\n\nconst DEMO_ORG_ID = \"f607f244-da91-41d9-a648-d02a1591105c\";\n\nconst supabaseAdmin = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\n);\n\nfunction shiftParamToDbValue(shift: string): string {\n  const map: Record<string, string> = {\n    day: \"Day\",\n    evening: \"Evening\",\n    night: \"Night\",\n  };\n  return map[shift.toLowerCase()] || \"Day\";\n}\n\nconst createAssignmentSchema = z.object({\n  machineCode: z.string(),\n  employeeCode: z.string(),\n  date: z.string(),\n  shift: z.string(),\n  startTime: z.string(),\n  endTime: z.string(),\n});\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const parsed = createAssignmentSchema.safeParse(body);\n\n    if (!parsed.success) {\n      return NextResponse.json({ error: \"Invalid input\", details: parsed.error.issues }, { status: 400 });\n    }\n\n    const { machineCode, employeeCode, date, shift, startTime, endTime } = parsed.data;\n\n    const { data, error } = await supabaseAdmin.from(\"pl_assignment_segments\").insert({\n      org_id: DEMO_ORG_ID,\n      machine_code: machineCode,\n      employee_code: employeeCode,\n      plan_date: date,\n      shift_type: shiftParamToDbValue(shift),\n      start_time: startTime,\n      end_time: endTime,\n    }).select().single();\n\n    if (error) throw error;\n\n    return NextResponse.json({ success: true, assignment: data });\n  } catch (error) {\n    console.error(\"Create assignment error:\", error);\n    return NextResponse.json({ error: \"Failed to create assignment\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,cAAc;AAEpB,MAAM,gBAAgB,IAAA,yLAAY,gFAEhC,QAAQ,GAAG,CAAC,yBAAyB;AAGvC,SAAS,oBAAoB,KAAa;IACxC,MAAM,MAA8B;QAClC,KAAK;QACL,SAAS;QACT,OAAO;IACT;IACA,OAAO,GAAG,CAAC,MAAM,WAAW,GAAG,IAAI;AACrC;AAEA,MAAM,yBAAyB,2IAAC,CAAC,MAAM,CAAC;IACtC,aAAa,2IAAC,CAAC,MAAM;IACrB,cAAc,2IAAC,CAAC,MAAM;IACtB,MAAM,2IAAC,CAAC,MAAM;IACd,OAAO,2IAAC,CAAC,MAAM;IACf,WAAW,2IAAC,CAAC,MAAM;IACnB,SAAS,2IAAC,CAAC,MAAM;AACnB;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,SAAS,uBAAuB,SAAS,CAAC;QAEhD,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;gBAAiB,SAAS,OAAO,KAAK,CAAC,MAAM;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACnG;QAEA,MAAM,EAAE,WAAW,EAAE,YAAY,EAAE,IAAI,EAAE,KAAK,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAO,IAAI;QAElF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,cAAc,IAAI,CAAC,0BAA0B,MAAM,CAAC;YAChF,QAAQ;YACR,cAAc;YACd,eAAe;YACf,WAAW;YACX,YAAY,oBAAoB;YAChC,YAAY;YACZ,UAAU;QACZ,GAAG,MAAM,GAAG,MAAM;QAElB,IAAI,OAAO,MAAM;QAEjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,YAAY;QAAK;IAC7D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACnF;AACF"}}]
}