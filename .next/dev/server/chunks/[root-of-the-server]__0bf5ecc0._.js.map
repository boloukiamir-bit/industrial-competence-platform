{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/env.ts"],"sourcesContent":["/**\n * Environment variable helper with fail-fast behavior\n * Ensures Supabase credentials are always available\n */\n\nexport interface PublicEnv {\n  supabaseUrl: string;\n  supabaseAnonKey: string;\n}\n\n// Hardcoded fallback values for production builds\nconst FALLBACK_SUPABASE_URL = \"https://bmvawfrnlpdvcmffqrzc.supabase.co\";\nconst FALLBACK_SUPABASE_ANON_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJtdmF3ZnJubHBkdmNtZmZxcnpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU1MTEwOTAsImV4cCI6MjA4MTA4NzA5MH0.DHLJ4aMn1dORfbNPt1XrJtcdIjYN81YQbJ19Q89A_pM\";\n\n/**\n * Get public environment variables with fail-fast behavior\n * Throws if credentials are not available\n */\nexport function getPublicEnv(): PublicEnv {\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || FALLBACK_SUPABASE_URL;\n  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || FALLBACK_SUPABASE_ANON_KEY;\n\n  const missing: string[] = [];\n  \n  if (!supabaseUrl || supabaseUrl.includes('placeholder')) {\n    missing.push('NEXT_PUBLIC_SUPABASE_URL');\n  }\n  if (!supabaseAnonKey || supabaseAnonKey.includes('placeholder')) {\n    missing.push('NEXT_PUBLIC_SUPABASE_ANON_KEY');\n  }\n\n  if (missing.length > 0) {\n    throw new Error(`Supabase env missing: ${missing.join(', ')}`);\n  }\n\n  return {\n    supabaseUrl,\n    supabaseAnonKey,\n  };\n}\n\n/**\n * Check if public environment is properly configured\n * Returns validation result without throwing\n */\nexport function validatePublicEnv(): { valid: boolean; missing: string[] } {\n  const missing: string[] = [];\n  \n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || FALLBACK_SUPABASE_URL;\n  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || FALLBACK_SUPABASE_ANON_KEY;\n\n  if (!supabaseUrl || supabaseUrl.includes('placeholder')) {\n    missing.push('NEXT_PUBLIC_SUPABASE_URL');\n  }\n  if (!supabaseAnonKey || supabaseAnonKey.includes('placeholder')) {\n    missing.push('NEXT_PUBLIC_SUPABASE_ANON_KEY');\n  }\n\n  return {\n    valid: missing.length === 0,\n    missing,\n  };\n}\n\n/**\n * Get the service role key (server-side only)\n * Never expose this to client code\n */\nexport function getServiceRoleKey(): string {\n  if (typeof window !== 'undefined') {\n    throw new Error('Service role key must never be accessed on the client');\n  }\n  \n  const key = process.env.SUPABASE_SERVICE_ROLE_KEY;\n  if (!key) {\n    throw new Error('SUPABASE_SERVICE_ROLE_KEY is not configured');\n  }\n  \n  return key;\n}\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;AAOD,kDAAkD;AAClD,MAAM,wBAAwB;AAC9B,MAAM,6BAA6B;AAM5B,SAAS;IACd,MAAM,cAAc,gFAAwC;IAC5D,MAAM,kBAAkB,wPAA6C;IAErE,MAAM,UAAoB,EAAE;IAE5B,IAAI,CAAC,eAAe,YAAY,QAAQ,CAAC,gBAAgB;QACvD,QAAQ,IAAI,CAAC;IACf;IACA,IAAI,CAAC,mBAAmB,gBAAgB,QAAQ,CAAC,gBAAgB;QAC/D,QAAQ,IAAI,CAAC;IACf;IAEA,IAAI,QAAQ,MAAM,GAAG,GAAG;QACtB,MAAM,IAAI,MAAM,CAAC,sBAAsB,EAAE,QAAQ,IAAI,CAAC,OAAO;IAC/D;IAEA,OAAO;QACL;QACA;IACF;AACF;AAMO,SAAS;IACd,MAAM,UAAoB,EAAE;IAE5B,MAAM,cAAc,gFAAwC;IAC5D,MAAM,kBAAkB,wPAA6C;IAErE,IAAI,CAAC,eAAe,YAAY,QAAQ,CAAC,gBAAgB;QACvD,QAAQ,IAAI,CAAC;IACf;IACA,IAAI,CAAC,mBAAmB,gBAAgB,QAAQ,CAAC,gBAAgB;QAC/D,QAAQ,IAAI,CAAC;IACf;IAEA,OAAO;QACL,OAAO,QAAQ,MAAM,KAAK;QAC1B;IACF;AACF;AAMO,SAAS;IACd;;IAIA,MAAM,MAAM,QAAQ,GAAG,CAAC,yBAAyB;IACjD,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;AACT"}},
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/supabaseClient.ts"],"sourcesContent":["import { createClient, SupabaseClient } from \"@supabase/supabase-js\";\nimport { getPublicEnv, validatePublicEnv } from \"./env\";\n\nlet supabaseInstance: SupabaseClient | null = null;\n\nfunction createSupabaseClient(): SupabaseClient {\n  const env = getPublicEnv();\n  return createClient(env.supabaseUrl, env.supabaseAnonKey, {\n    auth: {\n      persistSession: true,\n      autoRefreshToken: true,\n      detectSessionInUrl: true,\n    },\n  });\n}\n\nexport function getSupabaseClient(): SupabaseClient {\n  if (!supabaseInstance) {\n    supabaseInstance = createSupabaseClient();\n  }\n  return supabaseInstance;\n}\n\nexport const supabase: SupabaseClient = createSupabaseClient();\n\nexport function isSupabaseReady(): boolean {\n  const validation = validatePublicEnv();\n  return validation.valid;\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEA,IAAI,mBAA0C;AAE9C,SAAS;IACP,MAAM,MAAM,IAAA,4HAAY;IACxB,OAAO,IAAA,yLAAY,EAAC,IAAI,WAAW,EAAE,IAAI,eAAe,EAAE;QACxD,MAAM;YACJ,gBAAgB;YAChB,kBAAkB;YAClB,oBAAoB;QACtB;IACF;AACF;AAEO,SAAS;IACd,IAAI,CAAC,kBAAkB;QACrB,mBAAmB;IACrB;IACA,OAAO;AACT;AAEO,MAAM,WAA2B;AAEjC,SAAS;IACd,MAAM,aAAa,IAAA,iIAAiB;IACpC,OAAO,WAAW,KAAK;AACzB"}},
    {"offset": {"line": 144, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/services/hrWorkflows.ts"],"sourcesContent":["import { supabase } from \"@/lib/supabaseClient\";\nimport type { \n  HRWorkflowTemplate, \n  HRWorkflowTemplateId, \n  HRWorkflowInstance, \n  HRWorkflowStep,\n  HRWorkflowStatus \n} from \"@/types/domain\";\n\nexport const WORKFLOW_TEMPLATES: HRWorkflowTemplate[] = [\n  {\n    id: \"sick_leave\",\n    name: \"Sick Leave Follow-up\",\n    description: \"Structured follow-up process for employees on sick leave according to Swedish labor law\",\n    category: \"health\",\n    defaultSteps: [\n      { title: \"Day 1 Contact\", description: \"Manager contacts employee to check in\", daysFromStart: 1, responsibleRole: \"manager\" },\n      { title: \"Week 1 Review\", description: \"Assess if return-to-work plan needed\", daysFromStart: 7, responsibleRole: \"hr\" },\n      { title: \"Day 14 Coordination\", description: \"Evaluate need for rehab coordination with Försäkringskassan\", daysFromStart: 14, responsibleRole: \"hr\" },\n      { title: \"Day 30 Meeting\", description: \"Formal meeting to discuss return or continued leave\", daysFromStart: 30, responsibleRole: \"manager\" },\n      { title: \"Day 60 Rehab Plan\", description: \"If applicable, create detailed rehabilitation plan\", daysFromStart: 60, responsibleRole: \"hr\" },\n    ],\n  },\n  {\n    id: \"rehab\",\n    name: \"Rehabilitation Process\",\n    description: \"Comprehensive rehabilitation plan for returning employees to full capacity\",\n    category: \"health\",\n    defaultSteps: [\n      { title: \"Initial Assessment\", description: \"Assess current capacity and restrictions\", daysFromStart: 0, responsibleRole: \"hr\" },\n      { title: \"Doctor Consultation\", description: \"Review medical recommendations\", daysFromStart: 3, responsibleRole: \"hr\" },\n      { title: \"Workplace Adjustment\", description: \"Implement necessary workplace adjustments\", daysFromStart: 7, responsibleRole: \"manager\" },\n      { title: \"Week 2 Check-in\", description: \"Review progress and adjust if needed\", daysFromStart: 14, responsibleRole: \"manager\" },\n      { title: \"Week 4 Evaluation\", description: \"Formal evaluation of rehab progress\", daysFromStart: 28, responsibleRole: \"hr\" },\n      { title: \"Completion Review\", description: \"Final assessment and closure\", daysFromStart: 56, responsibleRole: \"hr\" },\n    ],\n  },\n  {\n    id: \"parental_leave\",\n    name: \"Parental Leave\",\n    description: \"Manage parental leave transitions smoothly for both departure and return\",\n    category: \"leave\",\n    defaultSteps: [\n      { title: \"Notification Received\", description: \"Record parental leave request and planned dates\", daysFromStart: 0, responsibleRole: \"hr\" },\n      { title: \"Handover Planning\", description: \"Plan work handover and coverage\", daysFromStart: 7, responsibleRole: \"manager\" },\n      { title: \"Backfill Decision\", description: \"Determine if temporary replacement needed\", daysFromStart: 14, responsibleRole: \"hr\" },\n      { title: \"Pre-departure Meeting\", description: \"Final handover meeting before leave\", daysFromStart: -7, responsibleRole: \"manager\" },\n      { title: \"Return Contact\", description: \"Contact employee 30 days before planned return\", daysFromStart: -30, responsibleRole: \"hr\" },\n      { title: \"Return Planning\", description: \"Plan reboarding activities\", daysFromStart: -14, responsibleRole: \"manager\" },\n    ],\n  },\n  {\n    id: \"reboarding\",\n    name: \"Reboarding\",\n    description: \"Re-integrate employees returning from extended leave\",\n    category: \"lifecycle\",\n    defaultSteps: [\n      { title: \"Welcome Back Meeting\", description: \"Discuss changes and expectations\", daysFromStart: 0, responsibleRole: \"manager\" },\n      { title: \"System Access Check\", description: \"Verify all system access is active\", daysFromStart: 0, responsibleRole: \"hr\" },\n      { title: \"Training Update\", description: \"Review and schedule any required training updates\", daysFromStart: 3, responsibleRole: \"manager\" },\n      { title: \"Week 1 Check-in\", description: \"Discuss how re-integration is going\", daysFromStart: 7, responsibleRole: \"manager\" },\n      { title: \"30-day Review\", description: \"Formal review of reboarding success\", daysFromStart: 30, responsibleRole: \"hr\" },\n    ],\n  },\n  {\n    id: \"onboarding\",\n    name: \"New Employee Onboarding\",\n    description: \"Standard onboarding process for new employees\",\n    category: \"lifecycle\",\n    defaultSteps: [\n      { title: \"Pre-start Preparation\", description: \"Prepare equipment, accounts, and workspace\", daysFromStart: -7, responsibleRole: \"hr\" },\n      { title: \"Day 1 Welcome\", description: \"Welcome meeting and office tour\", daysFromStart: 0, responsibleRole: \"manager\" },\n      { title: \"HR Introduction\", description: \"Policies, benefits, and compliance training\", daysFromStart: 1, responsibleRole: \"hr\" },\n      { title: \"Week 1 Check-in\", description: \"Review first week experience\", daysFromStart: 5, responsibleRole: \"manager\" },\n      { title: \"30-day Review\", description: \"Formal review of onboarding progress\", daysFromStart: 30, responsibleRole: \"manager\" },\n      { title: \"90-day Review\", description: \"End of probation review\", daysFromStart: 90, responsibleRole: \"hr\" },\n    ],\n  },\n  {\n    id: \"offboarding\",\n    name: \"Employee Offboarding\",\n    description: \"Standard offboarding process for departing employees\",\n    category: \"lifecycle\",\n    defaultSteps: [\n      { title: \"Exit Notice Received\", description: \"Document resignation or termination details\", daysFromStart: 0, responsibleRole: \"hr\" },\n      { title: \"Handover Planning\", description: \"Plan knowledge transfer and handover\", daysFromStart: 1, responsibleRole: \"manager\" },\n      { title: \"Exit Interview Scheduled\", description: \"Schedule exit interview if applicable\", daysFromStart: 7, responsibleRole: \"hr\" },\n      { title: \"Equipment Return\", description: \"Collect company equipment and access cards\", daysFromStart: -2, responsibleRole: \"hr\" },\n      { title: \"Final Day Procedures\", description: \"System access revocation, final paperwork\", daysFromStart: 0, responsibleRole: \"hr\" },\n      { title: \"Post-departure Cleanup\", description: \"Archive data, update org charts\", daysFromStart: 1, responsibleRole: \"hr\" },\n    ],\n  },\n];\n\nexport function getWorkflowTemplates(): HRWorkflowTemplate[] {\n  return WORKFLOW_TEMPLATES;\n}\n\nexport function getTemplateById(id: HRWorkflowTemplateId): HRWorkflowTemplate | undefined {\n  return WORKFLOW_TEMPLATES.find((t) => t.id === id);\n}\n\nexport async function startWorkflow(\n  templateId: HRWorkflowTemplateId,\n  employeeId: string,\n  createdBy?: string,\n  notes?: string\n): Promise<HRWorkflowInstance | null> {\n  const template = getTemplateById(templateId);\n  if (!template) return null;\n\n  const { data: employee } = await supabase\n    .from(\"employees\")\n    .select(\"name\")\n    .eq(\"id\", employeeId)\n    .single();\n\n  const now = new Date();\n  const steps: HRWorkflowStep[] = template.defaultSteps.map((step, index) => ({\n    id: `step-${index + 1}`,\n    title: step.title,\n    description: step.description,\n    daysFromStart: step.daysFromStart,\n    responsibleRole: step.responsibleRole,\n    isCompleted: false,\n  }));\n\n  const maxDays = Math.max(...template.defaultSteps.map((s) => s.daysFromStart));\n  const dueDate = new Date(now.getTime() + maxDays * 24 * 60 * 60 * 1000);\n\n  const instanceData = {\n    template_id: templateId,\n    template_name: template.name,\n    employee_id: employeeId,\n    employee_name: employee?.name || null,\n    started_at: now.toISOString(),\n    due_date: dueDate.toISOString().split(\"T\")[0],\n    status: \"active\" as HRWorkflowStatus,\n    steps: steps,\n    created_by: createdBy || null,\n    notes: notes || null,\n  };\n\n  const { data, error } = await supabase\n    .from(\"hr_workflow_instances\")\n    .insert(instanceData)\n    .select()\n    .single();\n\n  if (error || !data) {\n    console.error(\"Failed to start workflow:\", error);\n    return null;\n  }\n\n  return mapInstanceFromDb(data);\n}\n\nexport async function getWorkflowInstances(\n  filters?: { status?: HRWorkflowStatus; employeeId?: string; templateId?: string }\n): Promise<HRWorkflowInstance[]> {\n  let query = supabase\n    .from(\"hr_workflow_instances\")\n    .select(\"*\")\n    .order(\"started_at\", { ascending: false });\n\n  if (filters?.status) {\n    query = query.eq(\"status\", filters.status);\n  }\n  if (filters?.employeeId) {\n    query = query.eq(\"employee_id\", filters.employeeId);\n  }\n  if (filters?.templateId) {\n    query = query.eq(\"template_id\", filters.templateId);\n  }\n\n  const { data, error } = await query;\n  if (error || !data) return [];\n\n  return data.map(mapInstanceFromDb);\n}\n\nexport async function getWorkflowById(id: string): Promise<HRWorkflowInstance | null> {\n  const { data, error } = await supabase\n    .from(\"hr_workflow_instances\")\n    .select(\"*\")\n    .eq(\"id\", id)\n    .single();\n\n  if (error || !data) return null;\n  return mapInstanceFromDb(data);\n}\n\nexport async function completeWorkflowStep(\n  instanceId: string,\n  stepId: string,\n  completedBy?: string,\n  notes?: string\n): Promise<boolean> {\n  const instance = await getWorkflowById(instanceId);\n  if (!instance) return false;\n\n  const updatedSteps = instance.steps.map((step) => {\n    if (step.id === stepId) {\n      return {\n        ...step,\n        isCompleted: true,\n        completedAt: new Date().toISOString(),\n        completedBy,\n        notes,\n      };\n    }\n    return step;\n  });\n\n  const allCompleted = updatedSteps.every((s) => s.isCompleted);\n\n  const { error } = await supabase\n    .from(\"hr_workflow_instances\")\n    .update({\n      steps: updatedSteps,\n      status: allCompleted ? \"completed\" : \"active\",\n      completed_at: allCompleted ? new Date().toISOString() : null,\n    })\n    .eq(\"id\", instanceId);\n\n  return !error;\n}\n\nexport async function cancelWorkflow(instanceId: string): Promise<boolean> {\n  const { error } = await supabase\n    .from(\"hr_workflow_instances\")\n    .update({ status: \"cancelled\" })\n    .eq(\"id\", instanceId);\n\n  return !error;\n}\n\nfunction mapInstanceFromDb(row: Record<string, unknown>): HRWorkflowInstance {\n  return {\n    id: row.id as string,\n    templateId: row.template_id as HRWorkflowTemplateId,\n    templateName: row.template_name as string,\n    employeeId: row.employee_id as string,\n    employeeName: row.employee_name as string | undefined,\n    startedAt: row.started_at as string,\n    dueDate: row.due_date as string | undefined,\n    status: row.status as HRWorkflowStatus,\n    steps: (row.steps as HRWorkflowStep[]) || [],\n    createdBy: row.created_by as string | undefined,\n    completedAt: row.completed_at as string | undefined,\n    notes: row.notes as string | undefined,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 529, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/workflows/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { supabase } from \"@/lib/supabaseClient\";\nimport { WORKFLOW_TEMPLATES } from \"@/services/hrWorkflows\";\nimport type { HRWorkflowInstance, HRWorkflowStep, HRWorkflowTemplateId } from \"@/types/domain\";\n\nconst workflowInstances: HRWorkflowInstance[] = [];\n\nexport async function GET() {\n  return NextResponse.json(workflowInstances);\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { templateId, employeeId } = body;\n\n    if (!templateId || !employeeId) {\n      return NextResponse.json(\n        { error: \"templateId and employeeId are required\" },\n        { status: 400 }\n      );\n    }\n\n    const template = WORKFLOW_TEMPLATES.find((t) => t.id === templateId);\n    if (!template) {\n      return NextResponse.json(\n        { error: \"Template not found\" },\n        { status: 404 }\n      );\n    }\n\n    const { data: employee } = await supabase\n      .from(\"employees\")\n      .select(\"name\")\n      .eq(\"id\", employeeId)\n      .single();\n\n    const now = new Date();\n    const steps: HRWorkflowStep[] = template.defaultSteps.map((step, index) => ({\n      id: `step-${index + 1}`,\n      title: step.title,\n      description: step.description,\n      daysFromStart: step.daysFromStart,\n      responsibleRole: step.responsibleRole,\n      isCompleted: false,\n    }));\n\n    const id = `wf-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n    \n    const instance: HRWorkflowInstance = {\n      id,\n      templateId: templateId as HRWorkflowTemplateId,\n      templateName: template.name,\n      employeeId,\n      employeeName: employee?.name,\n      status: \"active\",\n      startedAt: now.toISOString(),\n      steps,\n    };\n\n    workflowInstances.push(instance);\n\n    const personEvents = template.defaultSteps.map((step) => {\n      const dueDate = new Date(now.getTime() + step.daysFromStart * 24 * 60 * 60 * 1000);\n      return {\n        employee_id: employeeId,\n        event_type: \"training\",\n        title: `[${template.name}] ${step.title}`,\n        description: step.description,\n        due_date: dueDate.toISOString().split(\"T\")[0],\n        status: \"pending\",\n      };\n    });\n\n    const { error: eventsError } = await supabase\n      .from(\"person_events\")\n      .insert(personEvents);\n\n    if (eventsError) {\n      console.warn(\"Failed to create person_events:\", eventsError.message);\n    }\n\n    return NextResponse.json(instance);\n  } catch (err) {\n    console.error(\"Workflow creation error:\", err);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAGA,MAAM,oBAA0C,EAAE;AAE3C,eAAe;IACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;AAC3B;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,UAAU,EAAE,UAAU,EAAE,GAAG;QAEnC,IAAI,CAAC,cAAc,CAAC,YAAY;YAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyC,GAClD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,WAAW,+IAAkB,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;QACzD,IAAI,CAAC,UAAU;YACb,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqB,GAC9B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,mIAAQ,CACtC,IAAI,CAAC,aACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,YACT,MAAM;QAET,MAAM,MAAM,IAAI;QAChB,MAAM,QAA0B,SAAS,YAAY,CAAC,GAAG,CAAC,CAAC,MAAM,QAAU,CAAC;gBAC1E,IAAI,CAAC,KAAK,EAAE,QAAQ,GAAG;gBACvB,OAAO,KAAK,KAAK;gBACjB,aAAa,KAAK,WAAW;gBAC7B,eAAe,KAAK,aAAa;gBACjC,iBAAiB,KAAK,eAAe;gBACrC,aAAa;YACf,CAAC;QAED,MAAM,KAAK,CAAC,GAAG,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;QAExE,MAAM,WAA+B;YACnC;YACA,YAAY;YACZ,cAAc,SAAS,IAAI;YAC3B;YACA,cAAc,UAAU;YACxB,QAAQ;YACR,WAAW,IAAI,WAAW;YAC1B;QACF;QAEA,kBAAkB,IAAI,CAAC;QAEvB,MAAM,eAAe,SAAS,YAAY,CAAC,GAAG,CAAC,CAAC;YAC9C,MAAM,UAAU,IAAI,KAAK,IAAI,OAAO,KAAK,KAAK,aAAa,GAAG,KAAK,KAAK,KAAK;YAC7E,OAAO;gBACL,aAAa;gBACb,YAAY;gBACZ,OAAO,CAAC,CAAC,EAAE,SAAS,IAAI,CAAC,EAAE,EAAE,KAAK,KAAK,EAAE;gBACzC,aAAa,KAAK,WAAW;gBAC7B,UAAU,QAAQ,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;gBAC7C,QAAQ;YACV;QACF;QAEA,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,mIAAQ,CAC1C,IAAI,CAAC,iBACL,MAAM,CAAC;QAEV,IAAI,aAAa;YACf,QAAQ,IAAI,CAAC,mCAAmC,YAAY,OAAO;QACrE;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}