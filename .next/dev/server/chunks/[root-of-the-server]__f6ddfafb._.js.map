{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/supabaseServer.ts"],"sourcesContent":["import { createClient, SupabaseClient } from \"@supabase/supabase-js\";\n\nlet serverClient: SupabaseClient | null = null;\n\nexport function getServerSupabase(): SupabaseClient {\n  if (serverClient) return serverClient;\n\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const key = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\n  if (!url || !key) {\n    throw new Error(\"Supabase server config missing\");\n  }\n\n  serverClient = createClient(url, key, {\n    auth: { persistSession: false, autoRefreshToken: false },\n  });\n\n  return serverClient;\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI,eAAsC;AAEnC,SAAS;IACd,IAAI,cAAc,OAAO;IAEzB,MAAM;IACN,MAAM,MAAM,QAAQ,GAAG,CAAC,yBAAyB;IAEjD,IAAI,CAAC,OAAO,CAAC,KAAK;QAChB,MAAM,IAAI,MAAM;IAClB;IAEA,eAAe,IAAA,yLAAY,EAAC,KAAK,KAAK;QACpC,MAAM;YAAE,gBAAgB;YAAO,kBAAkB;QAAM;IACzD;IAEA,OAAO;AACT"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/workflows/templates/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSupabase } from \"@/lib/supabaseServer\";\nimport { cookies } from \"next/headers\";\nimport { createClient } from \"@supabase/supabase-js\";\n\nasync function getOrgId(request: NextRequest): Promise<string | null> {\n  const orgId = request.headers.get(\"x-org-id\");\n  if (orgId) return orgId;\n  \n  const cookieStore = await cookies();\n  const orgCookie = cookieStore.get(\"current_org_id\");\n  return orgCookie?.value || null;\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const orgId = await getOrgId(request);\n    if (!orgId) {\n      return NextResponse.json({ error: \"Organization ID required\" }, { status: 400 });\n    }\n\n    const supabase = getServerSupabase();\n    \n    const { data: templates, error } = await supabase\n      .from(\"wf_templates\")\n      .select(`\n        id,\n        name,\n        description,\n        category,\n        is_active,\n        created_at,\n        wf_template_steps (\n          id,\n          step_no,\n          title,\n          owner_role,\n          default_due_days,\n          required\n        )\n      `)\n      .eq(\"org_id\", orgId)\n      .eq(\"is_active\", true)\n      .order(\"name\");\n\n    if (error) {\n      console.error(\"Templates fetch error:\", error);\n      return NextResponse.json({ error: error.message }, { status: 500 });\n    }\n\n    const templatesWithCount = (templates || []).map((t: any) => ({\n      ...t,\n      stepCount: t.wf_template_steps?.length || 0,\n      steps: t.wf_template_steps?.sort((a: any, b: any) => a.step_no - b.step_no) || [],\n    }));\n\n    return NextResponse.json({ templates: templatesWithCount });\n  } catch (err) {\n    console.error(\"Templates error:\", err);\n    return NextResponse.json(\n      { error: err instanceof Error ? err.message : \"Failed to fetch templates\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAGA,eAAe,SAAS,OAAoB;IAC1C,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC;IAClC,IAAI,OAAO,OAAO;IAElB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,YAAY,YAAY,GAAG,CAAC;IAClC,OAAO,WAAW,SAAS;AAC7B;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,QAAQ,MAAM,SAAS;QAC7B,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,MAAM,WAAW,IAAA,4IAAiB;QAElC,MAAM,EAAE,MAAM,SAAS,EAAE,KAAK,EAAE,GAAG,MAAM,SACtC,IAAI,CAAC,gBACL,MAAM,CAAC,CAAC;;;;;;;;;;;;;;;MAeT,CAAC,EACA,EAAE,CAAC,UAAU,OACb,EAAE,CAAC,aAAa,MAChB,KAAK,CAAC;QAET,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,0BAA0B;YACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,MAAM,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,MAAM,qBAAqB,CAAC,aAAa,EAAE,EAAE,GAAG,CAAC,CAAC,IAAW,CAAC;gBAC5D,GAAG,CAAC;gBACJ,WAAW,EAAE,iBAAiB,EAAE,UAAU;gBAC1C,OAAO,EAAE,iBAAiB,EAAE,KAAK,CAAC,GAAQ,IAAW,EAAE,OAAO,GAAG,EAAE,OAAO,KAAK,EAAE;YACnF,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,WAAW;QAAmB;IAC3D,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,eAAe,QAAQ,IAAI,OAAO,GAAG;QAA4B,GAC1E;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}