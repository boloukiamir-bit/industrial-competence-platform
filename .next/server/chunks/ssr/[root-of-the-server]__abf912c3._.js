module.exports=[36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},96221,a=>{"use strict";let b=(0,a.i(70106).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],96221)},70579,a=>{"use strict";var b=a.i(7291);async function c(a,c){let{data:d,error:e}=await b.supabase.auth.signInWithPassword({email:a,password:c});if(e)throw e;return d}async function d(){let{error:a}=await b.supabase.auth.signOut();if(a)throw a}async function e(){let{data:a,error:c}=await b.supabase.auth.getUser();return c?null:a.user}async function f(){let{data:a,error:c}=await b.supabase.auth.getSession();return c?null:a.session}function g(a){return b.supabase.auth.onAuthStateChange(a)}a.s(["getAuthUser",()=>e,"getSession",()=>f,"onAuthStateChange",()=>g,"signInWithEmail",()=>c,"signOut",()=>d])},21294,a=>{"use strict";var b=a.i(72131),c=a.i(7291);function d(){let[a,d]=(0,b.useState)(null),[e,f]=(0,b.useState)(!0),[g,h]=(0,b.useState)(null),[i,j]=(0,b.useState)(!1),k=(0,b.useCallback)(async()=>{f(!0),h(null);try{let{data:{session:a}}=await c.supabase.auth.getSession();if(!a?.user){d(null),f(!1);return}let{data:b,error:e}=await c.supabase.from("profiles").select("id, email, role").eq("id",a.user.id).single();if(e){let{data:b,error:e}=await c.supabase.from("profiles").select("id").limit(1);e?.code==="PGRST116"||e?.message?.includes("does not exist")?j(!0):b&&0!==b.length||j(!0),d({id:a.user.id,email:a.user.email||null,role:null})}else d(b),j(!1)}catch(a){h(a instanceof Error?a.message:"Failed to load profile")}finally{f(!1)}},[]),l=(0,b.useCallback)(async()=>{try{let{data:{session:a}}=await c.supabase.auth.getSession();if(!a)return{success:!1,message:"Not authenticated"};let b=await fetch("/api/bootstrap",{method:"POST",headers:{Authorization:`Bearer ${a.access_token}`,"Content-Type":"application/json"}}),d=await b.json();if(!b.ok)return{success:!1,message:d.error||"Bootstrap failed"};return await k(),{success:!0,message:d.message||"Bootstrap complete"}}catch(a){return{success:!1,message:a instanceof Error?a.message:"Bootstrap failed"}}},[k]);return(0,b.useEffect)(()=>{k()},[k]),{profile:a,loading:e,error:g,refresh:k,runBootstrap:l,canBootstrap:i}}function e(a){switch(a){case"admin":return"/app/admin";case"hr":case"user":default:return"/app/hr/tasks";case"manager":return"/app/manager"}}a.s(["getRoleRedirectPath",()=>e,"useProfile",()=>d])},83694,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(70579),f=a.i(7291),g=a.i(21294),h=a.i(96221);function i(){let a=(0,d.useRouter)(),[i,j]=(0,c.useState)("admin@nadiplan.test"),[k,l]=(0,c.useState)(""),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(!0),[s,t]=(0,c.useState)(!0),[u,v]=(0,c.useState)("idle"),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(!1);async function A(a){try{let{data:b,error:c}=await f.supabase.from("profiles").select("id").limit(1);if(c||!b||0===b.length)return{needsBootstrap:!0,role:null};let{data:d}=await f.supabase.from("profiles").select("role").eq("id",a).single();return{needsBootstrap:!1,role:d?.role||null}}catch{return{needsBootstrap:!1,role:null}}}async function B(b){if(b.preventDefault(),p(null),!s)return void p("Authentication service is not configured. Environment variables are missing.");n(!0);try{let b=await (0,e.signInWithEmail)(i,k);if(b?.user){let{needsBootstrap:c,role:d}=await A(b.user.id);if(c){z(!0),n(!1);return}let e=(0,g.getRoleRedirectPath)(d);a.replace(e)}}catch(b){console.error("Sign in error:",b);let a="Failed to sign in.";b instanceof Error&&(a="Failed to fetch"===b.message||b.message.includes("NetworkError")?"Unable to connect to authentication service. Please check your internet connection.":b.message.includes("placeholder")?"Authentication service is not configured. Please contact support.":b.message.includes("Invalid login credentials")?"Invalid email or password. Please try again.":b.message),p(a),n(!1)}}async function C(){v("loading"),x(null);try{let{data:{session:b}}=await f.supabase.auth.getSession();if(!b){v("error"),x("Not authenticated");return}let c=await fetch("/api/bootstrap",{method:"POST",headers:{Authorization:`Bearer ${b.access_token}`,"Content-Type":"application/json"}}),d=await c.json();if(!c.ok){v("error"),x(d.error||"Bootstrap failed");return}v("success"),x(d.message),z(!1),setTimeout(()=>{a.replace("/app/admin")},1500)}catch(a){v("error"),x(a instanceof Error?a.message:"Bootstrap failed")}}return((0,c.useEffect)(()=>{let b=(0,f.isSupabaseReady)();if(t(b),!b){console.error("Supabase not configured - env vars missing"),r(!1);return}!async function(){try{let b=await (0,e.getSession)();if(b?.user){let{data:c}=await f.supabase.from("profiles").select("role").eq("id",b.user.id).single(),d=(0,g.getRoleRedirectPath)(c?.role||null);a.replace(d)}else r(!1)}catch(a){console.error("Session check failed:",a),r(!1)}}()},[a]),q)?(0,b.jsx)("main",{className:"hr-page",style:{maxWidth:420,margin:"0 auto",paddingTop:80},children:(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,b.jsx)(h.Loader2,{className:"w-4 h-4 animate-spin"}),(0,b.jsx)("p",{className:"hr-page__subtitle",children:"Loading..."})]})}):(0,b.jsxs)("main",{className:"hr-page",style:{maxWidth:420,margin:"0 auto",paddingTop:80},children:[(0,b.jsx)("h1",{className:"hr-page__title",children:"Sign in"}),(0,b.jsx)("p",{className:"hr-page__subtitle",children:"Use your Nadiplan account to access HR dashboards."}),(0,b.jsxs)("form",{onSubmit:B,className:"hr-card",style:{marginTop:16},children:[(0,b.jsxs)("div",{className:"hr-form-field",children:[(0,b.jsx)("label",{className:"hr-form-label",children:"Email"}),(0,b.jsx)("input",{type:"email",className:"hr-input",value:i,onChange:a=>j(a.target.value),autoComplete:"email",required:!0,"data-testid":"input-email"})]}),(0,b.jsxs)("div",{className:"hr-form-field",children:[(0,b.jsx)("label",{className:"hr-form-label",children:"Password"}),(0,b.jsx)("input",{type:"password",className:"hr-input",value:k,onChange:a=>l(a.target.value),autoComplete:"current-password",required:!0,"data-testid":"input-password"})]}),o&&(0,b.jsx)("p",{className:"hr-error",style:{marginTop:8},"data-testid":"error-message",children:o}),(0,b.jsx)("button",{type:"submit",className:"hr-button hr-button--primary",disabled:m,style:{marginTop:12,width:"100%"},"data-testid":"button-signin",children:m?"Signing inâ€¦":"Sign in"})]}),y&&(0,b.jsxs)("div",{className:"hr-card",style:{marginTop:16,padding:16},"data-testid":"bootstrap-section",children:[(0,b.jsx)("h3",{style:{fontSize:14,fontWeight:600,marginBottom:8},children:"Admin Setup Required"}),(0,b.jsx)("p",{style:{fontSize:13,color:"var(--color-text-secondary)",marginBottom:12},children:"No admin user exists. Click below to become the first admin."}),w&&(0,b.jsx)("p",{className:"error"===u?"hr-error":"hr-success",style:{marginBottom:8,fontSize:13},"data-testid":"bootstrap-message",children:w}),(0,b.jsx)("button",{onClick:C,disabled:"loading"===u||"success"===u,className:"hr-button hr-button--secondary",style:{width:"100%"},"data-testid":"button-bootstrap",children:"loading"===u?(0,b.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,b.jsx)(h.Loader2,{className:"w-4 h-4 animate-spin"}),"Running Bootstrap..."]}):"success"===u?"Bootstrap Complete!":"Run Admin Bootstrap"})]}),(0,b.jsxs)("p",{style:{marginTop:16,fontSize:13,color:"var(--color-text-secondary)",textAlign:"center"},children:["Don't have an account?"," ",(0,b.jsx)("a",{href:"/signup",style:{color:"var(--color-primary)",textDecoration:"underline"},"data-testid":"link-signup",children:"Sign up"})]}),(0,b.jsx)("p",{style:{marginTop:8,fontSize:12,color:"var(--color-text-tertiary)",textAlign:"center"},children:(0,b.jsx)("a",{href:"/health",style:{textDecoration:"underline"},"data-testid":"link-health",children:"System Health Check"})})]})}a.s(["default",()=>i])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__abf912c3._.js.map