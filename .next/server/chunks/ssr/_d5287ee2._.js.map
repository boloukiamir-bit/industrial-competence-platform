{"version":3,"sources":["../../../../hooks/useAuthGuard.ts","../../../../services/competence.ts","../../../../app/app/employees/%5Bid%5D/competence/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { getAuthUser } from '@/services/auth';\n\nexport function useAuthGuard() {\n  const [loading, setLoading] = useState(true);\n  const router = useRouter();\n\n  useEffect(() => {\n    let isMounted = true;\n\n    async function check() {\n      try {\n        const user = await getAuthUser();\n        if (!user && isMounted) {\n          router.replace('/login');\n        } else if (isMounted) {\n          setLoading(false);\n        }\n      } catch (err) {\n        console.error('Error checking auth', err);\n        if (isMounted) {\n          router.replace('/login');\n        }\n      }\n    }\n\n    check();\n\n    return () => {\n      isMounted = false;\n    };\n  }, [router]);\n\n  return { loading };\n}\n","// services/competence.ts\nimport { supabase } from \"@/lib/supabaseClient\";\n\nexport type EmployeeCompetenceItem = {\n  competenceId: string;\n  competenceName: string;\n  competenceCode: string | null;\n  groupName: string | null;\n  requiredLevel: number | null;\n  mandatory: boolean;\n  employeeLevel: number | null;\n  validTo: string | null;\n  status: \"OK\" | \"GAP\" | \"RISK\" | \"N/A\";\n  riskReason: string | null;\n  isSafetyCritical: boolean;\n};\n\nexport type EmployeeCompetenceSummary = {\n  riskLevel: \"LOW\" | \"MEDIUM\" | \"HIGH\";\n  gapCount: number;\n  totalRequired: number;\n  coveragePercent: number; // 0–100\n  expiredCount: number;\n};\n\nexport type EmployeeCompetenceProfile = {\n  employee: {\n    id: string;\n    name: string;\n    positionName: string | null;\n  };\n  summary: EmployeeCompetenceSummary;\n  items: EmployeeCompetenceItem[];\n};\n\nexport type PositionSummary = {\n  id: string;\n  name: string;\n  site: string | null;\n  department: string | null;\n};\n\nexport type SimpleEmployee = {\n  id: string;\n  name: string;\n};\n\nexport type MatrixColumn = {\n  competenceId: string;\n  label: string;\n  groupName: string | null;\n  requiredLevel: number | null;\n};\n\nexport type MatrixCellStatus = 'OK' | 'GAP' | 'RISK' | 'N/A';\n\nexport type MatrixRow = {\n  employeeId: string;\n  employeeName: string;\n  riskLevel: 'LOW' | 'MEDIUM' | 'HIGH';\n  items: {\n    competenceId: string;\n    status: MatrixCellStatus;\n    level: number | null;\n    requiredLevel?: number | null;\n  }[];\n};\n\nexport async function getAllPositions(): Promise<PositionSummary[]> {\n  const { data, error } = await supabase\n    .from('positions')\n    .select('id, name, site, department')\n    .order('name', { ascending: true });\n\n  if (error) throw error;\n  return (data ?? []) as PositionSummary[];\n}\n\nexport async function getEmployeesForPosition(positionId: string): Promise<SimpleEmployee[]> {\n  const { data, error } = await supabase\n    .from('employees')\n    .select('id, name')\n    .eq('position_id', positionId);\n\n  if (error) throw error;\n\n  return (data ?? []).map((row: any) => ({\n    id: row.id,\n    name: row.name ?? 'Employee',\n  }));\n}\n\ntype EmployeeRow = {\n  id: string;\n  name?: string | null;\n  position_id?: string | null;\n};\n\ntype RequirementRow = {\n  id: string;\n  position_id: string;\n  competence_id: string;\n  required_level: number;\n  mandatory: boolean;\n};\n\ntype EmployeeCompetenceRow = {\n  id: string;\n  employee_id: string;\n  competence_id: string;\n  level: number;\n  valid_from: string | null;\n  valid_to: string | null;\n};\n\ntype CompetenceRow = {\n  id: string;\n  name: string;\n  description?: string | null;\n  code?: string | null;\n  group_id?: string | null;\n  is_safety_critical: boolean;\n};\n\ntype GroupRow = {\n  id: string;\n  name: string;\n};\n\nexport async function getEmployeeCompetenceProfile(\n  employeeId: string,\n  effectiveDate?: string\n): Promise<EmployeeCompetenceProfile> {\n  // Use provided date or default to today\n  const effectiveDateStr =\n    effectiveDate ?? new Date().toISOString().slice(0, 10);\n\n  // 1) Employee\n  const { data: employeeRow, error: empError } = await supabase\n    .from(\"employees\")\n    .select(\"id, name, position_id\")\n    .eq(\"id\", employeeId)\n    .single<EmployeeRow>();\n\n  if (empError || !employeeRow) {\n    console.error(empError);\n    throw empError ?? new Error(\"Employee not found\");\n  }\n\n  const employeeName = employeeRow.name ?? \"Employee\";\n\n  // 2) Position (optional)\n  let positionName: string | null = null;\n  const positionId = employeeRow.position_id ?? null;\n\n  if (positionId) {\n    const { data: posRows } = await supabase\n      .from(\"positions\")\n      .select(\"id, name\")\n      .eq(\"id\", positionId)\n      .limit(1);\n\n    const pos = posRows?.[0] as { id: string; name: string } | undefined;\n    if (pos) {\n      positionName = pos.name;\n    }\n  }\n\n  // 3) Requirements for this position\n  let requirementRows: RequirementRow[] = [];\n  if (positionId) {\n    const { data: reqData, error: reqError } = await supabase\n      .from(\"position_competence_requirements\")\n      .select(\"id, position_id, competence_id, required_level, mandatory\")\n      .eq(\"position_id\", positionId);\n\n    if (reqError) {\n      console.error(reqError);\n      throw reqError;\n    }\n    requirementRows = (reqData ?? []) as RequirementRow[];\n  }\n\n  // 4) Employee competences\n  const { data: empCompData, error: empCompError } = await supabase\n    .from(\"employee_competences\")\n    .select(\"id, employee_id, competence_id, level, valid_from, valid_to\")\n    .eq(\"employee_id\", employeeId);\n\n  if (empCompError) {\n    console.error(empCompError);\n    throw empCompError;\n  }\n\n  const employeeCompRows = (empCompData ?? []) as EmployeeCompetenceRow[];\n  const empCompByCompetenceId = new Map<string, EmployeeCompetenceRow>();\n  for (const row of employeeCompRows) {\n    empCompByCompetenceId.set(row.competence_id, row);\n  }\n\n  // 5) Load all involved competences + groups\n  const competenceIds = new Set<string>();\n  requirementRows.forEach((r) => competenceIds.add(r.competence_id));\n  employeeCompRows.forEach((r) => competenceIds.add(r.competence_id));\n\n  const competencesById = new Map<\n    string,\n    CompetenceRow & { groupName: string | null }\n  >();\n\n  if (competenceIds.size > 0) {\n    const { data: compData, error: compError } = await supabase\n      .from(\"competences\")\n      .select(\"id, name, description, code, group_id, is_safety_critical\")\n      .in(\"id\", Array.from(competenceIds));\n\n    if (compError) {\n      console.error(compError);\n      throw compError;\n    }\n\n    const comps = (compData ?? []) as CompetenceRow[];\n\n    const groupIds = new Set<string>();\n    comps.forEach((c) => {\n      if (c.group_id) groupIds.add(c.group_id);\n    });\n\n    let groupById = new Map<string, string>();\n    if (groupIds.size > 0) {\n      const { data: groupData, error: groupError } = await supabase\n        .from(\"competence_groups\")\n        .select(\"id, name\")\n        .in(\"id\", Array.from(groupIds));\n\n      if (groupError) {\n        console.error(groupError);\n      } else {\n        (groupData ?? []).forEach((g) => {\n          const gr = g as GroupRow;\n          groupById.set(gr.id, gr.name);\n        });\n      }\n    }\n\n    comps.forEach((c) => {\n      competencesById.set(c.id, {\n        ...c,\n        groupName: c.group_id ? (groupById.get(c.group_id) ?? null) : null,\n      });\n    });\n  }\n\n  function isExpired(validTo: string | null): boolean {\n    if (!validTo) return false;\n    return validTo < effectiveDateStr;\n  }\n\n  const items: EmployeeCompetenceItem[] = [];\n  let totalRequired = 0;\n  let gapCount = 0;\n  let expiredCount = 0;\n\n  const usedCompetenceIds = new Set<string>();\n\n  // 6) Build items for all requirements (rollkrav)\n  for (const req of requirementRows) {\n    const compInfo = competencesById.get(req.competence_id);\n    if (!compInfo) continue;\n\n    const empComp = empCompByCompetenceId.get(req.competence_id) ?? null;\n\n    let status: \"OK\" | \"GAP\" | \"RISK\" | \"N/A\" = \"N/A\";\n    let riskReason: string | null = null;\n    let empLevel: number | null = empComp ? empComp.level : null;\n    const validTo = empComp?.valid_to ?? null;\n\n    if (req.mandatory) {\n      totalRequired += 1;\n\n      if (!empComp) {\n        status = \"RISK\";\n        riskReason = \"Saknar kompetens\";\n        gapCount += 1;\n      } else if (isExpired(validTo)) {\n        status = \"RISK\";\n        riskReason = \"Utgången giltighet\";\n        gapCount += 1;\n        expiredCount += 1;\n      } else if (empLevel! < req.required_level) {\n        if (empLevel! >= req.required_level - 1) {\n          status = \"GAP\";\n          riskReason = \"En nivå under krav\";\n          gapCount += 1;\n        } else {\n          status = \"RISK\";\n          riskReason = \"För låg nivå\";\n          gapCount += 1;\n        }\n      } else {\n        status = \"OK\";\n      }\n    } else {\n      // ej obligatorisk men definierad\n      status = empComp ? \"OK\" : \"N/A\";\n    }\n\n    items.push({\n      competenceId: compInfo.id,\n      competenceName: compInfo.name,\n      competenceCode: compInfo.code ?? null,\n      groupName: compInfo.groupName,\n      requiredLevel: req.required_level,\n      mandatory: req.mandatory,\n      employeeLevel: empLevel,\n      validTo,\n      status,\n      riskReason,\n      isSafetyCritical: compInfo.is_safety_critical,\n    });\n\n    usedCompetenceIds.add(compInfo.id);\n  }\n\n  // 7) Extra kompetenser som inte finns i rollkraven (nice-to-have / historik)\n  for (const empComp of employeeCompRows) {\n    if (usedCompetenceIds.has(empComp.competence_id)) continue;\n    const compInfo = competencesById.get(empComp.competence_id);\n    if (!compInfo) continue;\n\n    items.push({\n      competenceId: compInfo.id,\n      competenceName: compInfo.name,\n      competenceCode: compInfo.code ?? null,\n      groupName: compInfo.groupName,\n      requiredLevel: null,\n      mandatory: false,\n      employeeLevel: empComp.level,\n      validTo: empComp.valid_to,\n      status: isExpired(empComp.valid_to) ? \"RISK\" : \"N/A\",\n      riskReason: isExpired(empComp.valid_to) ? \"Utgången giltighet\" : null,\n      isSafetyCritical: compInfo.is_safety_critical,\n    });\n  }\n\n  // 8) Summary / risk score\n  const coveragePercent =\n    totalRequired === 0\n      ? 100\n      : Math.round(((totalRequired - gapCount) / totalRequired) * 100);\n\n  let riskLevel: \"LOW\" | \"MEDIUM\" | \"HIGH\" = \"LOW\";\n  if (gapCount === 0) {\n    riskLevel = \"LOW\";\n  } else if (gapCount <= 2) {\n    riskLevel = \"MEDIUM\";\n  } else {\n    riskLevel = \"HIGH\";\n  }\n\n  // Sortera per grupp + namn\n  items.sort((a, b) => {\n    const g1 = a.groupName ?? \"\";\n    const g2 = b.groupName ?? \"\";\n    if (g1 !== g2) return g1.localeCompare(g2);\n    return a.competenceName.localeCompare(b.competenceName);\n  });\n\n  return {\n    employee: {\n      id: employeeRow.id,\n      name: employeeName,\n      positionName,\n    },\n    summary: {\n      riskLevel,\n      gapCount,\n      totalRequired,\n      coveragePercent,\n      expiredCount,\n    },\n    items,\n  };\n}\n\nexport type PositionCoverageSummary = {\n  positionId: string;\n  positionName: string;\n  site: string | null;\n  department: string | null;\n  minHeadcount: number;\n  availableCount: number;\n  gap: number;\n  riskLevel: 'LOW' | 'MEDIUM' | 'HIGH';\n};\n\nexport async function getPositionCoverageForDate(\n  effectiveDate: string\n): Promise<PositionCoverageSummary[]> {\n  let positions: {\n    id: string;\n    name: string;\n    site: string | null;\n    department: string | null;\n    minHeadcount: number;\n  }[] = [];\n\n  const result = await supabase\n    .from('positions')\n    .select('id, name, site, department, min_headcount')\n    .gt('min_headcount', 0);\n\n  if (result.error) {\n    const errorCode = (result.error as any).code;\n    if (errorCode === '42703' || result.error.message?.includes('min_headcount')) {\n      console.warn('min_headcount column not found, returning empty positions list');\n      return [];\n    }\n    throw result.error;\n  }\n\n  positions = (result.data ?? []).map((p: any) => ({\n    id: p.id as string,\n    name: p.name as string,\n    site: (p.site ?? null) as string | null,\n    department: (p.department ?? null) as string | null,\n    minHeadcount: p.min_headcount as number,\n  }));\n\n  const results: PositionCoverageSummary[] = [];\n\n  for (const pos of positions) {\n    const employees = await getEmployeesForPosition(pos.id);\n\n    if (employees.length === 0) {\n      results.push({\n        positionId: pos.id,\n        positionName: pos.name,\n        site: pos.site,\n        department: pos.department,\n        minHeadcount: pos.minHeadcount,\n        availableCount: 0,\n        gap: pos.minHeadcount,\n        riskLevel: 'HIGH',\n      });\n      continue;\n    }\n\n    let availableCount = 0;\n\n    for (const emp of employees) {\n      const profile = await getEmployeeCompetenceProfile(\n        emp.id,\n        effectiveDate\n      );\n\n      const isFullyCompetent = profile.summary.gapCount === 0;\n\n      if (isFullyCompetent) {\n        availableCount += 1;\n      }\n    }\n\n    const gap = Math.max(0, pos.minHeadcount - availableCount);\n\n    let riskLevel: 'LOW' | 'MEDIUM' | 'HIGH' = 'LOW';\n    if (gap > 0 && availableCount === 0) {\n      riskLevel = 'HIGH';\n    } else if (gap > 0) {\n      riskLevel = 'MEDIUM';\n    } else {\n      riskLevel = 'LOW';\n    }\n\n    results.push({\n      positionId: pos.id,\n      positionName: pos.name,\n      site: pos.site,\n      department: pos.department,\n      minHeadcount: pos.minHeadcount,\n      availableCount,\n      gap,\n      riskLevel,\n    });\n  }\n\n  const riskRank: Record<'LOW' | 'MEDIUM' | 'HIGH', number> = {\n    HIGH: 0,\n    MEDIUM: 1,\n    LOW: 2,\n  };\n\n  results.sort((a, b) => {\n    const rDiff = riskRank[a.riskLevel] - riskRank[b.riskLevel];\n    if (rDiff !== 0) return rDiff;\n    return a.positionName.localeCompare(b.positionName);\n  });\n\n  return results;\n}\n","// app/employees/[id]/competence/page.tsx\n\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport {\n  getEmployeeCompetenceProfile,\n  EmployeeCompetenceProfile,\n  EmployeeCompetenceItem,\n} from \"@/services/competence\";\nimport { useAuthGuard } from \"@/hooks/useAuthGuard\";\n\nexport default function EmployeeCompetencePage({\n  params,\n}: {\n  params: { id: string };\n}) {\n  const { loading: authLoading } = useAuthGuard();\n\n  if (authLoading) {\n    return (\n      <main className=\"hr-page\">\n        <p>Checking access...</p>\n      </main>\n    );\n  }\n\n  return <EmployeeCompetenceContent params={params} />;\n}\n\nfunction EmployeeCompetenceContent({\n  params,\n}: {\n  params: { id: string };\n}) {\n  const employeeId = params.id;\n  const router = useRouter();\n\n  const [profile, setProfile] = useState<EmployeeCompetenceProfile | null>(\n    null,\n  );\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [actionMessage, setActionMessage] = useState<string | null>(null);\n\n  useEffect(() => {\n    async function load() {\n      try {\n        const data = await getEmployeeCompetenceProfile(employeeId);\n        setProfile(data);\n      } catch (err) {\n        console.error(err);\n        setError(\"Kunde inte ladda kompetensprofil.\");\n      } finally {\n        setLoading(false);\n      }\n    }\n    load();\n  }, [employeeId]);\n\n  return (\n    <main className=\"hr-page\">\n      <button className=\"hr-link\" onClick={() => router.back()}>\n        ← Tillbaka\n      </button>\n\n      {loading && <p>Laddar kompetensprofil…</p>}\n      {error && <p className=\"hr-error\">{error}</p>}\n\n      {!loading && !error && profile && (\n        <>\n          <header className=\"hr-emp-header\">\n            <div>\n              <h1 className=\"hr-page__title\">{profile.employee.name}</h1>\n              <p className=\"hr-page__subtitle\">\n                {profile.employee.positionName\n                  ? profile.employee.positionName\n                  : \"Ingen position kopplad ännu\"}\n              </p>\n            </div>\n            <div className=\"hr-emp-header__badge\">\n              <span\n                className={`hr-risk-pill hr-risk-pill--${profile.summary.riskLevel.toLowerCase()}`}\n              >\n                Risk: {profile.summary.riskLevel}\n              </span>\n            </div>\n          </header>\n\n          <section className=\"hr-emp-summary-grid\">\n            <SummaryCard\n              label=\"Obligatoriska kompetenser\"\n              value={profile.summary.totalRequired}\n            />\n            <SummaryCard\n              label=\"Kompetens-gaps\"\n              value={profile.summary.gapCount}\n            />\n            <SummaryCard\n              label=\"Täckningsgrad\"\n              value={`${profile.summary.coveragePercent}%`}\n            />\n            <SummaryCard\n              label=\"Utgångna kompetenser\"\n              value={profile.summary.expiredCount}\n            />\n          </section>\n\n          {actionMessage && (\n            <p className=\"hr-action-message\">{actionMessage}</p>\n          )}\n\n          <section className=\"hr-competence-section\">\n            <h2 className=\"hr-section__title\">Kompetenser</h2>\n            <p className=\"hr-task-section__description\">\n              Krav baserat på roll samt faktiska kompetenser per person.\n            </p>\n\n            <div className=\"hr-competence-table-wrapper\">\n              <table className=\"hr-competence-table\">\n                <thead>\n                  <tr>\n                    <th>Grupp</th>\n                    <th>Kompetens</th>\n                    <th>Krav (nivå)</th>\n                    <th>Har (nivå)</th>\n                    <th>Giltig t.o.m.</th>\n                    <th>Status</th>\n                    <th></th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {profile.items.map((item) => (\n                    <CompetenceRow\n                      key={item.competenceId}\n                      item={item}\n                      onTriggerAction={(msg) => setActionMessage(msg)}\n                    />\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </section>\n        </>\n      )}\n    </main>\n  );\n}\n\nfunction SummaryCard({\n  label,\n  value,\n}: {\n  label: string;\n  value: string | number;\n}) {\n  return (\n    <div className=\"hr-emp-summary-card\">\n      <div className=\"hr-emp-summary-label\">{label}</div>\n      <div className=\"hr-emp-summary-value\">{value}</div>\n    </div>\n  );\n}\n\nfunction CompetenceRow({\n  item,\n  onTriggerAction,\n}: {\n  item: EmployeeCompetenceItem;\n  onTriggerAction: (msg: string) => void;\n}) {\n  const levelLabel = (lvl: number | null | undefined) => {\n    if (lvl == null) return \"-\";\n    return lvl.toString();\n  };\n\n  const statusClass =\n    item.status === \"OK\"\n      ? \"hr-status-badge--ok\"\n      : item.status === \"RISK\"\n        ? \"hr-status-badge--risk\"\n        : \"hr-status-badge--na\";\n\n  const dueLabel = item.validTo\n    ? new Date(item.validTo).toLocaleDateString()\n    : \"-\";\n\n  const showAction = item.status === \"RISK\";\n\n  // Här kan vi senare koppla \"Starta utbildning\"-workflow.\n  function handleClick() {\n    onTriggerAction(\n      `Åtgärd behövs för kompetens \"${item.competenceName}\". (Koppla till utbildnings-workflow när template är satt.)`,\n    );\n  }\n\n  return (\n    <tr>\n      <td>{item.groupName ?? \"-\"}</td>\n      <td>\n        <div className=\"hr-competence-name\">\n          {item.competenceName}\n          {item.isSafetyCritical && (\n            <span className=\"hr-competence-chip\">Safety</span>\n          )}\n        </div>\n      </td>\n      <td>\n        <span className=\"hr-level-chip\">{levelLabel(item.requiredLevel)}</span>\n      </td>\n      <td>\n        <span className=\"hr-level-chip hr-level-chip--owned\">\n          {levelLabel(item.employeeLevel)}\n        </span>\n      </td>\n      <td>{dueLabel}</td>\n      <td>\n        <span className={`hr-status-badge ${statusClass}`}>{item.status}</span>\n        {item.riskReason && (\n          <div className=\"hr-status-reason\">{item.riskReason}</div>\n        )}\n      </td>\n      <td>\n        {showAction && (\n          <button\n            type=\"button\"\n            className=\"hr-button hr-button--secondary hr-button--dense\"\n            onClick={handleClick}\n          >\n            Åtgärda\n          </button>\n        )}\n      </td>\n    </tr>\n  );\n}\n"],"names":[],"mappings":"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"}