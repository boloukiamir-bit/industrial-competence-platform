module.exports=[35112,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactDOM},96221,a=>{"use strict";let b=(0,a.i(70106).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],96221)},11011,70121,a=>{"use strict";var b=a.i(72131);function c(a,b){if("function"==typeof a)return a(b);null!=a&&(a.current=b)}function d(...a){return b=>{let d=!1,e=a.map(a=>{let e=c(a,b);return d||"function"!=typeof e||(d=!0),e});if(d)return()=>{for(let b=0;b<e.length;b++){let d=e[b];"function"==typeof d?d():c(a[b],null)}}}}function e(...a){return b.useCallback(d(...a),a)}a.s(["composeRefs",()=>d,"useComposedRefs",()=>e],70121);var f=a.i(87924);function g(a){var c;let e,g=(c=a,(e=b.forwardRef((a,c)=>{let{children:e,...f}=a;if(b.isValidElement(e)){var g;let a,h,i=(g=e,(h=(a=Object.getOwnPropertyDescriptor(g.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?g.ref:(h=(a=Object.getOwnPropertyDescriptor(g,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?g.props.ref:g.props.ref||g.ref),j=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{f(...a),e(...a)}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(f,e.props);return e.type!==b.Fragment&&(j.ref=c?d(c,i):i),b.cloneElement(e,j)}return b.Children.count(e)>1?b.Children.only(null):null})).displayName=`${c}.SlotClone`,e),h=b.forwardRef((a,c)=>{let{children:d,...e}=a,h=b.Children.toArray(d),i=h.find(k);if(i){let a=i.props.children,d=h.map(c=>c!==i?c:b.Children.count(a)>1?b.Children.only(null):b.isValidElement(a)?a.props.children:null);return(0,f.jsx)(g,{...e,ref:c,children:b.isValidElement(a)?b.cloneElement(a,void 0,d):null})}return(0,f.jsx)(g,{...e,ref:c,children:d})});return h.displayName=`${a}.Slot`,h}var h=g("Slot"),i=Symbol("radix.slottable");function j(a){let b=({children:a})=>(0,f.jsx)(f.Fragment,{children:a});return b.displayName=`${a}.Slottable`,b.__radixId=i,b}function k(a){return b.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===i}a.s(["Slot",()=>h,"createSlot",()=>g,"createSlottable",()=>j],11011)},50104,a=>{"use strict";var b=a.i(72131),c=a.i(87924);function d(a,d){let e=b.createContext(d),f=a=>{let{children:d,...f}=a,g=b.useMemo(()=>f,Object.values(f));return(0,c.jsx)(e.Provider,{value:g,children:d})};return f.displayName=a+"Provider",[f,function(c){let f=b.useContext(e);if(f)return f;if(void 0!==d)return d;throw Error(`\`${c}\` must be used within \`${a}\``)}]}function e(a,d=[]){let f=[],g=()=>{let c=f.map(a=>b.createContext(a));return function(d){let e=d?.[a]||c;return b.useMemo(()=>({[`__scope${a}`]:{...d,[a]:e}}),[d,e])}};return g.scopeName=a,[function(d,e){let g=b.createContext(e),h=f.length;f=[...f,e];let i=d=>{let{scope:e,children:f,...i}=d,j=e?.[a]?.[h]||g,k=b.useMemo(()=>i,Object.values(i));return(0,c.jsx)(j.Provider,{value:k,children:f})};return i.displayName=d+"Provider",[i,function(c,f){let i=f?.[a]?.[h]||g,j=b.useContext(i);if(j)return j;if(void 0!==e)return e;throw Error(`\`${c}\` must be used within \`${d}\``)}]},function(...a){let c=a[0];if(1===a.length)return c;let d=()=>{let d=a.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){let e=d.reduce((b,{useScope:c,scopeName:d})=>{let e=c(a)[`__scope${d}`];return{...b,...e}},{});return b.useMemo(()=>({[`__scope${c.scopeName}`]:e}),[e])}};return d.scopeName=c.scopeName,d}(g,...d)]}a.s(["createContext",()=>d,"createContextScope",()=>e])},30553,a=>{"use strict";var b=a.i(72131),c=a.i(35112),d=a.i(11011),e=a.i(87924),f=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((a,c)=>{let f=(0,d.createSlot)(`Primitive.${c}`),g=b.forwardRef((a,b)=>{let{asChild:d,...g}=a;return(0,e.jsx)(d?f:c,{...g,ref:b})});return g.displayName=`Primitive.${c}`,{...a,[c]:g}},{});function g(a,b){a&&c.flushSync(()=>a.dispatchEvent(b))}a.s(["Primitive",()=>f,"dispatchDiscreteCustomEvent",()=>g])},73570,a=>{"use strict";let b=(0,a.i(70106).default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);a.s(["AlertTriangle",()=>b],73570)},35227,a=>{"use strict";var b=a.i(72131),c=a.i(50944),d=a.i(70579);function e(){let[a,e]=(0,b.useState)(!0),f=(0,c.useRouter)();return(0,b.useEffect)(()=>{let a=!0;return async function(){try{!await (0,d.getAuthUser)()&&a?f.replace("/login"):a&&e(!1)}catch(b){console.error("Error checking auth",b),a&&f.replace("/login")}}(),()=>{a=!1}},[f]),{loading:a}}a.s(["useAuthGuard",()=>e])},2150,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50104),e=a.i(30553),f="Progress",[g,h]=(0,d.createContextScope)(f),[i,j]=g(f),k=c.forwardRef((a,c)=>{var d,f;let{__scopeProgress:g,value:h=null,max:j,getValueLabel:k=n,...l}=a;(j||0===j)&&!q(j)&&console.error((d=`${j}`,`Invalid prop \`max\` of value \`${d}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let m=q(j)?j:100;null===h||r(h,m)||console.error((f=`${h}`,`Invalid prop \`value\` of value \`${f}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let s=r(h,m)?h:null,t=p(s)?k(s,m):void 0;return(0,b.jsx)(i,{scope:g,value:s,max:m,children:(0,b.jsx)(e.Primitive.div,{"aria-valuemax":m,"aria-valuemin":0,"aria-valuenow":p(s)?s:void 0,"aria-valuetext":t,role:"progressbar","data-state":o(s,m),"data-value":s??void 0,"data-max":m,...l,ref:c})})});k.displayName=f;var l="ProgressIndicator",m=c.forwardRef((a,c)=>{let{__scopeProgress:d,...f}=a,g=j(l,d);return(0,b.jsx)(e.Primitive.div,{"data-state":o(g.value,g.max),"data-value":g.value??void 0,"data-max":g.max,...f,ref:c})});function n(a,b){return`${Math.round(a/b*100)}%`}function o(a,b){return null==a?"indeterminate":a===b?"complete":"loading"}function p(a){return"number"==typeof a}function q(a){return p(a)&&!isNaN(a)&&a>0}function r(a,b){return p(a)&&!isNaN(a)&&a<=b&&a>=0}m.displayName=l;var s=a.i(97895);let t=c.forwardRef(({className:a,value:c,...d},e)=>(0,b.jsx)(k,{ref:e,className:(0,s.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",a),...d,children:(0,b.jsx)(m,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(c||0)}%)`}})}));t.displayName=k.displayName,a.s(["Progress",()=>t],2150)},63615,a=>{"use strict";var b=a.i(7291);async function c(){let{data:a,error:c}=await b.supabase.from("positions").select("id, name, site, department").order("name",{ascending:!0});if(c)throw c;return a??[]}async function d(a){let{data:c,error:d}=await b.supabase.from("employees").select("id, name").eq("position_id",a);if(d)throw d;return(c??[]).map(a=>({id:a.id,name:a.name??"Employee"}))}async function e(a,c){var d,e,f;let g=c??new Date().toISOString().slice(0,10),{data:h,error:i}=await b.supabase.from("employees").select("id, name, position_id").eq("id",a).single();if(i||!h)throw console.error(i),i??Error("Employee not found");let j=h.name??"Employee",k=null,l=h.position_id??null;if(l){let{data:a}=await b.supabase.from("positions").select("id, name").eq("id",l).limit(1),c=a?.[0];c&&(k=c.name)}let m=[];if(l){let{data:a,error:c}=await b.supabase.from("position_competence_requirements").select("id, position_id, competence_id, required_level, mandatory").eq("position_id",l);if(c)throw console.error(c),c;m=a??[]}let{data:n,error:o}=await b.supabase.from("employee_competences").select("id, employee_id, competence_id, level, valid_from, valid_to").eq("employee_id",a);if(o)throw console.error(o),o;let p=n??[],q=new Map;for(let a of p)q.set(a.competence_id,a);let r=new Set;m.forEach(a=>r.add(a.competence_id)),p.forEach(a=>r.add(a.competence_id));let s=new Map;if(r.size>0){let{data:a,error:c}=await b.supabase.from("competences").select("id, name, description, code, group_id, is_safety_critical").in("id",Array.from(r));if(c)throw console.error(c),c;let d=a??[],e=new Set;d.forEach(a=>{a.group_id&&e.add(a.group_id)});let f=new Map;if(e.size>0){let{data:a,error:c}=await b.supabase.from("competence_groups").select("id, name").in("id",Array.from(e));c?console.error(c):(a??[]).forEach(a=>{f.set(a.id,a.name)})}d.forEach(a=>{s.set(a.id,{...a,groupName:a.group_id?f.get(a.group_id)??null:null})})}let t=[],u=0,v=0,w=0,x=new Set;for(let a of m){let b=s.get(a.competence_id);if(!b)continue;let c=q.get(a.competence_id)??null,e="N/A",f=null,h=c?c.level:null,i=c?.valid_to??null;a.mandatory?(u+=1,c?(d=i)&&d<g?(e="RISK",f="Utgången giltighet",v+=1,w+=1):h<a.required_level?(h>=a.required_level-1?(e="GAP",f="En nivå under krav"):(e="RISK",f="För låg nivå"),v+=1):e="OK":(e="RISK",f="Saknar kompetens",v+=1)):e=c?"OK":"N/A",t.push({competenceId:b.id,competenceName:b.name,competenceCode:b.code??null,groupName:b.groupName,requiredLevel:a.required_level,mandatory:a.mandatory,employeeLevel:h,validTo:i,status:e,riskReason:f,isSafetyCritical:b.is_safety_critical}),x.add(b.id)}for(let a of p){if(x.has(a.competence_id))continue;let b=s.get(a.competence_id);b&&t.push({competenceId:b.id,competenceName:b.name,competenceCode:b.code??null,groupName:b.groupName,requiredLevel:null,mandatory:!1,employeeLevel:a.level,validTo:a.valid_to,status:(e=a.valid_to)&&e<g?"RISK":"N/A",riskReason:(f=a.valid_to)&&f<g?"Utgången giltighet":null,isSafetyCritical:b.is_safety_critical})}let y=0===u?100:Math.round((u-v)/u*100),z="LOW";return z=0===v?"LOW":v<=2?"MEDIUM":"HIGH",t.sort((a,b)=>{let c=a.groupName??"",d=b.groupName??"";return c!==d?c.localeCompare(d):a.competenceName.localeCompare(b.competenceName)}),{employee:{id:h.id,name:j,positionName:k},summary:{riskLevel:z,gapCount:v,totalRequired:u,coveragePercent:y,expiredCount:w},items:t}}async function f(a){let c=[],f=await b.supabase.from("positions").select("id, name, site, department, min_headcount").gt("min_headcount",0);if(f.error){if("42703"===f.error.code||f.error.message?.includes("min_headcount"))return console.warn("min_headcount column not found, returning empty positions list"),[];throw f.error}c=(f.data??[]).map(a=>({id:a.id,name:a.name,site:a.site??null,department:a.department??null,minHeadcount:a.min_headcount}));let g=[];for(let b of c){let c=await d(b.id);if(0===c.length){g.push({positionId:b.id,positionName:b.name,site:b.site,department:b.department,minHeadcount:b.minHeadcount,availableCount:0,gap:b.minHeadcount,riskLevel:"HIGH"});continue}let f=0;for(let b of c)0===(await e(b.id,a)).summary.gapCount&&(f+=1);let h=Math.max(0,b.minHeadcount-f),i="LOW";i=h>0&&0===f?"HIGH":h>0?"MEDIUM":"LOW",g.push({positionId:b.id,positionName:b.name,site:b.site,department:b.department,minHeadcount:b.minHeadcount,availableCount:f,gap:h,riskLevel:i})}let h={HIGH:0,MEDIUM:1,LOW:2};return g.sort((a,b)=>{let c=h[a.riskLevel]-h[b.riskLevel];return 0!==c?c:a.positionName.localeCompare(b.positionName)}),g}a.s(["getAllPositions",()=>c,"getEmployeeCompetenceProfile",()=>e,"getEmployeesForPosition",()=>d,"getPositionCoverageForDate",()=>f])},37924,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(63615),e=a.i(96221),f=a.i(73570),g=a.i(2150),h=a.i(38246),i=a.i(35227);function j({risk:a}){return(0,b.jsx)("span",{className:{HIGH:"hr-risk-pill hr-risk-pill--high",MEDIUM:"hr-risk-pill hr-risk-pill--medium",LOW:"hr-risk-pill hr-risk-pill--low"}[a]||"hr-risk-pill","data-testid":`risk-badge-${a.toLowerCase()}`,children:a})}function k({position:a}){let c=a.minHeadcount>0?Math.round(a.availableCount/a.minHeadcount*100):100;return(0,b.jsxs)("div",{className:"hr-card","data-testid":`card-position-${a.positionId}`,children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2 flex-wrap mb-3",children:[(0,b.jsx)("h3",{className:"hr-card__title",children:a.positionName}),(0,b.jsx)(j,{risk:a.riskLevel})]}),(0,b.jsxs)("div",{className:"hr-emp-summary-grid",children:[(0,b.jsxs)("div",{className:"hr-emp-summary-card",children:[(0,b.jsx)("span",{className:"hr-emp-summary-label",children:"Min Required"}),(0,b.jsx)("span",{className:"hr-emp-summary-value",children:a.minHeadcount})]}),(0,b.jsxs)("div",{className:"hr-emp-summary-card",children:[(0,b.jsx)("span",{className:"hr-emp-summary-label",children:"Fully Competent"}),(0,b.jsx)("span",{className:"hr-emp-summary-value",children:a.availableCount})]}),(0,b.jsxs)("div",{className:"hr-emp-summary-card",children:[(0,b.jsx)("span",{className:"hr-emp-summary-label",children:"Gap"}),(0,b.jsx)("span",{className:`hr-emp-summary-value ${a.gap>0?"text-red-600 dark:text-red-400":""}`,children:a.gap})]})]}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-1",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Coverage"}),(0,b.jsxs)("span",{className:"text-sm font-medium",children:[c,"%"]})]}),(0,b.jsx)(g.Progress,{value:c,className:"h-2"})]}),(a.site||a.department)&&(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-3 text-sm text-muted-foreground",children:[a.site&&(0,b.jsx)("span",{children:a.site}),a.site&&a.department&&(0,b.jsx)("span",{children:"/"}),a.department&&(0,b.jsx)("span",{children:a.department})]}),(0,b.jsx)("div",{className:"mt-4 pt-3 border-t border-border",children:(0,b.jsx)(h.default,{href:"/competence/matrix",className:"text-sm text-primary hover:underline","data-testid":`link-matrix-${a.positionId}`,children:"View competence matrix"})})]})}function l(){let{loading:a}=(0,i.useAuthGuard)();return a?(0,b.jsx)("main",{className:"hr-page",children:(0,b.jsx)("p",{children:"Checking access..."})}):(0,b.jsx)(m,{})}function m(){let[a,g]=(0,c.useState)([]),[h,i]=(0,c.useState)(""),[j,l]=(0,c.useState)(!0),[m,n]=(0,c.useState)(null);(0,c.useEffect)(()=>{!async function(){let a,b;l(!0),n(null);let c=((b=new Date(a=new Date)).setDate(a.getDate()+1),b.toISOString().slice(0,10));i(c);try{let a=await (0,d.getPositionCoverageForDate)(c);g(a)}catch(a){console.error("Failed to load coverage data:",a),n("Failed to load gap analysis data. Please try again.")}finally{l(!1)}}()},[]);let o=a.length,p=a.filter(a=>"HIGH"===a.riskLevel).length,q=a.filter(a=>"MEDIUM"===a.riskLevel).length,r=a.filter(a=>"LOW"===a.riskLevel).length,s=a.reduce((a,b)=>a+b.gap,0);return j?(0,b.jsxs)("main",{className:"hr-page",children:[(0,b.jsx)("header",{className:"hr-page__header",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"hr-page__title",children:"Tomorrow's Gaps"}),(0,b.jsx)("p",{className:"hr-page__subtitle",children:"Coverage and risk per position based on minimum headcount and competence."})]})}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-3 p-12",children:[(0,b.jsx)(e.Loader2,{className:"h-5 w-5 animate-spin","data-testid":"loading-spinner"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Calculating tomorrow's gaps..."})]})]}):m?(0,b.jsxs)("main",{className:"hr-page",children:[(0,b.jsx)("header",{className:"hr-page__header",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"hr-page__title",children:"Tomorrow's Gaps"}),(0,b.jsx)("p",{className:"hr-page__subtitle",children:"Coverage and risk per position based on minimum headcount and competence."})]})}),(0,b.jsxs)("div",{className:"hr-error","data-testid":"error-message",children:[(0,b.jsx)(f.AlertTriangle,{className:"h-4 w-4 inline-block mr-2"}),m]})]}):0===a.length?(0,b.jsxs)("main",{className:"hr-page",children:[(0,b.jsxs)("header",{className:"hr-page__header",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"hr-page__title",children:"Tomorrow's Gaps"}),(0,b.jsx)("p",{className:"hr-page__subtitle",children:"Coverage and risk per position based on minimum headcount and competence."})]}),(0,b.jsxs)("div",{className:"tg-date-pill","data-testid":"date-pill",children:["Analyzing: ",h]})]}),(0,b.jsxs)("div",{className:"hr-empty","data-testid":"empty-state",children:[(0,b.jsx)("p",{className:"font-medium mb-2",children:"No positions with minimum headcount defined"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Add min_headcount to positions to see Tomorrow's Gaps analysis."})]})]}):(0,b.jsxs)("main",{className:"hr-page",children:[(0,b.jsxs)("header",{className:"hr-page__header",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"hr-page__title",children:"Tomorrow's Gaps"}),(0,b.jsx)("p",{className:"hr-page__subtitle",children:"Coverage and risk per position based on minimum headcount and competence."})]}),(0,b.jsxs)("div",{className:"tg-date-pill","data-testid":"date-pill",children:["Analyzing: ",h]})]}),(0,b.jsxs)("div",{className:"hr-kpi-grid","data-testid":"summary-kpis",children:[(0,b.jsxs)("div",{className:"hr-kpi",children:[(0,b.jsx)("span",{className:"hr-kpi__label",children:"Total Positions"}),(0,b.jsx)("span",{className:"hr-kpi__value",children:o})]}),(0,b.jsxs)("div",{className:"hr-kpi",children:[(0,b.jsx)("span",{className:"hr-kpi__label",children:"High Risk"}),(0,b.jsx)("span",{className:`hr-kpi__value ${p>0?"hr-kpi__value--danger":""}`,children:p})]}),(0,b.jsxs)("div",{className:"hr-kpi",children:[(0,b.jsx)("span",{className:"hr-kpi__label",children:"Medium Risk"}),(0,b.jsx)("span",{className:`hr-kpi__value ${q>0?"hr-kpi__value--warn":""}`,children:q})]}),(0,b.jsxs)("div",{className:"hr-kpi",children:[(0,b.jsx)("span",{className:"hr-kpi__label",children:"Low Risk"}),(0,b.jsx)("span",{className:"hr-kpi__value hr-kpi__value--ok",children:r})]}),(0,b.jsxs)("div",{className:"hr-kpi",children:[(0,b.jsx)("span",{className:"hr-kpi__label",children:"Total Missing Headcount"}),(0,b.jsx)("span",{className:`hr-kpi__value ${s>0?"hr-kpi__value--danger":""}`,children:s})]})]}),(0,b.jsx)("div",{className:"hr-grid mt-6","data-testid":"positions-grid",children:a.map(a=>(0,b.jsx)(k,{position:a},a.positionId))})]})}a.s(["default",()=>l])}];

//# sourceMappingURL=_9846db23._.js.map