module.exports=[57554,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(48654),e=a.i(40695),f=a.i(54161),g=a.i(5522),h=a.i(87682),i=a.i(65733),j=a.i(21958),k=a.i(15618),l=a.i(87532),m=a.i(41710),n=a.i(16201),o=a.i(62722),p=a.i(50522),q=a.i(46842),r=a.i(41675),s=a.i(73570),t=a.i(60431),u=a.i(7291),v=a.i(47033),w=a.i(35227);function x(){let{loading:a}=(0,w.useAuthGuard)();return a?(0,b.jsx)("main",{className:"hr-page",children:(0,b.jsx)("p",{children:"Checking access..."})}):(0,b.jsx)(y,{})}function y(){let[a]=(0,c.useState)((0,t.getWorkflowTemplates)()),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)(!0),[A,B]=(0,c.useState)(!0),[C,D]=(0,c.useState)("all"),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)([]),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)(null),[S,T]=(0,c.useState)(!1),U=(0,c.useCallback)(async()=>{try{let a=await fetch("/api/workflows");if(a.ok){let b=await a.json();"all"!==C&&(b=b.filter(a=>a.status===C)),x(b)}}catch(a){console.error("Failed to load workflow instances:",a),x([])}},[C]);(0,c.useEffect)(()=>{!async function(){let a=await (0,v.getCurrentUser)();if(!a||"HR_ADMIN"!==a.role){B(!1),z(!1);return}await U();let{data:b}=await u.supabase.from("employees").select("id, name").eq("is_active",!0).order("name");N(b||[]),z(!1)}()},[U]);let V=w.filter(a=>{if(!E)return!0;let b=E.toLowerCase();return a.templateName.toLowerCase().includes(b)||a.employeeName?.toLowerCase().includes(b)});async function W(){if(I&&K){P(!0);try{let a=await fetch("/api/workflows",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({templateId:I,employeeId:K})});if(!a.ok){let b=await a.json();console.error("Failed to start workflow:",b)}}catch(a){console.error("Error starting workflow:",a)}await U(),H(!1),J(null),L(""),P(!1)}}async function X(a){if(!Q)return;await (0,t.completeWorkflowStep)(Q.id,a);let b=await (0,t.getWorkflowById)(Q.id);b&&R(b),await U()}async function Y(){Q&&(await (0,t.cancelWorkflow)(Q.id),T(!1),R(null),await U())}let Z=a=>{switch(a){case"active":return(0,b.jsxs)(f.Badge,{variant:"default",children:[(0,b.jsx)(m.Clock,{className:"h-3 w-3 mr-1"})," Active"]});case"completed":return(0,b.jsxs)(f.Badge,{variant:"secondary",children:[(0,b.jsx)(n.CheckCircle,{className:"h-3 w-3 mr-1"})," Completed"]});case"cancelled":return(0,b.jsxs)(f.Badge,{variant:"outline",children:[(0,b.jsx)(o.XCircle,{className:"h-3 w-3 mr-1"})," Cancelled"]})}};return y?(0,b.jsx)("div",{className:"p-8",children:(0,b.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,b.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/3"}),(0,b.jsx)("div",{className:"h-64 bg-gray-200 dark:bg-gray-700 rounded"})]})}):A?(0,b.jsxs)("div",{className:"p-8","data-testid":"hr-workflows-page",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4 mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"HR Workflows"}),(0,b.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage standardized HR processes"})]}),(0,b.jsxs)(e.Button,{onClick:()=>H(!0),"data-testid":"button-start-workflow",children:[(0,b.jsx)(k.Plus,{className:"h-4 w-4 mr-2"}),"Start Workflow"]})]}),(0,b.jsxs)(j.Tabs,{defaultValue:"instances",className:"space-y-6",children:[(0,b.jsxs)(j.TabsList,{children:[(0,b.jsx)(j.TabsTrigger,{value:"instances",children:"Active Workflows"}),(0,b.jsx)(j.TabsTrigger,{value:"templates",children:"Templates"})]}),(0,b.jsxs)(j.TabsContent,{value:"instances",className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"relative flex-1 max-w-sm",children:[(0,b.jsx)(l.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,b.jsx)(g.Input,{placeholder:"Search workflows...",value:E,onChange:a=>F(a.target.value),className:"pl-9","data-testid":"input-search-workflows"})]}),(0,b.jsxs)(h.Select,{value:C,onValueChange:a=>D(a),children:[(0,b.jsx)(h.SelectTrigger,{className:"w-40","data-testid":"select-status-filter",children:(0,b.jsx)(h.SelectValue,{placeholder:"All statuses"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All statuses"}),(0,b.jsx)(h.SelectItem,{value:"active",children:"Active"}),(0,b.jsx)(h.SelectItem,{value:"completed",children:"Completed"}),(0,b.jsx)(h.SelectItem,{value:"cancelled",children:"Cancelled"})]})]})]}),y?(0,b.jsx)("div",{className:"space-y-4",children:[1,2,3].map(a=>(0,b.jsx)("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"},a))}):0===V.length?(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[(0,b.jsx)("p",{className:"mb-4",children:"No workflows found"}),(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>H(!0),children:"Start a Workflow"})]})})}):(0,b.jsx)("div",{className:"space-y-3",children:V.map(a=>{let c=a.steps.filter(a=>a.isCompleted).length,e=a.steps.length,f=e>0?Math.round(c/e*100):0;return(0,b.jsx)(d.Card,{className:"hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition-colors",onClick:()=>{R(a),T(!0)},"data-testid":`card-workflow-${a.id}`,children:(0,b.jsx)(d.CardContent,{className:"py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-1",children:[(0,b.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:a.templateName}),Z(a.status)]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400",children:[(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(q.User,{className:"h-3 w-3"}),a.employeeName||"Unknown"]}),(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(r.Calendar,{className:"h-3 w-3"}),"Started ",new Date(a.startedAt).toLocaleDateString("sv-SE")]}),(0,b.jsxs)("span",{children:[c,"/",e," steps (",f,"%)"]})]})]}),(0,b.jsx)(p.ChevronRight,{className:"h-5 w-5 text-gray-400"})]})})},a.id)})})]}),(0,b.jsx)(j.TabsContent,{value:"templates",className:"space-y-4",children:(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(a=>(0,b.jsxs)(d.Card,{"data-testid":`card-template-${a.id}`,children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-base",children:a.name}),(0,b.jsx)(f.Badge,{variant:"secondary",children:a.category})]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:a.description}),(0,b.jsxs)("p",{className:"text-xs text-gray-400 mb-4",children:[a.defaultSteps.length," steps"]}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",className:"w-full",onClick:()=>{J(a.id),H(!0)},children:"Start This Workflow"})]})]},a.id))})})]}),(0,b.jsx)(i.Dialog,{open:G,onOpenChange:H,children:(0,b.jsxs)(i.DialogContent,{children:[(0,b.jsxs)(i.DialogHeader,{children:[(0,b.jsx)(i.DialogTitle,{children:"Start New Workflow"}),(0,b.jsx)(i.DialogDescription,{children:"Select a workflow template and employee to begin the process."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Template"}),(0,b.jsxs)(h.Select,{value:I||"",onValueChange:a=>J(a),children:[(0,b.jsx)(h.SelectTrigger,{"data-testid":"select-template",children:(0,b.jsx)(h.SelectValue,{placeholder:"Select a template"})}),(0,b.jsx)(h.SelectContent,{children:a.map(a=>(0,b.jsx)(h.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Employee"}),(0,b.jsxs)(h.Select,{value:K,onValueChange:L,children:[(0,b.jsx)(h.SelectTrigger,{"data-testid":"select-employee",children:(0,b.jsx)(h.SelectValue,{placeholder:"Select an employee"})}),(0,b.jsx)(h.SelectContent,{children:M.map(a=>(0,b.jsx)(h.SelectItem,{value:a.id,children:a.name},a.id))})]})]})]}),(0,b.jsxs)(i.DialogFooter,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>H(!1),children:"Cancel"}),(0,b.jsx)(e.Button,{onClick:W,disabled:!I||!K||O,"data-testid":"button-confirm-start",children:O?"Starting...":"Start Workflow"})]})]})}),(0,b.jsx)(i.Dialog,{open:S,onOpenChange:T,children:(0,b.jsx)(i.DialogContent,{className:"max-w-2xl",children:Q&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(i.DialogHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(i.DialogTitle,{children:Q.templateName}),Z(Q.status)]}),(0,b.jsxs)(i.DialogDescription,{children:[Q.employeeName," - Started ",new Date(Q.startedAt).toLocaleDateString("sv-SE")]})]}),(0,b.jsx)("div",{className:"py-4 max-h-96 overflow-y-auto",children:(0,b.jsx)("div",{className:"space-y-3",children:Q.steps.map((a,c)=>(0,b.jsx)("div",{className:`p-4 rounded-md border ${a.isCompleted?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700"}`,children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsxs)("span",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:["Step ",c+1]}),(0,b.jsx)(f.Badge,{variant:"outline",className:"text-xs",children:a.responsibleRole.toUpperCase()}),0!==a.daysFromStart&&(0,b.jsxs)("span",{className:"text-xs text-gray-400",children:["Day ",a.daysFromStart]})]}),(0,b.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:a.title}),a.description&&(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a.description}),a.isCompleted&&a.completedAt&&(0,b.jsxs)("p",{className:"text-xs text-green-600 dark:text-green-400 mt-2",children:["Completed ",new Date(a.completedAt).toLocaleDateString("sv-SE")]})]}),!a.isCompleted&&"active"===Q.status&&(0,b.jsxs)(e.Button,{size:"sm",onClick:()=>X(a.id),"data-testid":`button-complete-step-${a.id}`,children:[(0,b.jsx)(n.CheckCircle,{className:"h-4 w-4 mr-1"}),"Complete"]}),a.isCompleted&&(0,b.jsx)(n.CheckCircle,{className:"h-5 w-5 text-green-500"})]})},a.id))})}),(0,b.jsxs)(i.DialogFooter,{children:["active"===Q.status&&(0,b.jsx)(e.Button,{variant:"destructive",onClick:Y,children:"Cancel Workflow"}),(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>T(!1),children:"Close"})]})]})})})]}):(0,b.jsx)("div",{className:"p-8",children:(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)(s.AlertTriangle,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Access Denied"}),(0,b.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"This page is only accessible to HR Administrators."})]})})})}a.s(["default",()=>x])}];

//# sourceMappingURL=app_app_hr_workflows_page_tsx_7b56a32b._.js.map