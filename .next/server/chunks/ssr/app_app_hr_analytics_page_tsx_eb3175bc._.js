module.exports=[42557,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(48654),e=a.i(54161),f=a.i(2150),g=a.i(60246),h=a.i(73570),i=a.i(41675),j=a.i(24669),k=a.i(70106);let l=(0,k.default)("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);var m=a.i(39761),n=a.i(41710),o=a.i(3314);let p=(0,k.default)("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var q=a.i(6807),r=a.i(7291);async function s(){let a=new Date().toISOString().split("T")[0],b=new Date(Date.now()+2592e6).toISOString().split("T")[0],c=new Date(Date.now()+7776e6).toISOString().split("T")[0],[d,e,f,g,h,i]=await Promise.all([r.supabase.from("employees").select("id",{count:"exact",head:!0}).eq("is_active",!0),r.supabase.from("employees").select("id, name, role, employment_type, contract_end_date, line, team, org_unit_id").eq("is_active",!0),r.supabase.from("employees").select("id, name, role, contract_end_date").eq("is_active",!0).eq("employment_type","temporary").not("contract_end_date","is",null).lte("contract_end_date",c),r.supabase.from("person_events").select("id, category, status, due_date, employee_id, employees:employee_id(line, team)").neq("status","completed"),r.supabase.from("employee_skills").select("level, skills(name)").order("level"),r.supabase.from("absences").select("id, type, from_date, to_date")]),j=d.count||0,k=e.data||[],l={},m={};for(let a of k){let b=a.line||a.team||"Unassigned",c=a.employment_type||"unknown";l[b]||(l[b]={count:0,permanent:0,temporary:0,consultant:0}),l[b].count++,"permanent"===c?l[b].permanent++:"temporary"===c?l[b].temporary++:"consultant"===c&&l[b].consultant++,m[c]=(m[c]||0)+1}let n=Object.entries(l).map(([a,b])=>({orgUnitName:a,count:b.count,permanent:b.permanent,temporary:b.temporary,consultant:b.consultant})),o=Object.entries(m).map(([a,b])=>({type:a,count:b})),p=f.data||[],q=p.length,s=p.map(a=>({id:a.id,name:a.name,contractEndDate:a.contract_end_date,role:a.role||"Unknown"})),t=g.data||[],u={},v=0,w=0,x={};for(let c of t){if(!c.due_date)continue;let d=c.due_date<a,e=c.due_date>=a&&c.due_date<=b;d&&v++,e&&w++,(d||e)&&(u[c.category]=(u[c.category]||0)+1);let f=c.employees,g=Array.isArray(f)?f[0]:f,h=g?.line||g?.team||"Unassigned";x[h]||(x[h]={overdueCount:0,dueSoonCount:0}),d&&x[h].overdueCount++,e&&x[h].dueSoonCount++}let y=Object.entries(u).map(([a,b])=>({category:a,count:b})),z=Object.entries(l).map(([a,b])=>{let c=x[a]||{overdueCount:0,dueSoonCount:0},d=b.count>0?(c.overdueCount+c.dueSoonCount)/b.count:0;return{unitName:a,headcount:b.count,overdueCount:c.overdueCount,dueSoonCount:c.dueSoonCount,riskIndex:Math.round(100*d)/100}}).sort((a,b)=>b.riskIndex-a.riskIndex),A=i.data,B=!i.error&&null!==A,C=new Date,D=new Date(C.getTime()-2592e6),E=0;if(B){for(let a of A||[])if("sick"===a.type){let b=new Date(a.from_date),c=new Date(a.to_date);if(c>=D){let a=b<D?D:b;E+=Math.max(0,Math.ceil(((c>C?C:c).getTime()-a.getTime())/864e5)+1)}}}let F=j>0?E/(22*j)*100:0,G={};for(let a of h.data||[]){let b=a.skills,c=b?.name||"Unknown";G[c]||(G[c]=[0,0,0,0,0]);let d=a.level;d>=0&&d<=4&&G[c][d]++}return{totalHeadcount:j,headcountByOrgUnit:n,headcountByEmploymentType:o,sickLeaveRatio:Math.round(100*F)/100,temporaryContractsEndingSoon:q,temporaryContractsEndingList:s,criticalEventsCount:y,criticalEventsByStatus:{overdue:v,dueSoon:w},skillDistribution:Object.entries(G).slice(0,10).map(([a,b])=>({skillName:a,levels:b})),riskIndexByUnit:z,absencesAvailable:B}}async function t(){let a=await s(),b=new Date,[c,d,e]=await Promise.all([r.supabase.from("employees").select("id, name, start_date, employment_type, contract_end_date").eq("is_active",!0),r.supabase.from("hr_workflow_instances").select("template_id, template_name",{count:"exact"}).eq("status","active"),r.supabase.from("competence_requirements").select("line, skill_id, min_level, min_headcount, skills(name)")]),f=c.data||[],g={"0-1 years":0,"1-3 years":0,"3-5 years":0,"5-10 years":0,"10+ years":0},h=0,i=0,j=0,k=[];for(let a of f){let c=[],d=0;if(a.start_date){let e=new Date(a.start_date),f=(b.getTime()-e.getTime())/315576e5;h+=f,f<1?(g["0-1 years"]++,d+=1,f<.5&&(c.push("New employee (<6 months)"),d+=1)):f<3?g["1-3 years"]++:f<5?g["3-5 years"]++:f<10?g["5-10 years"]++:g["10+ years"]++}else g["0-1 years"]++;if("temporary"===a.employment_type&&(d+=1,c.push("Temporary contract"),a.contract_end_date)){let e=(new Date(a.contract_end_date).getTime()-b.getTime())/864e5;e<30?(d+=2,c.push("Contract ending within 30 days")):e<90&&(d+=1,c.push("Contract ending within 90 days"))}d>=3?(i++,k.push({id:a.id,name:a.name,riskLevel:"high",factors:c})):d>=2&&(j++,k.push({id:a.id,name:a.name,riskLevel:"medium",factors:c}))}let l=f.length>0?Math.round(h/f.length*10)/10:0,m={};for(let a of d.data||[]){let b=a.template_id;m[b]||(m[b]={name:a.template_name,count:0}),m[b].count++}let n=Object.entries(m).map(([a,b])=>({templateId:a,templateName:b.name,count:b.count})),o=0,p=0;return o=a.criticalEventsByStatus.overdue,p=a.criticalEventsByStatus.dueSoon,{...a,attritionRisk:{highrisk:i,mediumRisk:j,employees:k.slice(0,10)},tenureBands:Object.entries(g).map(([a,b])=>({band:a,count:b})),avgTenureYears:l,openWorkflowsByTemplate:n,skillGapSummary:{criticalGaps:o,trainingNeeded:p,wellStaffed:0}}}var u=a.i(47033);function v({title:a,value:c,icon:e,description:f,testId:g}){return(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a}),(0,b.jsx)("p",{className:"text-3xl font-bold mt-1","data-testid":g,children:c}),f&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:f})]}),(0,b.jsx)("div",{className:"p-3 bg-primary/10 rounded-lg",children:(0,b.jsx)(e,{className:"h-6 w-6 text-primary"})})]})})})}function w(){let[a,k]=(0,c.useState)(null),[r,s]=(0,c.useState)(!0),[w,x]=(0,c.useState)(!0);return((0,c.useEffect)(()=>{!async function(){let a=await (0,u.getCurrentUser)();if(!a||"HR_ADMIN"!==a.role){x(!1),s(!1);return}k(await t()),s(!1)}()},[]),r)?(0,b.jsx)("div",{className:"p-6",children:(0,b.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,b.jsx)("div",{className:"h-8 bg-muted rounded w-1/3"}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[1,2,3,4].map(a=>(0,b.jsx)("div",{className:"h-32 bg-muted rounded"},a))})]})}):w?a?(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold","data-testid":"text-page-title",children:"HR Analytics Dashboard"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Key workforce metrics and insights"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsx)(v,{title:"Total Headcount",value:a.totalHeadcount,icon:g.Users,description:"Active employees",testId:"metric-headcount"}),(0,b.jsx)(v,{title:"Sick Leave Rate",value:a.absencesAvailable?`${a.sickLeaveRatio}%`:"N/A",icon:l,description:a.absencesAvailable?"Last 30 days":"Data not available",testId:"metric-sick-leave"}),(0,b.jsx)(v,{title:"Contracts Ending",value:a.temporaryContractsEndingSoon,icon:i.Calendar,description:"Within 90 days",testId:"metric-contracts-ending"}),(0,b.jsx)(v,{title:"Critical Events",value:a.criticalEventsByStatus.overdue+a.criticalEventsByStatus.dueSoon,icon:h.AlertTriangle,description:`${a.criticalEventsByStatus.overdue} overdue, ${a.criticalEventsByStatus.dueSoon} due soon`,testId:"metric-critical-events"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(g.Users,{className:"h-5 w-5"}),"Headcount by Unit & Employment Type"]})}),(0,b.jsx)(d.CardContent,{children:0===a.headcountByOrgUnit.length?(0,b.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No data available"}):(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b",children:[(0,b.jsx)("th",{className:"text-left py-2",children:"Unit"}),(0,b.jsx)("th",{className:"text-center py-2",children:"Perm"}),(0,b.jsx)("th",{className:"text-center py-2",children:"Temp"}),(0,b.jsx)("th",{className:"text-center py-2",children:"Cons"}),(0,b.jsx)("th",{className:"text-right py-2",children:"Total"})]})}),(0,b.jsx)("tbody",{children:a.headcountByOrgUnit.map(a=>(0,b.jsxs)("tr",{className:"border-b last:border-0",children:[(0,b.jsx)("td",{className:"py-2",children:a.orgUnitName}),(0,b.jsx)("td",{className:"text-center py-2",children:a.permanent}),(0,b.jsx)("td",{className:"text-center py-2",children:a.temporary}),(0,b.jsx)("td",{className:"text-center py-2",children:a.consultant}),(0,b.jsx)("td",{className:"text-right py-2 font-medium",children:a.count})]},a.orgUnitName))})]})})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(n.Clock,{className:"h-5 w-5"}),"Temporary Contracts Ending (90 days)"]})}),(0,b.jsx)(d.CardContent,{children:0===a.temporaryContractsEndingList.length?(0,b.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No contracts ending soon"}):(0,b.jsx)("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:a.temporaryContractsEndingList.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4 py-2 border-b last:border-0",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.name}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.role})]}),(0,b.jsx)(e.Badge,{variant:"outline",children:new Date(a.contractEndDate).toLocaleDateString("sv-SE")})]},a.id))})})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(h.AlertTriangle,{className:"h-5 w-5"}),"Critical Events by Category"]})}),(0,b.jsx)(d.CardContent,{children:0===a.criticalEventsCount.length?(0,b.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No critical events"}):(0,b.jsx)("div",{className:"space-y-3",children:a.criticalEventsCount.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsx)("span",{className:"text-sm capitalize",children:a.category.replace(/_/g," ")}),(0,b.jsx)(e.Badge,{variant:a.count>5?"destructive":a.count>2?"default":"secondary",children:a.count})]},a.category))})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Shield,{className:"h-5 w-5"}),"People Risk Index by Unit"]})}),(0,b.jsx)(d.CardContent,{children:0===a.riskIndexByUnit.length?(0,b.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No data available"}):(0,b.jsx)("div",{className:"space-y-3",children:a.riskIndexByUnit.slice(0,8).map(a=>{var c;return(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium truncate",children:a.unitName}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[a.overdueCount," overdue, ",a.dueSoonCount," due soon / ",a.headcount," staff"]})]}),(0,b.jsx)(e.Badge,{variant:(c=a.riskIndex)>=.5?"destructive":c>=.2?"default":"secondary",children:a.riskIndex.toFixed(2)})]},a.unitName)})})})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(j.TrendingUp,{className:"h-5 w-5"}),"Employment Type Distribution"]})}),(0,b.jsx)(d.CardContent,{children:0===a.headcountByEmploymentType.length?(0,b.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No data available"}):(0,b.jsx)("div",{className:"space-y-3",children:a.headcountByEmploymentType.map(c=>(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsx)("span",{className:"text-sm capitalize",children:c.type}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Progress,{value:c.count/a.totalHeadcount*100,className:"w-24 h-2"}),(0,b.jsx)("span",{className:"text-sm font-medium w-8 text-right",children:c.count})]})]},c.type))})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(m.BarChart3,{className:"h-5 w-5"}),"Skill Level Distribution"]})}),(0,b.jsx)(d.CardContent,{children:0===a.skillDistribution.length?(0,b.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No skills data"}):(0,b.jsx)("div",{className:"space-y-4",children:a.skillDistribution.slice(0,5).map(a=>(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium mb-1",children:a.skillName}),(0,b.jsx)("div",{className:"flex items-center gap-1",children:a.levels.map((a,c)=>(0,b.jsx)("div",{className:"flex-1 bg-muted rounded text-center text-xs py-1",title:`Level ${c}: ${a} employees`,children:a>0?a:"-"},c))}),(0,b.jsx)("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mt-1",children:[0,1,2,3,4].map(a=>(0,b.jsxs)("div",{className:"flex-1 text-center",children:["L",a]},a))})]},a.skillName))})})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(p,{className:"h-5 w-5"}),"Attrition Risk"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-6 mb-4",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-3xl font-bold text-red-600 dark:text-red-400","data-testid":"metric-attrition-high",children:a.attritionRisk.highrisk}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"High Risk"})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-3xl font-bold text-orange-600 dark:text-orange-400","data-testid":"metric-attrition-medium",children:a.attritionRisk.mediumRisk}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Medium Risk"})]})]}),a.attritionRisk.employees.length>0&&(0,b.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:a.attritionRisk.employees.slice(0,5).map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2 py-1 border-b last:border-0",children:[(0,b.jsx)("span",{className:"text-sm",children:a.name}),(0,b.jsx)(e.Badge,{variant:"high"===a.riskLevel?"destructive":"default",children:a.factors[0]})]},a.id))})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(n.Clock,{className:"h-5 w-5"}),"Tenure Distribution"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"flex items-center gap-4 mb-4",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-3xl font-bold","data-testid":"metric-avg-tenure",children:a.avgTenureYears}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Avg. Years"})]})}),(0,b.jsx)("div",{className:"space-y-2",children:a.tenureBands.map(c=>(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsx)("span",{className:"text-sm",children:c.band}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Progress,{value:c.count/a.totalHeadcount*100,className:"w-24 h-2"}),(0,b.jsx)("span",{className:"text-sm font-medium w-8 text-right",children:c.count})]})]},c.band))})]})]})]}),a.openWorkflowsByTemplate.length>0&&(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(q.Workflow,{className:"h-5 w-5"}),"Active Workflows by Type"]})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"flex flex-wrap gap-4",children:a.openWorkflowsByTemplate.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm",children:a.templateName}),(0,b.jsx)(e.Badge,{variant:"secondary",children:a.count})]},a.templateId))})})]}),!a.absencesAvailable&&(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardContent,{className:"py-8 text-center",children:[(0,b.jsx)(l,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Sick leave analytics coming soon - awaiting absences data integration."})]})})]}):(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"Unable to load analytics"})}):(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)(h.AlertTriangle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,b.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Access Denied"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"This page is only accessible to HR Administrators."})]})})})}a.s(["default",()=>w],42557)}];

//# sourceMappingURL=app_app_hr_analytics_page_tsx_eb3175bc._.js.map