{"version":3,"sources":["../../../../app/app/hr/workflows/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { \n  Select, \n  SelectContent, \n  SelectItem, \n  SelectTrigger, \n  SelectValue \n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { \n  Plus, \n  Search, \n  Clock, \n  CheckCircle, \n  XCircle, \n  ChevronRight,\n  User,\n  Calendar,\n  AlertTriangle\n} from \"lucide-react\";\nimport { \n  getWorkflowTemplates, \n  getWorkflowInstances, \n  startWorkflow,\n  completeWorkflowStep,\n  cancelWorkflow,\n  getWorkflowById\n} from \"@/services/hrWorkflows\";\nimport { supabase } from \"@/lib/supabaseClient\";\nimport { getCurrentUser, type CurrentUser } from \"@/lib/auth\";\nimport type { \n  HRWorkflowTemplate, \n  HRWorkflowInstance, \n  HRWorkflowStatus,\n  HRWorkflowTemplateId \n} from \"@/types/domain\";\nimport { useAuthGuard } from \"@/hooks/useAuthGuard\";\n\nexport default function HRWorkflowsPage() {\n  const { loading: authLoading } = useAuthGuard();\n\n  if (authLoading) {\n    return (\n      <main className=\"hr-page\">\n        <p>Checking access...</p>\n      </main>\n    );\n  }\n  \n  return <HRWorkflowsPageContent />;\n}\n\nfunction HRWorkflowsPageContent() {\n  const [templates] = useState<HRWorkflowTemplate[]>(getWorkflowTemplates());\n  const [instances, setInstances] = useState<HRWorkflowInstance[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [authorized, setAuthorized] = useState(true);\n  const [statusFilter, setStatusFilter] = useState<HRWorkflowStatus | \"all\">(\"all\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [showStartDialog, setShowStartDialog] = useState(false);\n  const [selectedTemplate, setSelectedTemplate] = useState<HRWorkflowTemplateId | null>(null);\n  const [selectedEmployeeId, setSelectedEmployeeId] = useState(\"\");\n  const [employees, setEmployees] = useState<{ id: string; name: string }[]>([]);\n  const [starting, setStarting] = useState(false);\n  const [selectedInstance, setSelectedInstance] = useState<HRWorkflowInstance | null>(null);\n  const [showDetailDialog, setShowDetailDialog] = useState(false);\n\n  const loadInstances = useCallback(async () => {\n    try {\n      const response = await fetch(\"/api/workflows\");\n      if (response.ok) {\n        let data = await response.json();\n        if (statusFilter !== \"all\") {\n          data = data.filter((i: HRWorkflowInstance) => i.status === statusFilter);\n        }\n        setInstances(data);\n      }\n    } catch (err) {\n      console.error(\"Failed to load workflow instances:\", err);\n      setInstances([]);\n    }\n  }, [statusFilter]);\n\n  useEffect(() => {\n    async function checkAuthAndLoad() {\n      const user = await getCurrentUser();\n      if (!user || user.role !== \"HR_ADMIN\") {\n        setAuthorized(false);\n        setLoading(false);\n        return;\n      }\n      \n      await loadInstances();\n      const { data } = await supabase\n        .from(\"employees\")\n        .select(\"id, name\")\n        .eq(\"is_active\", true)\n        .order(\"name\");\n      setEmployees(data || []);\n      setLoading(false);\n    }\n    checkAuthAndLoad();\n  }, [loadInstances]);\n\n  const filteredInstances = instances.filter((i) => {\n    if (!searchTerm) return true;\n    const term = searchTerm.toLowerCase();\n    return (\n      i.templateName.toLowerCase().includes(term) ||\n      i.employeeName?.toLowerCase().includes(term)\n    );\n  });\n\n  async function handleStartWorkflow() {\n    if (!selectedTemplate || !selectedEmployeeId) return;\n    setStarting(true);\n    try {\n      const response = await fetch(\"/api/workflows\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          templateId: selectedTemplate,\n          employeeId: selectedEmployeeId,\n        }),\n      });\n      if (!response.ok) {\n        const err = await response.json();\n        console.error(\"Failed to start workflow:\", err);\n      }\n    } catch (err) {\n      console.error(\"Error starting workflow:\", err);\n    }\n    await loadInstances();\n    setShowStartDialog(false);\n    setSelectedTemplate(null);\n    setSelectedEmployeeId(\"\");\n    setStarting(false);\n  }\n\n  async function handleCompleteStep(stepId: string) {\n    if (!selectedInstance) return;\n    await completeWorkflowStep(selectedInstance.id, stepId);\n    const updated = await getWorkflowById(selectedInstance.id);\n    if (updated) setSelectedInstance(updated);\n    await loadInstances();\n  }\n\n  async function handleCancelWorkflow() {\n    if (!selectedInstance) return;\n    await cancelWorkflow(selectedInstance.id);\n    setShowDetailDialog(false);\n    setSelectedInstance(null);\n    await loadInstances();\n  }\n\n  function openInstanceDetail(instance: HRWorkflowInstance) {\n    setSelectedInstance(instance);\n    setShowDetailDialog(true);\n  }\n\n  const statusBadge = (status: HRWorkflowStatus) => {\n    switch (status) {\n      case \"active\":\n        return <Badge variant=\"default\"><Clock className=\"h-3 w-3 mr-1\" /> Active</Badge>;\n      case \"completed\":\n        return <Badge variant=\"secondary\"><CheckCircle className=\"h-3 w-3 mr-1\" /> Completed</Badge>;\n      case \"cancelled\":\n        return <Badge variant=\"outline\"><XCircle className=\"h-3 w-3 mr-1\" /> Cancelled</Badge>;\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"p-8\">\n        <div className=\"animate-pulse space-y-4\">\n          <div className=\"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/3\" />\n          <div className=\"h-64 bg-gray-200 dark:bg-gray-700 rounded\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (!authorized) {\n    return (\n      <div className=\"p-8\">\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <AlertTriangle className=\"h-12 w-12 text-red-500 mx-auto mb-4\" />\n            <h2 className=\"text-xl font-bold text-gray-900 dark:text-white mb-2\">Access Denied</h2>\n            <p className=\"text-gray-500 dark:text-gray-400\">\n              This page is only accessible to HR Administrators.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-8\" data-testid=\"hr-workflows-page\">\n      <div className=\"flex items-center justify-between gap-4 mb-6\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">HR Workflows</h1>\n          <p className=\"text-gray-500 dark:text-gray-400 mt-1\">Manage standardized HR processes</p>\n        </div>\n        <Button onClick={() => setShowStartDialog(true)} data-testid=\"button-start-workflow\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Start Workflow\n        </Button>\n      </div>\n\n      <Tabs defaultValue=\"instances\" className=\"space-y-6\">\n        <TabsList>\n          <TabsTrigger value=\"instances\">Active Workflows</TabsTrigger>\n          <TabsTrigger value=\"templates\">Templates</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"instances\" className=\"space-y-4\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\n              <Input\n                placeholder=\"Search workflows...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search-workflows\"\n              />\n            </div>\n            <Select value={statusFilter} onValueChange={(v) => setStatusFilter(v as HRWorkflowStatus | \"all\")}>\n              <SelectTrigger className=\"w-40\" data-testid=\"select-status-filter\">\n                <SelectValue placeholder=\"All statuses\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All statuses</SelectItem>\n                <SelectItem value=\"active\">Active</SelectItem>\n                <SelectItem value=\"completed\">Completed</SelectItem>\n                <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          {loading ? (\n            <div className=\"space-y-4\">\n              {[1, 2, 3].map((i) => (\n                <div key={i} className=\"h-20 bg-gray-200 dark:bg-gray-700 rounded animate-pulse\" />\n              ))}\n            </div>\n          ) : filteredInstances.length === 0 ? (\n            <Card>\n              <CardContent className=\"pt-6\">\n                <div className=\"text-center py-12 text-gray-500 dark:text-gray-400\">\n                  <p className=\"mb-4\">No workflows found</p>\n                  <Button variant=\"outline\" onClick={() => setShowStartDialog(true)}>\n                    Start a Workflow\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"space-y-3\">\n              {filteredInstances.map((instance) => {\n                const completedSteps = instance.steps.filter((s) => s.isCompleted).length;\n                const totalSteps = instance.steps.length;\n                const progress = totalSteps > 0 ? Math.round((completedSteps / totalSteps) * 100) : 0;\n\n                return (\n                  <Card \n                    key={instance.id} \n                    className=\"hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition-colors\"\n                    onClick={() => openInstanceDetail(instance)}\n                    data-testid={`card-workflow-${instance.id}`}\n                  >\n                    <CardContent className=\"py-4\">\n                      <div className=\"flex items-center justify-between gap-4\">\n                        <div className=\"min-w-0 flex-1\">\n                          <div className=\"flex items-center gap-3 mb-1\">\n                            <span className=\"font-medium text-gray-900 dark:text-white\">{instance.templateName}</span>\n                            {statusBadge(instance.status)}\n                          </div>\n                          <div className=\"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400\">\n                            <span className=\"flex items-center gap-1\">\n                              <User className=\"h-3 w-3\" />\n                              {instance.employeeName || \"Unknown\"}\n                            </span>\n                            <span className=\"flex items-center gap-1\">\n                              <Calendar className=\"h-3 w-3\" />\n                              Started {new Date(instance.startedAt).toLocaleDateString(\"sv-SE\")}\n                            </span>\n                            <span>{completedSteps}/{totalSteps} steps ({progress}%)</span>\n                          </div>\n                        </div>\n                        <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"templates\" className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {templates.map((template) => (\n              <Card key={template.id} data-testid={`card-template-${template.id}`}>\n                <CardHeader className=\"pb-2\">\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <CardTitle className=\"text-base\">{template.name}</CardTitle>\n                    <Badge variant=\"secondary\">{template.category}</Badge>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-4\">{template.description}</p>\n                  <p className=\"text-xs text-gray-400 mb-4\">{template.defaultSteps.length} steps</p>\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\" \n                    className=\"w-full\"\n                    onClick={() => {\n                      setSelectedTemplate(template.id);\n                      setShowStartDialog(true);\n                    }}\n                  >\n                    Start This Workflow\n                  </Button>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </TabsContent>\n      </Tabs>\n\n      <Dialog open={showStartDialog} onOpenChange={setShowStartDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Start New Workflow</DialogTitle>\n            <DialogDescription>\n              Select a workflow template and employee to begin the process.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Template</label>\n              <Select value={selectedTemplate || \"\"} onValueChange={(v) => setSelectedTemplate(v as HRWorkflowTemplateId)}>\n                <SelectTrigger data-testid=\"select-template\">\n                  <SelectValue placeholder=\"Select a template\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {templates.map((t) => (\n                    <SelectItem key={t.id} value={t.id}>{t.name}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Employee</label>\n              <Select value={selectedEmployeeId} onValueChange={setSelectedEmployeeId}>\n                <SelectTrigger data-testid=\"select-employee\">\n                  <SelectValue placeholder=\"Select an employee\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {employees.map((e) => (\n                    <SelectItem key={e.id} value={e.id}>{e.name}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowStartDialog(false)}>Cancel</Button>\n            <Button \n              onClick={handleStartWorkflow} \n              disabled={!selectedTemplate || !selectedEmployeeId || starting}\n              data-testid=\"button-confirm-start\"\n            >\n              {starting ? \"Starting...\" : \"Start Workflow\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showDetailDialog} onOpenChange={setShowDetailDialog}>\n        <DialogContent className=\"max-w-2xl\">\n          {selectedInstance && (\n            <>\n              <DialogHeader>\n                <div className=\"flex items-center gap-3\">\n                  <DialogTitle>{selectedInstance.templateName}</DialogTitle>\n                  {statusBadge(selectedInstance.status)}\n                </div>\n                <DialogDescription>\n                  {selectedInstance.employeeName} - Started {new Date(selectedInstance.startedAt).toLocaleDateString(\"sv-SE\")}\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"py-4 max-h-96 overflow-y-auto\">\n                <div className=\"space-y-3\">\n                  {selectedInstance.steps.map((step, index) => (\n                    <div \n                      key={step.id} \n                      className={`p-4 rounded-md border ${\n                        step.isCompleted \n                          ? \"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800\" \n                          : \"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700\"\n                      }`}\n                    >\n                      <div className=\"flex items-start justify-between gap-4\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2 mb-1\">\n                            <span className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\n                              Step {index + 1}\n                            </span>\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              {step.responsibleRole.toUpperCase()}\n                            </Badge>\n                            {step.daysFromStart !== 0 && (\n                              <span className=\"text-xs text-gray-400\">\n                                Day {step.daysFromStart}\n                              </span>\n                            )}\n                          </div>\n                          <p className=\"font-medium text-gray-900 dark:text-white\">{step.title}</p>\n                          {step.description && (\n                            <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">{step.description}</p>\n                          )}\n                          {step.isCompleted && step.completedAt && (\n                            <p className=\"text-xs text-green-600 dark:text-green-400 mt-2\">\n                              Completed {new Date(step.completedAt).toLocaleDateString(\"sv-SE\")}\n                            </p>\n                          )}\n                        </div>\n                        {!step.isCompleted && selectedInstance.status === \"active\" && (\n                          <Button \n                            size=\"sm\" \n                            onClick={() => handleCompleteStep(step.id)}\n                            data-testid={`button-complete-step-${step.id}`}\n                          >\n                            <CheckCircle className=\"h-4 w-4 mr-1\" />\n                            Complete\n                          </Button>\n                        )}\n                        {step.isCompleted && (\n                          <CheckCircle className=\"h-5 w-5 text-green-500\" />\n                        )}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n              <DialogFooter>\n                {selectedInstance.status === \"active\" && (\n                  <Button variant=\"destructive\" onClick={handleCancelWorkflow}>\n                    Cancel Workflow\n                  </Button>\n                )}\n                <Button variant=\"outline\" onClick={() => setShowDetailDialog(false)}>Close</Button>\n              </DialogFooter>\n            </>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OAOA,EAAA,EAAA,CAAA,CAAA,OAQA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAWA,EAAA,EAAA,CAAA,CAAA,OAQA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OAOA,EAAA,EAAA,CAAA,CAAA,OAEe,SAAS,IACtB,GAAM,CAAE,QAAS,CAAW,CAAE,CAAG,CAAA,EAAA,EAAA,YAAA,AAAY,WAE7C,AAAI,EAEA,CAAA,EAAA,EAAA,GAAA,EAAC,CAFY,MAEZ,CAAK,UAAU,mBACd,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,UAAE,yBAKF,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAA,EACV,CAEA,SAAS,IACP,GAAM,CAAC,EAAU,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAuB,CAAA,EAAA,EAAA,oBAAA,AAAoB,KACjE,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAuB,EAAE,EAC7D,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjC,CAAC,EAAY,EAAc,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACvC,CAAC,EAAc,EAAgB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA2B,OACrE,CAAC,EAAY,EAAc,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAS,IACvC,CAAC,EAAiB,EAAmB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjD,CAAC,EAAkB,EAAoB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA8B,MAChF,CAAC,EAAoB,EAAsB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACvD,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAiC,EAAE,EACvE,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACnC,CAAC,EAAkB,EAAoB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA4B,MAC9E,CAAC,EAAkB,EAAoB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAEnD,EAAgB,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,UAChC,GAAI,CACF,IAAM,EAAW,MAAM,MAAM,kBAC7B,GAAI,EAAS,EAAE,CAAE,CACf,IAAI,EAAO,MAAM,EAAS,IAAI,GACT,OAAO,CAAxB,IACF,EAAO,EAAK,MAAM,CAAC,AAAC,GAA0B,EAAE,MAAM,GAAK,EAAA,EAE7D,EAAa,EACf,CACF,CAAE,MAAO,EAAK,CACZ,QAAQ,KAAK,CAAC,qCAAsC,GACpD,EAAa,EAAE,CACjB,CACF,EAAG,CAAC,EAAa,EAEjB,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,MACR,AAiBA,eAjBe,EACb,IAAM,EAAO,MAAM,CAAA,EAAA,EAAA,cAAA,AAAc,IACjC,GAAI,CAAC,GAAsB,aAAd,EAAK,IAAI,CAAiB,CACrC,GAAc,GACd,GAAW,GACX,MACF,CAEA,MAAM,IACN,GAAM,MAAE,CAAI,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC5B,IAAI,CAAC,aACL,MAAM,CAAC,YACP,EAAE,CAAC,aAAa,GAChB,KAAK,CAAC,QACT,EAAa,GAAQ,EAAE,EACvB,GAAW,EACb,GAEF,EAAG,CAAC,EAAc,EAElB,IAAM,EAAoB,EAAU,MAAM,CAAC,AAAC,IAC1C,GAAI,CAAC,EAAY,OAAO,EACxB,IAAM,EAAO,EAAW,WAAW,GACnC,OACE,EAAE,YAAY,CAAC,WAAW,GAAG,QAAQ,CAAC,IACtC,EAAE,YAAY,EAAE,cAAc,SAAS,EAE3C,GAEA,eAAe,IACb,GAAI,AAAC,GAAqB,GAC1B,GAAY,GACZ,GAAI,CACF,IAHuB,AAGjB,EAAW,CAH2B,KAGrB,MAAM,iBAAkB,CAC7C,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAmB,EAC9C,KAAM,KAAK,SAAS,CAAC,CACnB,WAAY,EACZ,WAAY,CACd,EACF,GACA,GAAI,CAAC,EAAS,EAAE,CAAE,CAChB,IAAM,EAAM,MAAM,EAAS,IAAI,GAC/B,QAAQ,KAAK,CAAC,4BAA6B,EAC7C,CACF,CAAE,MAAO,EAAK,CACZ,QAAQ,KAAK,CAAC,2BAA4B,EAC5C,CACA,MAAM,IACN,GAAmB,GACnB,EAAoB,MACpB,EAAsB,IACtB,GAAY,GACd,CAEA,eAAe,EAAmB,CAAc,EAC9C,GAAI,CAAC,EAAkB,MACvB,OAAM,CAAA,EAAA,EAAA,oBAAoB,AAApB,EAAqB,EAAiB,EAAE,CAAE,GAChD,IAAM,EAAU,MAAM,CAAA,EAAA,EAAA,eAAA,AAAe,EAAC,EAAiB,EAAE,EACrD,GAAS,EAAoB,GACjC,MAAM,GACR,CAEA,eAAe,IACR,IACL,MAAM,CAAA,EAAA,EAAA,GADiB,WACjB,AAAc,EAAC,EAAiB,EAAE,EACxC,GAAoB,GACpB,EAAoB,MACpB,MAAM,IACR,CAOA,IAAM,EAAc,AAAC,IACnB,OAAQ,GACN,IAAK,SACH,MAAO,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,KAAK,CAAA,CAAC,QAAQ,oBAAU,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,UAAU,iBAAiB,YACpE,KAAK,YACH,MAAO,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,KAAK,CAAA,CAAC,QAAQ,sBAAY,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,iBAAiB,eAC5E,KAAK,YACH,MAAO,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,KAAK,CAAA,CAAC,QAAQ,oBAAU,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAO,CAAA,CAAC,UAAU,iBAAiB,eACxE,CACF,SAEA,AAAI,EAEA,CAAA,EAAA,EAAA,EAFS,CAET,EAAC,MAAA,CAAI,UAAU,eACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oCACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,mDACf,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,mDAMlB,EAiBH,CAAA,EAAA,EAAA,IAAA,CAjBe,CAiBd,MAAA,CAAI,UAAU,MAAM,cAAY,8BAC/B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,4DAAmD,iBACjE,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iDAAwC,wCAEvD,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,MAAM,CAAA,CAAC,QAAS,IAAM,GAAmB,GAAO,cAAY,kCAC3D,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,iBAAiB,uBAKrC,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,CAAC,aAAa,YAAY,UAAU,sBACvC,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,QAAQ,CAAA,WACP,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,MAAM,qBAAY,qBAC/B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,MAAM,qBAAY,iBAGjC,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,WAAW,CAAA,CAAC,MAAM,YAAY,UAAU,sBACvC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oCACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,qCACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,UAAU,mEAClB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CACJ,YAAY,sBACZ,MAAO,EACP,SAAU,AAAC,GAAM,EAAc,EAAE,MAAM,CAAC,KAAK,EAC7C,UAAU,OACV,cAAY,8BAGhB,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,MAAM,CAAA,CAAC,MAAO,EAAc,cAAgB,AAAD,GAAO,EAAgB,aACjE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,aAAa,CAAA,CAAC,UAAU,OAAO,cAAY,gCAC1C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,YAAY,mBAE3B,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,aAAa,CAAA,WACZ,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAC,MAAM,eAAM,iBACxB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAC,MAAM,kBAAS,WAC3B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAC,MAAM,qBAAY,cAC9B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAC,MAAM,qBAAY,uBAKnC,EACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qBACZ,CAAC,EAAG,EAAG,EAAE,CAAC,GAAG,CAAC,AAAC,GACd,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAY,UAAU,2DAAb,MAGiB,IAA7B,EAAkB,MAAM,CAC1B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,UACH,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,gBACrB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,+DACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,gBAAO,uBACpB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,QAAQ,UAAU,QAAS,IAAM,GAAmB,YAAO,4BAOzE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qBACZ,EAAkB,GAAG,CAAC,AAAC,IACtB,IAAM,EAAiB,EAAS,KAAK,CAAC,MAAM,CAAC,AAAC,GAAM,EAAE,WAAW,EAAE,MAAM,CACnE,EAAa,EAAS,KAAK,CAAC,MAAM,CAClC,EAAW,EAAa,EAAI,KAAK,KAAK,CAAE,EAAiB,EAAc,KAAO,EAEpF,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,CAEH,UAAU,2EACV,QAAS,IAAM,CAlH/B,EAkHkD,GAjHlD,GAAoB,IAkHJ,QAnHI,MAmHS,CAAC,cAAc,EAAE,EAAS,EAAE,CAAA,CAAE,UAE3C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,gBACrB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2BACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yCACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,qDAA6C,EAAS,YAAY,GACjF,EAAY,EAAS,MAAM,KAE9B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,6EACb,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,oCACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,YACf,EAAS,YAAY,EAAI,aAE5B,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,oCACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CAAC,UAAU,YAAY,WACvB,IAAI,KAAK,EAAS,SAAS,EAAE,kBAAkB,CAAC,YAE3D,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,WAAM,EAAe,IAAE,EAAW,WAAS,EAAS,cAGzD,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,YAAY,CAAA,CAAC,UAAU,gCAxBvB,EAAS,EAAE,CA6BtB,QAKN,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,MAAM,YAAY,UAAU,qBACvC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gEACZ,EAAU,GAAG,CAAC,AAAC,GACd,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,CAAmB,cAAa,CAAC,cAAc,EAAE,EAAS,EAAE,CAAA,CAAE,WACjE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAC,UAAU,gBACpB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mDACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,qBAAa,EAAS,IAAI,GAC/C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,QAAQ,qBAAa,EAAS,QAAQ,QAGjD,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,WAAW,CAAA,WACV,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,yDAAiD,EAAS,WAAW,GAClF,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,uCAA8B,EAAS,YAAY,CAAC,MAAM,CAAC,YACxE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACL,QAAQ,UACR,KAAK,KACL,UAAU,SACV,QAAS,KACP,EAAoB,EAAS,EAAE,EAC/B,GAAmB,EACrB,WACD,6BAlBM,EAAS,EAAE,UA4B9B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,KAAM,EAAiB,aAAc,WAC3C,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,aAAa,CAAA,WACZ,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,YAAY,CAAA,WACX,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,UAAC,uBACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,iBAAiB,CAAA,UAAC,qEAIrB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2BACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,gEAAuD,aACxE,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,MAAM,CAAA,CAAC,MAAO,GAAoB,GAAI,cAAe,AAAC,GAAM,EAAoB,aAC/E,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,aAAa,CAAA,CAAC,cAAY,2BACzB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,YAAY,wBAE3B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,aAAa,CAAA,UACX,EAAU,GAAG,CAAC,AAAC,GACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAY,MAAO,EAAE,EAAE,UAAG,EAAE,IAAI,EAA1B,EAAE,EAAE,WAK7B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,gEAAuD,aACxE,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,MAAM,CAAA,CAAC,MAAO,EAAoB,cAAe,YAChD,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,aAAa,CAAA,CAAC,cAAY,2BACzB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,YAAY,yBAE3B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,aAAa,CAAA,UACX,EAAU,GAAG,CAAE,AAAD,GACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAY,MAAO,EAAE,EAAE,UAAG,EAAE,IAAI,EAA1B,EAAE,EAAE,cAM/B,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,YAAY,CAAA,WACX,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,QAAQ,UAAU,QAAS,IAAM,GAAmB,YAAQ,WACpE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACL,QAAS,EACT,SAAU,CAAC,GAAoB,CAAC,GAAsB,EACtD,cAAY,gCAEX,EAAW,cAAgB,2BAMpC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,KAAM,EAAkB,aAAc,WAC5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,aAAa,CAAA,CAAC,UAAU,qBACtB,GACC,CAAA,EAAA,EAAA,IAAA,EAAA,EAAA,QAAA,CAAA,WACE,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,YAAY,CAAA,WACX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oCACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,UAAE,EAAiB,YAAY,GAC1C,EAAY,EAAiB,MAAM,KAEtC,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,iBAAiB,CAAA,WACf,EAAiB,YAAY,CAAC,cAAY,IAAI,KAAK,EAAiB,SAAS,EAAE,kBAAkB,CAAC,eAGvG,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yCACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qBACZ,EAAiB,KAAK,CAAC,GAAG,CAAC,CAAC,EAAM,IACjC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAEC,UAAW,CAAC,sBAAsB,EAChC,EAAK,WAAW,CACZ,0EACA,iEAAA,CACJ,UAEF,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yCACb,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,iEAAuD,QAC/D,EAAQ,KAEhB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,QAAQ,UAAU,UAAU,mBAChC,EAAK,eAAe,CAAC,WAAW,KAEX,IAAvB,EAAK,aAAa,EACjB,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,kCAAwB,OACjC,EAAK,aAAa,OAI7B,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,qDAA6C,EAAK,KAAK,GACnE,EAAK,WAAW,EACf,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,yDAAiD,EAAK,WAAW,GAE/E,EAAK,WAAW,EAAI,EAAK,WAAW,EACnC,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,4DAAkD,aAClD,IAAI,KAAK,EAAK,WAAW,EAAE,kBAAkB,CAAC,eAI9D,CAAC,EAAK,WAAW,EAAgC,WAA5B,EAAiB,MAAM,EAC3C,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,MAAM,CAAA,CACL,KAAK,KACL,QAAS,IAAM,EAAmB,EAAK,EAAE,EACzC,cAAa,CAAC,qBAAqB,EAAE,EAAK,EAAE,CAAA,CAAE,WAE9C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,iBAAiB,cAI3C,EAAK,WAAW,EACf,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,+BA3CtB,EAAK,EAAE,OAkDpB,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,YAAY,CAAA,WACkB,WAA5B,EAAiB,MAAM,EACtB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,QAAQ,cAAc,QAAS,WAAsB,oBAI/D,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,QAAQ,UAAU,QAAS,IAAM,GAAoB,YAAQ,uBA/Q/E,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,eACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,UACH,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,8BACrB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,aAAa,CAAA,CAAC,UAAU,wCACzB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gEAAuD,kBACrE,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,4CAAmC,6DAkR5D"}