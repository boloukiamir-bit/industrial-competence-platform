module.exports=[35227,a=>{"use strict";var b=a.i(72131),c=a.i(50944),d=a.i(70579);function e(){let[a,e]=(0,b.useState)(!0),f=(0,c.useRouter)();return(0,b.useEffect)(()=>{let a=!0;return async function(){try{!await (0,d.getAuthUser)()&&a?f.replace("/login"):a&&e(!1)}catch(b){console.error("Error checking auth",b),a&&f.replace("/login")}}(),()=>{a=!1}},[f]),{loading:a}}a.s(["useAuthGuard",()=>e])},63615,a=>{"use strict";var b=a.i(7291);async function c(){let{data:a,error:c}=await b.supabase.from("positions").select("id, name, site, department").order("name",{ascending:!0});if(c)throw c;return a??[]}async function d(a){let{data:c,error:d}=await b.supabase.from("employees").select("id, name").eq("position_id",a);if(d)throw d;return(c??[]).map(a=>({id:a.id,name:a.name??"Employee"}))}async function e(a,c){var d,e,f;let g=c??new Date().toISOString().slice(0,10),{data:h,error:i}=await b.supabase.from("employees").select("id, name, position_id").eq("id",a).single();if(i||!h)throw console.error(i),i??Error("Employee not found");let j=h.name??"Employee",k=null,l=h.position_id??null;if(l){let{data:a}=await b.supabase.from("positions").select("id, name").eq("id",l).limit(1),c=a?.[0];c&&(k=c.name)}let m=[];if(l){let{data:a,error:c}=await b.supabase.from("position_competence_requirements").select("id, position_id, competence_id, required_level, mandatory").eq("position_id",l);if(c)throw console.error(c),c;m=a??[]}let{data:n,error:o}=await b.supabase.from("employee_competences").select("id, employee_id, competence_id, level, valid_from, valid_to").eq("employee_id",a);if(o)throw console.error(o),o;let p=n??[],q=new Map;for(let a of p)q.set(a.competence_id,a);let r=new Set;m.forEach(a=>r.add(a.competence_id)),p.forEach(a=>r.add(a.competence_id));let s=new Map;if(r.size>0){let{data:a,error:c}=await b.supabase.from("competences").select("id, name, description, code, group_id, is_safety_critical").in("id",Array.from(r));if(c)throw console.error(c),c;let d=a??[],e=new Set;d.forEach(a=>{a.group_id&&e.add(a.group_id)});let f=new Map;if(e.size>0){let{data:a,error:c}=await b.supabase.from("competence_groups").select("id, name").in("id",Array.from(e));c?console.error(c):(a??[]).forEach(a=>{f.set(a.id,a.name)})}d.forEach(a=>{s.set(a.id,{...a,groupName:a.group_id?f.get(a.group_id)??null:null})})}let t=[],u=0,v=0,w=0,x=new Set;for(let a of m){let b=s.get(a.competence_id);if(!b)continue;let c=q.get(a.competence_id)??null,e="N/A",f=null,h=c?c.level:null,i=c?.valid_to??null;a.mandatory?(u+=1,c?(d=i)&&d<g?(e="RISK",f="Utgången giltighet",v+=1,w+=1):h<a.required_level?(h>=a.required_level-1?(e="GAP",f="En nivå under krav"):(e="RISK",f="För låg nivå"),v+=1):e="OK":(e="RISK",f="Saknar kompetens",v+=1)):e=c?"OK":"N/A",t.push({competenceId:b.id,competenceName:b.name,competenceCode:b.code??null,groupName:b.groupName,requiredLevel:a.required_level,mandatory:a.mandatory,employeeLevel:h,validTo:i,status:e,riskReason:f,isSafetyCritical:b.is_safety_critical}),x.add(b.id)}for(let a of p){if(x.has(a.competence_id))continue;let b=s.get(a.competence_id);b&&t.push({competenceId:b.id,competenceName:b.name,competenceCode:b.code??null,groupName:b.groupName,requiredLevel:null,mandatory:!1,employeeLevel:a.level,validTo:a.valid_to,status:(e=a.valid_to)&&e<g?"RISK":"N/A",riskReason:(f=a.valid_to)&&f<g?"Utgången giltighet":null,isSafetyCritical:b.is_safety_critical})}let y=0===u?100:Math.round((u-v)/u*100),z="LOW";return z=0===v?"LOW":v<=2?"MEDIUM":"HIGH",t.sort((a,b)=>{let c=a.groupName??"",d=b.groupName??"";return c!==d?c.localeCompare(d):a.competenceName.localeCompare(b.competenceName)}),{employee:{id:h.id,name:j,positionName:k},summary:{riskLevel:z,gapCount:v,totalRequired:u,coveragePercent:y,expiredCount:w},items:t}}async function f(a){let c=[],f=await b.supabase.from("positions").select("id, name, site, department, min_headcount").gt("min_headcount",0);if(f.error){if("42703"===f.error.code||f.error.message?.includes("min_headcount"))return console.warn("min_headcount column not found, returning empty positions list"),[];throw f.error}c=(f.data??[]).map(a=>({id:a.id,name:a.name,site:a.site??null,department:a.department??null,minHeadcount:a.min_headcount}));let g=[];for(let b of c){let c=await d(b.id);if(0===c.length){g.push({positionId:b.id,positionName:b.name,site:b.site,department:b.department,minHeadcount:b.minHeadcount,availableCount:0,gap:b.minHeadcount,riskLevel:"HIGH"});continue}let f=0;for(let b of c)0===(await e(b.id,a)).summary.gapCount&&(f+=1);let h=Math.max(0,b.minHeadcount-f),i="LOW";i=h>0&&0===f?"HIGH":h>0?"MEDIUM":"LOW",g.push({positionId:b.id,positionName:b.name,site:b.site,department:b.department,minHeadcount:b.minHeadcount,availableCount:f,gap:h,riskLevel:i})}let h={HIGH:0,MEDIUM:1,LOW:2};return g.sort((a,b)=>{let c=h[a.riskLevel]-h[b.riskLevel];return 0!==c?c:a.positionName.localeCompare(b.positionName)}),g}a.s(["getAllPositions",()=>c,"getEmployeeCompetenceProfile",()=>e,"getEmployeesForPosition",()=>d,"getPositionCoverageForDate",()=>f])},25451,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(63615),f=a.i(35227);function g({params:a}){let{loading:c}=(0,f.useAuthGuard)();return c?(0,b.jsx)("main",{className:"hr-page",children:(0,b.jsx)("p",{children:"Checking access..."})}):(0,b.jsx)(h,{params:a})}function h({params:a}){let f=a.id,g=(0,d.useRouter)(),[h,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(!0),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(null);return(0,c.useEffect)(()=>{!async function(){try{let a=await (0,e.getEmployeeCompetenceProfile)(f);k(a)}catch(a){console.error(a),o("Kunde inte ladda kompetensprofil.")}finally{m(!1)}}()},[f]),(0,b.jsxs)("main",{className:"hr-page",children:[(0,b.jsx)("button",{className:"hr-link",onClick:()=>g.back(),children:"← Tillbaka"}),l&&(0,b.jsx)("p",{children:"Laddar kompetensprofil…"}),n&&(0,b.jsx)("p",{className:"hr-error",children:n}),!l&&!n&&h&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("header",{className:"hr-emp-header",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"hr-page__title",children:h.employee.name}),(0,b.jsx)("p",{className:"hr-page__subtitle",children:h.employee.positionName?h.employee.positionName:"Ingen position kopplad ännu"})]}),(0,b.jsx)("div",{className:"hr-emp-header__badge",children:(0,b.jsxs)("span",{className:`hr-risk-pill hr-risk-pill--${h.summary.riskLevel.toLowerCase()}`,children:["Risk: ",h.summary.riskLevel]})})]}),(0,b.jsxs)("section",{className:"hr-emp-summary-grid",children:[(0,b.jsx)(i,{label:"Obligatoriska kompetenser",value:h.summary.totalRequired}),(0,b.jsx)(i,{label:"Kompetens-gaps",value:h.summary.gapCount}),(0,b.jsx)(i,{label:"Täckningsgrad",value:`${h.summary.coveragePercent}%`}),(0,b.jsx)(i,{label:"Utgångna kompetenser",value:h.summary.expiredCount})]}),p&&(0,b.jsx)("p",{className:"hr-action-message",children:p}),(0,b.jsxs)("section",{className:"hr-competence-section",children:[(0,b.jsx)("h2",{className:"hr-section__title",children:"Kompetenser"}),(0,b.jsx)("p",{className:"hr-task-section__description",children:"Krav baserat på roll samt faktiska kompetenser per person."}),(0,b.jsx)("div",{className:"hr-competence-table-wrapper",children:(0,b.jsxs)("table",{className:"hr-competence-table",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"Grupp"}),(0,b.jsx)("th",{children:"Kompetens"}),(0,b.jsx)("th",{children:"Krav (nivå)"}),(0,b.jsx)("th",{children:"Har (nivå)"}),(0,b.jsx)("th",{children:"Giltig t.o.m."}),(0,b.jsx)("th",{children:"Status"}),(0,b.jsx)("th",{})]})}),(0,b.jsx)("tbody",{children:h.items.map(a=>(0,b.jsx)(j,{item:a,onTriggerAction:a=>q(a)},a.competenceId))})]})})]})]})]})}function i({label:a,value:c}){return(0,b.jsxs)("div",{className:"hr-emp-summary-card",children:[(0,b.jsx)("div",{className:"hr-emp-summary-label",children:a}),(0,b.jsx)("div",{className:"hr-emp-summary-value",children:c})]})}function j({item:a,onTriggerAction:c}){let d=a=>null==a?"-":a.toString(),e="OK"===a.status?"hr-status-badge--ok":"RISK"===a.status?"hr-status-badge--risk":"hr-status-badge--na",f=a.validTo?new Date(a.validTo).toLocaleDateString():"-",g="RISK"===a.status;return(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{children:a.groupName??"-"}),(0,b.jsx)("td",{children:(0,b.jsxs)("div",{className:"hr-competence-name",children:[a.competenceName,a.isSafetyCritical&&(0,b.jsx)("span",{className:"hr-competence-chip",children:"Safety"})]})}),(0,b.jsx)("td",{children:(0,b.jsx)("span",{className:"hr-level-chip",children:d(a.requiredLevel)})}),(0,b.jsx)("td",{children:(0,b.jsx)("span",{className:"hr-level-chip hr-level-chip--owned",children:d(a.employeeLevel)})}),(0,b.jsx)("td",{children:f}),(0,b.jsxs)("td",{children:[(0,b.jsx)("span",{className:`hr-status-badge ${e}`,children:a.status}),a.riskReason&&(0,b.jsx)("div",{className:"hr-status-reason",children:a.riskReason})]}),(0,b.jsx)("td",{children:g&&(0,b.jsx)("button",{type:"button",className:"hr-button hr-button--secondary hr-button--dense",onClick:function(){c(`\xc5tg\xe4rd beh\xf6vs f\xf6r kompetens "${a.competenceName}". (Koppla till utbildnings-workflow n\xe4r template \xe4r satt.)`)},children:"Åtgärda"})})]})}a.s(["default",()=>g])}];

//# sourceMappingURL=_d5287ee2._.js.map