module.exports=[33441,a=>{"use strict";let b=(0,a.i(70106).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["Check",()=>b],33441)},96221,a=>{"use strict";let b=(0,a.i(70106).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],96221)},33508,a=>{"use strict";let b=(0,a.i(70106).default)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);a.s(["X",()=>b],33508)},41710,a=>{"use strict";let b=(0,a.i(70106).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);a.s(["Clock",()=>b],41710)},92258,a=>{"use strict";let b=(0,a.i(70106).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);a.s(["Mail",()=>b],92258)},65321,17371,92319,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(72221);function f({children:a,requireAdmin:f=!1}){let{currentOrg:g,isLoading:h,memberships:i,isAdmin:j}=(0,e.useOrg)(),k=(0,d.useRouter)();return((0,c.useEffect)(()=>{if(!h){if(!g&&i.length>0||!g&&0===i.length)return void k.replace("/app/org/select");if(f&&!j)return void k.replace("/app")}},[g,h,i,j,f,k]),h)?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)("div",{className:"animate-pulse text-muted-foreground",children:"Loading..."})}):g&&(!f||j)?(0,b.jsx)(b.Fragment,{children:a}):null}a.s(["OrgGuard",()=>f],65321);var g=a.i(70106);let h=(0,g.default)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);a.s(["UserPlus",()=>h],17371);let i=(0,g.default)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);a.s(["UserX",()=>i],92319)},650,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(72221),e=a.i(65321),f=a.i(7291),g=a.i(60246),h=a.i(17371),i=a.i(92319),j=a.i(96221),k=a.i(92258),l=a.i(41710),m=a.i(33441),n=a.i(33508);function o(){let{currentOrg:a,isAdmin:e}=(0,d.useOrg)(),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(!0),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)("user"),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(null),G=(0,c.useCallback)(async()=>{if(a){t(!0),v(null);try{let{data:b,error:c}=await f.supabase.from("memberships").select(`
          user_id,
          role,
          status,
          created_at,
          profile:profiles(email)
        `).eq("org_id",a.id);if(c)console.error("Error fetching members:",c),v("Failed to load members");else{let a=(b||[]).map(a=>({...a,profile:Array.isArray(a.profile)?a.profile[0]:a.profile||void 0}));p(a)}let{data:d,error:e}=await f.supabase.from("invites").select("*").eq("org_id",a.id).is("accepted_at",null).gt("expires_at",new Date().toISOString());e?console.error("Error fetching invites:",e):r(d||[])}catch(a){console.error("Fetch error:",a),v("Failed to load data")}finally{t(!1)}}},[a]);(0,c.useEffect)(()=>{G()},[G]);let H=async b=>{if(b.preventDefault(),a){D(!0),v(null);try{let{data:{session:b}}=await f.supabase.auth.getSession();if(!b?.access_token){v("Not authenticated"),D(!1);return}let c=await fetch("/api/admin/invite",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.access_token}`},body:JSON.stringify({orgId:a.id,email:y,role:A})}),d=await c.json();if(!c.ok){v(d.error||"Failed to send invite"),D(!1);return}z(""),B("user"),x(!1),await G()}catch(a){console.error("Invite error:",a),v("Failed to send invite")}finally{D(!1)}}},I=async(b,c)=>{if(a){F(b),v(null);try{let{data:{session:d}}=await f.supabase.auth.getSession();if(!d?.access_token){v("Not authenticated"),F(null);return}let e=await fetch("/api/admin/membership/role",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d.access_token}`},body:JSON.stringify({orgId:a.id,userId:b,role:c})}),g=await e.json();if(!e.ok){v(g.error||"Failed to update role"),F(null);return}await G()}catch(a){console.error("Role change error:",a),v("Failed to update role")}finally{F(null)}}},J=async b=>{if(a&&confirm("Are you sure you want to disable this user?")){v(null);try{let{data:{session:c}}=await f.supabase.auth.getSession();if(!c?.access_token)return void v("Not authenticated");let d=await fetch("/api/admin/membership/disable",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.access_token}`},body:JSON.stringify({orgId:a.id,userId:b})}),e=await d.json();if(!d.ok)return void v(e.error||"Failed to disable user");await G()}catch(a){console.error("Disable error:",a),v("Failed to disable user")}}},K=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return s?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,b.jsx)(j.Loader2,{className:"w-6 h-6 animate-spin text-muted-foreground"})}):(0,b.jsxs)("div",{className:"p-6 max-w-6xl mx-auto space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold text-foreground","data-testid":"text-page-title",children:"User Management"}),(0,b.jsxs)("p",{className:"text-muted-foreground mt-1",children:["Manage members and invites for ",a?.name]})]}),e&&(0,b.jsxs)("button",{onClick:()=>x(!w),className:"px-4 py-2 rounded-md bg-primary text-primary-foreground flex items-center gap-2 hover-elevate","data-testid":"button-invite-user",children:[(0,b.jsx)(h.UserPlus,{className:"w-4 h-4"}),"Invite User"]})]}),u&&(0,b.jsx)("div",{className:"p-4 rounded-md bg-destructive/10 text-destructive","data-testid":"text-error",children:u}),w&&(0,b.jsx)("div",{className:"p-4 rounded-lg border border-border bg-card",children:(0,b.jsxs)("form",{onSubmit:H,className:"flex flex-wrap gap-4 items-end",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-[200px]",children:[(0,b.jsx)("label",{htmlFor:"invite-email",className:"block text-sm font-medium text-foreground mb-1",children:"Email Address"}),(0,b.jsx)("input",{id:"invite-email",type:"email",value:y,onChange:a=>z(a.target.value),placeholder:"user@example.com",className:"w-full px-3 py-2 rounded-md border border-input bg-background text-foreground",required:!0,"data-testid":"input-invite-email"})]}),(0,b.jsxs)("div",{className:"w-40",children:[(0,b.jsx)("label",{htmlFor:"invite-role",className:"block text-sm font-medium text-foreground mb-1",children:"Role"}),(0,b.jsxs)("select",{id:"invite-role",value:A,onChange:a=>B(a.target.value),className:"w-full px-3 py-2 rounded-md border border-input bg-background text-foreground","data-testid":"select-invite-role",children:[(0,b.jsx)("option",{value:"user",children:"User"}),(0,b.jsx)("option",{value:"manager",children:"Manager"}),(0,b.jsx)("option",{value:"hr",children:"HR"}),(0,b.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{type:"button",onClick:()=>x(!1),className:"px-4 py-2 rounded-md border border-border text-foreground hover-elevate","data-testid":"button-cancel-invite",children:"Cancel"}),(0,b.jsxs)("button",{type:"submit",disabled:C,className:"px-4 py-2 rounded-md bg-primary text-primary-foreground hover-elevate disabled:opacity-50 flex items-center gap-2","data-testid":"button-send-invite",children:[C?(0,b.jsx)(j.Loader2,{className:"w-4 h-4 animate-spin"}):(0,b.jsx)(k.Mail,{className:"w-4 h-4"}),"Send Invite"]})]})]})}),q.length>0&&(0,b.jsxs)("div",{className:"rounded-lg border border-border bg-card",children:[(0,b.jsx)("div",{className:"p-4 border-b border-border",children:(0,b.jsxs)("h2",{className:"font-medium text-foreground flex items-center gap-2",children:[(0,b.jsx)(l.Clock,{className:"w-4 h-4"}),"Pending Invites (",q.length,")"]})}),(0,b.jsx)("div",{className:"divide-y divide-border",children:q.map(a=>(0,b.jsxs)("div",{className:"p-4 flex items-center justify-between","data-testid":`row-invite-${a.id}`,children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-foreground",children:a.email}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Invited as ",a.role," - Expires ",K(a.expires_at)]})]}),(0,b.jsx)("span",{className:"px-2 py-1 rounded text-xs bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200",children:"Pending"})]},a.id))})]}),(0,b.jsxs)("div",{className:"rounded-lg border border-border bg-card",children:[(0,b.jsx)("div",{className:"p-4 border-b border-border",children:(0,b.jsxs)("h2",{className:"font-medium text-foreground flex items-center gap-2",children:[(0,b.jsx)(g.Users,{className:"w-4 h-4"}),"Members (",o.filter(a=>"active"===a.status).length,")"]})}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-border bg-muted/50",children:[(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Email"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Role"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Status"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Joined"}),(0,b.jsx)("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"Actions"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-border",children:o.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-muted/30","data-testid":`row-member-${a.user_id}`,children:[(0,b.jsx)("td",{className:"px-4 py-3 text-foreground",children:a.profile?.email||"Unknown"}),(0,b.jsx)("td",{className:"px-4 py-3",children:e&&E!==a.user_id?(0,b.jsxs)("select",{value:a.role,onChange:b=>I(a.user_id,b.target.value),className:"px-2 py-1 rounded border border-input bg-background text-foreground text-sm","data-testid":`select-role-${a.user_id}`,children:[(0,b.jsx)("option",{value:"user",children:"User"}),(0,b.jsx)("option",{value:"manager",children:"Manager"}),(0,b.jsx)("option",{value:"hr",children:"HR"}),(0,b.jsx)("option",{value:"admin",children:"Admin"})]}):E===a.user_id?(0,b.jsx)(j.Loader2,{className:"w-4 h-4 animate-spin text-muted-foreground"}):(0,b.jsx)("span",{className:"capitalize",children:a.role})}),(0,b.jsx)("td",{className:"px-4 py-3",children:"active"===a.status?(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[(0,b.jsx)(m.Check,{className:"w-3 h-3"}),"Active"]}):(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[(0,b.jsx)(n.X,{className:"w-3 h-3"}),"Disabled"]})}),(0,b.jsx)("td",{className:"px-4 py-3 text-muted-foreground text-sm",children:K(a.created_at)}),(0,b.jsx)("td",{className:"px-4 py-3 text-right",children:e&&"active"===a.status&&(0,b.jsx)("button",{onClick:()=>J(a.user_id),className:"p-2 rounded hover-elevate text-muted-foreground hover:text-destructive",title:"Disable user","data-testid":`button-disable-${a.user_id}`,children:(0,b.jsx)(i.UserX,{className:"w-4 h-4"})})})]},a.user_id))})]})})]})]})}function p(){return(0,b.jsx)(e.OrgGuard,{requireAdmin:!0,children:(0,b.jsx)(o,{})})}a.s(["default",()=>p])}];

//# sourceMappingURL=_8f91b1a0._.js.map