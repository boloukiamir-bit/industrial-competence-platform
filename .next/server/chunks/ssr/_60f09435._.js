module.exports=[96221,a=>{"use strict";let b=(0,a.i(70106).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],96221)},46842,a=>{"use strict";let b=(0,a.i(70106).default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);a.s(["User",()=>b],46842)},65321,17371,92319,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(72221);function f({children:a,requireAdmin:f=!1}){let{currentOrg:g,isLoading:h,memberships:i,isAdmin:j}=(0,e.useOrg)(),k=(0,d.useRouter)();return((0,c.useEffect)(()=>{if(!h){if(!g&&i.length>0||!g&&0===i.length)return void k.replace("/app/org/select");if(f&&!j)return void k.replace("/app")}},[g,h,i,j,f,k]),h)?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)("div",{className:"animate-pulse text-muted-foreground",children:"Loading..."})}):g&&(!f||j)?(0,b.jsx)(b.Fragment,{children:a}):null}a.s(["OrgGuard",()=>f],65321);var g=a.i(70106);let h=(0,g.default)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);a.s(["UserPlus",()=>h],17371);let i=(0,g.default)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);a.s(["UserX",()=>i],92319)},59324,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(72221),e=a.i(65321),f=a.i(7291),g=a.i(70106);let h=(0,g.default)("ScrollText",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]);var i=a.i(96221);let j=(0,g.default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var k=a.i(46842),l=a.i(67900),m=a.i(17371),n=a.i(3314),o=a.i(92319);let p={"org.created":l.Building2,"user.invited":m.UserPlus,"membership.role_updated":n.Shield,"membership.disabled":o.UserX},q={"org.created":"Organization Created","user.invited":"User Invited","membership.role_updated":"Role Changed","membership.disabled":"User Disabled"};function r(){let{currentOrg:a}=(0,d.useOrg)(),[e,g]=(0,c.useState)([]),[l,m]=(0,c.useState)(!0),[n,o]=(0,c.useState)(null),[r,s]=(0,c.useState)(""),t=(0,c.useCallback)(async()=>{if(a){m(!0),o(null);try{let b=f.supabase.from("audit_logs").select(`
          id,
          actor_user_id,
          action,
          target_type,
          target_id,
          metadata,
          created_at,
          actor_profile:profiles!audit_logs_actor_user_id_fkey(email)
        `).eq("org_id",a.id).order("created_at",{ascending:!1}).limit(100);r&&(b=b.eq("action",r));let{data:c,error:d}=await b;if(d)console.error("Error fetching audit logs:",d),o("Failed to load audit logs");else{let a=(c||[]).map(a=>({...a,actor_profile:Array.isArray(a.actor_profile)?a.actor_profile[0]:a.actor_profile||void 0}));g(a)}}catch(a){console.error("Fetch error:",a),o("Failed to load audit logs")}finally{m(!1)}}},[a,r]);(0,c.useEffect)(()=>{t()},[t]);let u=[...new Set(e.map(a=>a.action))];return(0,b.jsxs)("div",{className:"p-6 max-w-6xl mx-auto space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold text-foreground","data-testid":"text-page-title",children:"Audit Log"}),(0,b.jsxs)("p",{className:"text-muted-foreground mt-1",children:["Activity history for ",a?.name]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j,{className:"w-4 h-4 text-muted-foreground"}),(0,b.jsxs)("select",{value:r,onChange:a=>s(a.target.value),className:"px-3 py-2 rounded-md border border-input bg-background text-foreground text-sm","data-testid":"select-action-filter",children:[(0,b.jsx)("option",{value:"",children:"All Actions"}),u.map(a=>(0,b.jsx)("option",{value:a,children:q[a]||a},a))]})]})]}),n&&(0,b.jsx)("div",{className:"p-4 rounded-md bg-destructive/10 text-destructive","data-testid":"text-error",children:n}),l?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,b.jsx)(i.Loader2,{className:"w-6 h-6 animate-spin text-muted-foreground"})}):0===e.length?(0,b.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,b.jsx)(h,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,b.jsx)("p",{children:"No audit logs found"})]}):(0,b.jsx)("div",{className:"space-y-2",children:e.map(a=>{let c,d=p[a.action]||h;return(0,b.jsxs)("div",{className:"p-4 rounded-lg border border-border bg-card flex items-start gap-4","data-testid":`row-audit-${a.id}`,children:[(0,b.jsx)("div",{className:"p-2 rounded-md bg-muted",children:(0,b.jsx)(d,{className:"w-4 h-4 text-muted-foreground"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsx)("span",{className:"font-medium text-foreground",children:q[a.action]||a.action}),a.target_type&&(0,b.jsxs)("span",{className:"text-muted-foreground text-sm",children:["on ",a.target_type]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-sm text-muted-foreground",children:[(0,b.jsx)(k.User,{className:"w-3 h-3"}),(0,b.jsx)("span",{children:a.actor_profile?.email||"System"}),(0,b.jsxs)("span",{children:["at ",new Date(a.created_at).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),Object.keys(a.metadata).length>0&&(0,b.jsx)("div",{className:"mt-2",children:0===(c=Object.entries(a.metadata)).length?null:c.map(([a,c])=>(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-muted text-muted-foreground text-xs mr-1",children:[a,": ",String(c)]},a))})]})]},a.id)})})]})}function s(){return(0,b.jsx)(e.OrgGuard,{requireAdmin:!0,children:(0,b.jsx)(r,{})})}a.s(["default",()=>s],59324)}];

//# sourceMappingURL=_60f09435._.js.map