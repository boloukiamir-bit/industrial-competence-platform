module.exports=[36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},88347,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d,e={ACTION_HMR_REFRESH:function(){return k},ACTION_NAVIGATE:function(){return h},ACTION_REFRESH:function(){return g},ACTION_RESTORE:function(){return i},ACTION_SERVER_ACTION:function(){return l},ACTION_SERVER_PATCH:function(){return j},PrefetchKind:function(){return m}};for(var f in e)Object.defineProperty(c,f,{enumerable:!0,get:e[f]});let g="refresh",h="navigate",i="restore",j="server-patch",k="hmr-refresh",l="server-action";var m=((d={}).AUTO="auto",d.FULL="full",d.TEMPORARY="temporary",d);("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},67009,(a,b,c)=>{"use strict";function d(a){return null!==a&&"object"==typeof a&&"then"in a&&"function"==typeof a.then}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"isThenable",{enumerable:!0,get:function(){return d}})},90841,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={dispatchAppRouterAction:function(){return i},useActionQueue:function(){return j}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(46058)._(a.r(72131)),g=a.r(67009),h=null;function i(a){if(null===h)throw Object.defineProperty(Error("Internal Next.js error: Router action dispatched before initialization."),"__NEXT_ERROR_CODE",{value:"E668",enumerable:!1,configurable:!0});h(a)}function j(a){let[b,c]=f.default.useState(a.state);h=b=>a.dispatch(b,c);let d=(0,f.useMemo)(()=>b,[b]);return(0,g.isThenable)(d)?(0,f.use)(d):d}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},20611,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"callServer",{enumerable:!0,get:function(){return g}});let d=a.r(72131),e=a.r(88347),f=a.r(90841);async function g(a,b){return new Promise((c,g)=>{(0,d.startTransition)(()=>{(0,f.dispatchAppRouterAction)({type:e.ACTION_SERVER_ACTION,actionId:a,actionArgs:b,resolve:c,reject:g})})})}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},1722,(a,b,c)=>{"use strict";let d;Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"findSourceMapURL",{enumerable:!0,get:function(){return d}});("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},15618,a=>{"use strict";let b=(0,a.i(70106).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],15618)},33441,a=>{"use strict";let b=(0,a.i(70106).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["Check",()=>b],33441)},33508,a=>{"use strict";let b=(0,a.i(70106).default)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);a.s(["X",()=>b],33508)},70579,a=>{"use strict";var b=a.i(7291);async function c(a,c){let{data:d,error:e}=await b.supabase.auth.signInWithPassword({email:a,password:c});if(e)throw e;return d}async function d(){let{error:a}=await b.supabase.auth.signOut();if(a)throw a}async function e(){let{data:a,error:c}=await b.supabase.auth.getUser();return c?null:a.user}async function f(){let{data:a,error:c}=await b.supabase.auth.getSession();return c?null:a.session}function g(a){return b.supabase.auth.onAuthStateChange(a)}a.s(["getAuthUser",()=>e,"getSession",()=>f,"onAuthStateChange",()=>g,"signInWithEmail",()=>c,"signOut",()=>d])},35227,a=>{"use strict";var b=a.i(72131),c=a.i(50944),d=a.i(70579);function e(){let[a,e]=(0,b.useState)(!0),f=(0,c.useRouter)();return(0,b.useEffect)(()=>{let a=!0;return async function(){try{!await (0,d.getAuthUser)()&&a?f.replace("/login"):a&&e(!1)}catch(b){console.error("Error checking auth",b),a&&f.replace("/login")}}(),()=>{a=!1}},[f]),{loading:a}}a.s(["useAuthGuard",()=>e])},210,a=>{"use strict";let b=(0,a.i(70106).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],210)},81560,a=>{"use strict";let b=(0,a.i(70106).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);a.s(["Trash2",()=>b],81560)},92169,a=>{"use strict";var b=a.i(7291);async function c(){let{data:a,error:c}=await b.supabase.from("competence_groups").select("id, name, description, sort_order").order("sort_order",{ascending:!0}).order("name",{ascending:!0});if(c)throw c;return a??[]}async function d(a){let{error:c}=await b.supabase.from("competence_groups").insert({name:a.name,description:a.description??null});if(c)throw c}async function e(a,c){let{error:d}=await b.supabase.from("competence_groups").update(c).eq("id",a);if(d)throw d}async function f(){let{data:a,error:c}=await b.supabase.from("competences").select("id, group_id, code, name, description, is_safety_critical, active").order("name",{ascending:!0});if(c)throw c;return a??[]}async function g(a){let{error:c}=await b.supabase.from("competences").insert({name:a.name,code:a.code??null,group_id:a.group_id??null,description:a.description??null,is_safety_critical:a.is_safety_critical??!1,active:!0});if(c)throw c}async function h(a,c){let{error:d}=await b.supabase.from("competences").update(c).eq("id",a);if(d)throw d}async function i(){let{data:a,error:c}=await b.supabase.from("positions").select("id, name, description, site, department").order("name",{ascending:!0});if(c)throw c;return(a??[]).map(a=>({...a,min_headcount:null}))}async function j(a){let{data:c,error:d}=await b.supabase.from("positions").select("id, name, description, site, department").eq("id",a).single();if(d){if("PGRST116"===d.code)return null;throw d}return{...c,min_headcount:null}}async function k(a){let{error:c}=await b.supabase.from("positions").insert({name:a.name,description:a.description??null,site:a.site??null,department:a.department??null});if(c)throw c}async function l(a){let{data:c,error:d}=await b.supabase.from("position_competence_requirements").select("id, competence_id, required_level, mandatory, notes").eq("position_id",a).order("required_level",{ascending:!1});if(d)throw d;return c??[]}async function m(a){let{error:c}=await b.supabase.from("position_competence_requirements").insert({position_id:a.position_id,competence_id:a.competence_id,required_level:a.required_level,mandatory:a.mandatory,notes:a.notes??null});if(c)throw c}async function n(a,c){let{error:d}=await b.supabase.from("position_competence_requirements").update(c).eq("id",a);if(d)throw d}async function o(a){let{error:c}=await b.supabase.from("position_competence_requirements").delete().eq("id",a);if(c)throw c}a.s(["createCompetence",()=>g,"createCompetenceGroup",()=>d,"createPosition",()=>k,"createPositionRequirement",()=>m,"deletePositionRequirement",()=>o,"getPositionById",()=>j,"listCompetenceGroups",()=>c,"listCompetences",()=>f,"listPositionRequirements",()=>l,"listPositions",()=>i,"updateCompetence",()=>h,"updateCompetenceGroup",()=>e,"updatePositionRequirement",()=>n])},99464,a=>{"use strict";let b=(0,a.i(70106).default)("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);a.s(["Pencil",()=>b],99464)},81385,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(35227),f=a.i(38246),g=a.i(92169),h=a.i(15618),i=a.i(81560),j=a.i(33508),k=a.i(33441),l=a.i(210),m=a.i(99464);function n(){let a=(0,d.useParams)().id,{loading:n}=(0,e.useAuthGuard)(),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)(!0),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)({competence_id:"",required_level:1,mandatory:!0,notes:""}),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)({required_level:1,mandatory:!0,notes:""});async function I(){try{x(!0);let[b,c,d,e]=await Promise.all([(0,g.getPositionById)(a),(0,g.listPositionRequirements)(a),(0,g.listCompetences)(),(0,g.listCompetenceGroups)()]);if(!b)return void z("Position not found");p(b),v(e),t(d);let f=c.map(a=>{let b=d.find(b=>b.id===a.competence_id),c=b?.group_id?e.find(a=>a.id===b.group_id):null;return{...a,competence_name:b?.name||"Unknown",competence_code:b?.code||null,group_name:c?.name||null}});r(f)}catch(a){z("Failed to load data"),console.error(a)}finally{x(!1)}}async function J(){if(!C.competence_id)return void alert("Please select a competence");try{await (0,g.createPositionRequirement)({position_id:a,competence_id:C.competence_id,required_level:C.required_level,mandatory:C.mandatory,notes:C.notes||void 0}),B(!1),D({competence_id:"",required_level:1,mandatory:!0,notes:""}),I()}catch(a){console.error(a),alert("Failed to add requirement")}}function K(){F(null),H({required_level:1,mandatory:!0,notes:""})}async function L(){if(E)try{await (0,g.updatePositionRequirement)(E,{required_level:G.required_level,mandatory:G.mandatory,notes:G.notes||null}),F(null),I()}catch(a){console.error(a),alert("Failed to update requirement")}}async function M(a){if(confirm("Remove this competence requirement?"))try{await (0,g.deletePositionRequirement)(a),I()}catch(a){console.error(a),alert("Failed to delete requirement")}}if((0,c.useEffect)(()=>{!n&&a&&I()},[n,a]),n)return(0,b.jsx)("main",{className:"hr-page",children:(0,b.jsx)("p",{children:"Checking access…"})});if(w)return(0,b.jsx)("main",{className:"hr-page",children:(0,b.jsx)("p",{className:"hr-page__subtitle",children:"Loading..."})});if(y||!o)return(0,b.jsxs)("main",{className:"hr-page",children:[(0,b.jsx)("p",{className:"hr-error",children:y||"Position not found"}),(0,b.jsx)(f.default,{href:"/admin/positions",className:"hr-button hr-button--secondary",style:{marginTop:16},children:"Back to Positions"})]});let N=new Set(q.map(a=>a.competence_id)),O=s.filter(a=>a.active&&!N.has(a.id)),P=u.map(a=>({group:a,competences:O.filter(b=>b.group_id===a.id)})).filter(a=>a.competences.length>0),Q=O.filter(a=>!a.group_id);return(0,b.jsxs)("main",{className:"hr-page",children:[(0,b.jsx)("div",{className:"hr-page__header",children:(0,b.jsxs)("div",{children:[(0,b.jsxs)(f.default,{href:"/admin/positions",className:"hr-link",style:{display:"flex",alignItems:"center",gap:4,marginBottom:8},"data-testid":"link-back",children:[(0,b.jsx)(l.ArrowLeft,{size:16})," Back to positions"]}),(0,b.jsxs)("h1",{className:"hr-page__title",children:[o.name," – Requirements"]}),(0,b.jsxs)("p",{className:"hr-page__subtitle",children:[o.site||"No site",o.department&&` / ${o.department}`]})]})}),(0,b.jsxs)("nav",{className:"hr-breadcrumb",style:{marginBottom:16},children:[(0,b.jsx)(f.default,{href:"/app/hr/tasks",className:"hr-breadcrumb__link",children:"Dashboard"}),(0,b.jsx)("span",{className:"hr-breadcrumb__separator",children:"/"}),(0,b.jsx)(f.default,{href:"/admin/positions",className:"hr-breadcrumb__link",children:"Positions"}),(0,b.jsx)("span",{className:"hr-breadcrumb__separator",children:"/"}),(0,b.jsxs)("span",{children:[o.name," Requirements"]})]}),(0,b.jsxs)("div",{className:"hr-card",children:[(0,b.jsxs)("div",{className:"hr-section__title",style:{padding:"12px 16px",borderBottom:"1px solid var(--hr-border)",display:"flex",alignItems:"center",justifyContent:"space-between",gap:16},children:[(0,b.jsx)("span",{children:"Competence Requirements"}),!A&&(0,b.jsxs)("button",{className:"hr-button hr-button--primary hr-button--sm",onClick:()=>B(!0),disabled:0===O.length,"data-testid":"button-add-requirement",children:[(0,b.jsx)(h.Plus,{size:14})," Add Requirement"]})]}),(0,b.jsxs)("div",{style:{padding:16},children:[A&&(0,b.jsxs)("div",{style:{marginBottom:16,padding:16,background:"var(--hr-bg-secondary)",borderRadius:8},children:[(0,b.jsx)("h4",{className:"hr-section__title",style:{marginBottom:12},children:"Add Requirement"}),(0,b.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,b.jsxs)("div",{className:"hr-form-field",children:[(0,b.jsx)("label",{className:"hr-form-label",children:"Competence *"}),(0,b.jsxs)("select",{className:"hr-select",value:C.competence_id,onChange:a=>D({...C,competence_id:a.target.value}),"data-testid":"select-competence",children:[(0,b.jsx)("option",{value:"",children:"Select a competence..."}),P.map(a=>(0,b.jsx)("optgroup",{label:a.group.name,children:a.competences.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.code?`[${a.code}] `:"",a.name]},a.id))},a.group.id)),Q.length>0&&(0,b.jsx)("optgroup",{label:"Ungrouped",children:Q.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.code?`[${a.code}] `:"",a.name]},a.id))})]})]}),(0,b.jsxs)("div",{className:"hr-form-field",children:[(0,b.jsx)("label",{className:"hr-form-label",children:"Required Level (0-3)"}),(0,b.jsx)("select",{className:"hr-select",value:C.required_level,onChange:a=>D({...C,required_level:parseInt(a.target.value)}),"data-testid":"select-level",children:[0,1,2,3].map(a=>(0,b.jsxs)("option",{value:a,children:["Level ",a]},a))})]}),(0,b.jsxs)("div",{className:"hr-form-field hr-form-field--inline",children:[(0,b.jsx)("input",{type:"checkbox",id:"add-mandatory",checked:C.mandatory,onChange:a=>D({...C,mandatory:a.target.checked}),"data-testid":"checkbox-mandatory"}),(0,b.jsx)("label",{htmlFor:"add-mandatory",className:"hr-form-label",children:"Mandatory"})]}),(0,b.jsxs)("div",{className:"hr-form-field",children:[(0,b.jsx)("label",{className:"hr-form-label",children:"Notes"}),(0,b.jsx)("input",{type:"text",className:"hr-input",value:C.notes,onChange:a=>D({...C,notes:a.target.value}),placeholder:"Optional notes","data-testid":"input-notes"})]})]}),(0,b.jsxs)("div",{style:{display:"flex",gap:8,marginTop:12},children:[(0,b.jsxs)("button",{className:"hr-button hr-button--primary hr-button--sm",onClick:J,"data-testid":"button-save-requirement",children:[(0,b.jsx)(k.Check,{size:14})," Add Requirement"]}),(0,b.jsxs)("button",{className:"hr-button hr-button--ghost hr-button--sm",onClick:()=>{B(!1),D({competence_id:"",required_level:1,mandatory:!0,notes:""})},children:[(0,b.jsx)(j.X,{size:14})," Cancel"]})]})]}),0===q.length?(0,b.jsx)("p",{className:"hr-muted",style:{textAlign:"center",padding:24},children:"No competence requirements defined for this position."}):(0,b.jsxs)("table",{className:"hr-table",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"Competence"}),(0,b.jsx)("th",{style:{width:130},children:"Required Level"}),(0,b.jsx)("th",{style:{width:100},children:"Mandatory"}),(0,b.jsx)("th",{children:"Notes"}),(0,b.jsx)("th",{style:{width:100},children:"Actions"})]})}),(0,b.jsx)("tbody",{children:q.map(a=>(0,b.jsx)("tr",{"data-testid":`requirement-row-${a.id}`,children:E===a.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("td",{children:[(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.competence_code&&(0,b.jsx)("span",{className:"hr-code",children:a.competence_code}),a.competence_name]}),a.group_name&&(0,b.jsx)("div",{className:"hr-muted",style:{fontSize:12},children:a.group_name})]}),(0,b.jsx)("td",{children:(0,b.jsx)("select",{className:"hr-select hr-select--sm",value:G.required_level,onChange:a=>H({...G,required_level:parseInt(a.target.value)}),"data-testid":`select-edit-level-${a.id}`,children:[0,1,2,3].map(a=>(0,b.jsxs)("option",{value:a,children:["Level ",a]},a))})}),(0,b.jsx)("td",{children:(0,b.jsx)("input",{type:"checkbox",checked:G.mandatory,onChange:a=>H({...G,mandatory:a.target.checked}),"data-testid":`checkbox-edit-mandatory-${a.id}`})}),(0,b.jsx)("td",{children:(0,b.jsx)("input",{type:"text",className:"hr-input hr-input--sm",value:G.notes,onChange:a=>H({...G,notes:a.target.value}),placeholder:"Notes","data-testid":`input-edit-notes-${a.id}`})}),(0,b.jsx)("td",{children:(0,b.jsxs)("div",{style:{display:"flex",gap:4},children:[(0,b.jsx)("button",{className:"hr-button hr-button--primary hr-button--sm",onClick:L,"data-testid":`button-save-${a.id}`,children:(0,b.jsx)(k.Check,{size:14})}),(0,b.jsx)("button",{className:"hr-button hr-button--ghost hr-button--sm",onClick:K,children:(0,b.jsx)(j.X,{size:14})})]})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("td",{children:[(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.competence_code&&(0,b.jsx)("span",{className:"hr-code",children:a.competence_code}),a.competence_name]}),a.group_name&&(0,b.jsx)("div",{className:"hr-muted",style:{fontSize:12},children:a.group_name})]}),(0,b.jsxs)("td",{children:["Level ",a.required_level]}),(0,b.jsx)("td",{children:a.mandatory?"Yes":"No"}),(0,b.jsx)("td",{className:"hr-muted",children:a.notes||"-"}),(0,b.jsx)("td",{children:(0,b.jsxs)("div",{style:{display:"flex",gap:4},children:[(0,b.jsx)("button",{className:"hr-button hr-button--ghost hr-button--sm",onClick:()=>{F(a.id),H({required_level:a.required_level,mandatory:a.mandatory,notes:a.notes||""})},"data-testid":`button-edit-${a.id}`,title:"Edit",children:(0,b.jsx)(m.Pencil,{size:14})}),(0,b.jsx)("button",{className:"hr-button hr-button--ghost hr-button--sm",onClick:()=>M(a.id),"data-testid":`button-delete-${a.id}`,title:"Delete",children:(0,b.jsx)(i.Trash2,{size:14})})]})})]})},a.id))})]})]})]})]})}a.s(["default",()=>n])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__513e6041._.js.map