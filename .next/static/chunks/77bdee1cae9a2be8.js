(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78894,e=>{"use strict";let a=(0,e.i(75254).default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>a],78894)},31278,e=>{"use strict";let a=(0,e.i(75254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>a],31278)},91918,20783,e=>{"use strict";var a=e.i(71645);function t(e,a){if("function"==typeof e)return e(a);null!=e&&(e.current=a)}function r(...e){return a=>{let r=!1,i=e.map(e=>{let i=t(e,a);return r||"function"!=typeof i||(r=!0),i});if(r)return()=>{for(let a=0;a<i.length;a++){let r=i[a];"function"==typeof r?r():t(e[a],null)}}}}function i(...e){return a.useCallback(r(...e),e)}e.s(["composeRefs",()=>r,"useComposedRefs",()=>i],20783);var s=e.i(43476);function n(e){var t;let i,n=(t=e,(i=a.forwardRef((e,t)=>{let{children:i,...s}=e;if(a.isValidElement(i)){var n;let e,l,o=(n=i,(l=(e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.ref:(l=(e=Object.getOwnPropertyDescriptor(n,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.props.ref:n.props.ref||n.ref),d=function(e,a){let t={...a};for(let r in a){let i=e[r],s=a[r];/^on[A-Z]/.test(r)?i&&s?t[r]=(...e)=>{s(...e),i(...e)}:i&&(t[r]=i):"style"===r?t[r]={...i,...s}:"className"===r&&(t[r]=[i,s].filter(Boolean).join(" "))}return{...e,...t}}(s,i.props);return i.type!==a.Fragment&&(d.ref=t?r(t,o):o),a.cloneElement(i,d)}return a.Children.count(i)>1?a.Children.only(null):null})).displayName=`${t}.SlotClone`,i),l=a.forwardRef((e,t)=>{let{children:r,...i}=e,l=a.Children.toArray(r),o=l.find(c);if(o){let e=o.props.children,r=l.map(t=>t!==o?t:a.Children.count(e)>1?a.Children.only(null):a.isValidElement(e)?e.props.children:null);return(0,s.jsx)(n,{...i,ref:t,children:a.isValidElement(e)?a.cloneElement(e,void 0,r):null})}return(0,s.jsx)(n,{...i,ref:t,children:r})});return l.displayName=`${e}.Slot`,l}var l=n("Slot"),o=Symbol("radix.slottable");function d(e){let a=({children:e})=>(0,s.jsx)(s.Fragment,{children:e});return a.displayName=`${e}.Slottable`,a.__radixId=o,a}function c(e){return a.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===o}e.s(["Slot",()=>l,"createSlot",()=>n,"createSlottable",()=>d],91918)},30030,e=>{"use strict";var a=e.i(71645),t=e.i(43476);function r(e,r){let i=a.createContext(r),s=e=>{let{children:r,...s}=e,n=a.useMemo(()=>s,Object.values(s));return(0,t.jsx)(i.Provider,{value:n,children:r})};return s.displayName=e+"Provider",[s,function(t){let s=a.useContext(i);if(s)return s;if(void 0!==r)return r;throw Error(`\`${t}\` must be used within \`${e}\``)}]}function i(e,r=[]){let s=[],n=()=>{let t=s.map(e=>a.createContext(e));return function(r){let i=r?.[e]||t;return a.useMemo(()=>({[`__scope${e}`]:{...r,[e]:i}}),[r,i])}};return n.scopeName=e,[function(r,i){let n=a.createContext(i),l=s.length;s=[...s,i];let o=r=>{let{scope:i,children:s,...o}=r,d=i?.[e]?.[l]||n,c=a.useMemo(()=>o,Object.values(o));return(0,t.jsx)(d.Provider,{value:c,children:s})};return o.displayName=r+"Provider",[o,function(t,s){let o=s?.[e]?.[l]||n,d=a.useContext(o);if(d)return d;if(void 0!==i)return i;throw Error(`\`${t}\` must be used within \`${r}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let r=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let i=r.reduce((a,{useScope:t,scopeName:r})=>{let i=t(e)[`__scope${r}`];return{...a,...i}},{});return a.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return r.scopeName=t.scopeName,r}(n,...r)]}e.s(["createContext",()=>r,"createContextScope",()=>i])},48425,e=>{"use strict";var a=e.i(71645),t=e.i(74080),r=e.i(91918),i=e.i(43476),s=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((e,t)=>{let s=(0,r.createSlot)(`Primitive.${t}`),n=a.forwardRef((e,a)=>{let{asChild:r,...n}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,i.jsx)(r?s:t,{...n,ref:a})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function n(e,a){e&&t.flushSync(()=>e.dispatchEvent(a))}e.s(["Primitive",()=>s,"dispatchDiscreteCustomEvent",()=>n])},66685,e=>{"use strict";var a=e.i(71645),t=e.i(18566),r=e.i(65615);function i(){let[e,i]=(0,a.useState)(!0),s=(0,t.useRouter)();return(0,a.useEffect)(()=>{let e=!0;return async function(){try{!await (0,r.getAuthUser)()&&e?s.replace("/login"):e&&i(!1)}catch(a){console.error("Error checking auth",a),e&&s.replace("/login")}}(),()=>{e=!1}},[s]),{loading:e}}e.s(["useAuthGuard",()=>i])},87336,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(30030),i=e.i(48425),s="Progress",[n,l]=(0,r.createContextScope)(s),[o,d]=n(s),c=t.forwardRef((e,t)=>{var r,s;let{__scopeProgress:n,value:l=null,max:d,getValueLabel:c=p,...m}=e;(d||0===d)&&!g(d)&&console.error((r=`${d}`,`Invalid prop \`max\` of value \`${r}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let u=g(d)?d:100;null===l||v(l,u)||console.error((s=`${l}`,`Invalid prop \`value\` of value \`${s}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let x=v(l,u)?l:null,_=f(x)?c(x,u):void 0;return(0,a.jsx)(o,{scope:n,value:x,max:u,children:(0,a.jsx)(i.Primitive.div,{"aria-valuemax":u,"aria-valuemin":0,"aria-valuenow":f(x)?x:void 0,"aria-valuetext":_,role:"progressbar","data-state":h(x,u),"data-value":x??void 0,"data-max":u,...m,ref:t})})});c.displayName=s;var m="ProgressIndicator",u=t.forwardRef((e,t)=>{let{__scopeProgress:r,...s}=e,n=d(m,r);return(0,a.jsx)(i.Primitive.div,{"data-state":h(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...s,ref:t})});function p(e,a){return`${Math.round(e/a*100)}%`}function h(e,a){return null==e?"indeterminate":e===a?"complete":"loading"}function f(e){return"number"==typeof e}function g(e){return f(e)&&!isNaN(e)&&e>0}function v(e,a){return f(e)&&!isNaN(e)&&e<=a&&e>=0}u.displayName=m;var x=e.i(47163);let _=t.forwardRef(({className:e,value:t,...r},i)=>(0,a.jsx)(c,{ref:i,className:(0,x.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...r,children:(0,a.jsx)(u,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));_.displayName=c.displayName,e.s(["Progress",()=>_],87336)},85773,e=>{"use strict";var a=e.i(53210);async function t(){let{data:e,error:t}=await a.supabase.from("positions").select("id, name, site, department").order("name",{ascending:!0});if(t)throw t;return e??[]}async function r(e){let{data:t,error:r}=await a.supabase.from("employees").select("id, name").eq("position_id",e);if(r)throw r;return(t??[]).map(e=>({id:e.id,name:e.name??"Employee"}))}async function i(e,t){var r,i,s;let n=t??new Date().toISOString().slice(0,10),{data:l,error:o}=await a.supabase.from("employees").select("id, name, position_id").eq("id",e).single();if(o||!l)throw console.error(o),o??Error("Employee not found");let d=l.name??"Employee",c=null,m=l.position_id??null;if(m){let{data:e}=await a.supabase.from("positions").select("id, name").eq("id",m).limit(1),t=e?.[0];t&&(c=t.name)}let u=[];if(m){let{data:e,error:t}=await a.supabase.from("position_competence_requirements").select("id, position_id, competence_id, required_level, mandatory").eq("position_id",m);if(t)throw console.error(t),t;u=e??[]}let{data:p,error:h}=await a.supabase.from("employee_competences").select("id, employee_id, competence_id, level, valid_from, valid_to").eq("employee_id",e);if(h)throw console.error(h),h;let f=p??[],g=new Map;for(let e of f)g.set(e.competence_id,e);let v=new Set;u.forEach(e=>v.add(e.competence_id)),f.forEach(e=>v.add(e.competence_id));let x=new Map;if(v.size>0){let{data:e,error:t}=await a.supabase.from("competences").select("id, name, description, code, group_id, is_safety_critical").in("id",Array.from(v));if(t)throw console.error(t),t;let r=e??[],i=new Set;r.forEach(e=>{e.group_id&&i.add(e.group_id)});let s=new Map;if(i.size>0){let{data:e,error:t}=await a.supabase.from("competence_groups").select("id, name").in("id",Array.from(i));t?console.error(t):(e??[]).forEach(e=>{s.set(e.id,e.name)})}r.forEach(e=>{x.set(e.id,{...e,groupName:e.group_id?s.get(e.group_id)??null:null})})}let _=[],N=0,j=0,y=0,w=new Set;for(let e of u){let a=x.get(e.competence_id);if(!a)continue;let t=g.get(e.competence_id)??null,i="N/A",s=null,l=t?t.level:null,o=t?.valid_to??null;e.mandatory?(N+=1,t?(r=o)&&r<n?(i="RISK",s="Utgången giltighet",j+=1,y+=1):l<e.required_level?(l>=e.required_level-1?(i="GAP",s="En nivå under krav"):(i="RISK",s="För låg nivå"),j+=1):i="OK":(i="RISK",s="Saknar kompetens",j+=1)):i=t?"OK":"N/A",_.push({competenceId:a.id,competenceName:a.name,competenceCode:a.code??null,groupName:a.groupName,requiredLevel:e.required_level,mandatory:e.mandatory,employeeLevel:l,validTo:o,status:i,riskReason:s,isSafetyCritical:a.is_safety_critical}),w.add(a.id)}for(let e of f){if(w.has(e.competence_id))continue;let a=x.get(e.competence_id);a&&_.push({competenceId:a.id,competenceName:a.name,competenceCode:a.code??null,groupName:a.groupName,requiredLevel:null,mandatory:!1,employeeLevel:e.level,validTo:e.valid_to,status:(i=e.valid_to)&&i<n?"RISK":"N/A",riskReason:(s=e.valid_to)&&s<n?"Utgången giltighet":null,isSafetyCritical:a.is_safety_critical})}let b=0===N?100:Math.round((N-j)/N*100),k="LOW";return k=0===j?"LOW":j<=2?"MEDIUM":"HIGH",_.sort((e,a)=>{let t=e.groupName??"",r=a.groupName??"";return t!==r?t.localeCompare(r):e.competenceName.localeCompare(a.competenceName)}),{employee:{id:l.id,name:d,positionName:c},summary:{riskLevel:k,gapCount:j,totalRequired:N,coveragePercent:b,expiredCount:y},items:_}}async function s(e){let t=[],s=await a.supabase.from("positions").select("id, name, site, department, min_headcount").gt("min_headcount",0);if(s.error){if("42703"===s.error.code||s.error.message?.includes("min_headcount"))return console.warn("min_headcount column not found, returning empty positions list"),[];throw s.error}t=(s.data??[]).map(e=>({id:e.id,name:e.name,site:e.site??null,department:e.department??null,minHeadcount:e.min_headcount}));let n=[];for(let a of t){let t=await r(a.id);if(0===t.length){n.push({positionId:a.id,positionName:a.name,site:a.site,department:a.department,minHeadcount:a.minHeadcount,availableCount:0,gap:a.minHeadcount,riskLevel:"HIGH"});continue}let s=0;for(let a of t)0===(await i(a.id,e)).summary.gapCount&&(s+=1);let l=Math.max(0,a.minHeadcount-s),o="LOW";o=l>0&&0===s?"HIGH":l>0?"MEDIUM":"LOW",n.push({positionId:a.id,positionName:a.name,site:a.site,department:a.department,minHeadcount:a.minHeadcount,availableCount:s,gap:l,riskLevel:o})}let l={HIGH:0,MEDIUM:1,LOW:2};return n.sort((e,a)=>{let t=l[e.riskLevel]-l[a.riskLevel];return 0!==t?t:e.positionName.localeCompare(a.positionName)}),n}e.s(["getAllPositions",()=>t,"getEmployeeCompetenceProfile",()=>i,"getEmployeesForPosition",()=>r,"getPositionCoverageForDate",()=>s])},45589,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(85773),i=e.i(31278),s=e.i(78894),n=e.i(87336),l=e.i(22016),o=e.i(66685);function d({risk:e}){return(0,a.jsx)("span",{className:{HIGH:"hr-risk-pill hr-risk-pill--high",MEDIUM:"hr-risk-pill hr-risk-pill--medium",LOW:"hr-risk-pill hr-risk-pill--low"}[e]||"hr-risk-pill","data-testid":`risk-badge-${e.toLowerCase()}`,children:e})}function c({position:e}){let t=e.minHeadcount>0?Math.round(e.availableCount/e.minHeadcount*100):100;return(0,a.jsxs)("div",{className:"hr-card","data-testid":`card-position-${e.positionId}`,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 flex-wrap mb-3",children:[(0,a.jsx)("h3",{className:"hr-card__title",children:e.positionName}),(0,a.jsx)(d,{risk:e.riskLevel})]}),(0,a.jsxs)("div",{className:"hr-emp-summary-grid",children:[(0,a.jsxs)("div",{className:"hr-emp-summary-card",children:[(0,a.jsx)("span",{className:"hr-emp-summary-label",children:"Min Required"}),(0,a.jsx)("span",{className:"hr-emp-summary-value",children:e.minHeadcount})]}),(0,a.jsxs)("div",{className:"hr-emp-summary-card",children:[(0,a.jsx)("span",{className:"hr-emp-summary-label",children:"Fully Competent"}),(0,a.jsx)("span",{className:"hr-emp-summary-value",children:e.availableCount})]}),(0,a.jsxs)("div",{className:"hr-emp-summary-card",children:[(0,a.jsx)("span",{className:"hr-emp-summary-label",children:"Gap"}),(0,a.jsx)("span",{className:`hr-emp-summary-value ${e.gap>0?"text-red-600 dark:text-red-400":""}`,children:e.gap})]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-1",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Coverage"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[t,"%"]})]}),(0,a.jsx)(n.Progress,{value:t,className:"h-2"})]}),(e.site||e.department)&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-3 text-sm text-muted-foreground",children:[e.site&&(0,a.jsx)("span",{children:e.site}),e.site&&e.department&&(0,a.jsx)("span",{children:"/"}),e.department&&(0,a.jsx)("span",{children:e.department})]}),(0,a.jsx)("div",{className:"mt-4 pt-3 border-t border-border",children:(0,a.jsx)(l.default,{href:"/competence/matrix",className:"text-sm text-primary hover:underline","data-testid":`link-matrix-${e.positionId}`,children:"View competence matrix"})})]})}function m(){let{loading:e}=(0,o.useAuthGuard)();return e?(0,a.jsx)("main",{className:"hr-page",children:(0,a.jsx)("p",{children:"Checking access..."})}):(0,a.jsx)(u,{})}function u(){let[e,n]=(0,t.useState)([]),[l,o]=(0,t.useState)(""),[d,m]=(0,t.useState)(!0),[u,p]=(0,t.useState)(null);(0,t.useEffect)(()=>{!async function(){let e,a;m(!0),p(null);let t=((a=new Date(e=new Date)).setDate(e.getDate()+1),a.toISOString().slice(0,10));o(t);try{let e=await (0,r.getPositionCoverageForDate)(t);n(e)}catch(e){console.error("Failed to load coverage data:",e),p("Failed to load gap analysis data. Please try again.")}finally{m(!1)}}()},[]);let h=e.length,f=e.filter(e=>"HIGH"===e.riskLevel).length,g=e.filter(e=>"MEDIUM"===e.riskLevel).length,v=e.filter(e=>"LOW"===e.riskLevel).length,x=e.reduce((e,a)=>e+a.gap,0);return d?(0,a.jsxs)("main",{className:"hr-page",children:[(0,a.jsx)("header",{className:"hr-page__header",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"hr-page__title",children:"Tomorrow's Gaps"}),(0,a.jsx)("p",{className:"hr-page__subtitle",children:"Coverage and risk per position based on minimum headcount and competence."})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-3 p-12",children:[(0,a.jsx)(i.Loader2,{className:"h-5 w-5 animate-spin","data-testid":"loading-spinner"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Calculating tomorrow's gaps..."})]})]}):u?(0,a.jsxs)("main",{className:"hr-page",children:[(0,a.jsx)("header",{className:"hr-page__header",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"hr-page__title",children:"Tomorrow's Gaps"}),(0,a.jsx)("p",{className:"hr-page__subtitle",children:"Coverage and risk per position based on minimum headcount and competence."})]})}),(0,a.jsxs)("div",{className:"hr-error","data-testid":"error-message",children:[(0,a.jsx)(s.AlertTriangle,{className:"h-4 w-4 inline-block mr-2"}),u]})]}):0===e.length?(0,a.jsxs)("main",{className:"hr-page",children:[(0,a.jsxs)("header",{className:"hr-page__header",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"hr-page__title",children:"Tomorrow's Gaps"}),(0,a.jsx)("p",{className:"hr-page__subtitle",children:"Coverage and risk per position based on minimum headcount and competence."})]}),(0,a.jsxs)("div",{className:"tg-date-pill","data-testid":"date-pill",children:["Analyzing: ",l]})]}),(0,a.jsxs)("div",{className:"hr-empty","data-testid":"empty-state",children:[(0,a.jsx)("p",{className:"font-medium mb-2",children:"No positions with minimum headcount defined"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Add min_headcount to positions to see Tomorrow's Gaps analysis."})]})]}):(0,a.jsxs)("main",{className:"hr-page",children:[(0,a.jsxs)("header",{className:"hr-page__header",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"hr-page__title",children:"Tomorrow's Gaps"}),(0,a.jsx)("p",{className:"hr-page__subtitle",children:"Coverage and risk per position based on minimum headcount and competence."})]}),(0,a.jsxs)("div",{className:"tg-date-pill","data-testid":"date-pill",children:["Analyzing: ",l]})]}),(0,a.jsxs)("div",{className:"hr-kpi-grid","data-testid":"summary-kpis",children:[(0,a.jsxs)("div",{className:"hr-kpi",children:[(0,a.jsx)("span",{className:"hr-kpi__label",children:"Total Positions"}),(0,a.jsx)("span",{className:"hr-kpi__value",children:h})]}),(0,a.jsxs)("div",{className:"hr-kpi",children:[(0,a.jsx)("span",{className:"hr-kpi__label",children:"High Risk"}),(0,a.jsx)("span",{className:`hr-kpi__value ${f>0?"hr-kpi__value--danger":""}`,children:f})]}),(0,a.jsxs)("div",{className:"hr-kpi",children:[(0,a.jsx)("span",{className:"hr-kpi__label",children:"Medium Risk"}),(0,a.jsx)("span",{className:`hr-kpi__value ${g>0?"hr-kpi__value--warn":""}`,children:g})]}),(0,a.jsxs)("div",{className:"hr-kpi",children:[(0,a.jsx)("span",{className:"hr-kpi__label",children:"Low Risk"}),(0,a.jsx)("span",{className:"hr-kpi__value hr-kpi__value--ok",children:v})]}),(0,a.jsxs)("div",{className:"hr-kpi",children:[(0,a.jsx)("span",{className:"hr-kpi__label",children:"Total Missing Headcount"}),(0,a.jsx)("span",{className:`hr-kpi__value ${x>0?"hr-kpi__value--danger":""}`,children:x})]})]}),(0,a.jsx)("div",{className:"hr-grid mt-6","data-testid":"positions-grid",children:e.map(e=>(0,a.jsx)(c,{position:e},e.positionId))})]})}e.s(["default",()=>m])}]);