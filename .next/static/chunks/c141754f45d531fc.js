(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78894,e=>{"use strict";let t=(0,e.i(75254).default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>t],78894)},69638,e=>{"use strict";let t=(0,e.i(75254).default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],69638)},21686,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(22016),l=e.i(98919),s=e.i(78894),d=e.i(69638),i=e.i(53210);function n(){let[e,n]=(0,a.useState)([]),[c,x]=(0,a.useState)(!0),[o,m]=(0,a.useState)(""),[g,p]=(0,a.useState)(""),[y,u]=(0,a.useState)([]),[h,k]=(0,a.useState)([]);(0,a.useEffect)(()=>{!async function(){let[e,t,a]=await Promise.all([i.supabase.from("employee_skills").select(`
            employee_id,
            skill_id,
            level,
            employees!inner(id, name, line, team, is_active),
            skills!inner(id, name, code, category)
          `).in("skills.category",["safety","certificate"]),i.supabase.from("employees").select("line").eq("is_active",!0),i.supabase.from("skills").select("id, name").in("category",["safety","certificate"])]),r=[...new Set((e.data||[]).map(e=>{let t=e.employees;return t?.id}).filter(Boolean))],l=[];if(r.length>0){let{data:e}=await i.supabase.from("person_events").select("employee_id, category, completed_date, due_date").eq("category","training").in("employee_id",r);l=e||[]}let s=new Map;for(let e of l){let t=e.employee_id;if(s.has(t)){let a=s.get(t);e.completed_date&&(!a.completedDate||e.completed_date>a.completedDate)&&(a.completedDate=e.completed_date),e.due_date&&(!a.dueDate||e.due_date>a.dueDate)&&(a.dueDate=e.due_date)}else s.set(t,{completedDate:e.completed_date,dueDate:e.due_date})}n((e.data||[]).filter(e=>{let t=e.employees;return t?.is_active===!0}).map(e=>{let t=e.employees,a=e.skills,r=t?.id,l=s.get(r);return{employeeId:r,employeeName:t?.name,line:t?.line,team:t?.team,skillId:a?.id,skillName:a?.name,skillCode:a?.code,currentLevel:e.level,latestTrainingDate:l?.completedDate,nextDueDate:l?.dueDate}})),u([...new Set((t.data||[]).map(e=>e.line).filter(Boolean))].sort()),k((a.data||[]).map(e=>({id:e.id,name:e.name}))),x(!1)}()},[]);let f=e.filter(e=>{let t=!o||e.line===o,a=!g||e.skillId===g;return t&&a}),b=["Not trained","In training","Can assist","Trained","Can train others"];return c?(0,t.jsx)("div",{className:"p-6",children:(0,t.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-48"}),(0,t.jsx)("div",{className:"h-64 bg-gray-200 dark:bg-gray-700 rounded"})]})}):(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(l.Shield,{className:"h-6 w-6 text-gray-600 dark:text-gray-400"}),(0,t.jsx)("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Safety & Certificates"})]}),(0,t.jsxs)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[f.length," records"]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3 mb-6",children:[(0,t.jsxs)("select",{value:o,onChange:e=>m(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white","data-testid":"select-line-filter",children:[(0,t.jsx)("option",{value:"",children:"All Lines"}),y.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]}),(0,t.jsxs)("select",{value:g,onChange:e=>p(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white","data-testid":"select-skill-filter",children:[(0,t.jsx)("option",{value:"",children:"All Certificates"}),h.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-700",children:[(0,t.jsx)("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Employee"}),(0,t.jsx)("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Line / Team"}),(0,t.jsx)("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Certificate"}),(0,t.jsx)("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Level"}),(0,t.jsx)("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Last Training"}),(0,t.jsx)("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Next Due"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:0===f.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500 dark:text-gray-400",children:"No certificates found"})}):f.map((e,a)=>{var l;let i=function(e){if(!e)return null;let t=new Date(e),a=new Date,r=Math.ceil((t.getTime()-a.getTime())/864e5);return r<0?{status:"overdue",label:"Overdue",color:"text-red-600 dark:text-red-400"}:r<=30?{status:"soon",label:`Due in ${r}d`,color:"text-yellow-600 dark:text-yellow-400"}:{status:"ok",label:t.toLocaleDateString(),color:"text-gray-500 dark:text-gray-400"}}(e.nextDueDate);return(0,t.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(r.default,{href:`/app/employees/${e.employeeId}`,className:"font-medium text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400",children:e.employeeName})}),(0,t.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-600 dark:text-gray-300",children:[e.line||"-"," / ",e.team||"-"]}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.skillName}),(0,t.jsx)("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:e.skillCode})]})}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)("span",{className:`px-2 py-1 text-xs rounded-full ${(l=e.currentLevel)>=3?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":l>=2?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}`,children:b[e.currentLevel]})}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-600 dark:text-gray-300",children:e.latestTrainingDate?new Date(e.latestTrainingDate).toLocaleDateString():"-"}),(0,t.jsx)("td",{className:"px-4 py-3",children:i?(0,t.jsxs)("div",{className:"flex items-center gap-1",children:["overdue"===i.status&&(0,t.jsx)(s.AlertTriangle,{className:"h-4 w-4 text-red-500"}),"soon"===i.status&&(0,t.jsx)(s.AlertTriangle,{className:"h-4 w-4 text-yellow-500"}),"ok"===i.status&&(0,t.jsx)(d.CheckCircle,{className:"h-4 w-4 text-green-500"}),(0,t.jsx)("span",{className:`text-sm ${i.color}`,children:i.label})]}):(0,t.jsx)("span",{className:"text-sm text-gray-400",children:"-"})})]},`${e.employeeId}-${e.skillId}-${a}`)})})]})})]})}e.s(["default",()=>n])}]);