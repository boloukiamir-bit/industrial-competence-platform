(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78894,e=>{"use strict";let a=(0,e.i(75254).default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>a],78894)},7233,e=>{"use strict";let a=(0,e.i(75254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>a],7233)},94179,e=>{"use strict";var a=e.i(43476),t=e.i(25913),r=e.i(47163);let n=(0,t.cva)("whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 hover-elevate",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow-xs",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground shadow-xs",outline:"border [border-color:var(--badge-outline)] shadow-xs"},size:{default:"",sm:"text-[10px] px-2 py-0"}},defaultVariants:{variant:"default",size:"default"}});function i({className:e,variant:t,size:i,...s}){return(0,a.jsx)("div",{className:(0,r.cn)(n({variant:t,size:i}),e),...s})}e.s(["Badge",()=>i])},70065,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(47163);let n=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("div",{ref:n,className:(0,r.cn)("rounded-xl border bg-card border-card-border text-card-foreground shadow-sm",e),...t}));n.displayName="Card";let i=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("div",{ref:n,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",e),...t}));i.displayName="CardHeader";let s=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("div",{ref:n,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));s.displayName="CardTitle";let d=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("div",{ref:n,className:(0,r.cn)("text-sm text-muted-foreground",e),...t}));d.displayName="CardDescription";let l=t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("div",{ref:n,className:(0,r.cn)("p-6 pt-0",e),...t}));l.displayName="CardContent",t.forwardRef(({className:e,...t},n)=>(0,a.jsx)("div",{ref:n,className:(0,r.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter",e.s(["Card",()=>n,"CardContent",()=>l,"CardDescription",()=>d,"CardHeader",()=>i,"CardTitle",()=>s])},25913,e=>{"use strict";var a=e.i(7670);let t=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,r=a.clsx;e.s(["cva",0,(e,a)=>n=>{var i;if((null==a?void 0:a.variants)==null)return r(e,null==n?void 0:n.class,null==n?void 0:n.className);let{variants:s,defaultVariants:d}=a,l=Object.keys(s).map(e=>{let a=null==n?void 0:n[e],r=null==d?void 0:d[e];if(null===a)return null;let i=t(a)||t(r);return s[e][i]}),o=n&&Object.entries(n).reduce((e,a)=>{let[t,r]=a;return void 0===r||(e[t]=r),e},{});return r(e,l,null==a||null==(i=a.compoundVariants)?void 0:i.reduce((e,a)=>{let{class:t,className:r,...n}=a;return Object.entries(n).every(e=>{let[a,t]=e;return Array.isArray(t)?t.includes({...d,...o}[a]):({...d,...o})[a]===t})?[...e,t,r]:e},[]),null==n?void 0:n.class,null==n?void 0:n.className)}])},91918,20783,e=>{"use strict";var a=e.i(71645);function t(e,a){if("function"==typeof e)return e(a);null!=e&&(e.current=a)}function r(...e){return a=>{let r=!1,n=e.map(e=>{let n=t(e,a);return r||"function"!=typeof n||(r=!0),n});if(r)return()=>{for(let a=0;a<n.length;a++){let r=n[a];"function"==typeof r?r():t(e[a],null)}}}}function n(...e){return a.useCallback(r(...e),e)}e.s(["composeRefs",()=>r,"useComposedRefs",()=>n],20783);var i=e.i(43476);function s(e){var t;let n,s=(t=e,(n=a.forwardRef((e,t)=>{let{children:n,...i}=e;if(a.isValidElement(n)){var s;let e,d,l=(s=n,(d=(e=Object.getOwnPropertyDescriptor(s.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.ref:(d=(e=Object.getOwnPropertyDescriptor(s,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.props.ref:s.props.ref||s.ref),o=function(e,a){let t={...a};for(let r in a){let n=e[r],i=a[r];/^on[A-Z]/.test(r)?n&&i?t[r]=(...e)=>{i(...e),n(...e)}:n&&(t[r]=n):"style"===r?t[r]={...n,...i}:"className"===r&&(t[r]=[n,i].filter(Boolean).join(" "))}return{...e,...t}}(i,n.props);return n.type!==a.Fragment&&(o.ref=t?r(t,l):l),a.cloneElement(n,o)}return a.Children.count(n)>1?a.Children.only(null):null})).displayName=`${t}.SlotClone`,n),d=a.forwardRef((e,t)=>{let{children:r,...n}=e,d=a.Children.toArray(r),l=d.find(c);if(l){let e=l.props.children,r=d.map(t=>t!==l?t:a.Children.count(e)>1?a.Children.only(null):a.isValidElement(e)?e.props.children:null);return(0,i.jsx)(s,{...n,ref:t,children:a.isValidElement(e)?a.cloneElement(e,void 0,r):null})}return(0,i.jsx)(s,{...n,ref:t,children:r})});return d.displayName=`${e}.Slot`,d}var d=s("Slot"),l=Symbol("radix.slottable");function o(e){let a=({children:e})=>(0,i.jsx)(i.Fragment,{children:e});return a.displayName=`${e}.Slottable`,a.__radixId=l,a}function c(e){return a.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===l}e.s(["Slot",()=>d,"createSlot",()=>s,"createSlottable",()=>o],91918)},67881,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(91918),n=e.i(25913),i=e.i(47163);let s=(0,n.cva)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover-elevate active-elevate-2",{variants:{variant:{default:"bg-primary text-primary-foreground border border-primary-border",destructive:"bg-destructive text-destructive-foreground border border-destructive-border",outline:"border [border-color:var(--button-outline)] shadow-xs active:shadow-none",secondary:"border bg-secondary text-secondary-foreground border-secondary-border",ghost:"border border-transparent"},size:{default:"min-h-9 px-4 py-2",sm:"min-h-8 rounded-md px-3 text-xs",lg:"min-h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=t.forwardRef(({className:e,variant:t,size:n,asChild:d=!1,...l},o)=>{let c=d?r.Slot:"button";return(0,a.jsx)(c,{className:(0,i.cn)(s({variant:t,size:n,className:e})),ref:o,...l})});d.displayName="Button",e.s(["Button",()=>d,"buttonVariants",()=>s])},71689,e=>{"use strict";let a=(0,e.i(75254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>a],71689)},84614,e=>{"use strict";let a=(0,e.i(75254).default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>a],84614)},40160,e=>{"use strict";let a=(0,e.i(75254).default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);e.s(["Download",()=>a],40160)},87316,e=>{"use strict";let a=(0,e.i(75254).default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>a],87316)},46897,27979,e=>{"use strict";let a=(0,e.i(75254).default)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>a],46897);var t=e.i(53210),r=e.i(47167);function n(e){return e.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"")}function i(e){return e.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n")}async function s(e){let a,s,d,l,o,c,m,u,p,g,x,h=new Date(Date.now()-864e5).toISOString(),{data:y}=await t.supabase.from("email_outbox").select("id").filter("meta->>meeting_id","eq",String(e.id)).filter("meta->>type","eq","one_to_one_invite").gte("created_at",h).in("status",["pending","sent"]).limit(1);if(y&&y.length>0)return 0;let v=(a=new Date(e.scheduled_at),s=60*(e.duration_minutes||60)*1e3,d=new Date(a.getTime()+s),l=`meeting-${e.id}@industrialcompetence.app`,o=n(new Date),c=n(a),m=n(d),u=r.default.env.NEXT_PUBLIC_APP_URL||"https://industrial-competence.replit.app",p=i(`1:1 meeting – ${e.employee_name} & ${e.manager_name}`),g=i(`1:1 meeting between ${e.employee_name} and ${e.manager_name}.

View details: ${u}/app/one-to-ones/${e.id}`),["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Industrial Competence Platform//EN","CALSCALE:GREGORIAN","METHOD:REQUEST","BEGIN:VEVENT",`UID:${l}`,`DTSTAMP:${o}`,`DTSTART:${c}`,`DTEND:${m}`,`SUMMARY:${p}`,`DESCRIPTION:${g}`,(x=e.location?i(e.location):"")?`LOCATION:${x}`:"",`ORGANIZER;CN=${i(e.manager_name)}:mailto:${e.manager_email}`,`ATTENDEE;ROLE=REQ-PARTICIPANT;PARTSTAT=NEEDS-ACTION;CN=${i(e.manager_name)}:mailto:${e.manager_email}`,`ATTENDEE;ROLE=REQ-PARTICIPANT;PARTSTAT=NEEDS-ACTION;CN=${i(e.employee_name)}:mailto:${e.employee_email}`,"STATUS:CONFIRMED","SEQUENCE:0","END:VEVENT","END:VCALENDAR"].filter(Boolean).join("\r\n")),f=new Date(e.scheduled_at).toLocaleDateString("sv-SE"),_=new Date(e.scheduled_at).toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit"}),j=0,N=`1:1 meeting scheduled – ${f} ${_}`,b=`Hello ${e.employee_name},

A 1:1 meeting has been scheduled with ${e.manager_name}.

Date: ${f}
Time: ${_}
Duration: ${e.duration_minutes||60} minutes
${e.location?`Location: ${e.location}`:""}

Please add this to your calendar using the attached invite.

Best regards,
Industrial Competence Platform`,{error:w}=await t.supabase.from("email_outbox").insert({to_email:e.employee_email,subject:N,body:b,status:"pending",meta:{type:"one_to_one_invite",meeting_id:String(e.id),recipient_role:"employee",ics:v}});!w&&j++;let C=`1:1 meeting scheduled with ${e.employee_name} – ${f} ${_}`,E=`Hello ${e.manager_name},

A 1:1 meeting has been scheduled with ${e.employee_name}.

Date: ${f}
Time: ${_}
Duration: ${e.duration_minutes||60} minutes
${e.location?`Location: ${e.location}`:""}

Please add this to your calendar using the attached invite.

Best regards,
Industrial Competence Platform`,{error:S}=await t.supabase.from("email_outbox").insert({to_email:e.manager_email,subject:C,body:E,status:"pending",meta:{type:"one_to_one_invite",meeting_id:String(e.id),recipient_role:"manager",ics:v}});return!S&&j++,j}async function d(){let{data:e,error:a}=await t.supabase.from("one_to_one_meetings").select("*, employee:employee_id(name), manager:manager_id(name)").order("scheduled_at",{ascending:!1});return a?(console.error("Error fetching all meetings:",a),[]):(e||[]).map(e=>({id:e.id,employeeId:e.employee_id,employeeName:e.employee?.name||void 0,managerId:e.manager_id||void 0,managerName:e.manager?.name||void 0,scheduledAt:e.scheduled_at,durationMinutes:e.duration_minutes||void 0,location:e.location||void 0,status:e.status,templateName:e.template_name||void 0,sharedAgenda:e.shared_agenda||void 0,employeeNotesPrivate:e.employee_notes_private||void 0,managerNotesPrivate:e.manager_notes_private||void 0,createdAt:e.created_at,updatedAt:e.updated_at||void 0}))}async function l(e){let{data:a,error:r}=await t.supabase.from("one_to_one_meetings").select("*, employee:employee_id(name), manager:manager_id(name)").eq("employee_id",e).order("scheduled_at",{ascending:!1});return r?(console.error("Error fetching meetings for employee:",r),[]):(a||[]).map(e=>({id:e.id,employeeId:e.employee_id,employeeName:e.employee?.name||void 0,managerId:e.manager_id||void 0,managerName:e.manager?.name||void 0,scheduledAt:e.scheduled_at,durationMinutes:e.duration_minutes||void 0,location:e.location||void 0,status:e.status,templateName:e.template_name||void 0,sharedAgenda:e.shared_agenda||void 0,employeeNotesPrivate:e.employee_notes_private||void 0,managerNotesPrivate:e.manager_notes_private||void 0,createdAt:e.created_at,updatedAt:e.updated_at||void 0}))}async function o(e){let{data:a,error:r}=await t.supabase.from("one_to_one_meetings").select("*, employee:employee_id(name), manager:manager_id(name)").eq("id",e).single();return r||!a?(console.error("Error fetching meeting:",r),null):{id:a.id,employeeId:a.employee_id,employeeName:a.employee?.name||void 0,managerId:a.manager_id||void 0,managerName:a.manager?.name||void 0,scheduledAt:a.scheduled_at,durationMinutes:a.duration_minutes||void 0,location:a.location||void 0,status:a.status,templateName:a.template_name||void 0,sharedAgenda:a.shared_agenda||void 0,employeeNotesPrivate:a.employee_notes_private||void 0,managerNotesPrivate:a.manager_notes_private||void 0,createdAt:a.created_at,updatedAt:a.updated_at||void 0}}async function c(e){if(!e.employeeId||!e.managerId||!e.scheduledAt)return console.error("Invalid meeting payload: missing required fields"),null;let{data:a,error:r}=await t.supabase.from("one_to_one_meetings").insert({employee_id:e.employeeId,manager_id:e.managerId,scheduled_at:e.scheduledAt,duration_minutes:e.durationMinutes||null,location:e.location||null,template_name:e.templateName||null,shared_agenda:e.sharedAgenda||null,status:"planned"}).select().single();if(r||!a)return console.error("Error creating meeting:",r),null;let{data:n}=await t.supabase.from("employees").select("name, email").eq("id",e.employeeId).single(),{data:i}=await t.supabase.from("employees").select("name, email").eq("id",e.managerId).single();if(n?.email&&i?.email)try{await s({id:a.id,scheduled_at:a.scheduled_at,duration_minutes:a.duration_minutes||void 0,employee_name:n.name||"Employee",manager_name:i.name||"Manager",employee_email:n.email,manager_email:i.email,location:a.location||void 0})}catch(e){console.error("Error sending calendar invites:",e)}return{id:a.id,employeeId:a.employee_id,employeeName:n?.name||void 0,managerId:a.manager_id||void 0,managerName:i?.name||void 0,scheduledAt:a.scheduled_at,durationMinutes:a.duration_minutes||void 0,location:a.location||void 0,status:a.status,templateName:a.template_name||void 0,sharedAgenda:a.shared_agenda||void 0,employeeNotesPrivate:a.employee_notes_private||void 0,managerNotesPrivate:a.manager_notes_private||void 0,createdAt:a.created_at,updatedAt:a.updated_at||void 0}}async function m(e,a){if(!e)return console.error("Invalid updateMeeting: missing meeting id"),!1;if(void 0!==a.status&&!["planned","in_progress","completed","cancelled"].includes(a.status))return console.error("Invalid status value:",a.status),!1;let r={updated_at:new Date().toISOString()};void 0!==a.status&&(r.status=a.status),void 0!==a.sharedAgenda&&(r.shared_agenda=a.sharedAgenda),void 0!==a.employeeNotesPrivate&&(r.employee_notes_private=a.employeeNotesPrivate),void 0!==a.managerNotesPrivate&&(r.manager_notes_private=a.managerNotesPrivate),void 0!==a.scheduledAt&&(r.scheduled_at=a.scheduledAt),void 0!==a.durationMinutes&&(r.duration_minutes=a.durationMinutes),void 0!==a.location&&(r.location=a.location);let{error:n}=await t.supabase.from("one_to_one_meetings").update(r).eq("id",e);return!n||(console.error("Error updating meeting:",n),!1)}async function u(e){let{data:a,error:r}=await t.supabase.from("one_to_one_actions").select("*").eq("meeting_id",e).order("created_at",{ascending:!0});return r?(console.error("Error fetching actions:",r),[]):(a||[]).map(e=>({id:e.id,meetingId:e.meeting_id,description:e.description,ownerType:e.owner_type,isCompleted:e.is_completed,dueDate:e.due_date||void 0,createdAt:e.created_at,completedAt:e.completed_at||void 0}))}async function p(e,a){if(!e||!a.description||!a.description.trim())return console.error("Invalid action payload: missing meetingId or description"),null;let{data:r,error:n}=await t.supabase.from("one_to_one_actions").insert({meeting_id:e,description:a.description.trim(),owner_type:a.ownerType,due_date:a.dueDate||null}).select().single();return n||!r?(console.error("Error adding action:",n),null):{id:r.id,meetingId:r.meeting_id,description:r.description,ownerType:r.owner_type,isCompleted:r.is_completed,dueDate:r.due_date||void 0,createdAt:r.created_at,completedAt:r.completed_at||void 0}}async function g(e){let{error:a}=await t.supabase.from("one_to_one_actions").update({is_completed:!0,completed_at:new Date().toISOString()}).eq("id",e);return!a||(console.error("Error completing action:",a),!1)}e.s(["addAction",()=>p,"completeAction",()=>g,"createMeeting",()=>c,"getActionsForMeeting",()=>u,"getAllMeetings",()=>d,"getMeetingById",()=>o,"getMeetingsForEmployee",()=>l,"updateMeeting",()=>m],27979)},63727,e=>{"use strict";let a=(0,e.i(75254).default)("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);e.s(["Briefcase",()=>a],63727)},86311,e=>{"use strict";let a=(0,e.i(75254).default)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);e.s(["MessageSquare",()=>a],86311)},63488,e=>{"use strict";let a=(0,e.i(75254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>a],63488)},48513,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(18566),n=e.i(22016),i=e.i(84614),s=e.i(63488),d=e.i(75254);let l=(0,d.default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);var o=e.i(46897),c=e.i(87316),m=e.i(63727),u=e.i(71689),p=e.i(78583),g=e.i(88844),x=e.i(78894);let h=(0,d.default)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),y=(0,d.default)("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);var v=e.i(7233),f=e.i(40160),_=e.i(98919),j=e.i(86311),N=e.i(7486),b=e.i(53210),w=e.i(67881),C=e.i(70065),E=e.i(94179);async function S(e,a,t){await b.supabase.from("gdpr_access_logs").insert({employee_id:e,access_type:a,metadata:t||null})}var A=e.i(27979);function k({icon:e,label:t,value:r}){return(0,a.jsxs)("div",{className:"flex items-start gap-3","data-testid":`info-${t.toLowerCase().replace(/\s+/g,"-")}`,children:[(0,a.jsx)(e,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:t}),(0,a.jsx)("p",{className:"font-medium",children:r})]})]})}function D(){let e=(0,r.useParams)(),d=(0,r.useRouter)(),D=e.id,[T,I]=(0,t.useState)({employee:null,skills:[],events:[],documents:[],equipment:[],reviews:[],currentSalary:null,salaryRevisions:[],meetings:[]}),[M,P]=(0,t.useState)(!0),[$,R]=(0,t.useState)("personal");async function B(){let e=await fetch(`/api/gdpr/export-employee-data?employee_id=${D}`),a=new Blob([JSON.stringify(await e.json(),null,2)],{type:"application/json"}),t=URL.createObjectURL(a),r=document.createElement("a");r.href=t,r.download=`employee-data-${T.employee?.employeeNumber||D}.json`,r.click(),URL.revokeObjectURL(t)}if((0,t.useEffect)(()=>{async function e(){let[e,a,t,r,n,i,s,d,l]=await Promise.all([b.supabase.from("employees").select("*, manager:manager_id(name)").eq("id",D).single(),b.supabase.from("employee_skills").select("*, skills(*)").eq("employee_id",D),b.supabase.from("person_events").select("*").eq("employee_id",D).order("due_date"),b.supabase.from("documents").select("*").eq("employee_id",D).order("created_at",{ascending:!1}),b.supabase.from("employee_equipment").select("*, equipment(*)").eq("employee_id",D).eq("status","assigned"),b.supabase.from("employee_reviews").select("*, manager:manager_id(name), template:template_id(name)").eq("employee_id",D).order("review_date",{ascending:!1}),b.supabase.from("salary_records").select("*").eq("employee_id",D).order("effective_from",{ascending:!1}).limit(1),b.supabase.from("salary_revisions").select("*, manager:decided_by_manager_id(name)").eq("employee_id",D).order("revision_date",{ascending:!1}),(0,A.getMeetingsForEmployee)(D)]);if(e.data)try{await S(D,"view_profile")}catch(e){console.error("Error logging access:",e)}let o=e.data,c=o?.manager;I({employee:o?{id:o.id,name:o.name||"",firstName:o.first_name||void 0,lastName:o.last_name||void 0,employeeNumber:o.employee_number||"",email:o.email||void 0,phone:o.phone||void 0,dateOfBirth:o.date_of_birth||void 0,role:o.role||"",line:o.line||"",team:o.team||"",employmentType:o.employment_type||"permanent",startDate:o.start_date||void 0,contractEndDate:o.contract_end_date||void 0,managerId:o.manager_id||void 0,managerName:c?.name||void 0,address:o.address||void 0,city:o.city||void 0,postalCode:o.postal_code||void 0,country:o.country||"Sweden",isActive:o.is_active??!0}:null,skills:(a.data||[]).map(e=>{let a=e.skills;return{employeeId:e.employee_id,skillId:e.skill_id,level:e.level,skillName:a?.name,skillCode:a?.code,skillCategory:a?.category}}),events:(t.data||[]).map(e=>({id:e.id,employeeId:e.employee_id,category:e.category,title:e.title,description:e.description,dueDate:e.due_date,completedDate:e.completed_date,recurrence:e.recurrence,ownerManagerId:e.owner_manager_id,status:e.status,notes:e.notes})),documents:(r.data||[]).map(e=>({id:e.id,employeeId:e.employee_id,title:e.title,type:e.type,url:e.url,createdAt:e.created_at,validTo:e.valid_to})),equipment:(n.data||[]).map(e=>{let a=e.equipment;return{id:e.id,employeeId:e.employee_id,equipmentId:e.equipment_id,equipmentName:a?.name,serialNumber:a?.serial_number,assignedDate:e.assigned_date,returnDate:e.return_date,status:e.status}}),reviews:(i.data||[]).map(e=>{let a=e.manager,t=e.template;return{id:e.id,employeeId:e.employee_id,managerId:e.manager_id,managerName:a?.name,templateId:e.template_id,templateName:t?.name,reviewDate:e.review_date,periodStart:e.period_start,periodEnd:e.period_end,overallRating:e.overall_rating,summary:e.summary,goals:e.goals,notes:e.notes,createdAt:e.created_at,updatedAt:e.updated_at}}),currentSalary:s.data&&s.data.length>0?{id:s.data[0].id,employeeId:s.data[0].employee_id,effectiveFrom:s.data[0].effective_from,salaryAmountSek:parseFloat(s.data[0].salary_amount_sek)||0,salaryType:s.data[0].salary_type||"monthly",positionTitle:s.data[0].position_title||void 0,notes:s.data[0].notes||void 0,createdAt:s.data[0].created_at,createdBy:s.data[0].created_by||void 0}:null,salaryRevisions:(d.data||[]).map(e=>{let a=e.manager;return{id:e.id,employeeId:e.employee_id,revisionDate:e.revision_date,previousSalarySek:parseFloat(e.previous_salary_sek)||0,newSalarySek:parseFloat(e.new_salary_sek)||0,salaryType:e.salary_type||"monthly",reason:e.reason||void 0,decidedByManagerId:e.decided_by_manager_id||void 0,decidedByManagerName:a?.name||void 0,documentId:e.document_id,createdAt:e.created_at}}),meetings:l}),P(!1)}D&&e()},[D]),M)return(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,a.jsx)("div",{className:"h-8 bg-muted rounded w-48"}),(0,a.jsx)("div",{className:"h-64 bg-muted rounded"})]})});if(!T.employee)return(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Employee not found"}),(0,a.jsx)(n.default,{href:"/app/employees",className:"text-primary hover:underline mt-2 inline-block",children:"Back to employees"})]});let{employee:q,skills:L,events:O,documents:U,equipment:H,reviews:V,currentSalary:z,salaryRevisions:F,meetings:G}=T,W=[{id:"personal",label:"Personal Data",icon:i.User},{id:"contact",label:"Contact Information",icon:s.Mail},{id:"organisation",label:"Organisation",icon:N.Building2},{id:"employment",label:"Job & Employment",icon:m.Briefcase},{id:"compensation",label:"Compensation",icon:y},{id:"competence",label:"Competence",icon:h,count:L.length},{id:"one-to-ones",label:"1:1 / Medarbetarsamtal",icon:j.MessageSquare,count:G.length},{id:"documents",label:"Documents",icon:p.FileText,count:U.length},{id:"events",label:"People Risk & Tasks",icon:x.AlertTriangle,count:O.filter(e=>"completed"!==e.status).length},{id:"equipment",label:"Equipment",icon:g.Package,count:H.length}],K=["Not trained","In training","Can assist","Trained","Can train others"],Q={contract:"Contract",medical_check:"Medical Check",training:"Training",onboarding:"Onboarding",offboarding:"Offboarding",work_env_delegation:"Work Env Delegation",equipment:"Equipment"},J={upcoming:"outline",due_soon:"default",overdue:"destructive",completed:"secondary"};return(0,a.jsxs)("div",{className:"flex h-full",children:[(0,a.jsxs)("aside",{className:"w-64 border-r bg-muted/30 p-4 flex flex-col",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)(w.Button,{variant:"ghost",size:"sm",onClick:()=>d.push("/app/employees"),"data-testid":"button-back",children:[(0,a.jsx)(u.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back"]})}),(0,a.jsxs)("div",{className:"mb-6 px-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:(0,a.jsx)(i.User,{className:"h-6 w-6 text-primary"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-semibold","data-testid":"text-employee-name",children:q.name}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:q.role||"No role"})]})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground px-1",children:q.employeeNumber})]}),(0,a.jsx)("nav",{className:"flex-1 space-y-1",children:W.map(e=>{let t=e.icon,r=$===e.id;return(0,a.jsxs)("button",{onClick:()=>R(e.id),className:`w-full flex items-center justify-between gap-2 px-3 py-2 text-sm rounded-md transition-colors ${r?"bg-primary text-primary-foreground":"text-muted-foreground hover-elevate"}`,"data-testid":`nav-${e.id}`,children:[(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(t,{className:"h-4 w-4"}),e.label]}),void 0!==e.count&&e.count>0&&(0,a.jsx)(E.Badge,{variant:r?"secondary":"outline",className:"text-xs",children:e.count})]},e.id)})}),(0,a.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,a.jsxs)(w.Button,{variant:"outline",size:"sm",className:"w-full",onClick:B,"data-testid":"button-export-gdpr",children:[(0,a.jsx)(_.Shield,{className:"h-4 w-4 mr-2"}),"Export Data (GDPR)"]})})]}),(0,a.jsxs)("main",{className:"flex-1 overflow-auto p-6",children:["personal"===$&&(0,a.jsxs)(C.Card,{children:[(0,a.jsx)(C.CardHeader,{children:(0,a.jsx)(C.CardTitle,{children:"Personal Data"})}),(0,a.jsx)(C.CardContent,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsx)(k,{icon:i.User,label:"Full Name",value:q.name}),(0,a.jsx)(k,{icon:i.User,label:"First Name",value:q.firstName||"-"}),(0,a.jsx)(k,{icon:i.User,label:"Last Name",value:q.lastName||"-"}),(0,a.jsx)(k,{icon:c.Calendar,label:"Date of Birth",value:q.dateOfBirth?new Date(q.dateOfBirth).toLocaleDateString("sv-SE"):"-"}),(0,a.jsx)(k,{icon:i.User,label:"Employee Number",value:q.employeeNumber})]})})]}),"contact"===$&&(0,a.jsxs)(C.Card,{children:[(0,a.jsx)(C.CardHeader,{children:(0,a.jsx)(C.CardTitle,{children:"Contact Information"})}),(0,a.jsx)(C.CardContent,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsx)(k,{icon:s.Mail,label:"Email",value:q.email||"-"}),(0,a.jsx)(k,{icon:l,label:"Phone",value:q.phone||"-"}),(0,a.jsx)(k,{icon:o.MapPin,label:"Address",value:q.address||"-"}),(0,a.jsx)(k,{icon:o.MapPin,label:"City",value:q.city||"-"}),(0,a.jsx)(k,{icon:o.MapPin,label:"Postal Code",value:q.postalCode||"-"}),(0,a.jsx)(k,{icon:o.MapPin,label:"Country",value:q.country||"Sweden"})]})})]}),"organisation"===$&&(0,a.jsxs)(C.Card,{children:[(0,a.jsx)(C.CardHeader,{children:(0,a.jsx)(C.CardTitle,{children:"Organisation"})}),(0,a.jsx)(C.CardContent,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsx)(k,{icon:N.Building2,label:"Line",value:q.line||"-"}),(0,a.jsx)(k,{icon:N.Building2,label:"Team",value:q.team||"-"}),(0,a.jsx)(k,{icon:i.User,label:"Manager",value:q.managerName||"-"})]})})]}),"employment"===$&&(0,a.jsxs)(C.Card,{children:[(0,a.jsx)(C.CardHeader,{children:(0,a.jsx)(C.CardTitle,{children:"Job & Employment"})}),(0,a.jsx)(C.CardContent,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsx)(k,{icon:m.Briefcase,label:"Role",value:q.role||"-"}),(0,a.jsx)(k,{icon:m.Briefcase,label:"Employment Type",value:q.employmentType}),(0,a.jsx)(k,{icon:c.Calendar,label:"Start Date",value:q.startDate?new Date(q.startDate).toLocaleDateString("sv-SE"):"-"}),(0,a.jsx)(k,{icon:c.Calendar,label:"Contract End Date",value:q.contractEndDate?new Date(q.contractEndDate).toLocaleDateString("sv-SE"):"-"}),(0,a.jsx)(k,{icon:i.User,label:"Status",value:q.isActive?"Active":"Inactive"})]})})]}),"compensation"===$&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(C.Card,{children:[(0,a.jsxs)(C.CardHeader,{className:"flex flex-row items-center justify-between gap-4",children:[(0,a.jsx)(C.CardTitle,{children:"Current Salary"}),(0,a.jsx)(n.default,{href:`/app/employees/${D}/salary/new`,children:(0,a.jsxs)(w.Button,{size:"sm","data-testid":"button-new-salary",children:[(0,a.jsx)(v.Plus,{className:"h-4 w-4 mr-2"}),"New Revision"]})})]}),(0,a.jsx)(C.CardContent,{children:z?(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Amount"}),(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[z.salaryAmountSek.toLocaleString("sv-SE")," SEK"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Type"}),(0,a.jsx)("p",{className:"font-medium capitalize",children:z.salaryType})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Effective From"}),(0,a.jsx)("p",{className:"font-medium",children:new Date(z.effectiveFrom).toLocaleDateString("sv-SE")})]})]}):(0,a.jsx)("p",{className:"text-muted-foreground",children:"No salary record"})})]}),(0,a.jsxs)(C.Card,{children:[(0,a.jsx)(C.CardHeader,{children:(0,a.jsx)(C.CardTitle,{children:"Salary History"})}),(0,a.jsx)(C.CardContent,{children:0===F.length?(0,a.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No salary revisions"}):(0,a.jsx)("div",{className:"space-y-3",children:F.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium",children:[e.previousSalarySek.toLocaleString("sv-SE")," → ",e.newSalarySek.toLocaleString("sv-SE")," SEK"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.reason||"No reason"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm",children:new Date(e.revisionDate).toLocaleDateString("sv-SE")}),e.decidedByManagerName&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["by ",e.decidedByManagerName]})]})]},e.id))})})]})]}),"competence"===$&&(0,a.jsxs)(C.Card,{children:[(0,a.jsxs)(C.CardHeader,{className:"flex flex-row items-center justify-between gap-4",children:[(0,a.jsx)(C.CardTitle,{children:"Competence"}),(0,a.jsx)(n.default,{href:`/app/employees/${D}/competence`,className:"hr-link","data-testid":"link-competence-profile",children:"Visa kompetensprofil →"})]}),(0,a.jsx)(C.CardContent,{children:0===L.length?(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No competencies registered"}):(0,a.jsx)("div",{className:"space-y-3",children:L.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.skillName||"Unknown"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.skillCategory||"Uncategorized"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"flex gap-1",children:[0,1,2,3,4].map(t=>(0,a.jsx)("div",{className:`w-3 h-3 rounded-full ${t<=e.level?"bg-primary":"bg-muted"}`},t))}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground w-24 text-right",children:K[e.level]})]})]},e.skillId))})})]}),"one-to-ones"===$&&(0,a.jsxs)(C.Card,{children:[(0,a.jsxs)(C.CardHeader,{className:"flex flex-row items-center justify-between gap-4",children:[(0,a.jsx)(C.CardTitle,{children:"1:1 Meetings / Medarbetarsamtal"}),(0,a.jsx)(n.default,{href:`/app/employees/${D}/one-to-ones`,children:(0,a.jsx)(w.Button,{size:"sm","data-testid":"button-view-all-meetings",children:"View All"})})]}),(0,a.jsx)(C.CardContent,{children:0===G.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-muted-foreground mb-4",children:"No 1:1 meetings scheduled"}),(0,a.jsx)(n.default,{href:`/app/employees/${D}/one-to-ones`,children:(0,a.jsxs)(w.Button,{"data-testid":"button-schedule-meeting",children:[(0,a.jsx)(v.Plus,{className:"h-4 w-4 mr-2"}),"Schedule Meeting"]})})]}):(0,a.jsx)("div",{className:"space-y-3",children:G.slice(0,5).map(e=>(0,a.jsx)(n.default,{href:`/app/one-to-ones/${e.id}`,children:(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-md hover-elevate cursor-pointer",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.templateName||"1:1 Meeting"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[new Date(e.scheduledAt).toLocaleDateString("sv-SE")," with ",e.managerName]})]}),(0,a.jsx)(E.Badge,{variant:J[e.status]||"outline",children:e.status.replace("_"," ")})]})},e.id))})})]}),"documents"===$&&(0,a.jsxs)(C.Card,{children:[(0,a.jsx)(C.CardHeader,{children:(0,a.jsx)(C.CardTitle,{children:"Documents"})}),(0,a.jsx)(C.CardContent,{children:0===U.length?(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No documents"}):(0,a.jsx)("div",{className:"space-y-3",children:U.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(p.FileText,{className:"h-5 w-5 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground capitalize",children:e.type.replace("_"," ")})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.validTo&&(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Valid to: ",new Date(e.validTo).toLocaleDateString("sv-SE")]}),(0,a.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:(0,a.jsx)(w.Button,{size:"icon",variant:"ghost",children:(0,a.jsx)(f.Download,{className:"h-4 w-4"})})})]})]},e.id))})})]}),"events"===$&&(0,a.jsxs)(C.Card,{children:[(0,a.jsx)(C.CardHeader,{children:(0,a.jsx)(C.CardTitle,{children:"People Risk & Tasks"})}),(0,a.jsx)(C.CardContent,{children:0===O.length?(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No events or tasks"}):(0,a.jsx)("div",{className:"space-y-3",children:O.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.title}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[Q[e.category]||e.category," · Due: ",new Date(e.dueDate).toLocaleDateString("sv-SE")]})]}),(0,a.jsx)(E.Badge,{variant:J[e.status]||"outline",children:e.status.replace("_"," ")})]},e.id))})})]}),"equipment"===$&&(0,a.jsxs)(C.Card,{children:[(0,a.jsx)(C.CardHeader,{children:(0,a.jsx)(C.CardTitle,{children:"Equipment"})}),(0,a.jsx)(C.CardContent,{children:0===H.length?(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No equipment assigned"}):(0,a.jsx)("div",{className:"space-y-3",children:H.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(g.Package,{className:"h-5 w-5 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.equipmentName||"Unknown"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.serialNumber})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)(E.Badge,{variant:"secondary",children:e.status}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Assigned: ",new Date(e.assignedDate).toLocaleDateString("sv-SE")]})]})]},e.id))})})]})]})]})}e.s(["default",()=>D],48513)}]);