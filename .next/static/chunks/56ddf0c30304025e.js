(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,70065,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(47163);let r=t.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,a.cn)("rounded-xl border bg-card border-card-border text-card-foreground shadow-sm",e),...t}));r.displayName="Card";let l=t.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",e),...t}));l.displayName="CardHeader";let i=t.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));i.displayName="CardTitle";let n=t.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,a.cn)("text-sm text-muted-foreground",e),...t}));n.displayName="CardDescription";let d=t.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,a.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent",t.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,a.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter",e.s(["Card",()=>r,"CardContent",()=>d,"CardDescription",()=>n,"CardHeader",()=>l,"CardTitle",()=>i])},25913,e=>{"use strict";var s=e.i(7670);let t=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,a=s.clsx;e.s(["cva",0,(e,s)=>r=>{var l;if((null==s?void 0:s.variants)==null)return a(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:i,defaultVariants:n}=s,d=Object.keys(i).map(e=>{let s=null==r?void 0:r[e],a=null==n?void 0:n[e];if(null===s)return null;let l=t(s)||t(a);return i[e][l]}),o=r&&Object.entries(r).reduce((e,s)=>{let[t,a]=s;return void 0===a||(e[t]=a),e},{});return a(e,d,null==s||null==(l=s.compoundVariants)?void 0:l.reduce((e,s)=>{let{class:t,className:a,...r}=s;return Object.entries(r).every(e=>{let[s,t]=e;return Array.isArray(t)?t.includes({...n,...o}[s]):({...n,...o})[s]===t})?[...e,t,a]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}])},91918,20783,e=>{"use strict";var s=e.i(71645);function t(e,s){if("function"==typeof e)return e(s);null!=e&&(e.current=s)}function a(...e){return s=>{let a=!1,r=e.map(e=>{let r=t(e,s);return a||"function"!=typeof r||(a=!0),r});if(a)return()=>{for(let s=0;s<r.length;s++){let a=r[s];"function"==typeof a?a():t(e[s],null)}}}}function r(...e){return s.useCallback(a(...e),e)}e.s(["composeRefs",()=>a,"useComposedRefs",()=>r],20783);var l=e.i(43476);function i(e){var t;let r,i=(t=e,(r=s.forwardRef((e,t)=>{let{children:r,...l}=e;if(s.isValidElement(r)){var i;let e,n,d=(i=r,(n=(e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?i.ref:(n=(e=Object.getOwnPropertyDescriptor(i,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?i.props.ref:i.props.ref||i.ref),o=function(e,s){let t={...s};for(let a in s){let r=e[a],l=s[a];/^on[A-Z]/.test(a)?r&&l?t[a]=(...e)=>{l(...e),r(...e)}:r&&(t[a]=r):"style"===a?t[a]={...r,...l}:"className"===a&&(t[a]=[r,l].filter(Boolean).join(" "))}return{...e,...t}}(l,r.props);return r.type!==s.Fragment&&(o.ref=t?a(t,d):d),s.cloneElement(r,o)}return s.Children.count(r)>1?s.Children.only(null):null})).displayName=`${t}.SlotClone`,r),n=s.forwardRef((e,t)=>{let{children:a,...r}=e,n=s.Children.toArray(a),d=n.find(c);if(d){let e=d.props.children,a=n.map(t=>t!==d?t:s.Children.count(e)>1?s.Children.only(null):s.isValidElement(e)?e.props.children:null);return(0,l.jsx)(i,{...r,ref:t,children:s.isValidElement(e)?s.cloneElement(e,void 0,a):null})}return(0,l.jsx)(i,{...r,ref:t,children:a})});return n.displayName=`${e}.Slot`,n}var n=i("Slot"),d=Symbol("radix.slottable");function o(e){let s=({children:e})=>(0,l.jsx)(l.Fragment,{children:e});return s.displayName=`${e}.Slottable`,s.__radixId=d,s}function c(e){return s.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===d}e.s(["Slot",()=>n,"createSlot",()=>i,"createSlottable",()=>o],91918)},67881,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(91918),r=e.i(25913),l=e.i(47163);let i=(0,r.cva)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover-elevate active-elevate-2",{variants:{variant:{default:"bg-primary text-primary-foreground border border-primary-border",destructive:"bg-destructive text-destructive-foreground border border-destructive-border",outline:"border [border-color:var(--button-outline)] shadow-xs active:shadow-none",secondary:"border bg-secondary text-secondary-foreground border-secondary-border",ghost:"border border-transparent"},size:{default:"min-h-9 px-4 py-2",sm:"min-h-8 rounded-md px-3 text-xs",lg:"min-h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),n=t.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...d},o)=>{let c=n?a.Slot:"button";return(0,s.jsx)(c,{className:(0,l.cn)(i({variant:t,size:r,className:e})),ref:o,...d})});n.displayName="Button",e.s(["Button",()=>n,"buttonVariants",()=>i])},43531,e=>{"use strict";let s=(0,e.i(75254).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>s],43531)},31278,e=>{"use strict";let s=(0,e.i(75254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>s],31278)},78894,e=>{"use strict";let s=(0,e.i(75254).default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>s],78894)},3116,e=>{"use strict";let s=(0,e.i(75254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>s],3116)},84614,e=>{"use strict";let s=(0,e.i(75254).default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>s],84614)},90098,e=>{"use strict";var s=e.i(47167);function t(){return"true"===new URLSearchParams(window.location.search).get("demo")||"true"===s.default.env.NEXT_PUBLIC_DEMO_MODE}e.s(["DEMO_EMPLOYEES",0,[{id:"E1001",employeeNumber:"E1001",name:"Anna Lindberg",firstName:"Anna",lastName:"Lindberg",email:"anna.lindberg@example.com",role:"Operator",line:"Pressline 1",team:"Day Shift",startDate:"2020-03-15",isActive:!0},{id:"E1002",employeeNumber:"E1002",name:"Erik Johansson",firstName:"Erik",lastName:"Johansson",email:"erik.johansson@example.com",role:"Operator",line:"Pressline 1",team:"Day Shift",startDate:"2019-06-01",isActive:!0},{id:"E1003",employeeNumber:"E1003",name:"Maria Svensson",firstName:"Maria",lastName:"Svensson",email:"maria.svensson@example.com",role:"Team Lead",line:"Pressline 1",team:"Day Shift",startDate:"2018-01-10",isActive:!0},{id:"E1004",employeeNumber:"E1004",name:"Karl Andersson",firstName:"Karl",lastName:"Andersson",email:"karl.andersson@example.com",role:"Operator",line:"Pressline 1",team:"Night Shift",startDate:"2021-09-20",isActive:!0},{id:"E1005",employeeNumber:"E1005",name:"Sofia Nilsson",firstName:"Sofia",lastName:"Nilsson",email:"sofia.nilsson@example.com",role:"Operator",line:"Pressline 2",team:"Day Shift",startDate:"2022-02-14",isActive:!0},{id:"E1006",employeeNumber:"E1006",name:"Lars Pettersson",firstName:"Lars",lastName:"Pettersson",email:"lars.pettersson@example.com",role:"Team Lead",line:"Pressline 2",team:"Day Shift",startDate:"2017-05-22",isActive:!0},{id:"E1007",employeeNumber:"E1007",name:"Emma Gustafsson",firstName:"Emma",lastName:"Gustafsson",email:"emma.gustafsson@example.com",role:"Quality Inspector",line:"Quality Control",team:"Day Shift",startDate:"2020-11-03",isActive:!0},{id:"E1008",employeeNumber:"E1008",name:"Oscar Eriksson",firstName:"Oscar",lastName:"Eriksson",email:"oscar.eriksson@example.com",role:"Operator",line:"Assembly",team:"Day Shift",startDate:"2021-04-18",isActive:!0},{id:"E1009",employeeNumber:"E1009",name:"Maja Larsson",firstName:"Maja",lastName:"Larsson",email:"maja.larsson@example.com",role:"Operator",line:"Assembly",team:"Night Shift",startDate:"2019-08-25",isActive:!0},{id:"E1010",employeeNumber:"E1010",name:"Viktor Olsson",firstName:"Viktor",lastName:"Olsson",email:"viktor.olsson@example.com",role:"Logistics Coordinator",line:"Logistics",team:"Day Shift",startDate:"2018-12-01",isActive:!0}],"DEMO_ORG_UNITS",0,[{id:"OU1",name:"Manufacturing Division",code:"MFG",type:"Division",parentId:null,employeeCount:10},{id:"OU2",name:"Pressline Department",code:"PRESS",type:"Department",parentId:"OU1",employeeCount:6},{id:"OU3",name:"Assembly Department",code:"ASSY",type:"Department",parentId:"OU1",employeeCount:2},{id:"OU4",name:"Quality Department",code:"QC",type:"Department",parentId:"OU1",employeeCount:1},{id:"OU5",name:"Logistics Department",code:"LOG",type:"Department",parentId:"OU1",employeeCount:1}],"DEMO_POSITIONS",0,[{id:"P1",name:"Pressline 1 Operator",line:"Pressline 1",minHeadcount:4},{id:"P2",name:"Pressline 2 Operator",line:"Pressline 2",minHeadcount:3},{id:"P3",name:"Assembly Operator",line:"Assembly",minHeadcount:3},{id:"P4",name:"Quality Inspector",line:"Quality Control",minHeadcount:2},{id:"P5",name:"Logistics Coordinator",line:"Logistics",minHeadcount:2}],"DEMO_SKILLS",0,[{id:"SK001",code:"PRESS_A",name:"Pressline A Operation",groupId:"G1",groupName:"Production"},{id:"SK002",code:"PRESS_B",name:"Pressline B Operation",groupId:"G1",groupName:"Production"},{id:"SK003",code:"SAFETY_BASIC",name:"Safety Basic",groupId:"G2",groupName:"Safety"},{id:"SK004",code:"SAFETY_ADV",name:"Safety Advanced",groupId:"G2",groupName:"Safety"},{id:"SK005",code:"TRUCK_A1",name:"Truck A1 License",groupId:"G3",groupName:"Certifications"},{id:"SK006",code:"TRUCK_B1",name:"Truck B1 License",groupId:"G3",groupName:"Certifications"},{id:"SK007",code:"QUALITY_INSP",name:"Quality Inspection",groupId:"G4",groupName:"Quality"},{id:"SK008",code:"FIRST_AID",name:"First Aid Certified",groupId:"G2",groupName:"Safety"}],"isDemoMode",()=>t])},69638,e=>{"use strict";let s=(0,e.i(75254).default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>s],69638)},73884,e=>{"use strict";let s=(0,e.i(75254).default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>s],73884)},55436,e=>{"use strict";let s=(0,e.i(75254).default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);e.s(["Search",()=>s],55436)},27612,e=>{"use strict";let s=(0,e.i(75254).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>s],27612)},16715,e=>{"use strict";let s=(0,e.i(75254).default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>s],16715)},89699,e=>{"use strict";var s=e.i(5512),t=e.i(53210);async function a(){let{data:{session:e}}=await t.supabase.auth.getSession(),s={"Content-Type":"application/json"};return e?.access_token&&(s.Authorization=`Bearer ${e.access_token}`),s}async function r(e){let t=await a(),r=await fetch(e,{headers:t});if((0,s.logApiCall)(e,r.status),!r.ok){let t={};try{t=await r.json()}catch{t={message:r.statusText}}throw(0,s.logDebugError)({type:"api",endpoint:e,status:r.status,code:t.code,message:t.message||t.error||`HTTP ${r.status}`,hint:t.hint}),Error(t.message||t.error||`Request failed: ${r.status}`)}return r.json()}async function l(e,t){let r=await a(),l=await fetch(e,{method:"POST",headers:r,body:JSON.stringify(t)});if((0,s.logApiCall)(e,l.status),!l.ok){let t={};try{t=await l.json()}catch{t={message:l.statusText}}throw(0,s.logDebugError)({type:"api",endpoint:e,status:l.status,code:t.code,message:t.message||t.error||`HTTP ${l.status}`,hint:t.hint}),Error(t.message||t.error||`Request failed: ${l.status}`)}return l.json()}e.s(["apiGet",()=>r,"apiPost",()=>l])},77841,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(68934),r=e.i(24136),l=e.i(53210),i=e.i(90098),n=e.i(5512);async function d(e,s){try{let a=await e();if(a.error){var t;let e,r;if((0,n.logDebugError)({type:"supabase",endpoint:s,code:a.error.code,message:a.error.message,hint:a.error.hint}),t=a.error,e=t.message?.toLowerCase()||"",r=t.code||"",e.includes("permission denied")||e.includes("rls")||e.includes("row-level security")||e.includes("policy")||"PGRST301"===r||"42501"===r||"42P01"===r)return(0,n.setFlag)("rlsBlocked",!0),"denied";return null}return a.count??null}catch(e){return(0,n.logDebugError)({type:"supabase",endpoint:s,message:e instanceof Error?e.message:"Unknown error"}),null}}var o=e.i(10289),c=e.i(75254);let m=(0,c.default)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var u=e.i(43531);let x=(0,c.default)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);var p=e.i(84614),g=e.i(7486),h=e.i(78894),f=e.i(16715),y=e.i(31278),N=e.i(98919),b=e.i(27612);let j=(0,c.default)("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);var v=e.i(3116),C=e.i(55436),k=e.i(95116),w=e.i(69638),S=e.i(73884),E=e.i(89699),O=e.i(67881),D=e.i(70065);function A(){let{currentOrg:e,currentRole:c,memberships:A,isLoading:T,error:M}=(0,a.useOrg)(),{user:I,isAuthenticated:L}=(0,r.useAuth)(),[P,R]=(0,t.useState)({employees:null,units:null,skills:null,positions:null}),[_,B]=(0,t.useState)(!1),[U,z]=(0,t.useState)(!1),[H,$]=(0,t.useState)((0,n.getState)()),[G,K]=(0,t.useState)(null),[V,F]=(0,t.useState)(null),[Y,q]=(0,t.useState)(!1),[Q,W]=(0,t.useState)(null),[J,X]=(0,t.useState)(!1);(0,t.useEffect)(()=>(0,n.subscribe)(e=>{$(e)}),[]),(0,t.useEffect)(()=>{T?K(Date.now()):(K(null),(0,n.setFlag)("loadingTimeout",!1))},[T]),(0,t.useEffect)(()=>{if(!G)return;let e=setTimeout(()=>{T&&(0,n.setFlag)("loadingTimeout",!0)},5e3);return()=>clearTimeout(e)},[G,T]),(0,t.useEffect)(()=>{(0,n.setFlag)("orgMissing",!e&&!T)},[e,T]);let Z=(0,t.useCallback)(async()=>{if((0,i.isDemoMode)())return void R({employees:i.DEMO_EMPLOYEES.length,units:i.DEMO_ORG_UNITS.length,skills:i.DEMO_SKILLS.length,positions:i.DEMO_POSITIONS.length});if(!e)return void R({employees:null,units:null,skills:null,positions:null});B(!0);try{let[s,t,a,r]=await Promise.all([d(async()=>await l.supabase.from("employees").select("id",{count:"exact",head:!0}).eq("org_id",e.id),"employees"),d(async()=>await l.supabase.from("org_units").select("id",{count:"exact",head:!0}).eq("org_id",e.id),"org_units"),d(async()=>await l.supabase.from("competences").select("id",{count:"exact",head:!0}),"competences (global)"),d(async()=>await l.supabase.from("positions").select("id",{count:"exact",head:!0}),"positions (global)")]);R({employees:s,units:t,skills:a,positions:r})}catch(e){console.error("Error fetching counts:",e)}finally{B(!1)}},[e]);(0,t.useEffect)(()=>{Z()},[Z]);let ee=(0,t.useCallback)(async()=>{if(!(!e||(0,i.isDemoMode)())){q(!0),F(null);try{let s=await (0,E.apiGet)(`/api/debug/schema?orgId=${e.id}`);F(s)}catch(e){console.error("Schema check error:",e)}finally{q(!1)}}},[e]),es=async(s,t)=>{if(e){X(!0),W(null);try{let a=await (0,E.apiPost)("/api/debug/repair-orgid",{orgId:e.id,table:s,dryRun:t});W(a.message),t||(await ee(),await Z())}catch(e){W(e instanceof Error?e.message:"Repair failed")}finally{X(!1)}}},et=()=>e?localStorage.getItem("nadiplan_current_org")===e.id?"localStorage":1===A.length?"auto-selected (single org)":"selected":"none",ea=async()=>{try{await navigator.clipboard.writeText(JSON.stringify({timestamp:new Date().toISOString(),demoMode:(0,i.isDemoMode)(),user:{email:I?.email||"not authenticated",id:I?.id||null,authenticated:L},organization:{id:e?.id||null,name:e?.name||null,slug:e?.slug||null,source:et(),role:c},memberships:A.map(e=>({orgId:e.org_id,orgName:e.organization?.name,role:e.role,status:e.status})),counts:P,flags:H.flags,errors:H.errors.slice(0,10),lastApiCalls:H.lastApiCalls,orgLoadingState:{isLoading:T,error:M}},null,2)),z(!0),setTimeout(()=>z(!1),2e3)}catch(e){console.error("Failed to copy:",e)}},er=H.flags.orgMissing||H.flags.rlsBlocked||H.flags.loadingTimeout||!c;return(0,s.jsxs)("div",{className:"p-6 max-w-4xl mx-auto space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-2xl font-semibold text-foreground flex items-center gap-2","data-testid":"text-page-title",children:[(0,s.jsx)(o.Bug,{className:"w-6 h-6"}),"Debug Cockpit",(0,s.jsxs)("span",{className:"ml-2 flex items-center gap-1 text-sm font-normal text-green-600",children:[(0,s.jsx)(j,{className:"w-3 h-3 animate-pulse"}),"Live"]})]}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1",children:"System state and diagnostics"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(O.Button,{variant:"outline",size:"sm",onClick:()=>(0,n.clearErrors)(),"data-testid":"button-clear-errors",children:[(0,s.jsx)(b.Trash2,{className:"w-4 h-4 mr-2"}),"Clear Errors"]}),(0,s.jsxs)(O.Button,{onClick:ea,"data-testid":"button-copy-report",children:[U?(0,s.jsx)(u.Check,{className:"w-4 h-4 mr-2"}):(0,s.jsx)(m,{className:"w-4 h-4 mr-2"}),U?"Copied!":"Copy Debug Report"]})]})]}),er&&(0,s.jsxs)("div",{className:"p-4 rounded-md bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 space-y-2",children:[(0,s.jsxs)("p",{className:"font-medium text-red-800 dark:text-red-200 flex items-center gap-2",children:[(0,s.jsx)(h.AlertTriangle,{className:"w-5 h-5"}),"System Warnings"]}),(0,s.jsxs)("ul",{className:"text-sm text-red-700 dark:text-red-300 space-y-1 ml-7",children:[H.flags.orgMissing&&(0,s.jsx)("li",{children:"No organization selected"}),!c&&e&&(0,s.jsx)("li",{children:"Current role is null (permissions issue)"}),H.flags.rlsBlocked&&(0,s.jsx)("li",{children:"RLS (Row Level Security) blocked some queries"}),H.flags.loadingTimeout&&(0,s.jsx)("li",{children:"Organization loading took longer than 5 seconds"})]})]}),(0,i.isDemoMode)()&&(0,s.jsx)("div",{className:"p-4 rounded-md bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800",children:(0,s.jsxs)("p",{className:"text-sm text-amber-800 dark:text-amber-200 flex items-center gap-2",children:[(0,s.jsx)(h.AlertTriangle,{className:"w-4 h-4"}),"Demo mode is active. Counts reflect demo data, not database."]})}),(0,s.jsxs)(D.Card,{children:[(0,s.jsx)(D.CardHeader,{className:"pb-3",children:(0,s.jsxs)(D.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,s.jsx)(N.Shield,{className:"w-4 h-4"}),"System Flags"]})}),(0,s.jsx)(D.CardContent,{children:(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"text-center p-3 rounded-md bg-muted/50",children:[(0,s.jsx)("div",{className:`text-lg font-semibold ${H.flags.rlsBlocked?"text-red-600":"text-green-600"}`,children:H.flags.rlsBlocked?"YES":"NO"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"RLS Blocked"})]}),(0,s.jsxs)("div",{className:"text-center p-3 rounded-md bg-muted/50",children:[(0,s.jsx)("div",{className:`text-lg font-semibold ${H.flags.orgMissing?"text-red-600":"text-green-600"}`,children:H.flags.orgMissing?"YES":"NO"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Org Missing"})]}),(0,s.jsxs)("div",{className:"text-center p-3 rounded-md bg-muted/50",children:[(0,s.jsx)("div",{className:`text-lg font-semibold ${H.flags.loadingTimeout?"text-red-600":"text-green-600"}`,children:H.flags.loadingTimeout?"YES":"NO"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Loading Timeout"})]}),(0,s.jsxs)("div",{className:"text-center p-3 rounded-md bg-muted/50",children:[(0,s.jsx)("div",{className:`text-lg font-semibold ${(0,i.isDemoMode)()?"text-amber-600":"text-foreground"}`,children:(0,i.isDemoMode)()?"YES":"NO"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Demo Mode"})]})]})})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsxs)(D.Card,{children:[(0,s.jsx)(D.CardHeader,{className:"pb-3",children:(0,s.jsxs)(D.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,s.jsx)(p.User,{className:"w-4 h-4"}),"Current User"]})}),(0,s.jsxs)(D.CardContent,{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Email:"}),(0,s.jsx)("span",{className:"font-mono text-foreground","data-testid":"text-user-email",children:I?.email||"Not authenticated"})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"User ID:"}),(0,s.jsx)("span",{className:"font-mono text-foreground text-xs truncate max-w-[200px]",children:I?.id||"-"})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Authenticated:"}),(0,s.jsx)("span",{className:L?"text-green-600":"text-red-600",children:L?"Yes":"No"})]})]})]}),(0,s.jsxs)(D.Card,{children:[(0,s.jsx)(D.CardHeader,{className:"pb-3",children:(0,s.jsxs)(D.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,s.jsx)(g.Building2,{className:"w-4 h-4"}),"Current Organization"]})}),(0,s.jsxs)(D.CardContent,{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Name:"}),(0,s.jsx)("span",{className:"font-medium text-foreground","data-testid":"text-org-name",children:e?.name||"None selected"})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Org ID:"}),(0,s.jsx)("span",{className:"font-mono text-foreground text-xs truncate max-w-[200px]","data-testid":"text-org-id",children:e?.id||"-"})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Source:"}),(0,s.jsx)("span",{className:"text-foreground",children:et()})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Role:"}),(0,s.jsx)("span",{className:`capitalize ${c?"text-foreground":"text-red-600"}`,children:c||"null (!)"})]}),T&&(0,s.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[(0,s.jsx)(y.Loader2,{className:"w-3 h-3 animate-spin"})," Loading org..."]}),M&&(0,s.jsx)("div",{className:"text-sm text-destructive",children:M})]})]})]}),(0,s.jsxs)(D.Card,{children:[(0,s.jsxs)(D.CardHeader,{className:"pb-3 flex flex-row items-center justify-between gap-2",children:[(0,s.jsxs)(D.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,s.jsx)(x,{className:"w-4 h-4"}),"Data Counts ",(0,i.isDemoMode)()?"(Demo)":e?"(Org-scoped)":""]}),(0,s.jsx)(O.Button,{variant:"ghost",size:"sm",onClick:Z,disabled:_,children:(0,s.jsx)(f.RefreshCw,{className:`w-4 h-4 ${_?"animate-spin":""}`})})]}),(0,s.jsx)(D.CardContent,{children:(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"Employees",value:P.employees},{label:"Org Units",value:P.units},{label:"Skills (Global)",value:P.skills},{label:"Positions (Global)",value:P.positions}].map(e=>{var t;return(0,s.jsxs)("div",{className:"text-center p-3 rounded-md bg-muted/50",children:[(0,s.jsx)("div",{className:`text-2xl font-semibold ${"denied"===e.value?"text-red-600":"text-foreground"}`,children:"denied"===(t=e.value)?"Denied":null===t?"-":String(t)}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:e.label})]},e.label)})})})]}),!(0,i.isDemoMode)()&&(0,s.jsxs)(D.Card,{children:[(0,s.jsxs)(D.CardHeader,{className:"pb-3 flex flex-row items-center justify-between gap-2",children:[(0,s.jsxs)(D.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,s.jsx)(C.Search,{className:"w-4 h-4"}),"Schema Check"]}),(0,s.jsxs)(O.Button,{variant:"outline",size:"sm",onClick:ee,disabled:Y||!e,children:[Y?(0,s.jsx)(y.Loader2,{className:"w-4 h-4 animate-spin"}):(0,s.jsx)(f.RefreshCw,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"ml-2",children:"Run Check"})]})]}),(0,s.jsx)(D.CardContent,{children:V?(0,s.jsxs)("div",{className:"space-y-4",children:[V.errors.length>0&&(0,s.jsxs)("div",{className:"p-3 rounded-md bg-destructive/10 border border-destructive/20",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-destructive mb-1",children:"Errors:"}),V.errors.map((e,t)=>(0,s.jsx)("p",{className:"text-xs text-destructive",children:e},t))]}),(0,s.jsx)("div",{className:"grid gap-2",children:Object.entries(V.tables).map(([e,t])=>(0,s.jsxs)("div",{className:"p-3 rounded-md bg-muted/50 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"font-medium text-sm",children:e}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:t.exists?(0,s.jsxs)("span",{className:"text-xs text-green-600 flex items-center gap-1",children:[(0,s.jsx)(w.CheckCircle,{className:"w-3 h-3"})," Exists"]}):(0,s.jsxs)("span",{className:"text-xs text-red-600 flex items-center gap-1",children:[(0,s.jsx)(S.XCircle,{className:"w-3 h-3"})," Missing"]})})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 text-xs",children:[(0,s.jsxs)("span",{className:t.hasOrgId?"text-green-600":"text-red-600",children:["org_id: ",t.hasOrgId?"Yes":"No"]}),(0,s.jsxs)("span",{className:!0===t.rlsEnabled?"text-green-600":!1===t.rlsEnabled?"text-red-600":"text-muted-foreground",children:["RLS: ",!0===t.rlsEnabled?"Enabled":!1===t.rlsEnabled?"Disabled":"Unknown"]}),void 0!==V.nullOrgIdCounts[e]&&(0,s.jsxs)("span",{className:V.nullOrgIdCounts[e]>0?"text-amber-600":"text-green-600",children:["Null org_id: ",V.nullOrgIdCounts[e]]})]}),V.nullOrgIdCounts[e]>0&&(0,s.jsxs)("div",{className:"pt-2 border-t border-border flex items-center gap-2",children:[(0,s.jsxs)(O.Button,{variant:"outline",size:"sm",onClick:()=>es(e,!0),disabled:J,children:[(0,s.jsx)(k.Wrench,{className:"w-3 h-3 mr-1"}),"Preview Repair"]}),(0,s.jsxs)(O.Button,{variant:"destructive",size:"sm",onClick:()=>{confirm(`This will update all ${V.nullOrgIdCounts[e]} rows with null org_id to the current org. Continue?`)&&es(e,!1)},disabled:J,children:[J?(0,s.jsx)(y.Loader2,{className:"w-3 h-3 animate-spin mr-1"}):(0,s.jsx)(k.Wrench,{className:"w-3 h-3 mr-1"}),"Apply Repair"]})]})]},e))}),Q&&(0,s.jsx)("div",{className:"p-3 rounded-md bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800",children:(0,s.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:Q})})]}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:'Click "Run Check" to validate database schema and RLS'})})]}),H.lastApiCalls.length>0&&(0,s.jsxs)(D.Card,{children:[(0,s.jsx)(D.CardHeader,{className:"pb-3",children:(0,s.jsxs)(D.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,s.jsx)(v.Clock,{className:"w-4 h-4"}),"Last API Calls (",H.lastApiCalls.length,")"]})}),(0,s.jsx)(D.CardContent,{children:(0,s.jsx)("div",{className:"space-y-1 max-h-[200px] overflow-y-auto",children:H.lastApiCalls.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm p-2 rounded bg-muted/30",children:[(0,s.jsx)("span",{className:`px-1.5 py-0.5 rounded text-xs font-mono ${e.status>=200&&e.status<300?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:e.status}),(0,s.jsx)("span",{className:"font-mono text-xs text-muted-foreground truncate flex-1",children:e.endpoint}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:new Date(e.timestamp).toLocaleTimeString()})]},t))})})]}),(0,s.jsxs)(D.Card,{children:[(0,s.jsx)(D.CardHeader,{className:"pb-3",children:(0,s.jsxs)(D.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,s.jsx)(h.AlertTriangle,{className:"w-4 h-4"}),"Recent Errors (",H.errors.length,")",(0,s.jsxs)("span",{className:"ml-auto text-xs font-normal text-muted-foreground flex items-center gap-1",children:[(0,s.jsx)(j,{className:"w-3 h-3 animate-pulse text-green-500"}),"Auto-updating"]})]})}),(0,s.jsx)(D.CardContent,{children:0===H.errors.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No errors logged in this session"}):(0,s.jsx)("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:H.errors.map((e,t)=>(0,s.jsxs)("div",{className:"p-3 rounded-md bg-destructive/5 border border-destructive/20 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("span",{className:`px-1.5 py-0.5 rounded text-xs uppercase ${"supabase"===e.type?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":"client"===e.type?"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:e.type}),e.endpoint&&(0,s.jsx)("span",{className:"font-mono text-xs text-muted-foreground",children:e.endpoint}),e.status&&(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Status: ",e.status]})]}),(0,s.jsx)("p",{className:"text-foreground",children:e.message}),e.code&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Code: ",e.code]}),e.hint&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Hint: ",e.hint]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(e.timestamp).toLocaleString()})]},t))})})]}),(0,s.jsxs)(D.Card,{children:[(0,s.jsx)(D.CardHeader,{className:"pb-3",children:(0,s.jsx)(D.CardTitle,{className:"text-base",children:"All Memberships"})}),(0,s.jsx)(D.CardContent,{children:0===A.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No organization memberships found"}):(0,s.jsx)("div",{className:"space-y-2",children:A.map((t,a)=>(0,s.jsxs)("div",{className:`p-3 rounded-md border ${t.org_id===e?.id?"border-primary bg-primary/5":"border-border bg-muted/30"}`,children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"font-medium text-foreground",children:t.organization?.name||t.org_id}),(0,s.jsx)("span",{className:"text-xs px-2 py-1 rounded bg-muted text-muted-foreground capitalize",children:t.role})]}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground mt-1 font-mono",children:t.org_id})]},a))})})]})]})}e.s(["default",()=>A],77841)}]);