(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,25913,e=>{"use strict";var t=e.i(7670);let r=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,a=t.clsx;e.s(["cva",0,(e,t)=>s=>{var i;if((null==t?void 0:t.variants)==null)return a(e,null==s?void 0:s.class,null==s?void 0:s.className);let{variants:n,defaultVariants:l}=t,d=Object.keys(n).map(e=>{let t=null==s?void 0:s[e],a=null==l?void 0:l[e];if(null===t)return null;let i=r(t)||r(a);return n[e][i]}),o=s&&Object.entries(s).reduce((e,t)=>{let[r,a]=t;return void 0===a||(e[r]=a),e},{});return a(e,d,null==t||null==(i=t.compoundVariants)?void 0:i.reduce((e,t)=>{let{class:r,className:a,...s}=t;return Object.entries(s).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...l,...o}[t]):({...l,...o})[t]===r})?[...e,r,a]:e},[]),null==s?void 0:s.class,null==s?void 0:s.className)}])},91918,20783,e=>{"use strict";var t=e.i(71645);function r(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function a(...e){return t=>{let a=!1,s=e.map(e=>{let s=r(e,t);return a||"function"!=typeof s||(a=!0),s});if(a)return()=>{for(let t=0;t<s.length;t++){let a=s[t];"function"==typeof a?a():r(e[t],null)}}}}function s(...e){return t.useCallback(a(...e),e)}e.s(["composeRefs",()=>a,"useComposedRefs",()=>s],20783);var i=e.i(43476);function n(e){var r;let s,n=(r=e,(s=t.forwardRef((e,r)=>{let{children:s,...i}=e;if(t.isValidElement(s)){var n;let e,l,d=(n=s,(l=(e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.ref:(l=(e=Object.getOwnPropertyDescriptor(n,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.props.ref:n.props.ref||n.ref),o=function(e,t){let r={...t};for(let a in t){let s=e[a],i=t[a];/^on[A-Z]/.test(a)?s&&i?r[a]=(...e)=>{i(...e),s(...e)}:s&&(r[a]=s):"style"===a?r[a]={...s,...i}:"className"===a&&(r[a]=[s,i].filter(Boolean).join(" "))}return{...e,...r}}(i,s.props);return s.type!==t.Fragment&&(o.ref=r?a(r,d):d),t.cloneElement(s,o)}return t.Children.count(s)>1?t.Children.only(null):null})).displayName=`${r}.SlotClone`,s),l=t.forwardRef((e,r)=>{let{children:a,...s}=e,l=t.Children.toArray(a),d=l.find(c);if(d){let e=d.props.children,a=l.map(r=>r!==d?r:t.Children.count(e)>1?t.Children.only(null):t.isValidElement(e)?e.props.children:null);return(0,i.jsx)(n,{...s,ref:r,children:t.isValidElement(e)?t.cloneElement(e,void 0,a):null})}return(0,i.jsx)(n,{...s,ref:r,children:a})});return l.displayName=`${e}.Slot`,l}var l=n("Slot"),d=Symbol("radix.slottable");function o(e){let t=({children:e})=>(0,i.jsx)(i.Fragment,{children:e});return t.displayName=`${e}.Slottable`,t.__radixId=d,t}function c(e){return t.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===d}e.s(["Slot",()=>l,"createSlot",()=>n,"createSlottable",()=>o],91918)},67881,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(91918),s=e.i(25913),i=e.i(47163);let n=(0,s.cva)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover-elevate active-elevate-2",{variants:{variant:{default:"bg-primary text-primary-foreground border border-primary-border",destructive:"bg-destructive text-destructive-foreground border border-destructive-border",outline:"border [border-color:var(--button-outline)] shadow-xs active:shadow-none",secondary:"border bg-secondary text-secondary-foreground border-secondary-border",ghost:"border border-transparent"},size:{default:"min-h-9 px-4 py-2",sm:"min-h-8 rounded-md px-3 text-xs",lg:"min-h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),l=r.forwardRef(({className:e,variant:r,size:s,asChild:l=!1,...d},o)=>{let c=l?a.Slot:"button";return(0,t.jsx)(c,{className:(0,i.cn)(n({variant:r,size:s,className:e})),ref:o,...d})});l.displayName="Button",e.s(["Button",()=>l,"buttonVariants",()=>n])},31278,e=>{"use strict";let t=(0,e.i(75254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},84614,e=>{"use strict";let t=(0,e.i(75254).default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>t],84614)},16715,e=>{"use strict";let t=(0,e.i(75254).default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>t],16715)},79002,e=>{"use strict";let t=(0,e.i(75254).default)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);e.s(["UserPlus",()=>t],79002)},71634,62163,89699,98962,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(18566),s=e.i(68934);function i({children:e,requireAdmin:i=!1}){let{currentOrg:n,isLoading:l,memberships:d,isAdmin:o}=(0,s.useOrg)(),c=(0,a.useRouter)();return((0,r.useEffect)(()=>{if(!l){if(!n&&d.length>0||!n&&0===d.length)return void c.replace("/app/org/select");if(i&&!o)return void c.replace("/app")}},[n,l,d,o,i,c]),l)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)("div",{className:"animate-pulse text-muted-foreground",children:"Loading..."})}):n&&(!i||o)?(0,t.jsx)(t.Fragment,{children:e}):null}e.s(["OrgGuard",()=>i],71634);var n=e.i(31278),l=e.i(63209),d=e.i(16715),o=e.i(10289),c=e.i(75254);let u=(0,c.default)("FileQuestion",[["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}],["path",{d:"M9.1 9a3 3 0 0 1 5.82 1c0 2-3 3-3 3",key:"mhlwft"}]]);var m=e.i(67881),p=e.i(22016);function f({status:e,children:r,error:a,onRetry:s,emptyTitle:i="No data yet",emptyMessage:c="Get started by adding your first item.",emptyCta:f,emptyIcon:x,loadingMessage:h="Loading...",minHeight:g="400px"}){return"ready"===e&&r?(0,t.jsx)(t.Fragment,{children:r}):"loading"===e?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-3",style:{minHeight:g},"data-testid":"state-loading",children:[(0,t.jsx)(n.Loader2,{className:"w-6 h-6 animate-spin text-muted-foreground"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:h})]}):"error"===e?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 p-6",style:{minHeight:g},"data-testid":"state-error",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-destructive/10",children:(0,t.jsx)(l.AlertCircle,{className:"w-8 h-8 text-destructive"})}),(0,t.jsxs)("div",{className:"text-center max-w-md",children:[(0,t.jsx)("h3",{className:"font-medium text-foreground mb-1",children:"Something went wrong"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:a?.message||"Failed to load data"}),a?.code&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground font-mono bg-muted px-2 py-1 rounded inline-block",children:["Code: ",a.code]}),a?.hint&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Hint: ",a.hint]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[s&&(0,t.jsxs)(m.Button,{variant:"outline",onClick:s,"data-testid":"button-retry",children:[(0,t.jsx)(d.RefreshCw,{className:"w-4 h-4 mr-2"}),"Retry"]}),(0,t.jsx)(m.Button,{variant:"ghost",asChild:!0,"data-testid":"button-open-debug",children:(0,t.jsxs)(p.default,{href:"/app/debug",children:[(0,t.jsx)(o.Bug,{className:"w-4 h-4 mr-2"}),"Open Debug"]})})]})]}):"empty"===e?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 p-6",style:{minHeight:g},"data-testid":"state-empty",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-muted",children:x||(0,t.jsx)(u,{className:"w-8 h-8 text-muted-foreground"})}),(0,t.jsxs)("div",{className:"text-center max-w-md",children:[(0,t.jsx)("h3",{className:"font-medium text-foreground mb-1",children:i}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:c})]}),f&&(f.href?(0,t.jsx)(m.Button,{asChild:!0,"data-testid":"button-empty-cta",children:(0,t.jsx)(p.default,{href:f.href,children:f.label})}):(0,t.jsx)(m.Button,{onClick:f.onClick,"data-testid":"button-empty-cta",children:f.label}))]}):null}function x(e,t,r){return t?"loading":r?"error":!e||Array.isArray(e)&&0===e.length?"empty":"ready"}e.s(["DataState",()=>f,"useDataState",()=>x],62163);var h=e.i(5512),g=e.i(53210);async function y(){let{data:{session:e}}=await g.supabase.auth.getSession(),t={"Content-Type":"application/json"};return e?.access_token&&(t.Authorization=`Bearer ${e.access_token}`),t}async function v(e){let t=await y(),r=await fetch(e,{headers:t});if((0,h.logApiCall)(e,r.status),!r.ok){let t={};try{t=await r.json()}catch{t={message:r.statusText}}throw(0,h.logDebugError)({type:"api",endpoint:e,status:r.status,code:t.code,message:t.message||t.error||`HTTP ${r.status}`,hint:t.hint}),Error(t.message||t.error||`Request failed: ${r.status}`)}return r.json()}async function j(e,t){let r=await y(),a=await fetch(e,{method:"POST",headers:r,body:JSON.stringify(t)});if((0,h.logApiCall)(e,a.status),!a.ok){let t={};try{t=await a.json()}catch{t={message:a.statusText}}throw(0,h.logDebugError)({type:"api",endpoint:e,status:a.status,code:t.code,message:t.message||t.error||`HTTP ${a.status}`,hint:t.hint}),Error(t.message||t.error||`Request failed: ${a.status}`)}return a.json()}e.s(["apiGet",()=>v,"apiPost",()=>j],89699);let b=(0,c.default)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);e.s(["UserX",()=>b],98962)},64610,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(68934),s=e.i(71634),i=e.i(62163),n=e.i(89699),l=e.i(75254);let d=(0,l.default)("ScrollText",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]),o=(0,l.default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var c=e.i(84614),u=e.i(7486),m=e.i(79002),p=e.i(98919),f=e.i(98962);let x={"org.created":u.Building2,"user.invited":m.UserPlus,"membership.role_updated":p.Shield,"membership.disabled":f.UserX},h={"org.created":"Organization Created","user.invited":"User Invited","membership.role_updated":"Role Changed","membership.disabled":"User Disabled"};function g(){let{currentOrg:e}=(0,a.useOrg)(),[s,l]=(0,r.useState)([]),[u,m]=(0,r.useState)(!0),[p,f]=(0,r.useState)(null),[g,y]=(0,r.useState)(""),v=(0,r.useCallback)(async()=>{if(e){m(!0),f(null);try{let t=(await (0,n.apiGet)(`/api/admin/audit?orgId=${e.id}`)).logs||[];g&&(t=t.filter(e=>e.action===g)),l(t)}catch(e){console.error("Fetch error:",e),f({message:e instanceof Error?e.message:"Failed to load audit logs",code:"NETWORK_ERROR"})}finally{m(!1)}}},[e,g]);(0,r.useEffect)(()=>{v()},[v]);let j=[...new Set(s.map(e=>e.action))],b=(0,i.useDataState)(s,u,p);return(0,t.jsxs)("div",{className:"p-6 max-w-6xl mx-auto space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold text-foreground","data-testid":"text-page-title",children:"Audit Log"}),(0,t.jsxs)("p",{className:"text-muted-foreground mt-1",children:["Activity history for ",e?.name]})]}),"ready"===b&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(o,{className:"w-4 h-4 text-muted-foreground"}),(0,t.jsxs)("select",{value:g,onChange:e=>y(e.target.value),className:"px-3 py-2 rounded-md border border-input bg-background text-foreground text-sm","data-testid":"select-action-filter",children:[(0,t.jsx)("option",{value:"",children:"All Actions"}),j.map(e=>(0,t.jsx)("option",{value:e,children:h[e]||e},e))]})]})]}),(0,t.jsx)(i.DataState,{status:b,error:p,onRetry:v,emptyTitle:"No audit events yet",emptyMessage:"Activity will appear here as users take actions in the organization.",emptyIcon:(0,t.jsx)(d,{className:"w-8 h-8 text-muted-foreground"}),children:(0,t.jsx)("div",{className:"space-y-2",children:s.map(e=>{let r,a=x[e.action]||d;return(0,t.jsxs)("div",{className:"p-4 rounded-lg border border-border bg-card flex items-start gap-4","data-testid":`row-audit-${e.id}`,children:[(0,t.jsx)("div",{className:"p-2 rounded-md bg-muted",children:(0,t.jsx)(a,{className:"w-4 h-4 text-muted-foreground"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:h[e.action]||e.action}),e.target_type&&(0,t.jsxs)("span",{className:"text-muted-foreground text-sm",children:["on ",e.target_type]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-sm text-muted-foreground",children:[(0,t.jsx)(c.User,{className:"w-3 h-3"}),(0,t.jsx)("span",{children:e.actor_email||"System"}),(0,t.jsxs)("span",{children:["at ",new Date(e.created_at).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),Object.keys(e.metadata).length>0&&(0,t.jsx)("div",{className:"mt-2",children:0===(r=Object.entries(e.metadata)).length?null:r.map(([e,r])=>(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-muted text-muted-foreground text-xs mr-1",children:[e,": ",String(r)]},e))})]})]},e.id)})})})]})}function y(){return(0,t.jsx)(s.OrgGuard,{requireAdmin:!0,children:(0,t.jsx)(g,{})})}e.s(["default",()=>y],64610)}]);