(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,66685,e=>{"use strict";var t=e.i(71645),a=e.i(18566),r=e.i(65615);function i(){let[e,i]=(0,t.useState)(!0),n=(0,a.useRouter)();return(0,t.useEffect)(()=>{let e=!0;return async function(){try{!await (0,r.getAuthUser)()&&e?n.replace("/login"):e&&i(!1)}catch(t){console.error("Error checking auth",t),e&&n.replace("/login")}}(),()=>{e=!1}},[n]),{loading:e}}e.s(["useAuthGuard",()=>i])},85773,e=>{"use strict";var t=e.i(53210);async function a(){let{data:e,error:a}=await t.supabase.from("positions").select("id, name, site, department").order("name",{ascending:!0});if(a)throw a;return e??[]}async function r(e){let{data:a,error:r}=await t.supabase.from("employees").select("id, name").eq("position_id",e);if(r)throw r;return(a??[]).map(e=>({id:e.id,name:e.name??"Employee"}))}async function i(e,a){var r,i,n;let s=a??new Date().toISOString().slice(0,10),{data:o,error:l}=await t.supabase.from("employees").select("id, name, position_id").eq("id",e).single();if(l||!o)throw console.error(l),l??Error("Employee not found");let c=o.name??"Employee",d=null,m=o.position_id??null;if(m){let{data:e}=await t.supabase.from("positions").select("id, name").eq("id",m).limit(1),a=e?.[0];a&&(d=a.name)}let p=[];if(m){let{data:e,error:a}=await t.supabase.from("position_competence_requirements").select("id, position_id, competence_id, required_level, mandatory").eq("position_id",m);if(a)throw console.error(a),a;p=e??[]}let{data:u,error:h}=await t.supabase.from("employee_competences").select("id, employee_id, competence_id, level, valid_from, valid_to").eq("employee_id",e);if(h)throw console.error(h),h;let f=u??[],g=new Map;for(let e of f)g.set(e.competence_id,e);let x=new Set;p.forEach(e=>x.add(e.competence_id)),f.forEach(e=>x.add(e.competence_id));let v=new Map;if(x.size>0){let{data:e,error:a}=await t.supabase.from("competences").select("id, name, description, code, group_id, is_safety_critical").in("id",Array.from(x));if(a)throw console.error(a),a;let r=e??[],i=new Set;r.forEach(e=>{e.group_id&&i.add(e.group_id)});let n=new Map;if(i.size>0){let{data:e,error:a}=await t.supabase.from("competence_groups").select("id, name").in("id",Array.from(i));a?console.error(a):(e??[]).forEach(e=>{n.set(e.id,e.name)})}r.forEach(e=>{v.set(e.id,{...e,groupName:e.group_id?n.get(e.group_id)??null:null})})}let y=[],_=0,j=0,N=0,b=new Set;for(let e of p){let t=v.get(e.competence_id);if(!t)continue;let a=g.get(e.competence_id)??null,i="N/A",n=null,o=a?a.level:null,l=a?.valid_to??null;e.mandatory?(_+=1,a?(r=l)&&r<s?(i="RISK",n="Utgången giltighet",j+=1,N+=1):o<e.required_level?(o>=e.required_level-1?(i="GAP",n="En nivå under krav"):(i="RISK",n="För låg nivå"),j+=1):i="OK":(i="RISK",n="Saknar kompetens",j+=1)):i=a?"OK":"N/A",y.push({competenceId:t.id,competenceName:t.name,competenceCode:t.code??null,groupName:t.groupName,requiredLevel:e.required_level,mandatory:e.mandatory,employeeLevel:o,validTo:l,status:i,riskReason:n,isSafetyCritical:t.is_safety_critical}),b.add(t.id)}for(let e of f){if(b.has(e.competence_id))continue;let t=v.get(e.competence_id);t&&y.push({competenceId:t.id,competenceName:t.name,competenceCode:t.code??null,groupName:t.groupName,requiredLevel:null,mandatory:!1,employeeLevel:e.level,validTo:e.valid_to,status:(i=e.valid_to)&&i<s?"RISK":"N/A",riskReason:(n=e.valid_to)&&n<s?"Utgången giltighet":null,isSafetyCritical:t.is_safety_critical})}let k=0===_?100:Math.round((_-j)/_*100),w="LOW";return w=0===j?"LOW":j<=2?"MEDIUM":"HIGH",y.sort((e,t)=>{let a=e.groupName??"",r=t.groupName??"";return a!==r?a.localeCompare(r):e.competenceName.localeCompare(t.competenceName)}),{employee:{id:o.id,name:c,positionName:d},summary:{riskLevel:w,gapCount:j,totalRequired:_,coveragePercent:k,expiredCount:N},items:y}}async function n(e){let a=[],n=await t.supabase.from("positions").select("id, name, site, department, min_headcount").gt("min_headcount",0);if(n.error){if("42703"===n.error.code||n.error.message?.includes("min_headcount"))return console.warn("min_headcount column not found, returning empty positions list"),[];throw n.error}a=(n.data??[]).map(e=>({id:e.id,name:e.name,site:e.site??null,department:e.department??null,minHeadcount:e.min_headcount}));let s=[];for(let t of a){let a=await r(t.id);if(0===a.length){s.push({positionId:t.id,positionName:t.name,site:t.site,department:t.department,minHeadcount:t.minHeadcount,availableCount:0,gap:t.minHeadcount,riskLevel:"HIGH"});continue}let n=0;for(let t of a)0===(await i(t.id,e)).summary.gapCount&&(n+=1);let o=Math.max(0,t.minHeadcount-n),l="LOW";l=o>0&&0===n?"HIGH":o>0?"MEDIUM":"LOW",s.push({positionId:t.id,positionName:t.name,site:t.site,department:t.department,minHeadcount:t.minHeadcount,availableCount:n,gap:o,riskLevel:l})}let o={HIGH:0,MEDIUM:1,LOW:2};return s.sort((e,t)=>{let a=o[e.riskLevel]-o[t.riskLevel];return 0!==a?a:e.positionName.localeCompare(t.positionName)}),s}e.s(["getAllPositions",()=>a,"getEmployeeCompetenceProfile",()=>i,"getEmployeesForPosition",()=>r,"getPositionCoverageForDate",()=>n])},32612,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(18566),i=e.i(85773),n=e.i(66685);function s({params:e}){let{loading:a}=(0,n.useAuthGuard)();return a?(0,t.jsx)("main",{className:"hr-page",children:(0,t.jsx)("p",{children:"Checking access..."})}):(0,t.jsx)(o,{params:e})}function o({params:e}){let n=e.id,s=(0,r.useRouter)(),[o,d]=(0,a.useState)(null),[m,p]=(0,a.useState)(!0),[u,h]=(0,a.useState)(null),[f,g]=(0,a.useState)(null);return(0,a.useEffect)(()=>{!async function(){try{let e=await (0,i.getEmployeeCompetenceProfile)(n);d(e)}catch(e){console.error(e),h("Kunde inte ladda kompetensprofil.")}finally{p(!1)}}()},[n]),(0,t.jsxs)("main",{className:"hr-page",children:[(0,t.jsx)("button",{className:"hr-link",onClick:()=>s.back(),children:"← Tillbaka"}),m&&(0,t.jsx)("p",{children:"Laddar kompetensprofil…"}),u&&(0,t.jsx)("p",{className:"hr-error",children:u}),!m&&!u&&o&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("header",{className:"hr-emp-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"hr-page__title",children:o.employee.name}),(0,t.jsx)("p",{className:"hr-page__subtitle",children:o.employee.positionName?o.employee.positionName:"Ingen position kopplad ännu"})]}),(0,t.jsx)("div",{className:"hr-emp-header__badge",children:(0,t.jsxs)("span",{className:`hr-risk-pill hr-risk-pill--${o.summary.riskLevel.toLowerCase()}`,children:["Risk: ",o.summary.riskLevel]})})]}),(0,t.jsxs)("section",{className:"hr-emp-summary-grid",children:[(0,t.jsx)(l,{label:"Obligatoriska kompetenser",value:o.summary.totalRequired}),(0,t.jsx)(l,{label:"Kompetens-gaps",value:o.summary.gapCount}),(0,t.jsx)(l,{label:"Täckningsgrad",value:`${o.summary.coveragePercent}%`}),(0,t.jsx)(l,{label:"Utgångna kompetenser",value:o.summary.expiredCount})]}),f&&(0,t.jsx)("p",{className:"hr-action-message",children:f}),(0,t.jsxs)("section",{className:"hr-competence-section",children:[(0,t.jsx)("h2",{className:"hr-section__title",children:"Kompetenser"}),(0,t.jsx)("p",{className:"hr-task-section__description",children:"Krav baserat på roll samt faktiska kompetenser per person."}),(0,t.jsx)("div",{className:"hr-competence-table-wrapper",children:(0,t.jsxs)("table",{className:"hr-competence-table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Grupp"}),(0,t.jsx)("th",{children:"Kompetens"}),(0,t.jsx)("th",{children:"Krav (nivå)"}),(0,t.jsx)("th",{children:"Har (nivå)"}),(0,t.jsx)("th",{children:"Giltig t.o.m."}),(0,t.jsx)("th",{children:"Status"}),(0,t.jsx)("th",{})]})}),(0,t.jsx)("tbody",{children:o.items.map(e=>(0,t.jsx)(c,{item:e,onTriggerAction:e=>g(e)},e.competenceId))})]})})]})]})]})}function l({label:e,value:a}){return(0,t.jsxs)("div",{className:"hr-emp-summary-card",children:[(0,t.jsx)("div",{className:"hr-emp-summary-label",children:e}),(0,t.jsx)("div",{className:"hr-emp-summary-value",children:a})]})}function c({item:e,onTriggerAction:a}){let r=e=>null==e?"-":e.toString(),i="OK"===e.status?"hr-status-badge--ok":"RISK"===e.status?"hr-status-badge--risk":"hr-status-badge--na",n=e.validTo?new Date(e.validTo).toLocaleDateString():"-",s="RISK"===e.status;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:e.groupName??"-"}),(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:"hr-competence-name",children:[e.competenceName,e.isSafetyCritical&&(0,t.jsx)("span",{className:"hr-competence-chip",children:"Safety"})]})}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"hr-level-chip",children:r(e.requiredLevel)})}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"hr-level-chip hr-level-chip--owned",children:r(e.employeeLevel)})}),(0,t.jsx)("td",{children:n}),(0,t.jsxs)("td",{children:[(0,t.jsx)("span",{className:`hr-status-badge ${i}`,children:e.status}),e.riskReason&&(0,t.jsx)("div",{className:"hr-status-reason",children:e.riskReason})]}),(0,t.jsx)("td",{children:s&&(0,t.jsx)("button",{type:"button",className:"hr-button hr-button--secondary hr-button--dense",onClick:function(){a(`\xc5tg\xe4rd beh\xf6vs f\xf6r kompetens "${e.competenceName}". (Koppla till utbildnings-workflow n\xe4r template \xe4r satt.)`)},children:"Åtgärda"})})]})}e.s(["default",()=>s])}]);