(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,43531,e=>{"use strict";let t=(0,e.i(75254).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],43531)},31278,e=>{"use strict";let t=(0,e.i(75254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},37727,e=>{"use strict";let t=(0,e.i(75254).default)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},3116,e=>{"use strict";let t=(0,e.i(75254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],3116)},63488,e=>{"use strict";let t=(0,e.i(75254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>t],63488)},71634,79002,98962,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(18566),a=e.i(68934);function i({children:e,requireAdmin:i=!1}){let{currentOrg:d,isLoading:l,memberships:n,isAdmin:o}=(0,a.useOrg)(),c=(0,s.useRouter)();return((0,r.useEffect)(()=>{if(!l){if(!d&&n.length>0||!d&&0===n.length)return void c.replace("/app/org/select");if(i&&!o)return void c.replace("/app")}},[d,l,n,o,i,c]),l)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)("div",{className:"animate-pulse text-muted-foreground",children:"Loading..."})}):d&&(!i||o)?(0,t.jsx)(t.Fragment,{children:e}):null}e.s(["OrgGuard",()=>i],71634);var d=e.i(75254);let l=(0,d.default)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);e.s(["UserPlus",()=>l],79002);let n=(0,d.default)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);e.s(["UserX",()=>n],98962)},13969,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(68934),a=e.i(71634),i=e.i(53210),d=e.i(61911),l=e.i(79002),n=e.i(98962),o=e.i(31278),c=e.i(63488),u=e.i(3116),m=e.i(43531),x=e.i(37727);function h(){let{currentOrg:e,isAdmin:a}=(0,s.useOrg)(),[h,p]=(0,r.useState)([]),[f,g]=(0,r.useState)([]),[b,y]=(0,r.useState)(!0),[v,j]=(0,r.useState)(null),[N,k]=(0,r.useState)(!1),[w,S]=(0,r.useState)(""),[_,C]=(0,r.useState)("user"),[U,A]=(0,r.useState)(!1),[M,O]=(0,r.useState)(null),F=(0,r.useCallback)(async()=>{if(e){y(!0),j(null);try{let{data:t,error:r}=await i.supabase.from("memberships").select(`
          user_id,
          role,
          status,
          created_at,
          profile:profiles(email)
        `).eq("org_id",e.id);if(r)console.error("Error fetching members:",r),j("Failed to load members");else{let e=(t||[]).map(e=>({...e,profile:Array.isArray(e.profile)?e.profile[0]:e.profile||void 0}));p(e)}let{data:s,error:a}=await i.supabase.from("invites").select("*").eq("org_id",e.id).is("accepted_at",null).gt("expires_at",new Date().toISOString());a?console.error("Error fetching invites:",a):g(s||[])}catch(e){console.error("Fetch error:",e),j("Failed to load data")}finally{y(!1)}}},[e]);(0,r.useEffect)(()=>{F()},[F]);let P=async t=>{if(t.preventDefault(),e){A(!0),j(null);try{let{data:{session:t}}=await i.supabase.auth.getSession();if(!t?.access_token){j("Not authenticated"),A(!1);return}let r=await fetch("/api/admin/invite",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`},body:JSON.stringify({orgId:e.id,email:w,role:_})}),s=await r.json();if(!r.ok){j(s.error||"Failed to send invite"),A(!1);return}S(""),C("user"),k(!1),await F()}catch(e){console.error("Invite error:",e),j("Failed to send invite")}finally{A(!1)}}},T=async(t,r)=>{if(e){O(t),j(null);try{let{data:{session:s}}=await i.supabase.auth.getSession();if(!s?.access_token){j("Not authenticated"),O(null);return}let a=await fetch("/api/admin/membership/role",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({orgId:e.id,userId:t,role:r})}),d=await a.json();if(!a.ok){j(d.error||"Failed to update role"),O(null);return}await F()}catch(e){console.error("Role change error:",e),j("Failed to update role")}finally{O(null)}}},I=async t=>{if(e&&confirm("Are you sure you want to disable this user?")){j(null);try{let{data:{session:r}}=await i.supabase.auth.getSession();if(!r?.access_token)return void j("Not authenticated");let s=await fetch("/api/admin/membership/disable",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`},body:JSON.stringify({orgId:e.id,userId:t})}),a=await s.json();if(!s.ok)return void j(a.error||"Failed to disable user");await F()}catch(e){console.error("Disable error:",e),j("Failed to disable user")}}},L=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return b?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsx)(o.Loader2,{className:"w-6 h-6 animate-spin text-muted-foreground"})}):(0,t.jsxs)("div",{className:"p-6 max-w-6xl mx-auto space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold text-foreground","data-testid":"text-page-title",children:"User Management"}),(0,t.jsxs)("p",{className:"text-muted-foreground mt-1",children:["Manage members and invites for ",e?.name]})]}),a&&(0,t.jsxs)("button",{onClick:()=>k(!N),className:"px-4 py-2 rounded-md bg-primary text-primary-foreground flex items-center gap-2 hover-elevate","data-testid":"button-invite-user",children:[(0,t.jsx)(l.UserPlus,{className:"w-4 h-4"}),"Invite User"]})]}),v&&(0,t.jsx)("div",{className:"p-4 rounded-md bg-destructive/10 text-destructive","data-testid":"text-error",children:v}),N&&(0,t.jsx)("div",{className:"p-4 rounded-lg border border-border bg-card",children:(0,t.jsxs)("form",{onSubmit:P,className:"flex flex-wrap gap-4 items-end",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-[200px]",children:[(0,t.jsx)("label",{htmlFor:"invite-email",className:"block text-sm font-medium text-foreground mb-1",children:"Email Address"}),(0,t.jsx)("input",{id:"invite-email",type:"email",value:w,onChange:e=>S(e.target.value),placeholder:"user@example.com",className:"w-full px-3 py-2 rounded-md border border-input bg-background text-foreground",required:!0,"data-testid":"input-invite-email"})]}),(0,t.jsxs)("div",{className:"w-40",children:[(0,t.jsx)("label",{htmlFor:"invite-role",className:"block text-sm font-medium text-foreground mb-1",children:"Role"}),(0,t.jsxs)("select",{id:"invite-role",value:_,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 rounded-md border border-input bg-background text-foreground","data-testid":"select-invite-role",children:[(0,t.jsx)("option",{value:"user",children:"User"}),(0,t.jsx)("option",{value:"manager",children:"Manager"}),(0,t.jsx)("option",{value:"hr",children:"HR"}),(0,t.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>k(!1),className:"px-4 py-2 rounded-md border border-border text-foreground hover-elevate","data-testid":"button-cancel-invite",children:"Cancel"}),(0,t.jsxs)("button",{type:"submit",disabled:U,className:"px-4 py-2 rounded-md bg-primary text-primary-foreground hover-elevate disabled:opacity-50 flex items-center gap-2","data-testid":"button-send-invite",children:[U?(0,t.jsx)(o.Loader2,{className:"w-4 h-4 animate-spin"}):(0,t.jsx)(c.Mail,{className:"w-4 h-4"}),"Send Invite"]})]})]})}),f.length>0&&(0,t.jsxs)("div",{className:"rounded-lg border border-border bg-card",children:[(0,t.jsx)("div",{className:"p-4 border-b border-border",children:(0,t.jsxs)("h2",{className:"font-medium text-foreground flex items-center gap-2",children:[(0,t.jsx)(u.Clock,{className:"w-4 h-4"}),"Pending Invites (",f.length,")"]})}),(0,t.jsx)("div",{className:"divide-y divide-border",children:f.map(e=>(0,t.jsxs)("div",{className:"p-4 flex items-center justify-between","data-testid":`row-invite-${e.id}`,children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-foreground",children:e.email}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Invited as ",e.role," - Expires ",L(e.expires_at)]})]}),(0,t.jsx)("span",{className:"px-2 py-1 rounded text-xs bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200",children:"Pending"})]},e.id))})]}),(0,t.jsxs)("div",{className:"rounded-lg border border-border bg-card",children:[(0,t.jsx)("div",{className:"p-4 border-b border-border",children:(0,t.jsxs)("h2",{className:"font-medium text-foreground flex items-center gap-2",children:[(0,t.jsx)(d.Users,{className:"w-4 h-4"}),"Members (",h.filter(e=>"active"===e.status).length,")"]})}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b border-border bg-muted/50",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Email"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Role"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Status"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Joined"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"Actions"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-border",children:h.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-muted/30","data-testid":`row-member-${e.user_id}`,children:[(0,t.jsx)("td",{className:"px-4 py-3 text-foreground",children:e.profile?.email||"Unknown"}),(0,t.jsx)("td",{className:"px-4 py-3",children:a&&M!==e.user_id?(0,t.jsxs)("select",{value:e.role,onChange:t=>T(e.user_id,t.target.value),className:"px-2 py-1 rounded border border-input bg-background text-foreground text-sm","data-testid":`select-role-${e.user_id}`,children:[(0,t.jsx)("option",{value:"user",children:"User"}),(0,t.jsx)("option",{value:"manager",children:"Manager"}),(0,t.jsx)("option",{value:"hr",children:"HR"}),(0,t.jsx)("option",{value:"admin",children:"Admin"})]}):M===e.user_id?(0,t.jsx)(o.Loader2,{className:"w-4 h-4 animate-spin text-muted-foreground"}):(0,t.jsx)("span",{className:"capitalize",children:e.role})}),(0,t.jsx)("td",{className:"px-4 py-3",children:"active"===e.status?(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[(0,t.jsx)(m.Check,{className:"w-3 h-3"}),"Active"]}):(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[(0,t.jsx)(x.X,{className:"w-3 h-3"}),"Disabled"]})}),(0,t.jsx)("td",{className:"px-4 py-3 text-muted-foreground text-sm",children:L(e.created_at)}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:a&&"active"===e.status&&(0,t.jsx)("button",{onClick:()=>I(e.user_id),className:"p-2 rounded hover-elevate text-muted-foreground hover:text-destructive",title:"Disable user","data-testid":`button-disable-${e.user_id}`,children:(0,t.jsx)(n.UserX,{className:"w-4 h-4"})})})]},e.user_id))})]})})]})]})}function p(){return(0,t.jsx)(a.OrgGuard,{requireAdmin:!0,children:(0,t.jsx)(h,{})})}e.s(["default",()=>p])}]);